[{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\ApplyLeaveForm.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'existingLeaves' is assigned a value but never used.","line":58,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":71,"suggestions":[{"messageId":"removeVar","data":{"varName":"existingLeaves"},"fix":{"range":[1376,1397],"text":""},"desc":"Remove unused variable 'existingLeaves'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'dStr' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":296,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":296,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"dStr"},"fix":{"range":[9784,9830],"text":""},"desc":"Remove unused variable 'dStr'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport api from '../utils/api';\r\nimport { showToast } from '../utils/uiNotifications';\r\nimport {\r\n    Calendar as CalendarIcon,\r\n    AlertCircle,\r\n    CheckCircle,\r\n    Clock,\r\n    ChevronLeft,\r\n    ChevronRight,\r\n    Info,\r\n    Lock,\r\n    ArrowLeft\r\n} from 'lucide-react';\r\nimport { formatDateDDMMYYYY } from '../utils/dateUtils';\r\n\r\n// --- Static configs for fallback if no category/color provided ---\r\nconst FALLBACK_CONFIG = {\r\n    bg: 'bg-blue-50',\r\n    border: 'border-blue-200',\r\n    text: 'text-blue-700',\r\n    main: '#3b82f6',\r\n    light: '#dbeafe',\r\n    active: 'bg-blue-600'\r\n};\r\n\r\nconst LOP_CONFIG = {\r\n    id: 'LOP',\r\n    label: 'Unpaid / Personal',\r\n    bg: 'bg-rose-50',\r\n    border: 'border-rose-200',\r\n    text: 'text-rose-700',\r\n    main: '#ef4444',\r\n    light: '#fee2e2',\r\n    active: 'bg-rose-600'\r\n};\r\n\r\nconst HOLIDAY_ICONS = {\r\n    diwali: 'ü™î',\r\n    christmas: 'üéÑ',\r\n    holidays: 'üéâ',\r\n    independence: 'üáÆüá≥',\r\n    republic: 'üáÆüá≥',\r\n    gandhi: 'üëì',\r\n    eid: 'üåô',\r\n    holi: 'üé®',\r\n    default: 'üéâ'\r\n};\r\n\r\nconst getHolidayIcon = (name = '') => {\r\n    const n = name.toLowerCase();\r\n    for (const key in HOLIDAY_ICONS) {\r\n        if (n.includes(key)) return HOLIDAY_ICONS[key];\r\n    }\r\n    return HOLIDAY_ICONS.default;\r\n};\r\n\r\nexport default function ApplyLeaveForm({ balances = [], existingLeaves = [], editData = null, isHR = false, targetEmployeeId = null, onCancelEdit, onSuccess, onClose }) {\r\n    const [form, setForm] = useState({\r\n        leaveType: '',\r\n        startDate: '',\r\n        endDate: '',\r\n        reason: '',\r\n        isHalfDay: false,\r\n        halfDayTarget: 'Start', // 'Start' or 'End'\r\n        halfDaySession: 'First Half',\r\n        employeeId: targetEmployeeId || ''\r\n    });\r\n\r\n    const [approvedRanges, setApprovedRanges] = useState([]);\r\n\r\n    const [employees, setEmployees] = useState([]); // For HR to select employee\r\n    const [internalBalances, setInternalBalances] = useState([]);\r\n\r\n    // Fetch Balances Effect\r\n    useEffect(() => {\r\n        const fetchBalances = async () => {\r\n            const empId = isHR ? (targetEmployeeId || form.employeeId) : null;\r\n            if (!empId && isHR) return;\r\n\r\n            try {\r\n                const endpoint = isHR ? `/hr/leaves/balances/${empId}` : '/employee/leaves/balances';\r\n                const res = await api.get(endpoint);\r\n                const balanceData = res.data?.balances || (Array.isArray(res.data) ? res.data : []);\r\n                setInternalBalances(balanceData);\r\n            } catch (err) {\r\n                console.error(\"Failed to fetch balances\", err);\r\n            }\r\n        };\r\n\r\n        if (isHR && (targetEmployeeId || form.employeeId)) {\r\n            fetchBalances();\r\n        } else if (!isHR && balances.length === 0) {\r\n            fetchBalances();\r\n        }\r\n    }, [isHR, targetEmployeeId, form.employeeId, balances.length]);\r\n\r\n    // Use internalBalances if balances prop is empty\r\n    const effectiveBalances = useMemo(() => {\r\n        return balances && balances.length > 0 ? balances : internalBalances;\r\n    }, [balances, internalBalances]);\r\n\r\n    // Generate dynamic LEAVE_CONFIG from effectiveBalances\r\n    const dynamicLeaveConfig = useMemo(() => {\r\n        const config = {};\r\n        effectiveBalances.forEach(b => {\r\n            const mainColor = b.color || '#3b82f6';\r\n            config[b.leaveType] = {\r\n                id: b.leaveType,\r\n                label: b.leaveType,\r\n                main: mainColor,\r\n                light: `${mainColor}20`, // 20% opacity\r\n                bg: 'bg-white',\r\n                border: 'border-slate-200',\r\n                text: 'text-slate-700'\r\n            };\r\n        });\r\n        // Always add Unpaid/Personal Leave\r\n        config['Personal Leave'] = LOP_CONFIG;\r\n        return config;\r\n    }, [effectiveBalances]);\r\n\r\n    const [currentCalDate, setCurrentCalDate] = useState(new Date());\r\n    const [duration, setDuration] = useState(0);\r\n    const [error, setError] = useState(null);\r\n    const [infoMessage, setInfoMessage] = useState(null);\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [holidays, setHolidays] = useState([]);\r\n    const [hoverDate, setHoverDate] = useState(null);\r\n    const [settings, setSettings] = useState({});\r\n\r\n    // Fetch Settings\r\n    useEffect(() => {\r\n        const fetchSettings = async () => {\r\n            try {\r\n                const res = await api.get('/attendance/settings');\r\n                setSettings(res.data || {});\r\n            } catch (err) {\r\n                console.error(\"Failed to fetch settings\", err);\r\n            }\r\n        };\r\n        fetchSettings();\r\n    }, []);\r\n\r\n    // Fetch Employees if HR\r\n    useEffect(() => {\r\n        if (isHR && !targetEmployeeId) {\r\n            const fetchEmployees = async () => {\r\n                try {\r\n                    const res = await api.get('/hr/employees');\r\n                    setEmployees(res.data.data || []);\r\n                } catch (err) {\r\n                    console.error(\"Failed to fetch employees\", err);\r\n                }\r\n            };\r\n            fetchEmployees();\r\n        }\r\n    }, [isHR, targetEmployeeId]);\r\n\r\n\r\n\r\n    // Fetch Holidays\r\n    useEffect(() => {\r\n        const fetchHolidays = async () => {\r\n            try {\r\n                const res = await api.get('/holidays');\r\n                setHolidays(res.data || []);\r\n            } catch (err) {\r\n                console.error(\"Failed to fetch holidays\", err);\r\n            }\r\n        };\r\n        fetchHolidays();\r\n    }, []);\r\n\r\n    // Fetch Approved Date Ranges (to disable them in calendar)\r\n    useEffect(() => {\r\n        const fetchApprovedDates = async () => {\r\n            if (isHR) return; // HR might need to override, but usually we focus on employee self-service first\r\n            try {\r\n                const res = await api.get('/employee/leaves/approved-dates');\r\n                setApprovedRanges(res.data || []);\r\n            } catch (err) {\r\n                console.error(\"Failed to fetch approved dates\", err);\r\n            }\r\n        };\r\n        fetchApprovedDates();\r\n    }, [isHR]);\r\n\r\n    // Populate form if editing\r\n    useEffect(() => {\r\n        if (editData) {\r\n            setForm({\r\n                leaveType: editData.leaveType,\r\n                startDate: editData.startDate.split('T')[0],\r\n                endDate: editData.endDate.split('T')[0],\r\n                reason: editData.reason,\r\n                isHalfDay: editData.isHalfDay || false,\r\n                halfDayTarget: editData.halfDayTarget || 'Start',\r\n                halfDaySession: editData.halfDaySession || 'First Half'\r\n            });\r\n            setCurrentCalDate(new Date(editData.startDate));\r\n        }\r\n    }, [editData]);\r\n\r\n    const holidayMap = useMemo(() => {\r\n        const map = {};\r\n        holidays.forEach(h => {\r\n            const dStr = new Date(h.date).toISOString().split('T')[0];\r\n            map[dStr] = h;\r\n        });\r\n        return map;\r\n    }, [holidays]);\r\n\r\n    const isDateSelectable = (dateStr) => {\r\n        if (!dateStr) return false;\r\n\r\n        const [y, m, dPart] = dateStr.split('-').map(Number);\r\n        const d = new Date(y, m - 1, dPart);\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n\r\n        const weeklyOffDays = settings.weeklyOffDays || [0];\r\n\r\n        // 1. Future Dates Only\r\n        if (d < today) return false;\r\n\r\n        // 2. No Weekly Offs\r\n        if (weeklyOffDays.includes(d.getDay())) return false;\r\n\r\n        // 3. No Holidays\r\n        if (holidayMap[dateStr]) return false;\r\n\r\n        // 4. No Approved Leaves (Locking)\r\n        const date = new Date(dateStr);\r\n        date.setHours(0, 0, 0, 0);\r\n        const hasApprovedOverlap = approvedRanges.some(range => {\r\n            const start = new Date(range.startDate);\r\n            const end = new Date(range.endDate);\r\n            start.setHours(0, 0, 0, 0);\r\n            end.setHours(0, 0, 0, 0);\r\n            return date >= start && date <= end;\r\n        });\r\n\r\n        if (hasApprovedOverlap) return false;\r\n\r\n        return true;\r\n    };\r\n\r\n    const getDisabledReason = (dateStr) => {\r\n        if (!dateStr) return null;\r\n        const [y, m, dPart] = dateStr.split('-').map(Number);\r\n        const d = new Date(y, m - 1, dPart);\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n\r\n        const weeklyOffDays = settings.weeklyOffDays || [0];\r\n\r\n        if (d < today) return \"Past dates are locked\";\r\n        if (weeklyOffDays.includes(d.getDay())) return \"Selection blocked on Weekly Offs\";\r\n        if (holidayMap[dateStr]) return `Holiday: ${holidayMap[dateStr].name}`;\r\n\r\n        // Check Approved Ranges for Tooltip\r\n        const dObj = new Date(dateStr);\r\n        dObj.setHours(0, 0, 0, 0);\r\n        const hasApprovedOverlap = approvedRanges.some(range => {\r\n            const start = new Date(range.startDate);\r\n            const end = new Date(range.endDate);\r\n            start.setHours(0, 0, 0, 0);\r\n            end.setHours(0, 0, 0, 0);\r\n            return dObj >= start && dObj <= end;\r\n        });\r\n        if (hasApprovedOverlap) return \"Date already approved for leave\";\r\n\r\n        return null;\r\n    };\r\n\r\n    // Validation\r\n    useEffect(() => {\r\n        setError(null);\r\n        setDuration(0);\r\n        setInfoMessage(null);\r\n\r\n        if (!form.startDate) return;\r\n\r\n        const start = new Date(form.startDate);\r\n        const end = new Date(form.endDate || form.startDate);\r\n\r\n        if (end < start) {\r\n            setError('To Date cannot be earlier than From Date.');\r\n            return;\r\n        }\r\n\r\n        let count = 0;\r\n        let loop = new Date(start);\r\n        while (loop <= end) {\r\n            const dStr = loop.toISOString().split('T')[0];\r\n\r\n            // Sandwich Rule: Count ALL days in the range, including Sundays and Holidays.\r\n            // If the user selects Sat to Mon, it should count Sat, Sun, Mon = 3 Days.\r\n            count++;\r\n            loop.setDate(loop.getDate() + 1);\r\n        }\r\n\r\n        if (form.isHalfDay && count > 0) count -= 0.5;\r\n\r\n        if (count <= 0) {\r\n            setError('Range contains no working days.');\r\n            return;\r\n        }\r\n\r\n        setDuration(count);\r\n\r\n        if (form.leaveType) {\r\n            const bal = balances.find(b => b.leaveType === form.leaveType);\r\n            const rawAvailable = bal ? (bal.total - bal.used - bal.pending) : 0;\r\n            const currentlyBlocked = (editData && editData.leaveType === form.leaveType) ? editData.daysCount : 0;\r\n            const availableToThisAction = rawAvailable + currentlyBlocked;\r\n\r\n            if (count > availableToThisAction) {\r\n                // Allow submission but warn about LOP\r\n                setInfoMessage(`Note: You have ${availableToThisAction} ${form.leaveType} balance. Remaining ${count - availableToThisAction} days will be marked as Unpaid / Loss of Pay.`);\r\n            }\r\n        }\r\n\r\n        // 5. Final Block: Overlap with Approved Ranges\r\n        const startObj = new Date(form.startDate);\r\n        const endObj = new Date(form.endDate || form.startDate);\r\n        startObj.setHours(0, 0, 0, 0);\r\n        endObj.setHours(0, 0, 0, 0);\r\n\r\n        const overlapsWithApproved = approvedRanges.some(range => {\r\n            const rStart = new Date(range.startDate);\r\n            const rEnd = new Date(range.endDate);\r\n            rStart.setHours(0, 0, 0, 0);\r\n            rEnd.setHours(0, 0, 0, 0);\r\n            return (startObj <= rEnd && endObj >= rStart);\r\n        });\r\n\r\n        if (overlapsWithApproved) {\r\n            setError('The selected dates overlap with an already approved leave.');\r\n        }\r\n    }, [form.startDate, form.endDate, form.leaveType, form.isHalfDay, holidayMap, balances, editData, approvedRanges]);\r\n\r\n    // Calendar Grid\r\n    const calendarArray = useMemo(() => {\r\n        const month = currentCalDate.getMonth();\r\n        const year = currentCalDate.getFullYear();\r\n        const firstDay = new Date(year, month, 1).getDay();\r\n        const lastDate = new Date(year, month + 1, 0).getDate();\r\n\r\n        const arr = [];\r\n        for (let i = 0; i < firstDay; i++) arr.push(null);\r\n        for (let d = 1; d <= lastDate; d++) {\r\n            // Generates YYYY-MM-DD\r\n            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;\r\n            arr.push(dateStr);\r\n        }\r\n        return arr;\r\n    }, [currentCalDate]);\r\n\r\n    const handleDateClick = (dateStr) => {\r\n        if (!isDateSelectable(dateStr)) return;\r\n\r\n        if (!form.startDate || (form.startDate && form.endDate)) {\r\n            setForm(prev => ({ ...prev, startDate: dateStr, endDate: '', isHalfDay: false }));\r\n        } else {\r\n            if (new Date(dateStr) < new Date(form.startDate)) {\r\n                setForm(prev => ({ ...prev, startDate: dateStr, endDate: '', isHalfDay: false }));\r\n            } else {\r\n                setForm(prev => ({ ...prev, endDate: dateStr }));\r\n            }\r\n        }\r\n    };\r\n\r\n    const isInRange = (dateStr) => {\r\n        if (!form.startDate) return false;\r\n        if (dateStr === form.startDate) return true;\r\n        if (form.endDate && dateStr >= form.startDate && dateStr <= form.endDate) return true;\r\n        return false;\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (error || isSubmitting || !form.leaveType || duration <= 0) return;\r\n\r\n        try {\r\n            setIsSubmitting(true);\r\n            const payload = { ...form, daysCount: duration };\r\n            if (editData) {\r\n                await api.put(`/employee/leaves/edit/${editData._id}`, payload);\r\n                showToast('success', 'Success', 'Request Updated.');\r\n            } else {\r\n                await api.post('/employee/leaves/apply', payload);\r\n                showToast('success', 'Success', 'Leave Applied.');\r\n            }\r\n            onSuccess();\r\n        } catch (err) {\r\n            showToast('error', 'Error', err.response?.data?.error || \"Failed\");\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-slate-900 p-8 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-2xl transition-all\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between mb-8\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    {onClose && (\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-3 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition text-slate-500\"\r\n                            title=\"Go Back\"\r\n                        >\r\n                            <ArrowLeft size={24} />\r\n                        </button>\r\n                    )}\r\n                    <div className=\"p-3 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-xl\">\r\n                        <CalendarIcon size={24} />\r\n                    </div>\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-black text-slate-800 dark:text-white leading-tight\">\r\n                            {editData ? 'Edit Request' : 'Time Off'}\r\n                        </h2>\r\n                        <p className=\"text-xs font-bold text-slate-400 uppercase tracking-widest mt-1\">Leave Application Form</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"hidden lg:block bg-blue-50 dark:bg-blue-900/10 p-3 rounded-xl border border-blue-100 dark:border-blue-800/50 max-w-xs transition-all hover:shadow-sm\">\r\n                    <p className=\"text-[10px] font-bold text-blue-600 dark:text-blue-400 leading-relaxed text-center\">\r\n                        ‚ÄúSelect the start and end dates of your leave. You may optionally apply a half-day on the first or last day. The system will calculate the total leave automatically.‚Äù\r\n                    </p>\r\n                </div>\r\n                {editData && (\r\n                    <button onClick={onCancelEdit} className=\"text-xs font-black text-rose-500 hover:text-rose-600 uppercase tracking-tighter border-b-2 border-rose-100 dark:border-rose-900/30\">Cancel Edit</button>\r\n                )}\r\n            </div>\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-8\">\r\n                {/* Employee Selection (HR only) */}\r\n                {isHR && !targetEmployeeId && (\r\n                    <div>\r\n                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 block px-1\">Select Employee</label>\r\n                        <select\r\n                            required\r\n                            className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-2xl p-4 text-sm focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all dark:text-white\"\r\n                            value={form.employeeId}\r\n                            onChange={e => setForm({ ...form, employeeId: e.target.value })}\r\n                        >\r\n                            <option value=\"\">-- Choose Employee --</option>\r\n                            {employees.map(emp => (\r\n                                <option key={emp._id} value={emp._id}>{emp.firstName} {emp.lastName} ({emp.employeeId})</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Leave Type Grid */}\r\n                <div>\r\n                    <div className=\"flex items-center justify-between mb-4 px-1\">\r\n                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Select Category</label>\r\n                        {form.leaveType && (\r\n                            <span className=\"text-[10px] font-bold bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded text-slate-500\">\r\n                                {form.leaveType === 'Personal Leave' ? 'UNPAID / LOP' : `BAL: ${balances.find(b => b.leaveType === form.leaveType)?.available || 0}`}\r\n                            </span>\r\n                        )}\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-3\">\r\n                        {Object.entries(dynamicLeaveConfig).map(([key, config]) => (\r\n                            <button\r\n                                key={key}\r\n                                type=\"button\"\r\n                                onClick={() => setForm(prev => ({ ...prev, leaveType: key }))}\r\n                                className={`flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all ${form.leaveType === key\r\n                                    ? `shadow-lg scale-105 ring-2 ring-blue-500/10`\r\n                                    : 'bg-white dark:bg-slate-900 border-slate-100 dark:border-slate-800 hover:border-slate-200'\r\n                                    }`}\r\n                                style={form.leaveType === key ? { borderColor: config.main, backgroundColor: config.light || '#f8fafc' } : {}}\r\n                            >\r\n                                <div className=\"h-3 w-3 rounded-full mb-1\" style={{ backgroundColor: config.main }}></div>\r\n                                <span className={`text-[10px] font-black uppercase text-center ${form.leaveType === key ? 'text-slate-900 dark:text-white' : 'text-slate-500'}`}>\r\n                                    {key}\r\n                                </span>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                    {form.leaveType === 'Personal Leave' && (\r\n                        <p className=\"mt-3 text-[10px] font-bold text-rose-500 uppercase bg-rose-50 dark:bg-rose-900/20 p-2 rounded-lg border border-rose-100 dark:border-rose-900/30\">\r\n                            Note: This leave will be treated as unpaid personal leave.\r\n                        </p>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Calendar View */}\r\n                <div className=\"bg-slate-50 dark:bg-slate-950/50 p-6 rounded-3xl border border-slate-100 dark:border-slate-800\">\r\n                    <div className=\"flex items-center justify-between mb-6\">\r\n                        <h4 className=\"font-black text-slate-800 dark:text-white uppercase tracking-tighter\">\r\n                            {currentCalDate.toLocaleString('default', { month: 'long', year: 'numeric' })}\r\n                        </h4>\r\n                        <div className=\"flex gap-2\">\r\n                            <button type=\"button\" onClick={() => setCurrentCalDate(new Date(currentCalDate.setMonth(currentCalDate.getMonth() - 1)))} className=\"p-2 hover:bg-white dark:hover:bg-slate-800 rounded-full transition shadow-sm\"><ChevronLeft size={20} /></button>\r\n                            <button type=\"button\" onClick={() => setCurrentCalDate(new Date(currentCalDate.setMonth(currentCalDate.getMonth() + 1)))} className=\"p-2 hover:bg-white dark:hover:bg-slate-800 rounded-full transition shadow-sm\"><ChevronRight size={20} /></button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-7 gap-1\">\r\n                        {['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'].map(day => (\r\n                            <div key={day} className=\"text-center py-2 text-[10px] font-black text-slate-400 uppercase\">{day}</div>\r\n                        ))}\r\n                        {calendarArray.map((d, i) => {\r\n                            if (!d) return <div key={`empty-${i}`} className=\"p-1\"></div>;\r\n\r\n                            const selectable = isDateSelectable(d);\r\n                            const selected = isInRange(d);\r\n                            const holiday = holidayMap[d];\r\n\r\n                            // Visual index matches Day Of Week because we start with empty 'Su' slots if needed\r\n                            const dayOfWeek = i % 7;\r\n                            const sunday = dayOfWeek === 0;\r\n\r\n                            const isStart = d === form.startDate;\r\n                            const isEnd = d === form.endDate;\r\n\r\n                            const config = dynamicLeaveConfig[form.leaveType] || { main: '#334145', light: '#f1f5f9' };\r\n\r\n                            return (\r\n                                <div\r\n                                    key={d}\r\n                                    onMouseEnter={() => setHoverDate(d)}\r\n                                    onMouseLeave={() => setHoverDate(null)}\r\n                                    onClick={() => handleDateClick(d)}\r\n                                    className={`relative h-12 flex items-center justify-center rounded-xl text-sm transition-all\r\n                                        ${!selectable ? 'opacity-20 grayscale cursor-not-allowed' : 'cursor-pointer hover:bg-white dark:hover:bg-slate-800'}\r\n                                        ${sunday ? 'text-rose-500 font-bold' : ''}\r\n                                    `}\r\n                                    style={selected ? {\r\n                                        backgroundColor: (isStart || isEnd) ? config.main : config.light,\r\n                                        color: (isStart || isEnd) ? 'white' : (form.leaveType ? getComputedStyle(document.documentElement).getPropertyValue(`--leave-${config.id.toLowerCase()}-text`) || 'inherit' : 'inherit'),\r\n                                        fontWeight: 800\r\n                                    } : {}}\r\n                                >\r\n                                    {new Date(d).getDate()}\r\n\r\n                                    {holiday && (\r\n                                        <div className=\"absolute top-1 right-1 text-[8px]\" title={holiday.name}>{getHolidayIcon(holiday.name)}</div>\r\n                                    )}\r\n\r\n                                    {hoverDate === d && (getDisabledReason(d) || holiday) && (\r\n                                        <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 z-50 px-3 py-2 bg-slate-800 text-white text-[10px] rounded-lg shadow-xl pointer-events-none w-max max-w-[150px] animate-in fade-in zoom-in-95 duration-200\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                {holiday ? <Info size={10} className=\"text-blue-400\" /> : <Lock size={10} className=\"text-rose-400\" />}\r\n                                                <span className=\"font-bold\">{getDisabledReason(d) || holiday?.name}</span>\r\n                                            </div>\r\n                                            <div className=\"absolute top-full left-1/2 -translate-x-1/2 -mt-1\">\r\n                                                <div className=\"w-2 h-2 bg-slate-800 rotate-45\"></div>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n\r\n                </div>\r\n\r\n                {/* Range Info */}\r\n                {form.startDate && (\r\n                    <div className=\"flex flex-col md:flex-row items-center justify-between p-6 bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/30 rounded-3xl gap-4\">\r\n                        <div className=\"flex items-center gap-6\">\r\n                            <div>\r\n                                <p className=\"text-[10px] font-black text-blue-600 uppercase tracking-widest mb-1\">Period</p>\r\n                                <h5 className=\"text-sm font-black text-slate-800 dark:text-white\">\r\n                                    {formatDateDDMMYYYY(form.startDate)}\r\n                                    {form.endDate && ` ‚Äî ${formatDateDDMMYYYY(form.endDate)}`}\r\n                                </h5>\r\n                            </div>\r\n                            <div className=\"h-8 w-px bg-blue-200 dark:bg-blue-800\"></div>\r\n                            <div>\r\n                                <p className=\"text-[10px] font-black text-blue-600 uppercase tracking-widest mb-1\">Net Days</p>\r\n                                <h5 className=\"text-xl font-black text-blue-700 dark:text-blue-400\">{duration} <span className=\"text-[10px]\">DAYS</span></h5>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Half Day Variant */}\r\n                        {form.startDate && duration > 0 && (\r\n                            <div className=\"flex flex-col gap-3 bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm border border-blue-100 dark:border-blue-900/50 transition-all\">\r\n                                <label className=\"flex items-center gap-3 cursor-pointer group\">\r\n                                    <div className={`w-5 h-5 rounded-lg border-2 transition-all flex items-center justify-center ${form.isHalfDay ? 'bg-blue-600 border-blue-600' : 'bg-transparent border-slate-300 group-hover:border-blue-400'}`}>\r\n                                        {form.isHalfDay && <CheckCircle size={14} className=\"text-white\" />}\r\n                                    </div>\r\n                                    <input type=\"checkbox\" className=\"hidden\" checked={form.isHalfDay} onChange={e => setForm({ ...form, isHalfDay: e.target.checked, halfDayTarget: form.endDate ? 'End' : 'Start', halfDaySession: 'First Half' })} />\r\n                                    <span className=\"text-xs font-black text-slate-600 dark:text-slate-400 uppercase tracking-tighter\">Enable Half Day</span>\r\n                                </label>\r\n\r\n                                {form.isHalfDay && (\r\n                                    <div className=\"space-y-3 animate-in fade-in slide-in-from-top-2 duration-200\">\r\n                                        {/* If Range selection, choose WHICH day is half-day */}\r\n                                        {form.endDate && form.startDate !== form.endDate && (\r\n                                            <div className=\"flex gap-2\">\r\n                                                <button\r\n                                                    type=\"button\"\r\n                                                    onClick={() => setForm({ ...form, halfDayTarget: 'Start' })}\r\n                                                    className={`flex-1 py-1.5 text-[9px] font-black uppercase tracking-wider rounded-lg border transition-all ${form.halfDayTarget === 'Start'\r\n                                                        ? 'bg-blue-600 text-white border-blue-600 shadow-md shadow-blue-500/20'\r\n                                                        : 'bg-slate-50 text-slate-400 border-slate-200 hover:bg-slate-100'\r\n                                                        }`}\r\n                                                >\r\n                                                    On Start Day\r\n                                                </button>\r\n                                                <button\r\n                                                    type=\"button\"\r\n                                                    onClick={() => setForm({ ...form, halfDayTarget: 'End' })}\r\n                                                    className={`flex-1 py-1.5 text-[9px] font-black uppercase tracking-wider rounded-lg border transition-all ${form.halfDayTarget === 'End'\r\n                                                        ? 'bg-blue-600 text-white border-blue-600 shadow-md shadow-blue-500/20'\r\n                                                        : 'bg-slate-50 text-slate-400 border-slate-200 hover:bg-slate-100'\r\n                                                        }`}\r\n                                                >\r\n                                                    On End Day\r\n                                                </button>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        <div className=\"flex gap-2 p-1 bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-100 dark:border-slate-800\">\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={() => setForm({ ...form, halfDaySession: 'First Half' })}\r\n                                                className={`flex-1 py-1.5 text-[9px] font-bold uppercase tracking-wider rounded-lg transition-all ${form.halfDaySession === 'First Half'\r\n                                                    ? 'bg-white dark:bg-slate-800 text-blue-600 shadow-sm ring-1 ring-slate-200 dark:ring-slate-700'\r\n                                                    : 'text-slate-400 hover:text-slate-600'\r\n                                                    }`}\r\n                                            >\r\n                                                First Half\r\n                                            </button>\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={() => setForm({ ...form, halfDaySession: 'Second Half' })}\r\n                                                className={`flex-1 py-1.5 text-[9px] font-bold uppercase tracking-wider rounded-lg transition-all ${form.halfDaySession === 'Second Half'\r\n                                                    ? 'bg-white dark:bg-slate-800 text-blue-600 shadow-sm ring-1 ring-slate-200 dark:ring-slate-700'\r\n                                                    : 'text-slate-400 hover:text-slate-600'\r\n                                                    }`}\r\n                                            >\r\n                                                Second Half\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Alerts */}\r\n                {error && (\r\n                    <div className=\"flex items-center gap-4 p-5 bg-rose-50 dark:bg-rose-900/20 text-rose-700 dark:text-rose-400 rounded-2xl border border-rose-100 dark:border-rose-900/50 animate-pulse\">\r\n                        <AlertCircle size={20} />\r\n                        <p className=\"text-sm font-bold tracking-tight\">{error}</p>\r\n                    </div>\r\n                )}\r\n\r\n                {infoMessage && (\r\n                    <div className=\"flex items-center gap-4 p-5 bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400 rounded-2xl border border-amber-100 dark:border-amber-900/50\">\r\n                        <Info size={20} />\r\n                        <p className=\"text-sm font-bold tracking-tight\">{infoMessage}</p>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Reason */}\r\n                <div>\r\n                    <label className=\"flex items-center justify-between px-1 mb-2\">\r\n                        <span className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Reason / Justification</span>\r\n                        <span className=\"text-[10px] text-rose-500 font-bold uppercase\">Required</span>\r\n                    </label>\r\n                    <textarea\r\n                        required\r\n                        rows=\"3\"\r\n                        className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-2xl p-4 text-sm focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all dark:text-white resize-none\"\r\n                        placeholder=\"Why do you need this time off?...\"\r\n                        value={form.reason}\r\n                        onChange={e => setForm({ ...form, reason: e.target.value })}\r\n                    ></textarea>\r\n                </div>\r\n\r\n                {/* Submit */}\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={isSubmitting || !!error || duration <= 0 || !form.leaveType}\r\n                    className={`w-full py-5 rounded-2xl text-white font-black uppercase tracking-widest flex items-center justify-center gap-3 transition-all shadow-xl active:scale-95 disabled:grayscale disabled:opacity-50\r\n                        ${form.leaveType ? 'shadow-blue-500/20' : 'shadow-slate-500/20'}\r\n                    `}\r\n                    style={{ backgroundColor: form.leaveType ? dynamicLeaveConfig[form.leaveType]?.main : '#334155' }}\r\n                >\r\n                    {isSubmitting ? (\r\n                        <div className=\"h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                    ) : (\r\n                        <>\r\n                            <span>\r\n                                {!form.leaveType ? 'Select Leave Category' :\r\n                                    !form.startDate ? 'Select Dates' :\r\n                                        duration <= 0 ? 'Invalid Dates' :\r\n                                            editData ? 'Update Application' : 'Request Time Off'}\r\n                            </span>\r\n                            {(form.leaveType && duration > 0) && <CheckCircle size={20} />}\r\n                        </>\r\n                    )}\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\AssignSalaryModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":25,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"loading"},"fix":{"range":[735,742],"text":""},"desc":"Remove unused variable 'loading'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSalary'. Either include it or remove the dependency array.","line":67,"column":8,"nodeType":"ArrayExpression","endLine":67,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, loadSalary, targetId]","fix":{"range":[2214,2232],"text":"[isOpen, loadSalary, targetId]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback } from 'react';\r\nimport api from '../utils/api';\r\n\r\n/**\r\n * ============================================\r\n * ASSIGN SALARY MODAL (v9.0) - STABILIZED\r\n * ============================================\r\n * \r\n * CORE PRINCIPLES:\r\n * 1. HR enters ONLY CTC\r\n * 2. Backend is the SINGLE SOURCE OF TRUTH (v8.1 Engine)\r\n * 3. Supports Snapshot Loading and Live Calculation\r\n * 4. Strict Contract: { monthly, yearly }\r\n */\r\n\r\nexport default function AssignSalaryModal({\r\n    isOpen,\r\n    onClose,\r\n    applicant,\r\n    employee, // Added employee support\r\n    onSuccess\r\n}) {\r\n    const [ctcAnnual, setCtcAnnual] = useState('');\r\n    const [salaryData, setSalaryData] = useState(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const [calculating, setCalculating] = useState(false);\r\n    const [assigning, setAssigning] = useState(false);\r\n    const [error, setError] = useState(null);\r\n\r\n    const targetId = applicant?._id || employee?._id;\r\n    const targetType = applicant ? 'applicantId' : 'employeeId';\r\n\r\n    // Load existing salary snapshot or default preview\r\n    const loadSalary = useCallback(async () => {\r\n        if (!isOpen || !targetId) return;\r\n\r\n        try {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            // Fetch current state from backend\r\n            const res = await api.get(`/salary/current?${targetType}=${targetId}&annualCTC=${ctcAnnual || 0}`);\r\n\r\n            if (res.data.success) {\r\n                setSalaryData(res.data.data);\r\n                // Sync CTC input if from snapshot\r\n                if (res.data.source === 'SNAPSHOT') {\r\n                    setCtcAnnual(res.data.data.annualCTC || '');\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to load salary:', err);\r\n            setError('Failed to fetch salary information');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [isOpen, targetId, targetType, ctcAnnual]);\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            loadSalary();\r\n        } else {\r\n            setSalaryData(null);\r\n            setCtcAnnual('');\r\n            setError(null);\r\n        }\r\n    }, [isOpen, targetId]);\r\n\r\n    // Calculate salary breakdown from CTC\r\n    const handleCalculate = async () => {\r\n        if (!ctcAnnual || isNaN(ctcAnnual) || Number(ctcAnnual) <= 0) {\r\n            setError('Please enter a valid Annual CTC');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setCalculating(true);\r\n            setError(null);\r\n\r\n            const res = await api.post('/salary/preview', {\r\n                annualCTC: Number(ctcAnnual)\r\n            });\r\n\r\n            if (res.data.success) {\r\n                setSalaryData(res.data.data);\r\n            } else {\r\n                setError(res.data.message || 'Failed to calculate salary');\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to calculate salary:', err);\r\n            setError(err.response?.data?.message || 'Failed to calculate salary breakdown');\r\n        } finally {\r\n            setCalculating(false);\r\n        }\r\n    };\r\n\r\n    // Assign salary (Draft state)\r\n    const handleAssign = async () => {\r\n        if (!ctcAnnual || !salaryData) {\r\n            setError('Please calculate salary first');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setAssigning(true);\r\n            setError(null);\r\n\r\n            const payload = {\r\n                [targetType]: targetId,\r\n                annualCTC: Number(ctcAnnual),\r\n                earnings: salaryData.earnings,\r\n                deductions: salaryData.deductions,\r\n                benefits: salaryData.benefits\r\n            };\r\n\r\n            const res = await api.post('/salary/assign', payload);\r\n\r\n            if (res.data.success) {\r\n                // Now trigger Lock\r\n                const confirmRes = await api.post('/salary/confirm', {\r\n                    [targetType]: targetId\r\n                });\r\n\r\n                if (confirmRes.data.success) {\r\n                    alert('Salary finalized and locked successfully!');\r\n                    onSuccess && onSuccess(confirmRes.data.data);\r\n                    onClose();\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to assign salary:', err);\r\n            setError(err.response?.data?.message || 'Failed to assign salary');\r\n        } finally {\r\n            setAssigning(false);\r\n        }\r\n    };\r\n\r\n    const formatCurrency = (amount) => {\r\n        const val = parseFloat(amount || 0);\r\n        return `‚Çπ${val.toLocaleString('en-IN', {\r\n            minimumFractionDigits: 2,\r\n            maximumFractionDigits: 2\r\n        })}`;\r\n    };\r\n\r\n    const isLocked = !!salaryData?.locked;\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-hidden\">\r\n            <div className=\"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col\">\r\n                {/* Header */}\r\n                <div className=\"px-8 py-6 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-2xl\">\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-bold text-slate-900 leading-tight\">\r\n                            {isLocked ? \"Salary Snapshot\" : \"Salary Configuration\"}\r\n                        </h2>\r\n                        <p className=\"text-sm text-slate-500 mt-1\">\r\n                            {applicant?.name || employee?.name} | {applicant?.requirementId?.jobTitle || employee?.designation || 'N/A'}\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-2 hover:bg-white rounded-full transition-colors text-slate-400 hover:text-slate-600\"\r\n                    >\r\n                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-8 space-y-8\">\r\n                    {/* Error Display */}\r\n                    {error && (\r\n                        <div className=\"bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg\">\r\n                            <div className=\"flex\">\r\n                                <span className=\"text-red-500 mr-3\">‚ö†Ô∏è</span>\r\n                                <p className=\"text-sm text-red-700 font-medium\">{error}</p>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* CTC Input */}\r\n                    {!isLocked && (\r\n                        <div className=\"bg-blue-50/50 rounded-2xl p-6 border border-blue-100\">\r\n                            <label className=\"block text-sm font-semibold text-slate-700 mb-3\">\r\n                                Annual Cost to Company (CTC)\r\n                            </label>\r\n                            <div className=\"flex gap-4\">\r\n                                <div className=\"relative flex-1\">\r\n                                    <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium\">‚Çπ</span>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={ctcAnnual}\r\n                                        onChange={(e) => setCtcAnnual(e.target.value)}\r\n                                        placeholder=\"Enter Amount (e.g. 800000)\"\r\n                                        disabled={calculating || assigning}\r\n                                        className=\"w-full pl-8 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all outline-none font-semibold text-slate-900\"\r\n                                    />\r\n                                </div>\r\n                                <button\r\n                                    onClick={handleCalculate}\r\n                                    disabled={!ctcAnnual || calculating || assigning}\r\n                                    className=\"px-8 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 active:scale-95 transition-all disabled:opacity-50 disabled:pointer-events-none font-bold shadow-lg shadow-blue-500/20\"\r\n                                >\r\n                                    {calculating ? 'Analyzing...' : 'Calculate'}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Salary Grid */}\r\n                    {salaryData && (\r\n                        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                            {/* Master Totals */}\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"bg-slate-900 rounded-2xl p-6 text-white\">\r\n                                    <p className=\"text-slate-400 text-xs font-bold uppercase tracking-wider mb-1\">Annual CTC</p>\r\n                                    <h3 className=\"text-3xl font-black\">{formatCurrency(salaryData.totals?.ctcYearly || salaryData.annualCTC)}</h3>\r\n                                </div>\r\n                                <div className=\"bg-emerald-600 rounded-2xl p-6 text-white\">\r\n                                    <p className=\"text-emerald-100/70 text-xs font-bold uppercase tracking-wider mb-1\">Monthly Take Home</p>\r\n                                    <h3 className=\"text-3xl font-black\">{formatCurrency(salaryData.totals?.netMonthly)}</h3>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Components Tables */}\r\n                            <div className=\"space-y-6\">\r\n                                {/* Earnings Group */}\r\n                                <div>\r\n                                    <h4 className=\"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2\">\r\n                                        <div className=\"w-1.5 h-4 bg-blue-500 rounded-full\"></div>\r\n                                        Earnings Breakdown\r\n                                    </h4>\r\n                                    <div className=\"bg-white border border-slate-100 rounded-2xl overflow-hidden shadow-sm\">\r\n                                        <table className=\"w-full text-sm\">\r\n                                            <thead className=\"bg-slate-50 text-slate-500 font-bold\">\r\n                                                <tr>\r\n                                                    <th className=\"px-6 py-3 text-left\">Component</th>\r\n                                                    <th className=\"px-6 py-3 text-right\">Monthly</th>\r\n                                                    <th className=\"px-6 py-3 text-right\">Yearly</th>\r\n                                                </tr>\r\n                                            </thead>\r\n                                            <tbody className=\"divide-y divide-slate-50\">\r\n                                                {salaryData.earnings?.map((e) => (\r\n                                                    <tr key={e.code} className=\"hover:bg-slate-50/50 transition-colors\">\r\n                                                        <td className=\"px-6 py-4 font-medium text-slate-700\">{e.name}</td>\r\n                                                        <td className=\"px-6 py-4 text-right font-semibold text-slate-900\">{formatCurrency(e.monthly)}</td>\r\n                                                        <td className=\"px-6 py-4 text-right text-slate-500\">{formatCurrency(e.yearly)}</td>\r\n                                                    </tr>\r\n                                                ))}\r\n                                                <tr className=\"bg-slate-50/80 font-bold text-slate-900 border-t-2 border-slate-100\">\r\n                                                    <td className=\"px-6 py-4\">Gross Earnings</td>\r\n                                                    <td className=\"px-6 py-4 text-right\">{formatCurrency(salaryData.totals?.grossMonthly)}</td>\r\n                                                    <td className=\"px-6 py-4 text-right\">{formatCurrency(salaryData.totals?.grossYearly)}</td>\r\n                                                </tr>\r\n                                            </tbody>\r\n                                        </table>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Benefits & Deductions Grid */}\r\n                                <div className=\"grid md:grid-cols-2 gap-6\">\r\n                                    {/* Benefits */}\r\n                                    <div>\r\n                                        <h4 className=\"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2\">\r\n                                            <div className=\"w-1.5 h-4 bg-emerald-500 rounded-full\"></div>\r\n                                            Employer Benefits\r\n                                        </h4>\r\n                                        <div className=\"bg-white border border-slate-100 rounded-2xl overflow-hidden shadow-sm h-full\">\r\n                                            <table className=\"w-full text-xs\">\r\n                                                <tbody className=\"divide-y divide-slate-50\">\r\n                                                    {(salaryData.benefits || []).map((b) => (\r\n                                                        <tr key={b.code} className=\"hover:bg-slate-50/50\">\r\n                                                            <td className=\"px-4 py-3 text-slate-600\">{b.name}</td>\r\n                                                            <td className=\"px-4 py-3 text-right font-bold text-slate-900\">{formatCurrency(b.monthly)}</td>\r\n                                                        </tr>\r\n                                                    ))}\r\n                                                </tbody>\r\n                                            </table>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Deductions */}\r\n                                    <div>\r\n                                        <h4 className=\"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2\">\r\n                                            <div className=\"w-1.5 h-4 bg-red-500 rounded-full\"></div>\r\n                                            Employee Deductions\r\n                                        </h4>\r\n                                        <div className=\"bg-white border border-slate-100 rounded-2xl overflow-hidden shadow-sm h-full\">\r\n                                            <table className=\"w-full text-xs\">\r\n                                                <tbody className=\"divide-y divide-slate-50\">\r\n                                                    {(salaryData.deductions || []).map((d) => (\r\n                                                        <tr key={d.code} className=\"hover:bg-slate-50/50\">\r\n                                                            <td className=\"px-4 py-3 text-slate-600\">{d.name}</td>\r\n                                                            <td className=\"px-4 py-3 text-right font-bold text-red-600\">-{formatCurrency(d.monthly)}</td>\r\n                                                        </tr>\r\n                                                    ))}\r\n                                                </tbody>\r\n                                            </table>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer Actions */}\r\n                <div className=\"px-8 py-6 border-t border-slate-100 flex justify-between items-center bg-slate-50 rounded-b-2xl\">\r\n                    <div className=\"flex items-center text-slate-400 gap-2 text-sm\">\r\n                        <div className={`w-2 h-2 rounded-full ${isLocked ? 'bg-green-500' : 'bg-yellow-500 animate-pulse'}`}></div>\r\n                        {isLocked ? 'Immutable Snapshot' : 'Configuration Mode'}\r\n                    </div>\r\n                    <div className=\"flex gap-4\">\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"px-8 py-3 text-slate-600 bg-white border border-slate-200 rounded-xl hover:bg-slate-100 transition-all font-bold\"\r\n                        >\r\n                            {isLocked ? 'Close' : 'Cancel'}\r\n                        </button>\r\n                        {!isLocked && salaryData && (\r\n                            <button\r\n                                onClick={handleAssign}\r\n                                disabled={assigning}\r\n                                className=\"px-8 py-3 bg-slate-900 text-white rounded-xl hover:bg-black active:scale-95 transition-all disabled:opacity-50 font-bold shadow-xl shadow-slate-900/10\"\r\n                            >\r\n                                {assigning ? 'Finalizing...' : 'Finalize & Lock Salary'}\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\AttendanceCalendar.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'weeklyOffDays' logical expression could make the dependencies of useMemo Hook (at line 63) change on every render. Move it inside the useMemo callback. Alternatively, wrap the initialization of 'weeklyOffDays' in its own useMemo() Hook.","line":29,"column":11,"nodeType":"VariableDeclarator","endLine":29,"endColumn":56},{"ruleId":"no-unused-vars","severity":2,"message":"'isFuture' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":109,"column":82,"nodeType":"Identifier","messageId":"unusedVar","endLine":109,"endColumn":90,"suggestions":[{"messageId":"removeVar","data":{"varName":"isFuture"},"fix":{"range":[5435,5445],"text":""},"desc":"Remove unused variable 'isFuture'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { Info, AlertCircle, CheckCircle, Clock, Calendar as CalendarIcon, Coffee, Briefcase, Lock } from 'lucide-react';\r\n\r\nconst STATUS_CONFIG = {\r\n    present: { label: 'Present', color: 'bg-emerald-500', text: 'text-emerald-700', bg: 'bg-emerald-50/50', border: 'border-emerald-100', icon: CheckCircle },\r\n    absent: { label: 'Absent', color: 'bg-rose-500', text: 'text-rose-700', bg: 'bg-rose-50/50', border: 'border-rose-100', icon: AlertCircle },\r\n    leave: { label: 'Leave', color: 'bg-blue-500', text: 'text-blue-700', bg: 'bg-blue-50/50', border: 'border-blue-100', icon: Info },\r\n    holiday: { label: 'Holiday', color: 'bg-amber-500', text: 'text-amber-700', bg: 'bg-amber-50/50', border: 'border-amber-100', icon: Coffee },\r\n    weekly_off: { label: 'Weekly Off', color: 'bg-slate-400', text: 'text-slate-600', bg: 'bg-slate-50/50', border: 'border-slate-100', icon: CalendarIcon },\r\n    half_day: { label: 'Half Day', color: 'bg-orange-500', text: 'text-orange-700', bg: 'bg-orange-50/50', border: 'border-orange-100', icon: Clock },\r\n    official_duty: { label: 'On Duty', color: 'bg-purple-500', text: 'text-purple-700', bg: 'bg-purple-50/50', border: 'border-purple-100', icon: Briefcase },\r\n    missed_punch: { label: 'Missed', color: 'bg-rose-500', text: 'text-rose-600', bg: 'bg-rose-50', border: 'border-rose-200', icon: AlertCircle },\r\n    not_marked: { label: '-', color: 'bg-slate-100', text: 'text-slate-300', bg: 'bg-white', border: 'border-slate-50', icon: null },\r\n    disabled: { label: 'Disabled', color: 'bg-slate-200', text: 'text-slate-400', bg: 'bg-slate-50', border: 'border-slate-100', icon: Lock }\r\n};\r\n\r\nexport default function AttendanceCalendar({\r\n    data = [],\r\n    holidays = [],\r\n    settings = {},\r\n    currentMonth,\r\n    currentYear,\r\n    onDateClick,\r\n    selectedDate,\r\n    selectionMode = false,\r\n    disabledDates = {} // { \"YYYY-MM-DD\": \"Reason\" }\r\n}) {\r\n\r\n    const weeklyOffDays = settings.weeklyOffDays || [0];\r\n\r\n    const formatDateStr = (year, month, day) => {\r\n        return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\r\n    };\r\n\r\n    const today = new Date();\r\n    const todayStr = formatDateStr(today.getFullYear(), today.getMonth(), today.getDate());\r\n\r\n    const calendarArray = useMemo(() => {\r\n        const firstDay = new Date(currentYear, currentMonth, 1).getDay();\r\n        const lastDate = new Date(currentYear, currentMonth + 1, 0).getDate();\r\n\r\n        const arr = [];\r\n        for (let i = 0; i < firstDay; i++) arr.push({ type: 'empty' });\r\n\r\n        for (let d = 1; d <= lastDate; d++) {\r\n            const date = new Date(currentYear, currentMonth, d);\r\n            const dateStr = formatDateStr(currentYear, currentMonth, d);\r\n            const isWeeklyOff = weeklyOffDays.includes(date.getDay());\r\n            const isSunday = date.getDay() === 0;\r\n\r\n            arr.push({\r\n                type: 'date',\r\n                dateStr,\r\n                dayNum: d,\r\n                dayName: date.toLocaleDateString('en-US', { weekday: 'short' }),\r\n                isWeeklyOff,\r\n                isSunday,\r\n                isToday: todayStr === dateStr,\r\n                isFuture: dateStr > todayStr\r\n            });\r\n        }\r\n        return arr;\r\n    }, [currentMonth, currentYear, weeklyOffDays, todayStr]);\r\n\r\n    const attendanceMap = useMemo(() => {\r\n        const map = {};\r\n        data.forEach(item => {\r\n            const dStr = item.date.split('T')[0];\r\n            map[dStr] = item;\r\n        });\r\n        return map;\r\n    }, [data]);\r\n\r\n    const holidayMap = useMemo(() => {\r\n        const map = {};\r\n        holidays.forEach(h => {\r\n            const dStr = h.date.split('T')[0];\r\n            map[dStr] = h;\r\n        });\r\n        return map;\r\n    }, [holidays]);\r\n\r\n    return (\r\n        <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden\">\r\n            <div className=\"flex flex-wrap gap-x-6 gap-y-2 p-4 bg-slate-50 border-b border-slate-200\">\r\n                {Object.entries(STATUS_CONFIG).map(([key, config]) => {\r\n                    if (key === 'missed_punch' || key === 'not_marked' || key === 'disabled') return null;\r\n                    if (selectionMode && key === 'not_marked') return null;\r\n                    return (\r\n                        <div key={key} className=\"flex items-center gap-2\">\r\n                            <div className={`h-2 w-2 rounded-full ${config.color}`}></div>\r\n                            <span className=\"text-xs font-medium text-slate-600\">{config.label}</span>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            <div className=\"p-4 md:p-6 bg-white\">\r\n                <div className=\"grid grid-cols-7 gap-1 md:gap-3\">\r\n                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (\r\n                        <div key={day} className={`text-center py-2 text-xs font-semibold uppercase tracking-wider ${day === 'Sun' ? 'text-rose-500' : 'text-slate-400'}`}>\r\n                            {day}\r\n                        </div>\r\n                    ))}\r\n\r\n                    {calendarArray.map((cell, i) => {\r\n                        if (cell.type === 'empty') return <div key={`empty-${i}`} className=\"h-24 md:h-28 invisible\"></div>;\r\n\r\n                        const { dateStr, dayNum, isWeeklyOff, isSunday, isToday, isFuture } = cell;\r\n                        const attendance = attendanceMap[dateStr];\r\n                        const holiday = holidayMap[dateStr];\r\n                        const disabledReason = disabledDates[dateStr];\r\n                        const isSelected = selectedDate === dateStr;\r\n\r\n                        let statusKey = 'not_marked';\r\n                        if (holiday) {\r\n                            statusKey = 'holiday';\r\n                        } else if (attendance) {\r\n                            statusKey = attendance.status?.toLowerCase() || 'not_marked';\r\n                            if (attendance.locked) statusKey = 'disabled';\r\n                        } else if (isWeeklyOff) {\r\n                            statusKey = 'weekly_off';\r\n                        }\r\n\r\n                        const config = (disabledReason && selectionMode) ? STATUS_CONFIG.disabled : (STATUS_CONFIG[statusKey] || STATUS_CONFIG.not_marked);\r\n                        const StatusIcon = config.icon;\r\n\r\n                        return (\r\n                            <div\r\n                                key={dateStr}\r\n                                onClick={() => !disabledReason && onDateClick?.(dateStr, attendance || { status: statusKey, isWeeklyOff, holiday })}\r\n                                className={`group relative h-24 md:h-28 p-2.5 rounded-xl border transition-all duration-200 flex flex-col justify-between\r\n                                    ${disabledReason && selectionMode ? 'opacity-50 cursor-not-allowed bg-slate-50' : 'cursor-pointer hover:-translate-y-1 hover:shadow-md hover:border-blue-200 hover:z-10'}\r\n                                    ${isSelected ? 'ring-2 ring-blue-500 ring-offset-1 z-20 shadow-md' : ''}\r\n                                    ${isToday && !isSelected ? 'ring-1 ring-blue-500 ring-offset-1' : ''}\r\n                                    ${config.bg} ${config.border}\r\n                                `}\r\n                                style={statusKey === 'leave' && attendance?.leaveColor ? {\r\n                                    backgroundColor: isSelected ? undefined : `${attendance.leaveColor}10`,\r\n                                    borderColor: isSelected ? undefined : `${attendance.leaveColor}30`\r\n                                } : {}}\r\n                            >\r\n                                <div className=\"flex justify-between items-start\">\r\n                                    <span className={`text-sm font-semibold h-7 w-7 rounded-full flex items-center justify-center \r\n                                        ${isSunday ? 'text-rose-600' : 'text-slate-700'}\r\n                                        ${isSelected ? 'bg-blue-600 text-white shadow-sm' : ''}\r\n                                        ${isToday && !isSelected ? 'bg-blue-100 text-blue-700' : ''}\r\n                                    `}>\r\n                                        {dayNum}\r\n                                    </span>\r\n                                    {holiday && <Coffee size={14} className=\"text-amber-500\" />}\r\n                                    {StatusIcon && !holiday && <StatusIcon size={14} className={config.text} style={statusKey === 'leave' && attendance?.leaveColor ? { color: attendance.leaveColor } : {}} />}\r\n                                </div>\r\n\r\n                                <div className=\"space-y-0.5 px-0.5\">\r\n                                    <div className={`text-[10px] font-semibold truncate ${config.text}`} style={statusKey === 'leave' && attendance?.leaveColor ? { color: attendance.leaveColor } : {}}>\r\n                                        {holiday ? holiday.name : (attendance ? (attendance.leaveType || STATUS_CONFIG[attendance.status.toLowerCase()]?.label || attendance.status) : (isWeeklyOff ? 'Weekly Off' : ''))}\r\n                                    </div>\r\n\r\n                                    {attendance?.checkIn && (\r\n                                        <div className=\"flex flex-col text-[9px] font-medium text-slate-500 leading-tight\">\r\n                                            <span>{new Date(attendance.checkIn).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\r\n                                            {attendance.checkOut && <span>{new Date(attendance.checkOut).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>}\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {attendance?.workingHours > 0 && (\r\n                                        <div className=\"text-[9px] font-medium text-slate-400\">\r\n                                            {attendance.workingHours}h\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\AttendanceClock.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  53 |             interval = setInterval(calculateTime, 1000);\n  54 |         } else if (!isCheckedIn) {\n> 55 |             setElapsed(\"00:00:00\");\n     |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  56 |             setProgress(0);\n  57 |         } else if (isCheckedOut) {\n  58 |             // If checked out, we might want to show the final progress if we had the checkout time, ","line":55,"column":13,"nodeType":null,"endLine":55,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'statusText' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":82,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'statusColor' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":83,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":83,"endColumn":20},{"ruleId":"no-unused-vars","severity":2,"message":"'strokeColorClass' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":86,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":46}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { LogIn, LogOut, Clock, CheckCircle, AlertOctagon } from 'lucide-react';\r\nimport { formatDateDDMMYYYY } from '../utils/dateUtils';\r\n\r\nexport default function AttendanceClock({\r\n    isCheckedIn,\r\n    isCheckedOut,\r\n    checkInTime,\r\n    onAction,\r\n    isLoading,\r\n    location = \"Remote\",\r\n    settings = {},\r\n    error = null\r\n}) {\r\n    const [elapsed, setElapsed] = useState(\"00:00:00\");\r\n    const [currentTime, setCurrentTime] = useState(new Date());\r\n    const [progress, setProgress] = useState(0);\r\n\r\n    // Live Clock Update\r\n    useEffect(() => {\r\n        const timer = setInterval(() => setCurrentTime(new Date()), 1000);\r\n        return () => clearInterval(timer);\r\n    }, []);\r\n\r\n    // Duration Timer & Progress Logic\r\n    useEffect(() => {\r\n        let interval;\r\n        if (isCheckedIn && !isCheckedOut && checkInTime) {\r\n\r\n            // Initial calculation to avoid 1s delay\r\n            const calculateTime = () => {\r\n                const now = new Date();\r\n                const start = new Date(checkInTime);\r\n                const diff = Math.max(0, now - start);\r\n\r\n                const hours = Math.floor(diff / 3600000);\r\n                const minutes = Math.floor((diff % 3600000) / 60000);\r\n                const seconds = Math.floor((diff % 60000) / 1000);\r\n\r\n                setElapsed(\r\n                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`\r\n                );\r\n\r\n                // Calculate Progress\r\n                const totalSeconds = diff / 1000;\r\n                const targetHours = settings?.fullDayThresholdHours || 9;\r\n                const targetSeconds = targetHours * 3600;\r\n                const pct = Math.min((totalSeconds / targetSeconds) * 100, 100);\r\n                setProgress(pct);\r\n            };\r\n\r\n            calculateTime(); // Run immediately\r\n            interval = setInterval(calculateTime, 1000);\r\n        } else if (!isCheckedIn) {\r\n            setElapsed(\"00:00:00\");\r\n            setProgress(0);\r\n        } else if (isCheckedOut) {\r\n            // If checked out, we might want to show the final progress if we had the checkout time, \r\n            // but for now we stop the timer. The User didn't explicitly ask for historical progress here.\r\n            // We'll leave progress as is or reset if we want. \r\n            // Often purely visual \"Shift Completed\" state is better.\r\n        }\r\n        return () => clearInterval(interval);\r\n    }, [isCheckedIn, isCheckedOut, checkInTime, settings]);\r\n\r\n    // UI Configuration based on Policy\r\n    const isMultipleMode = settings?.punchMode === 'multiple';\r\n    const showShiftCompleted = !isMultipleMode && isCheckedOut;\r\n\r\n    let statusText = \"Not Punched In\";\r\n    let statusColor = \"text-slate-400\";\r\n    // let ringColor = \"border-slate-100\"; // No longer used for border color directly\r\n\r\n    // Colors for SVG Stroke\r\n    let strokeColorClass = \"text-slate-200 dark:text-slate-700\";\r\n\r\n    if (isCheckedIn && !isCheckedOut) {\r\n        statusText = \"You are Punched In\";\r\n        statusColor = \"text-emerald-500\";\r\n        strokeColorClass = \"text-emerald-500\";\r\n    } else if (isCheckedOut) {\r\n        statusText = isMultipleMode ? \"Currently Out\" : \"Shift Completed\";\r\n        statusColor = isMultipleMode ? \"text-amber-500\" : \"text-blue-500\";\r\n        strokeColorClass = isMultipleMode ? \"text-amber-500\" : \"text-blue-500\";\r\n        // If shift completed, maybe show full ring?\r\n        if (!isMultipleMode) strokeColorClass = \"text-blue-500\";\r\n    }\r\n\r\n    // Circular Progress Constants\r\n    const radius = 120;\r\n    const circumference = 2 * Math.PI * radius;\r\n    const strokeDashoffset = circumference - (progress / 100) * circumference;\r\n\r\n    return (\r\n        <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl p-10 rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-2xl flex flex-col items-center justify-center min-h-[520px] transition-all relative overflow-hidden group\">\r\n            {/* Animated Background Gradient */}\r\n            <div className=\"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 opacity-40\"></div>\r\n            <div className=\"absolute -bottom-20 -left-20 w-40 h-40 bg-indigo-500/10 blur-[80px] rounded-full\"></div>\r\n            <div className=\"absolute -top-20 -right-20 w-40 h-40 bg-purple-500/10 blur-[80px] rounded-full\"></div>\r\n\r\n            <h3 className=\"text-[10px] font-black text-slate-400 dark:text-slate-500 mb-10 flex items-center gap-3 uppercase tracking-[0.3em] relative z-10\">\r\n                <div className=\"p-1.5 rounded-lg bg-indigo-500/10 text-indigo-500\">\r\n                    <Clock size={12} />\r\n                </div>\r\n                Live Pulse Console\r\n            </h3>\r\n\r\n            {/* Circular Progress Clock UI */}\r\n            <div className=\"relative mb-12 w-72 h-72 flex items-center justify-center group/clock scale-90 sm:scale-100 transition-transform duration-700\">\r\n\r\n                {/* SVG Progress Ring */}\r\n                <div className=\"absolute inset-0 transform -rotate-90\">\r\n                    <svg className=\"w-full h-full\" viewBox=\"0 0 256 256\">\r\n                        <defs>\r\n                            <linearGradient id=\"clockGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\r\n                                <stop offset=\"0%\" stopColor=\"#6366f1\" />\r\n                                <stop offset=\"100%\" stopColor=\"#a855f7\" />\r\n                            </linearGradient>\r\n                            <filter id=\"glow\" x=\"-20%\" y=\"-20%\" width=\"140%\" height=\"140%\">\r\n                                <feGaussianBlur stdDeviation=\"4\" result=\"blur\" />\r\n                                <feComposite in=\"SourceGraphic\" in2=\"blur\" operator=\"over\" />\r\n                            </filter>\r\n                        </defs>\r\n                        {/* Track */}\r\n                        <circle\r\n                            cx=\"128\"\r\n                            cy=\"128\"\r\n                            r={radius}\r\n                            fill=\"none\"\r\n                            className=\"stroke-slate-100 dark:stroke-slate-800/40\"\r\n                            strokeWidth=\"10\"\r\n                        />\r\n                        {/* Progress */}\r\n                        <circle\r\n                            cx=\"128\"\r\n                            cy=\"128\"\r\n                            r={radius}\r\n                            fill=\"none\"\r\n                            stroke=\"url(#clockGradient)\"\r\n                            className={`transition-all duration-1000 ease-[cubic-bezier(0.34,1.56,0.64,1)]`}\r\n                            strokeWidth=\"10\"\r\n                            strokeDasharray={circumference}\r\n                            strokeDashoffset={isCheckedIn && !isCheckedOut ? strokeDashoffset : (isCheckedOut && !isMultipleMode ? 0 : circumference)}\r\n                            strokeLinecap=\"round\"\r\n                            style={{ filter: isCheckedIn && !isCheckedOut ? 'url(#glow)' : 'none' }}\r\n                        />\r\n                    </svg>\r\n                </div>\r\n\r\n                {/* Inner Content */}\r\n                <div className=\"relative z-10 text-center flex flex-col items-center justify-center w-52 h-52 bg-white dark:bg-slate-900 rounded-full shadow-2xl border border-slate-100 dark:border-slate-800 group-hover/clock:scale-[1.02] transition-transform duration-500\">\r\n                    <div className=\"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.2em] mb-2\">Duration</div>\r\n                    <div className=\"text-5xl font-mono font-black text-slate-800 dark:text-white tracking-tighter tabular-nums mb-1\">\r\n                        {elapsed}\r\n                    </div>\r\n                    <div className={`mt-2 px-4 py-1 rounded-xl text-[9px] font-black uppercase tracking-widest border transition-all duration-500 ${isCheckedIn && !isCheckedOut\r\n                        ? 'bg-emerald-500/10 text-emerald-500 border-emerald-500/20 shadow-[0_0_15px_rgba(16,185,129,0.1)] animate-pulse'\r\n                        : 'bg-slate-50 text-slate-400 border-slate-100 dark:bg-slate-800 dark:text-slate-500 dark:border-slate-700'\r\n                        }`}>\r\n                        {isCheckedIn && !isCheckedOut ? 'Station Active' : 'System Idle'}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Current Time Small Display */}\r\n            <div className=\"mb-10 text-center bg-slate-50/50 dark:bg-slate-800/30 px-10 py-5 rounded-[2rem] border border-slate-100/50 dark:border-slate-800/50 w-full max-w-[320px] backdrop-blur-sm\">\r\n                <div className=\"text-2xl font-black text-slate-800 dark:text-white tracking-tight tabular-nums\">\r\n                    {currentTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true })}\r\n                </div>\r\n                <div className=\"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-[0.2em] mt-2 flex items-center justify-center gap-3\">\r\n                    <span className=\"text-indigo-500\">{currentTime.toLocaleDateString('en-US', { weekday: 'long' })}</span>\r\n                    <span className=\"w-1.5 h-1.5 rounded-full bg-slate-200 dark:bg-slate-700\"></span>\r\n                    <span>{formatDateDDMMYYYY(currentTime)}</span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Action Button */}\r\n            <div className=\"w-full max-w-[320px] z-20 relative\">\r\n                {showShiftCompleted ? (\r\n                    <div className=\"w-full py-5 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest text-center shadow-xl shadow-emerald-500/20 flex flex-col items-center gap-1 group/complete hover:scale-[1.02] transition-transform\">\r\n                        <div className=\"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mb-1 group-hover/complete:scale-110 transition-transform\">\r\n                            <CheckCircle size={18} />\r\n                        </div>\r\n                        Deployment Securely Closed\r\n                    </div>\r\n                ) : (\r\n                    <button\r\n                        onClick={onAction}\r\n                        disabled={isLoading}\r\n                        className={`w-full py-5 rounded-2xl font-black text-[10px] uppercase tracking-[0.25em] shadow-2xl transition-all duration-500 transform active:scale-[0.98] flex items-center justify-center gap-3 disabled:opacity-50 disabled:grayscale cursor-pointer overflow-hidden relative group/btn ${isCheckedIn && !isCheckedOut\r\n                            ? 'bg-rose-500 hover:bg-rose-600 text-white shadow-rose-500/30'\r\n                            : 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-indigo-600/30'\r\n                            }`}\r\n                    >\r\n                        <div className=\"absolute inset-0 bg-white/10 translate-x-[-100%] group-hover/btn:translate-x-[100%] transition-transform duration-1000 ease-in-out\"></div>\r\n                        {isLoading ? (\r\n                            <div className=\"h-4 w-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                        ) : (isCheckedIn && !isCheckedOut) ? (\r\n                            <>\r\n                                <LogOut size={16} />\r\n                                Terminate Session\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                <LogIn size={16} />\r\n                                {isMultipleMode && isCheckedIn ? 'Resume Operation' : 'Initialize Session'}\r\n                            </>\r\n                        )}\r\n                    </button>\r\n                )}\r\n\r\n                {/* Error Message Display */}\r\n                {error && (\r\n                    <div className=\"mt-5 p-4 bg-rose-50 dark:bg-rose-900/40 border border-rose-200/50 dark:border-rose-900/50 rounded-2xl flex items-start gap-3 animate-in fade-in zoom-in-95 duration-300\">\r\n                        <AlertOctagon size={16} className=\"text-rose-500 mt-0.5 shrink-0\" />\r\n                        <p className=\"text-[10px] font-bold text-rose-600 dark:text-rose-300 leading-relaxed text-left\">\r\n                            {error}\r\n                        </p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"mt-8 flex items-center gap-2 group/loc cursor-help\" title=\"Location verification active\">\r\n                <div className=\"w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]\"></div>\r\n                <p className=\"text-[10px] font-bold text-slate-400 dark:text-slate-600 uppercase tracking-widest opacity-80 group-hover/loc:opacity-100 transition-opacity\">\r\n                    Resolved: <span className=\"text-slate-500 dark:text-slate-400 capitalize\">{location}</span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\BenefitsSection.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\Compensation\\CompensationTab.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCurrentSalary'. Either include it or remove the dependency array.","line":27,"column":8,"nodeType":"ArrayExpression","endLine":27,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [employee, loadCurrentSalary]","fix":{"range":[945,955],"text":"[employee, loadCurrentSalary]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport api from '../../utils/api';\r\nimport { TrendingUp, RefreshCw, ArrowUpCircle, IndianRupee, Calendar, FileText } from 'lucide-react';\r\nimport SalaryChangeModal from './SalaryChangeModal';\r\nimport SalaryHistory from './SalaryHistory';\r\n\r\n/**\r\n * Compensation Tab Component\r\n * \r\n * Displays employee's current salary and provides options for:\r\n * - Increment\r\n * - Revision\r\n * - Promotion\r\n * - View Salary History\r\n */\r\nexport default function CompensationTab({ employee }) {\r\n    const [currentSnapshot, setCurrentSnapshot] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showChangeModal, setShowChangeModal] = useState(false);\r\n    const [changeType, setChangeType] = useState(null);\r\n    const [showHistory, setShowHistory] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (employee?._id) {\r\n            loadCurrentSalary();\r\n        }\r\n    }, [employee]);\r\n\r\n    const loadCurrentSalary = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const response = await api.get(`/hr/employees/${employee._id}/salary-history`);\r\n            if (response.data.success) {\r\n                const snapshots = response.data.data.snapshots || [];\r\n                const current = snapshots.find(s =>\r\n                    s._id.toString() === employee.currentSalarySnapshotId?.toString()\r\n                );\r\n                setCurrentSnapshot(current || snapshots[0]);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading current salary:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleChangeClick = (type) => {\r\n        setChangeType(type);\r\n        setShowChangeModal(true);\r\n    };\r\n\r\n    const handleChangeSuccess = () => {\r\n        setShowChangeModal(false);\r\n        loadCurrentSalary();\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center p-12\">\r\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!currentSnapshot) {\r\n        return (\r\n            <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-6\">\r\n                <p className=\"text-amber-800\">No salary information available for this employee.</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header Actions */}\r\n            <div className=\"flex flex-wrap gap-3\">\r\n                <button\r\n                    onClick={() => handleChangeClick('INCREMENT')}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition shadow-md\"\r\n                >\r\n                    <TrendingUp className=\"h-5 w-5\" />\r\n                    <span>Increment</span>\r\n                </button>\r\n                <button\r\n                    onClick={() => handleChangeClick('REVISION')}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md\"\r\n                >\r\n                    <RefreshCw className=\"h-5 w-5\" />\r\n                    <span>Revision</span>\r\n                </button>\r\n                <button\r\n                    onClick={() => handleChangeClick('PROMOTION')}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition shadow-md\"\r\n                >\r\n                    <ArrowUpCircle className=\"h-5 w-5\" />\r\n                    <span>Promotion</span>\r\n                </button>\r\n                <button\r\n                    onClick={() => setShowHistory(true)}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition shadow-md ml-auto\"\r\n                >\r\n                    <FileText className=\"h-5 w-5\" />\r\n                    <span>View History</span>\r\n                </button>\r\n            </div>\r\n\r\n            {/* Current Salary Overview */}\r\n            <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200\">\r\n                <h3 className=\"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2\">\r\n                    <IndianRupee className=\"h-5 w-5 text-blue-600\" />\r\n                    Current Salary Structure\r\n                </h3>\r\n\r\n                <div className=\"grid md:grid-cols-2 gap-6\">\r\n                    {/* CTC Summary */}\r\n                    <div className=\"bg-white rounded-lg p-4 shadow-sm\">\r\n                        <div className=\"text-sm text-slate-600 mb-1\">Annual CTC</div>\r\n                        <div className=\"text-3xl font-bold text-slate-900\">\r\n                            ‚Çπ{currentSnapshot.ctc?.toLocaleString('en-IN') || 0}\r\n                        </div>\r\n                        <div className=\"text-sm text-slate-500 mt-1\">\r\n                            Monthly: ‚Çπ{currentSnapshot.monthlyCTC?.toLocaleString('en-IN') || 0}\r\n                        </div>\r\n                        <div className=\"text-xs text-slate-400 mt-2 flex items-center gap-1\">\r\n                            <Calendar className=\"h-3 w-3\" />\r\n                            Effective from: {new Date(currentSnapshot.effectiveFrom).toLocaleDateString('en-IN')}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Breakdown Summary */}\r\n                    <div className=\"bg-white rounded-lg p-4 shadow-sm\">\r\n                        <div className=\"space-y-2\">\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-slate-600\">Gross Salary</span>\r\n                                <span className=\"font-semibold text-slate-900\">\r\n                                    ‚Çπ{currentSnapshot.breakdown?.grossA?.toLocaleString('en-IN') || 0}\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-slate-600\">Total Deductions</span>\r\n                                <span className=\"font-semibold text-red-600\">\r\n                                    -‚Çπ{currentSnapshot.breakdown?.totalDeductions?.toLocaleString('en-IN') || 0}\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"border-t border-slate-200 pt-2 mt-2\"></div>\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"font-semibold text-slate-700\">Take Home</span>\r\n                                <span className=\"font-bold text-green-600 text-lg\">\r\n                                    ‚Çπ{currentSnapshot.breakdown?.takeHome?.toLocaleString('en-IN') || 0}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Earnings Breakdown */}\r\n            <div className=\"bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden\">\r\n                <div className=\"bg-slate-50 px-6 py-3 border-b border-slate-200\">\r\n                    <h4 className=\"font-semibold text-slate-900\">Earnings</h4>\r\n                </div>\r\n                <div className=\"p-6\">\r\n                    <div className=\"grid md:grid-cols-2 gap-4\">\r\n                        {currentSnapshot.earnings?.map((earning, idx) => (\r\n                            <div key={idx} className=\"flex justify-between items-center p-3 bg-green-50 rounded-lg border border-green-200\">\r\n                                <div>\r\n                                    <div className=\"font-medium text-slate-900\">{earning.name}</div>\r\n                                    <div className=\"text-xs text-slate-500\">\r\n                                        {earning.calculationType === 'PERCENT_CTC' && `${earning.percentage}% of CTC`}\r\n                                        {earning.calculationType === 'PERCENT_BASIC' && `${earning.percentage}% of Basic`}\r\n                                        {earning.calculationType === 'FIXED' && 'Fixed Amount'}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"text-right\">\r\n                                    <div className=\"font-semibold text-green-700\">\r\n                                        ‚Çπ{earning.monthlyAmount?.toLocaleString('en-IN')}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-slate-500\">per month</div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Deductions Breakdown */}\r\n            {currentSnapshot.employeeDeductions && currentSnapshot.employeeDeductions.length > 0 && (\r\n                <div className=\"bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden\">\r\n                    <div className=\"bg-slate-50 px-6 py-3 border-b border-slate-200\">\r\n                        <h4 className=\"font-semibold text-slate-900\">Deductions</h4>\r\n                    </div>\r\n                    <div className=\"p-6\">\r\n                        <div className=\"grid md:grid-cols-2 gap-4\">\r\n                            {currentSnapshot.employeeDeductions.map((deduction, idx) => (\r\n                                <div key={idx} className=\"flex justify-between items-center p-3 bg-red-50 rounded-lg border border-red-200\">\r\n                                    <div>\r\n                                        <div className=\"font-medium text-slate-900\">{deduction.name}</div>\r\n                                        <div className=\"text-xs text-slate-500\">{deduction.category || 'Deduction'}</div>\r\n                                    </div>\r\n                                    <div className=\"text-right\">\r\n                                        <div className=\"font-semibold text-red-700\">\r\n                                            ‚Çπ{deduction.monthlyAmount?.toLocaleString('en-IN')}\r\n                                        </div>\r\n                                        <div className=\"text-xs text-slate-500\">per month</div>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Modals */}\r\n            {showChangeModal && (\r\n                <SalaryChangeModal\r\n                    employee={employee}\r\n                    currentSnapshot={currentSnapshot}\r\n                    type={changeType}\r\n                    onClose={() => setShowChangeModal(false)}\r\n                    onSuccess={handleChangeSuccess}\r\n                />\r\n            )}\r\n\r\n            {showHistory && (\r\n                <SalaryHistory\r\n                    employee={employee}\r\n                    onClose={() => setShowHistory(false)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\Compensation\\SalaryChangeModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\Compensation\\SalaryHistory.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadHistory'. Either include it or remove the dependency array.","line":21,"column":8,"nodeType":"ArrayExpression","endLine":21,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [employee, loadHistory]","fix":{"range":[640,650],"text":"[employee, loadHistory]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport api from '../../utils/api';\r\nimport { X, TrendingUp, RefreshCw, ArrowUpCircle, Briefcase, Calendar, IndianRupee } from 'lucide-react';\r\n\r\n/**\r\n * Salary History Component\r\n * \r\n * Displays complete salary history including:\r\n * - Joining salary\r\n * - All increments\r\n * - All revisions\r\n * - All promotions\r\n */\r\nexport default function SalaryHistory({ employee, onClose }) {\r\n    const [history, setHistory] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n\r\n    useEffect(() => {\r\n        loadHistory();\r\n    }, [employee]);\r\n\r\n    const loadHistory = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const response = await api.get(`/hr/employees/${employee._id}/salary-history`);\r\n            if (response.data.success) {\r\n                setHistory(response.data.data);\r\n            } else {\r\n                setError('Failed to load salary history');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading salary history:', error);\r\n            setError(error.response?.data?.message || 'Failed to load salary history');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const getTypeIcon = (type) => {\r\n        switch (type) {\r\n            case 'INCREMENT':\r\n                return <TrendingUp className=\"h-5 w-5 text-green-600\" />;\r\n            case 'REVISION':\r\n                return <RefreshCw className=\"h-5 w-5 text-blue-600\" />;\r\n            case 'PROMOTION':\r\n                return <ArrowUpCircle className=\"h-5 w-5 text-purple-600\" />;\r\n            case 'JOINING':\r\n                return <Briefcase className=\"h-5 w-5 text-slate-600\" />;\r\n            default:\r\n                return <IndianRupee className=\"h-5 w-5 text-slate-600\" />;\r\n        }\r\n    };\r\n\r\n    const getTypeColor = (type) => {\r\n        switch (type) {\r\n            case 'INCREMENT':\r\n                return 'green';\r\n            case 'REVISION':\r\n                return 'blue';\r\n            case 'PROMOTION':\r\n                return 'purple';\r\n            case 'JOINING':\r\n                return 'slate';\r\n            default:\r\n                return 'slate';\r\n        }\r\n    };\r\n\r\n    const getTypeBadge = (type) => {\r\n        const color = getTypeColor(type);\r\n        return (\r\n            <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-${color}-100 text-${color}-800`}>\r\n                {getTypeIcon(type)}\r\n                {type}\r\n            </span>\r\n        );\r\n    };\r\n\r\n    const getStatusBadge = (status) => {\r\n        const colors = {\r\n            DRAFT: 'bg-slate-100 text-slate-800',\r\n            PENDING_APPROVAL: 'bg-yellow-100 text-yellow-800',\r\n            APPROVED: 'bg-green-100 text-green-800',\r\n            APPLIED: 'bg-blue-100 text-blue-800',\r\n            REJECTED: 'bg-red-100 text-red-800'\r\n        };\r\n\r\n        return (\r\n            <span className={`inline-flex px-2 py-0.5 rounded-full text-xs font-medium ${colors[status] || colors.DRAFT}`}>\r\n                {status}\r\n            </span>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-300\">\r\n            <div className=\"w-full max-w-5xl max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-2xl animate-in zoom-in-95 duration-300\">\r\n                {/* Header */}\r\n                <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-4 flex items-center justify-between rounded-t-2xl sticky top-0 z-10\">\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold\">Salary History</h2>\r\n                        <p className=\"text-sm text-blue-100 mt-1\">\r\n                            {employee.firstName} {employee.lastName} ({employee.employeeId})\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-1 hover:bg-white/20 rounded-full transition\"\r\n                    >\r\n                        <X className=\"h-6 w-6\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-6\">\r\n                    {loading ? (\r\n                        <div className=\"flex items-center justify-center p-12\">\r\n                            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n                        </div>\r\n                    ) : error ? (\r\n                        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 text-red-800\">\r\n                            {error}\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-6\">\r\n                            {/* Current CTC Summary */}\r\n                            <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div>\r\n                                        <div className=\"text-sm text-slate-600 mb-1\">Current Annual CTC</div>\r\n                                        <div className=\"text-4xl font-bold text-slate-900\">\r\n                                            ‚Çπ{history?.currentCTC?.toLocaleString('en-IN') || 0}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"text-right\">\r\n                                        <div className=\"text-sm text-slate-600 mb-1\">Position</div>\r\n                                        <div className=\"font-semibold text-slate-900\">\r\n                                            {history?.employee?.designation || 'N/A'}\r\n                                        </div>\r\n                                        <div className=\"text-sm text-slate-500\">\r\n                                            {history?.employee?.department || 'N/A'}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Timeline */}\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold text-slate-900 mb-4\">Timeline</h3>\r\n\r\n                                {history?.timeline && history.timeline.length > 0 ? (\r\n                                    <div className=\"space-y-4\">\r\n                                        {history.timeline.map((item, idx) => (\r\n                                            <div\r\n                                                key={idx}\r\n                                                className=\"bg-white border border-slate-200 rounded-lg p-5 hover:shadow-md transition\"\r\n                                            >\r\n                                                <div className=\"flex items-start justify-between gap-4\">\r\n                                                    <div className=\"flex items-start gap-4 flex-1\">\r\n                                                        <div className=\"mt-1\">\r\n                                                            {getTypeIcon(item.type)}\r\n                                                        </div>\r\n\r\n                                                        <div className=\"flex-1\">\r\n                                                            <div className=\"flex items-center gap-3 mb-2\">\r\n                                                                {getTypeBadge(item.type)}\r\n                                                                {item.status && getStatusBadge(item.status)}\r\n                                                            </div>\r\n\r\n                                                            <div className=\"flex items-center gap-2 text-sm text-slate-600 mb-3\">\r\n                                                                <Calendar className=\"h-4 w-4\" />\r\n                                                                <span>\r\n                                                                    {new Date(item.date).toLocaleDateString('en-IN', {\r\n                                                                        year: 'numeric',\r\n                                                                        month: 'long',\r\n                                                                        day: 'numeric'\r\n                                                                    })}\r\n                                                                </span>\r\n                                                            </div>\r\n\r\n                                                            {item.type === 'JOINING' ? (\r\n                                                                <div className=\"space-y-1\">\r\n                                                                    <div className=\"font-semibold text-slate-900\">\r\n                                                                        Joining CTC: ‚Çπ{item.ctc?.toLocaleString('en-IN')}\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            ) : (\r\n                                                                <div className=\"grid md:grid-cols-3 gap-4\">\r\n                                                                    <div>\r\n                                                                        <div className=\"text-xs text-slate-500 mb-1\">Previous CTC</div>\r\n                                                                        <div className=\"font-semibold text-slate-700\">\r\n                                                                            ‚Çπ{item.oldCTC?.toLocaleString('en-IN')}\r\n                                                                        </div>\r\n                                                                    </div>\r\n                                                                    <div>\r\n                                                                        <div className=\"text-xs text-slate-500 mb-1\">New CTC</div>\r\n                                                                        <div className=\"font-semibold text-green-600\">\r\n                                                                            ‚Çπ{item.newCTC?.toLocaleString('en-IN')}\r\n                                                                        </div>\r\n                                                                    </div>\r\n                                                                    <div>\r\n                                                                        <div className=\"text-xs text-slate-500 mb-1\">Change</div>\r\n                                                                        <div className={`font-semibold ${item.change >= 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n                                                                            {item.change >= 0 ? '+' : ''}‚Çπ{Math.abs(item.change || 0).toLocaleString('en-IN')}\r\n                                                                            <span className=\"text-xs ml-1\">\r\n                                                                                ({item.percentageChange >= 0 ? '+' : ''}{item.percentageChange}%)\r\n                                                                            </span>\r\n                                                                        </div>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            )}\r\n\r\n                                                            {/* Promotion Details */}\r\n                                                            {item.type === 'PROMOTION' && item.revision?.promotionDetails && (\r\n                                                                <div className=\"mt-3 p-3 bg-purple-50 rounded-lg border border-purple-200\">\r\n                                                                    <div className=\"text-xs font-semibold text-purple-900 mb-2\">Promotion Details</div>\r\n                                                                    <div className=\"grid md:grid-cols-2 gap-2 text-sm\">\r\n                                                                        {item.revision.promotionDetails.oldDesignation && (\r\n                                                                            <div>\r\n                                                                                <span className=\"text-slate-600\">Designation: </span>\r\n                                                                                <span className=\"line-through text-slate-500\">\r\n                                                                                    {item.revision.promotionDetails.oldDesignation}\r\n                                                                                </span>\r\n                                                                                <span className=\"mx-1\">‚Üí</span>\r\n                                                                                <span className=\"font-semibold text-purple-700\">\r\n                                                                                    {item.revision.promotionDetails.newDesignation}\r\n                                                                                </span>\r\n                                                                            </div>\r\n                                                                        )}\r\n                                                                        {item.revision.promotionDetails.newGrade && (\r\n                                                                            <div>\r\n                                                                                <span className=\"text-slate-600\">Grade: </span>\r\n                                                                                <span className=\"font-semibold text-purple-700\">\r\n                                                                                    {item.revision.promotionDetails.newGrade}\r\n                                                                                </span>\r\n                                                                            </div>\r\n                                                                        )}\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            )}\r\n\r\n                                                            {/* Reason */}\r\n                                                            {item.revision?.changeSummary?.reason && (\r\n                                                                <div className=\"mt-3 text-sm text-slate-600 italic\">\r\n                                                                    \"{item.revision.changeSummary.reason}\"\r\n                                                                </div>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"text-center text-slate-500 py-8\">\r\n                                        No salary history available\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"border-t border-slate-200 px-6 py-4 bg-slate-50 rounded-b-2xl\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-6 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition font-medium\"\r\n                    >\r\n                        Close\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\DynamicFormBuilder.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'setActiveSection' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":5,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"setActiveSection"},"fix":{"range":[212,230],"text":""},"desc":"Remove unused variable 'setActiveSection'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'uiId' is defined but never used.","line":73,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"uiId"},"fix":{"range":[2408,2413],"text":""},"desc":"Remove unused variable 'uiId'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\n\r\nexport default function DynamicFormBuilder({ template, onSave, onCancel }) {\r\n    const [fields, setFields] = useState(template.fields || []);\r\n    const [activeSection, setActiveSection] = useState('Basic Details');\r\n\r\n    // Default sections\r\n    const SECTIONS = ['Basic Details', 'Job Description', 'Experience & Skills', 'Salary & Perks', 'Additional Info'];\r\n\r\n    // Field Types\r\n    const FIELD_TYPES = ['text', 'number', 'dropdown', 'textarea', 'date', 'checkbox', 'file'];\r\n\r\n    const [editingField, setEditingField] = useState(null);\r\n    const [isNewField, setIsNewField] = useState(false);\r\n\r\n    const handleAddField = () => {\r\n        setEditingField({\r\n            uiId: `new_${Date.now()}`,\r\n            key: '',\r\n            label: '',\r\n            type: 'text',\r\n            section: activeSection,\r\n            required: false,\r\n            options: [] // for dropdowns\r\n        });\r\n        setIsNewField(true);\r\n    };\r\n\r\n    const handleEditField = (field) => {\r\n        setEditingField({ ...field });\r\n        setIsNewField(false);\r\n    };\r\n\r\n    const handleDeleteField = (uiId) => {\r\n        if (window.confirm(\"Delete this field?\")) {\r\n            setFields(prev => prev.filter(f => f.uiId !== uiId));\r\n        }\r\n    };\r\n\r\n    const saveField = (e) => {\r\n        e.preventDefault();\r\n\r\n        // Manual validation\r\n        if (!editingField.label.trim()) {\r\n            alert(\"Label is required\");\r\n            return;\r\n        }\r\n\r\n        const fieldToSave = { ...editingField };\r\n\r\n        // Auto-generate key if empty\r\n        if (!fieldToSave.key) {\r\n            fieldToSave.key = fieldToSave.label.toLowerCase().trim().replace(/[^a-z0-9]/g, '_');\r\n        }\r\n\r\n        // Check key uniqueness manually (ignoring self)\r\n        const duplicate = fields.find(f => f.key === fieldToSave.key && f.uiId !== fieldToSave.uiId);\r\n        if (duplicate) {\r\n            alert(\"Field key must be unique. Change label or key.\");\r\n            return;\r\n        }\r\n\r\n        if (isNewField) {\r\n            setFields([...fields, fieldToSave]);\r\n        } else {\r\n            setFields(fields.map(f => f.uiId === editingField.uiId ? fieldToSave : f));\r\n        }\r\n        setEditingField(null);\r\n    };\r\n\r\n    const handleSaveTemplate = () => {\r\n        // Strip uiId before sending to parent/backend\r\n        const cleanFields = fields.map(({ uiId, ...rest }) => rest);\r\n        onSave({ ...template, fields: cleanFields, sections: SECTIONS });\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-6xl h-[90vh] flex overflow-hidden\">\r\n\r\n                {/* Left: Field List */}\r\n                <div className=\"w-1/3 bg-slate-50 border-r border-slate-200 flex flex-col\">\r\n                    <div className=\"p-4 border-b border-slate-200 bg-white\">\r\n                        <h2 className=\"font-bold text-lg text-slate-800\">Form Fields</h2>\r\n                        <p className=\"text-xs text-slate-500\">Drag to reorder (coming soon)</p>\r\n                    </div>\r\n\r\n                    <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\r\n                        {fields.map((field) => (\r\n                            <div key={field.uiId} className=\"bg-white p-3 rounded-lg border border-slate-200 shadow-sm flex justify-between items-center group hover:border-blue-400 transition cursor-pointer\" onClick={() => handleEditField(field)}>\r\n                                <div>\r\n                                    <div className=\"font-semibold text-slate-700\">{field.label}</div>\r\n                                    <div className=\"text-xs text-slate-500 flex gap-2\">\r\n                                        <span className=\"capitalize bg-slate-100 px-1 rounded\">{field.type}</span>\r\n                                        {field.required && <span className=\"text-red-500\">Required</span>}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"opacity-0 group-hover:opacity-100 transition\">\r\n                                    <button onClick={(e) => { e.stopPropagation(); handleDeleteField(field.uiId); }} className=\"text-red-500 hover:bg-red-50 p-1 rounded\">\r\n                                        <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" /></svg>\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                        <button onClick={handleAddField} className=\"w-full py-3 border-2 border-dashed border-slate-300 rounded-lg text-slate-500 hover:border-blue-500 hover:text-blue-500 transition font-medium\">\r\n                            + Add Custom Field\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right: Editor Panel */}\r\n                <div className=\"flex-1 bg-white p-8 flex flex-col\">\r\n                    <div className=\"flex justify-between items-center mb-8\">\r\n                        <div>\r\n                            <h2 className=\"text-2xl font-bold text-slate-800\">Configure Template</h2>\r\n                            <p className=\"text-slate-500\">Define the customized structure for your job posts.</p>\r\n                        </div>\r\n                        <div className=\"flex gap-3\">\r\n                            <button type=\"button\" onClick={onCancel} className=\"px-4 py-2 border border-slate-300 rounded-lg\">Cancel</button>\r\n                            <button type=\"button\" onClick={handleSaveTemplate} className=\"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 shadow-md\">Save Changes</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {editingField ? (\r\n                        <div className=\"bg-slate-50 p-6 rounded-xl border border-slate-200 animate-fadeIn\">\r\n                            <h3 className=\"font-bold text-lg mb-4 text-slate-800\">{isNewField ? 'Add New Field' : 'Edit Field'}</h3>\r\n                            <form className=\"space-y-4\">\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Label <span className=\"text-red-500\">*</span></label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={editingField.label}\r\n                                            onChange={e => setEditingField({ ...editingField, label: e.target.value })}\r\n                                            className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                            placeholder=\"e.g. Budget Code\"\r\n                                            autoFocus\r\n                                            required\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Field Type</label>\r\n                                        <select\r\n                                            value={editingField.type}\r\n                                            onChange={e => setEditingField({ ...editingField, type: e.target.value })}\r\n                                            className=\"w-full px-3 py-2 border border-slate-300 rounded-lg\"\r\n                                        >\r\n                                            {FIELD_TYPES.map(t => <option key={t} value={t}>{t}</option>)}\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Section</label>\r\n                                        <select\r\n                                            value={editingField.section}\r\n                                            onChange={e => setEditingField({ ...editingField, section: e.target.value })}\r\n                                            className=\"w-full px-3 py-2 border border-slate-300 rounded-lg\"\r\n                                        >\r\n                                            {SECTIONS.map(s => <option key={s} value={s}>{s}</option>)}\r\n                                        </select>\r\n                                    </div>\r\n                                    <div className=\"flex items-center pt-6\">\r\n                                        <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                checked={editingField.required}\r\n                                                onChange={e => setEditingField({ ...editingField, required: e.target.checked })}\r\n                                                className=\"w-5 h-5 text-blue-600 rounded\"\r\n                                            />\r\n                                            <span className=\"text-sm font-medium text-slate-700\">Required Field?</span>\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {editingField.type === 'dropdown' && (\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1\">Options (Comma separated)</label>\r\n                                        <input\r\n                                            value={Array.isArray(editingField.options) ? editingField.options.join(', ') : ''}\r\n                                            onChange={e => setEditingField({ ...editingField, options: e.target.value.split(',').map(s => s.trim()) })}\r\n                                            className=\"w-full px-3 py-2 border border-slate-300 rounded-lg\"\r\n                                            placeholder=\"Option A, Option B\"\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"flex justify-end gap-3 pt-4\">\r\n                                    <button type=\"button\" onClick={() => setEditingField(null)} className=\"px-4 py-2 text-slate-500 hover:text-slate-700\">Cancel</button>\r\n                                    <button type=\"button\" onClick={saveField} className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\">Apply Field</button>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"flex-1 flex flex-col items-center justify-center text-slate-400 border-2 border-dashed border-slate-200 rounded-xl\">\r\n                            <p>Select a field to edit or click \"+ Add Custom Field\"</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\DynamicFormRenderer.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\EmployeeProfileView.jsx","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":276,"column":33,"nodeType":"TemplateElement","messageId":"unnecessaryEscape","endLine":276,"endColumn":34,"suggestions":[{"messageId":"removeEscape","fix":{"range":[18709,18710],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[18709,18709],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Tabs, Tag, Button } from 'antd';\r\nimport {\r\n    User, Briefcase, FileText, MapPin,\r\n    Calendar, Mail, Phone, Shield,\r\n    GraduationCap, Landmark, Printer,\r\n    CreditCard, Heart, Globe, Users\r\n} from 'lucide-react';\r\nimport { formatDateDDMMYYYY } from '../utils/dateUtils';\r\n\r\nconst BACKEND_URL = import.meta.env.VITE_BACKEND_URL || 'https://hrms.gitakshmi.com';\r\n\r\nconst InfoGroup = ({ title, children, icon: Icon }) => (\r\n    <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md rounded-[2rem] border border-slate-200/60 dark:border-slate-800/60 shadow-lg overflow-hidden mb-8 transition-all hover:shadow-xl group\">\r\n        <div className=\"px-8 py-5 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-xl bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 group-hover:scale-110 transition-transform\">\r\n                    {Icon && <Icon size={18} />}\r\n                </div>\r\n                <h3 className=\"text-sm font-black text-slate-800 dark:text-white uppercase tracking-[0.2em]\">{title}</h3>\r\n            </div>\r\n            <div className=\"w-1.5 h-1.5 rounded-full bg-slate-200 dark:bg-slate-700\"></div>\r\n        </div>\r\n        <div className=\"p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n            {children}\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst DetailItem = ({ label, value, icon: Icon }) => (\r\n    <div className=\"flex flex-col gap-2 group/item\">\r\n        <div className=\"flex items-center gap-2\">\r\n            <div className=\"p-1 rounded bg-slate-50 dark:bg-slate-800 text-slate-400 group-hover/item:text-indigo-500 transition-colors\">\r\n                {Icon ? <Icon size={10} /> : <div className=\"w-2.5 h-2.5 rounded-full border border-current opacity-30\"></div>}\r\n            </div>\r\n            <span className=\"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest\">{label}</span>\r\n        </div>\r\n        <div className=\"text-sm font-bold text-slate-700 dark:text-slate-200 tracking-tight pl-0.5\">\r\n            {value || <span className=\"text-slate-300 dark:text-slate-700 font-medium italic\">Pending Verification</span>}\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst FileDownloadLink = ({ url, label }) => {\r\n    if (!url) return (\r\n        <div className=\"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-slate-300 dark:text-slate-700 py-3 border border-slate-100 dark:border-slate-800 border-dashed rounded-xl px-4 italic\">\r\n            <FileText size={12} /> {label}: Unavailable\r\n        </div>\r\n    );\r\n    return (\r\n        <a\r\n            href={`${BACKEND_URL}${url}`}\r\n            target=\"_blank\"\r\n            rel=\"noreferrer\"\r\n            className=\"flex items-center justify-between gap-3 text-indigo-600 dark:text-indigo-400 bg-indigo-50/50 dark:bg-indigo-900/20 px-4 py-3 rounded-xl transition-all border border-indigo-100 dark:border-indigo-800/50 hover:bg-indigo-600 hover:text-white dark:hover:bg-indigo-600 group\"\r\n        >\r\n            <div className=\"flex items-center gap-3 overflow-hidden\">\r\n                <FileText size={16} className=\"group-hover:text-white shrink-0\" />\r\n                <span className=\"text-[10px] font-black uppercase tracking-widest truncate\">{label}</span>\r\n            </div>\r\n            <div className=\"shrink-0 opacity-40 group-hover:opacity-100 group-hover:translate-x-1 transition-all\">\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\" /></svg>\r\n            </div>\r\n        </a>\r\n    );\r\n};\r\n\r\nexport default function EmployeeProfileView({ employee, profile }) {\r\n    const [activeTab, setActiveTab] = useState('1');\r\n    const emp = employee || profile;\r\n\r\n    if (!emp) return (\r\n        <div className=\"flex flex-col items-center justify-center p-20 text-slate-400 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200\">\r\n            <User size={48} className=\"mb-4 opacity-20\" />\r\n            <p className=\"font-bold uppercase tracking-widest text-xs\">No employee record found</p>\r\n        </div>\r\n    );\r\n\r\n    const items = [\r\n        {\r\n            key: '1',\r\n            label: <span className=\"flex items-center gap-2 px-2\"><User size={16} /> Personal</span>,\r\n            children: (\r\n                <div className=\"animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n                    <InfoGroup title=\"Identity & Personal\" icon={User}>\r\n                        <DetailItem label=\"Full Name\" value={`${emp.firstName} ${emp.middleName ? emp.middleName + ' ' : ''}${emp.lastName}`} icon={User} />\r\n                        <DetailItem label=\"Date of Birth\" value={formatDateDDMMYYYY(emp.dob)} icon={Calendar} />\r\n                        <DetailItem label=\"Gender\" value={emp.gender} icon={Users} />\r\n                        <DetailItem label=\"Blood Group\" value={emp.bloodGroup} icon={Heart} />\r\n                        <DetailItem label=\"Marital Status\" value={emp.maritalStatus} icon={Users} />\r\n                        <DetailItem label=\"Nationality\" value={emp.nationality} icon={Globe} />\r\n                    </InfoGroup>\r\n\r\n                    <InfoGroup title=\"Family Details\" icon={Users}>\r\n                        <DetailItem label=\"Father's Name\" value={emp.fatherName} />\r\n                        <DetailItem label=\"Mother's Name\" value={emp.motherName} />\r\n                        <DetailItem label=\"Emergency Contact\" value={emp.emergencyContactName} />\r\n                        <DetailItem label=\"Emergency No.\" value={emp.emergencyContactNumber} />\r\n                    </InfoGroup>\r\n\r\n                    <InfoGroup title=\"Address Information\" icon={MapPin}>\r\n                        <div className=\"col-span-full grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                            <div className=\"p-4 bg-slate-50 rounded-xl border border-slate-100\">\r\n                                <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 flex items-center gap-2\">\r\n                                    <div className=\"w-1.5 h-1.5 rounded-full bg-blue-500\"></div> Temporary Address\r\n                                </h4>\r\n                                <p className=\"text-sm text-slate-700 leading-relaxed font-medium\">\r\n                                    {emp.tempAddress?.line1}, {emp.tempAddress?.line2 && emp.tempAddress?.line2 + ', '}<br />\r\n                                    {emp.tempAddress?.city}, {emp.tempAddress?.state} - {emp.tempAddress?.pinCode}<br />\r\n                                    {emp.tempAddress?.country}\r\n                                </p>\r\n                            </div>\r\n                            <div className=\"p-4 bg-slate-50 rounded-xl border border-slate-100\">\r\n                                <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 flex items-center gap-2\">\r\n                                    <div className=\"w-1.5 h-1.5 rounded-full bg-emerald-500\"></div> Permanent Address\r\n                                </h4>\r\n                                <p className=\"text-sm text-slate-700 leading-relaxed font-medium\">\r\n                                    {emp.permAddress?.line1}, {emp.permAddress?.line2 && emp.permAddress?.line2 + ', '}<br />\r\n                                    {emp.permAddress?.city}, {emp.permAddress?.state} - {emp.permAddress?.pinCode}<br />\r\n                                    {emp.permAddress?.country}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </InfoGroup>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: '2',\r\n            label: <span className=\"flex items-center gap-2 px-2\"><Briefcase size={16} /> Employment</span>,\r\n            children: (\r\n                <div className=\"animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n                    <InfoGroup title=\"Organization Details\" icon={Shield}>\r\n                        <DetailItem label=\"Employee ID\" value={emp.employeeId} icon={Shield} />\r\n                        <DetailItem label=\"Joining Date\" value={formatDateDDMMYYYY(emp.joiningDate)} icon={Calendar} />\r\n                        <DetailItem label=\"Designation\" value={emp.role} icon={Briefcase} />\r\n                        <DetailItem label=\"Department\" value={emp.department} icon={Globe} />\r\n                        <DetailItem label=\"Job Type\" value={emp.jobType} icon={Briefcase} />\r\n                        <DetailItem label=\"Reporting Manager\" value={\r\n                            emp.manager\r\n                                ? (typeof emp.manager === 'object' ? `${emp.manager.firstName} ${emp.manager.lastName}` : 'Assigned')\r\n                                : 'Top Level'\r\n                        } icon={Users} />\r\n                    </InfoGroup>\r\n\r\n                    <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden mb-6\">\r\n                        <div className=\"px-5 py-4 border-b border-slate-100 bg-slate-50/50 flex items-center gap-2\">\r\n                            <Briefcase size={18} className=\"text-blue-600\" />\r\n                            <h3 className=\"text-sm font-bold text-slate-800 uppercase tracking-tight\">Experience History</h3>\r\n                        </div>\r\n                        <div className=\"p-6\">\r\n                            {emp.experience && emp.experience.length > 0 ? (\r\n                                <div className=\"space-y-6\">\r\n                                    {emp.experience.map((exp, idx) => (\r\n                                        <div key={idx} className=\"relative pl-8 border-l-2 border-slate-100 last:border-0 pb-4\">\r\n                                            <div className=\"absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-white border-2 border-blue-600 shadow-sm z-10\"></div>\r\n                                            <div className=\"flex flex-col sm:flex-row sm:justify-between items-start mb-3\">\r\n                                                <div>\r\n                                                    <h4 className=\"text-base font-bold text-slate-900\">{exp.companyName}</h4>\r\n                                                    <p className=\"text-blue-600 text-xs font-bold uppercase tracking-tight\">{exp.designation}</p>\r\n                                                </div>\r\n                                                <div className=\"mt-2 sm:mt-0 px-3 py-1 bg-slate-100 text-slate-600 rounded-full text-[10px] font-black tracking-widest uppercase\">\r\n                                                    {formatDateDDMMYYYY(exp.from)} - {formatDateDDMMYYYY(exp.to)}\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 bg-slate-50/50 p-4 rounded-xl border border-slate-100/50\">\r\n                                                <DetailItem label=\"Last Salary\" value={exp.lastDrawnSalary} />\r\n                                                <DetailItem label=\"Mgr Name\" value={exp.reportingPersonName} />\r\n                                                <DetailItem label=\"Mgr Contact\" value={exp.reportingPersonContact} />\r\n                                                {/* Payslips if any */}\r\n                                                {exp.payslips && exp.payslips.length > 0 && (\r\n                                                    <div className=\"col-span-full pt-2 flex flex-wrap gap-2\">\r\n                                                        {exp.payslips.map((p, i) => (\r\n                                                            <a key={i} href={`${BACKEND_URL}${p}`} target=\"_blank\" rel=\"noreferrer\" className=\"text-[10px] bg-white border border-slate-200 text-slate-600 px-2 py-1 rounded-md hover:border-blue-500 hover:text-blue-600 transition flex items-center gap-1.5\">\r\n                                                                <FileText size={12} /> Payslip {i + 1}\r\n                                                            </a>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            ) : (\r\n                                <p className=\"text-center py-6 text-slate-400 text-sm italic\">No prior experience records.</p>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: '3',\r\n            label: <span className=\"flex items-center gap-2 px-2\"><GraduationCap size={16} /> Education</span>,\r\n            children: (\r\n                <div className=\"animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n                    <InfoGroup title=\"Academic Background\" icon={GraduationCap}>\r\n                        <div className=\"col-span-full\">\r\n                            <Tag color=\"blue\" className=\"mb-6 font-bold uppercase tracking-widest text-[10px] px-3 py-1\">\r\n                                {emp.education?.type || 'Standard'} Qualification\r\n                            </Tag>\r\n                            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                                <FileDownloadLink url={emp.education?.class10Marksheet} label=\"10th Marksheet\" />\r\n                                {emp.education?.type === 'Bachelor' ? (\r\n                                    <>\r\n                                        <FileDownloadLink url={emp.education?.class12Marksheet} label=\"12th Marksheet\" />\r\n                                        <FileDownloadLink url={emp.education?.bachelorDegree} label=\"Bachelor Degree\" />\r\n                                        <FileDownloadLink url={emp.education?.masterDegree} label=\"Master Degree\" />\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <FileDownloadLink url={emp.education?.diplomaCertificate} label=\"Diploma Certificate\" />\r\n                                        <FileDownloadLink url={emp.education?.lastSem1Marksheet} label=\"Sem 1 Marksheet\" />\r\n                                        <FileDownloadLink url={emp.education?.lastSem2Marksheet} label=\"Sem 2 Marksheet\" />\r\n                                        <FileDownloadLink url={emp.education?.lastSem3Marksheet} label=\"Sem 3 Marksheet\" />\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </InfoGroup>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            key: '4',\r\n            label: <span className=\"flex items-center gap-2 px-2\"><Shield size={16} /> Docs & Bank</span>,\r\n            children: (\r\n                <div className=\"animate-in fade-in slide-in-from-bottom-2 duration-300\">\r\n                    <InfoGroup title=\"Financial Information\" icon={Landmark}>\r\n                        <DetailItem label=\"Bank Name\" value={emp.bankDetails?.bankName} icon={Landmark} />\r\n                        <DetailItem label=\"Account Number\" value={emp.bankDetails?.accountNumber} icon={CreditCard} />\r\n                        <DetailItem label=\"IFSC Code\" value={emp.bankDetails?.ifsc} />\r\n                        <DetailItem label=\"Branch Name\" value={emp.bankDetails?.branchName} />\r\n                        <div className=\"col-span-full mt-2\">\r\n                            <FileDownloadLink url={emp.bankDetails?.bankProofUrl} label=\"Bank Proof (Passbook/Cheque)\" />\r\n                        </div>\r\n                    </InfoGroup>\r\n\r\n                    <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden mb-6\">\r\n                        <div className=\"px-5 py-4 border-b border-slate-100 bg-slate-50/50 flex items-center gap-2\">\r\n                            <Shield size={18} className=\"text-blue-600\" />\r\n                            <h3 className=\"text-sm font-bold text-slate-800 uppercase tracking-tight\">Identity Documents</h3>\r\n                        </div>\r\n                        <div className=\"p-5 grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                            <div>\r\n                                <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3\">Aadhar Verification</h4>\r\n                                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                                    <FileDownloadLink url={emp.documents?.aadharFront} label=\"Aadhar Front\" />\r\n                                    <FileDownloadLink url={emp.documents?.aadharBack} label=\"Aadhar Back\" />\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3\">Tax Identification</h4>\r\n                                <FileDownloadLink url={emp.documents?.panCard} label=\"PAN Card\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <style>{`\r\n                .ant-tabs-nav-wrap { padding: 0 1rem; }\r\n                .ant-tabs-tab { padding: 12px 0 !important; margin: 0 16px !important; }\r\n                .ant-tabs-tab-active .ant-tabs-tab-btn { color: #2563eb !important; font-weight: 800 !important; }\r\n                .ant-tabs-ink-bar { background: #2563eb !important; height: 3px !important; border-radius: 3px 3px 0 0; }\r\n                \r\n                @media print {\r\n                    .no-print { display: none !important; }\r\n                    .print-only { display: block !important; }\r\n                    body { background: white !important; font-size: 10pt !important; }\r\n                    .bg-white { box-shadow: none !important; border: 1px solid #eee !important; }\r\n                    .bg-slate-50\\/50, .bg-slate-50 { background-color: #f8fafc !important; -webkit-print-color-adjust: exact; }\r\n                    .ant-tabs-nav { display: none !important; }\r\n                    .ant-tabs-content-holder { display: block !important; }\r\n                    .print-section { page-break-inside: avoid; margin-bottom: 2rem; }\r\n                }\r\n                .print-only { display: none; }\r\n            `}</style>\r\n\r\n            {/* 1. PREMIUM HEADER */}\r\n            <div className=\"relative overflow-hidden bg-slate-900 rounded-[2rem] shadow-2xl shadow-blue-900/10 p-1 group\">\r\n                {/* Decorative Elements */}\r\n                <div className=\"absolute top-0 right-0 w-96 h-96 bg-blue-600/20 rounded-full blur-[100px] -translate-y-1/2 translate-x-1/2\"></div>\r\n                <div className=\"absolute bottom-0 left-0 w-64 h-64 bg-indigo-600/10 rounded-full blur-[80px] translate-y-1/2 -translate-x-1/2\"></div>\r\n\r\n                <div className=\"relative bg-white dark:bg-slate-900 rounded-[1.8rem] p-6 sm:p-8 flex flex-col md:flex-row gap-8 items-center md:items-start transition-all duration-500\">\r\n                    {/* Avatar Section */}\r\n                    <div className=\"relative shrink-0\">\r\n                        <div className=\"w-36 h-36 rounded-3xl overflow-hidden bg-slate-100 border-4 border-white dark:border-slate-800 shadow-xl relative group\">\r\n                            {emp.profilePic ? (\r\n                                <img src={`${BACKEND_URL}${emp.profilePic}`} alt=\"Profile\" className=\"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110\" />\r\n                            ) : (\r\n                                <div className=\"w-full h-full flex items-center justify-center text-5xl font-black text-slate-300 bg-slate-50 uppercase tracking-tighter\">\r\n                                    {emp.firstName?.[0]}{emp.lastName?.[0]}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"absolute -bottom-2 -right-2 bg-emerald-500 border-4 border-white dark:border-slate-800 w-8 h-8 rounded-full shadow-lg\" title=\"Active Account\"></div>\r\n                    </div>\r\n\r\n                    {/* Meta Section */}\r\n                    <div className=\"flex-1 w-full text-center md:text-left\">\r\n                        <div className=\"flex flex-col md:flex-row justify-between items-start gap-4 mb-6\">\r\n                            <div>\r\n                                <h1 className=\"text-3xl sm:text-4xl font-black text-slate-900 dark:text-white tracking-tighter mb-2\">\r\n                                    {emp.firstName} {emp.lastName}\r\n                                </h1>\r\n                                <div className=\"flex flex-wrap items-center justify-center md:justify-start gap-3\">\r\n                                    <span className=\"text-blue-600 font-black uppercase tracking-widest text-[10px] bg-blue-50 px-3 py-1 rounded-lg border border-blue-100\">\r\n                                        {emp.role}\r\n                                    </span>\r\n                                    <span className=\"w-1.5 h-1.5 rounded-full bg-slate-300\"></span>\r\n                                    <span className=\"text-slate-500 font-bold text-sm\">\r\n                                        {emp.department} Unit\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex gap-2 mx-auto md:mx-0\">\r\n                                <Tag color={emp.status === 'Active' ? 'success' : 'warning'} className=\"font-black uppercase tracking-widest text-[10px] m-0 px-4 py-1.5 rounded-full shadow-sm\">\r\n                                    {emp.status}\r\n                                </Tag>\r\n                                <Button\r\n                                    icon={<Printer size={14} />}\r\n                                    onClick={() => window.print()}\r\n                                    className=\"no-print rounded-full font-black uppercase tracking-widest text-[10px] h-9 border-slate-200\"\r\n                                >\r\n                                    Print\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Quick Stats Grid */}\r\n                        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 border-t border-slate-100 dark:border-slate-800 pt-6\">\r\n                            <div className=\"flex items-center gap-3 px-2\">\r\n                                <div className=\"w-10 h-10 rounded-2xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-600\">\r\n                                    <Mail size={18} />\r\n                                </div>\r\n                                <div className=\"text-left overflow-hidden\">\r\n                                    <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">Email Address</p>\r\n                                    <p className=\"text-sm font-bold text-slate-700 dark:text-slate-300 truncate\" title={emp.email}>{emp.email}</p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3 px-2\">\r\n                                <div className=\"w-10 h-10 rounded-2xl bg-emerald-50 dark:bg-emerald-900/20 flex items-center justify-center text-emerald-600\">\r\n                                    <Phone size={18} />\r\n                                </div>\r\n                                <div className=\"text-left\">\r\n                                    <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">Contact No</p>\r\n                                    <p className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">{emp.contactNo || emp.phone || 'N/A'}</p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3 px-2\">\r\n                                <div className=\"w-10 h-10 rounded-2xl bg-amber-50 dark:bg-amber-900/20 flex items-center justify-center text-amber-600\">\r\n                                    <Shield size={18} />\r\n                                </div>\r\n                                <div className=\"text-left\">\r\n                                    <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">System Code</p>\r\n                                    <p className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">{emp.employeeId}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* 2. TABBED CONTENT */}\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-xl shadow-slate-200/50 dark:shadow-none overflow-hidden no-print\">\r\n                <Tabs\r\n                    activeKey={activeTab}\r\n                    onChange={setActiveTab}\r\n                    items={items}\r\n                    className=\"p-2 ant-tabs-modern\"\r\n                />\r\n            </div>\r\n\r\n            {/* 3. PRINT ONLY VIEW (Full dump) */}\r\n            <div className=\"print-only\">\r\n                <h2 className=\"text-xl font-bold uppercase mb-8 border-b-4 border-slate-900 pb-2\">Employee Master Record</h2>\r\n                {items.map(item => (\r\n                    <div key={item.key} className=\"print-section\">\r\n                        {item.children}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\EmployeeSidebar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\HRSidebar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\Icons.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\JobCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\JobModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\LetterFooter.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\LetterSignatureBlock.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\LetterWrapper.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\MyAttendanceView.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":10,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"loading"},"fix":{"range":[393,400],"text":""},"desc":"Remove unused variable 'loading'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAttendance'. Either include it or remove the dependency array.","line":20,"column":8,"nodeType":"ArrayExpression","endLine":20,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [currentMonth, currentYear, fetchAttendance]","fix":{"range":[915,942],"text":"[currentMonth, currentYear, fetchAttendance]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport api from '../utils/api';\r\nimport AttendanceCalendar from './AttendanceCalendar';\r\nimport { ChevronLeft, ChevronRight, Download, Filter } from 'lucide-react';\r\nimport { formatDateDDMMYYYY } from '../utils/dateUtils';\r\n\r\n\r\nexport default function MyAttendanceView() {\r\n    const [attendance, setAttendance] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());\r\n    const [currentYear, setCurrentYear] = useState(new Date().getFullYear());\r\n    const [summary, setSummary] = useState({ present: 0, absent: 0, leave: 0, late: 0, hours: 0 });\r\n    const [statusFilter, setStatusFilter] = useState('all');\r\n    const [holidays, setHolidays] = useState([]);\r\n    const [settings, setSettings] = useState({});\r\n\r\n    useEffect(() => {\r\n        fetchAttendance();\r\n    }, [currentMonth, currentYear]);\r\n\r\n    const fetchAttendance = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const t = new Date().getTime();\r\n            // Fetch Attendance, Leaves, Holidays, and Settings in parallel\r\n            const [attRes, leaveRes, holidayRes, settingsRes] = await Promise.all([\r\n                api.get(`/attendance/my?month=${currentMonth + 1}&year=${currentYear}&t=${t}`),\r\n                api.get(`/employee/leaves/history?t=${t}`),\r\n                api.get(`/holidays?t=${t}`),\r\n                api.get(`/attendance/settings?t=${t}`)\r\n            ]); \r\n\r\n            const rawAttendance = attRes.data || [];\r\n            const leaves = leaveRes.data || [];\r\n\r\n            // --- Merge Leaves into Attendance Data (Client-Side Patch) ---\r\n            // This ensures \"On Leave\" shows up even if backend sync failed or for Pending leaves\r\n\r\n            // 1. Create a map of existing attendance dates\r\n            const attendanceMap = new Set(rawAttendance.map(a => new Date(a.date).toDateString()));\r\n\r\n            // 2. Identify view range\r\n            const viewStart = new Date(currentYear, currentMonth, 1);\r\n            const viewEnd = new Date(currentYear, currentMonth + 1, 0);\r\n\r\n            const mergedAttendance = [...rawAttendance];\r\n\r\n            leaves.forEach(leave => {\r\n                // Only consider Active leaves\r\n                if (!['Approved', 'Pending'].includes(leave.status)) return;\r\n\r\n                const start = new Date(leave.startDate);\r\n                const end = new Date(leave.endDate);\r\n\r\n                // Iterate through leave days\r\n                for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {\r\n                    // Check if date is within current view month\r\n                    if (d < viewStart || d > viewEnd) continue;\r\n\r\n                    // If no attendance record exists for this date, create a synthetic one\r\n                    if (!attendanceMap.has(d.toDateString())) {\r\n                        mergedAttendance.push({\r\n                            _id: `synthetic-leave-${d.getTime()}`,\r\n                            date: d.toISOString(),\r\n                            status: 'leave', // Force status to leave for visualization\r\n                            leaveType: leave.leaveType,\r\n                            isSynthetic: true, // Marker\r\n                            checkIn: null,\r\n                            checkOut: null,\r\n                            workingHours: 0,\r\n                            isLate: false\r\n                        });\r\n                        attendanceMap.add(d.toDateString()); // Prevent dupes if overlapping leaves exist (rare)\r\n                    }\r\n                }\r\n            });\r\n\r\n            // Sort by date again after merge\r\n            mergedAttendance.sort((a, b) => new Date(a.date) - new Date(b.date));\r\n\r\n            setAttendance(mergedAttendance);\r\n            setHolidays(holidayRes.data || []);\r\n            setSettings(settingsRes.data || {});\r\n\r\n            // Calculate Summary\r\n            const stats = mergedAttendance.reduce((acc, item) => {\r\n                const s = (item.status || '').toLowerCase();\r\n\r\n                if (s === 'present' || s === 'half_day') acc.present++;\r\n                if (s === 'absent') acc.absent++;\r\n                // \"On Leave\" count now includes synthetic leaves (Applied/Approved but not synced)\r\n                if (s === 'leave') acc.leave++;\r\n                if (item.isLate) acc.late++;\r\n                acc.hours += (item.workingHours || 0);\r\n                return acc;\r\n            }, { present: 0, absent: 0, leave: 0, late: 0, hours: 0 });\r\n\r\n            setSummary(stats);\r\n        } catch (err) {\r\n            console.error(\"Failed to fetch attendance\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const nextMonth = () => {\r\n        if (currentMonth === 11) {\r\n            setCurrentMonth(0);\r\n            setCurrentYear(prev => prev + 1);\r\n        } else {\r\n            setCurrentMonth(prev => prev + 1);\r\n        }\r\n    };\r\n\r\n    const prevMonth = () => {\r\n        if (currentMonth === 0) {\r\n            setCurrentMonth(11);\r\n            setCurrentYear(prev => prev - 1);\r\n        } else {\r\n            setCurrentMonth(prev => prev - 1);\r\n        }\r\n    };\r\n\r\n    const handleExport = async () => {\r\n        if (!attendance.length) return alert(\"No data to export\");\r\n\r\n        const headers = [\"Employee_id\", \"Employee_Name\", \"Date\", \"Status\", \"Check In\", \"Check Out\", \"Working Hours\", \"Is Late\"];\r\n        const tenant = localStorage.getItem(\"tenantId\");\r\n        console.log(tenant);\r\n\r\n        // const attandanceData = await attendance.find({}).lean();\r\n        // console.log(attandanceData);\r\n        // const employee = employee.find({tenant: tenant });\r\n        // console.log(attendance);\r\n\r\n        const rows = attendance.map(item => [\r\n            item.employee.employeeId,\r\n            (item.employee.firstName + \" \" +item.employee.lastName),\r\n            formatDateDDMMYYYY(item.date),\r\n            (item.leaveType ? `${item.status} (${item.leaveType})` : item.status).toUpperCase(),\r\n            item.checkIn ? new Date(item.checkIn).toLocaleTimeString() : '-',\r\n            item.checkOut ? new Date(item.checkOut).toLocaleTimeString() : '-',\r\n            item.workingHours || 0,\r\n            item.isLate ? \"YES\" : \"NO\"\r\n        ]);\r\n\r\n        const csvContent = [headers, ...rows].map(e => e.join(\",\")).join(\"\\n\");\r\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n        const url = URL.createObjectURL(blob);\r\n        const link = document.createElement(\"a\");\r\n        link.setAttribute(\"href\", url);\r\n        link.setAttribute(\"download\", `Attendance_${currentMonth + 1}_${currentYear}.csv`);\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n    };\r\n\r\n    const filteredAttendance = attendance.filter(item => {\r\n        if (statusFilter === 'all') return true;\r\n        return (item.status || '').toLowerCase() === statusFilter.toLowerCase();\r\n    });\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-in fade-in duration-500\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-3xl font-black text-slate-800 dark:text-white tracking-tighter uppercase\">My Attendance</h2>\r\n                    <p className=\"text-xs font-bold text-slate-400 uppercase tracking-widest mt-1\">Track your presence and working hours</p>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3 bg-white dark:bg-slate-900 p-2 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm\">\r\n                    <button onClick={prevMonth} className=\"p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition\"><ChevronLeft size={20} /></button>\r\n                    <div className=\"px-4 text-sm font-black text-slate-700 dark:text-slate-300 min-w-[140px] text-center uppercase tracking-tighter\">\r\n                        {new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long', year: 'numeric' })}\r\n                    </div>\r\n                    <button onClick={nextMonth} className=\"p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition\"><ChevronRight size={20} /></button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Summary Grid */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-6\">\r\n                <SummaryCard label=\"Present\" value={summary.present} color=\"text-emerald-500\" bg=\"bg-emerald-500\" />\r\n                <SummaryCard label=\"Absent\" value={summary.absent} color=\"text-rose-500\" bg=\"bg-rose-500\" />\r\n                <SummaryCard label=\"On Leave\" value={summary.leave} color=\"text-blue-500\" bg=\"bg-blue-500\" />\r\n                <SummaryCard label=\"Late Marks\" value={summary.late} color=\"text-amber-500\" bg=\"bg-amber-500\" />\r\n                <SummaryCard label=\"Total Hours\" value={summary.hours.toFixed(1)} color=\"text-indigo-500\" bg=\"bg-indigo-500\" unit=\"HRS\" />\r\n            </div>\r\n\r\n            {/* Calendar Section */}\r\n            <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between px-2\">\r\n                    <h3 className=\"text-xs font-black text-slate-500 uppercase tracking-widest\">Attendance Register</h3>\r\n                    <div className=\"flex gap-2\">\r\n                        <div className=\"relative\">\r\n                            <select\r\n                                value={statusFilter}\r\n                                onChange={(e) => setStatusFilter(e.target.value)}\r\n                                className=\"appearance-none flex items-center gap-2 pl-4 pr-10 py-2 text-[10px] font-black uppercase tracking-widest bg-white dark:bg-slate-900 text-slate-500 rounded-xl border border-slate-100 dark:border-slate-800 hover:bg-slate-50 transition shadow-sm outline-none\"\r\n                            >\r\n                                <option value=\"all\">All Records</option>\r\n                                <option value=\"present\">Present Only</option>\r\n                                <option value=\"absent\">Absent Only</option>\r\n                                <option value=\"leave\">On Leave</option>\r\n                                <option value=\"half_day\">Half Day</option>\r\n                            </select>\r\n                            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400\">\r\n                                <Filter size={12} />\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleExport}\r\n                            className=\"flex items-center gap-2 px-6 py-2 text-[10px] font-black uppercase tracking-widest bg-blue-600 text-white rounded-xl shadow-lg shadow-blue-500/20 hover:bg-blue-700 transition\"\r\n                        >\r\n                            <Download size={14} /> Export CSV\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                <AttendanceCalendar\r\n                    data={filteredAttendance}\r\n                    holidays={holidays}\r\n                    settings={settings}\r\n                    currentMonth={currentMonth}\r\n                    currentYear={currentYear}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction SummaryCard({ label, value, color, bg, unit }) {\r\n    return (\r\n        <div className=\"bg-white dark:bg-slate-900 p-6 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/40 dark:shadow-none\">\r\n            <div className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3\">{label}</div>\r\n            <div className={`text-4xl font-black ${color} tracking-tighter flex items-baseline gap-1`}>\r\n                {value}\r\n                {unit && <span className=\"text-[10px] opacity-50\">{unit}</span>}\r\n            </div>\r\n            <div className={`h-1 w-8 rounded-full mt-4 ${bg} opacity-20`}></div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\NotificationDropdown.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  28 |\n  29 |     useEffect(() => {\n> 30 |         fetchNotifications();\n     |         ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  31 |         const interval = setInterval(fetchNotifications, 300000); // Poll every 5 minutes instead of 1 minute\n  32 |         return () => clearInterval(interval);\n  33 |     }, []);","line":30,"column":9,"nodeType":null,"endLine":30,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api from '../utils/api'; // Centralized axios instance with auth & tenant headers\r\nimport { useAuth } from '../context/AuthContext';\r\n\r\n\r\nexport default function NotificationDropdown() {\r\n    const { user } = useAuth();\r\n    const [notifications, setNotifications] = useState([]);\r\n    const [unreadCount, setUnreadCount] = useState(0);\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const dropdownRef = useRef(null);\r\n    const navigate = useNavigate();\r\n\r\n\r\n    const fetchNotifications = async () => {\r\n        try {\r\n            // Uses centralized api instance - automatically includes Authorization & X-Tenant-ID headers\r\n            const res = await api.get('/notifications');\r\n            if (res.data) {\r\n                setNotifications(res.data.notifications || []);\r\n                setUnreadCount(res.data.unreadCount || 0);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch notifications\", error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchNotifications();\r\n        const interval = setInterval(fetchNotifications, 300000); // Poll every 5 minutes instead of 1 minute\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    // Close when clicking outside\r\n    useEffect(() => {\r\n        function handleClickOutside(event) {\r\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\r\n                setIsOpen(false);\r\n            }\r\n        }\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, [dropdownRef]);\r\n\r\n    const handleNotificationClick = async (notif) => {\r\n        if (!notif.isRead) {\r\n            try {\r\n                await api.patch(`/notifications/${notif._id}/read`);\r\n                // Update local state\r\n                setNotifications(prev => prev.map(n => n._id === notif._id ? { ...n, isRead: true } : n));\r\n                setUnreadCount(prev => Math.max(0, prev - 1));\r\n            } catch (error) {\r\n                console.error(\"Failed to mark read\", error);\r\n            }\r\n        }\r\n\r\n        // Unified Detail Redirection\r\n        const { entityType, entityId } = notif;\r\n        const isHr = ['hr', 'admin'].includes(user?.role);\r\n        const basePath = isHr ? '/hr/details' : '/employee/details';\r\n\r\n        navigate(`${basePath}/${entityType}/${entityId}`);\r\n        setIsOpen(false);\r\n    };\r\n\r\n\r\n\r\n    const markAllRead = async () => {\r\n        try {\r\n            await api.patch('/notifications/read-all');\r\n            setNotifications(prev => prev.map(n => ({ ...n, isRead: true })));\r\n            setUnreadCount(0);\r\n        } catch (error) {\r\n            console.error(\"Failed to mark all read\", error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative\" ref={dropdownRef}>\r\n            <button\r\n                onClick={() => setIsOpen(!isOpen)}\r\n                className=\"relative p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition text-slate-600 dark:text-slate-300\"\r\n            >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\" />\r\n                </svg>\r\n\r\n                {unreadCount > 0 && (\r\n                    <span className=\"absolute top-1.5 right-1.5 flex h-4 w-4\">\r\n                        <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\r\n                        <span className=\"relative inline-flex rounded-full h-4 w-4 bg-red-500 text-white text-[10px] items-center justify-center font-bold\">\r\n                            {unreadCount > 9 ? '9+' : unreadCount}\r\n                        </span>\r\n                    </span>\r\n                )}\r\n            </button>\r\n\r\n            {isOpen && (\r\n                <div className=\"absolute top-full right-0 mt-2 w-80 md:w-96 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden z-50\">\r\n                    <div className=\"px-4 py-3 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center\">\r\n                        <h3 className=\"font-semibold text-slate-800 dark:text-white\">Notifications</h3>\r\n                        {unreadCount > 0 && (\r\n                            <button onClick={markAllRead} className=\"text-xs text-blue-600 dark:text-blue-400 hover:underline\">\r\n                                Mark all read\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"max-h-[400px] overflow-y-auto\">\r\n                        {notifications.length === 0 ? (\r\n                            <div className=\"p-6 text-center text-slate-500 dark:text-slate-400 text-sm\">\r\n                                No notifications yet.\r\n                            </div>\r\n                        ) : (\r\n                            <ul className=\"divide-y divide-slate-100 dark:divide-slate-700\">\r\n                                {notifications.map((notif) => (\r\n                                    <li\r\n                                        key={notif._id}\r\n                                        onClick={() => handleNotificationClick(notif)}\r\n                                        className={`p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 cursor-pointer transition ${!notif.isRead ? 'bg-blue-50/50 dark:bg-blue-900/10' : ''}`}\r\n                                    >\r\n                                        <div className=\"flex gap-3\">\r\n                                            <div className=\"flex-shrink-0 mt-1\">\r\n                                                <div className={`h-8 w-8 rounded-full flex items-center justify-center ${notif.type === 'LEAVE_APPLIED' ? 'bg-orange-100 text-orange-600' : 'bg-slate-100 text-slate-600'}`}>\r\n                                                    {notif.sender?.profilePic ? (\r\n                                                        <img src={notif.sender.profilePic} alt=\"\" className=\"h-8 w-8 rounded-full object-cover\" />\r\n                                                    ) : (\r\n                                                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                                                        </svg>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <p className={`text-sm font-medium ${!notif.isRead ? 'text-slate-900 dark:text-white' : 'text-slate-700 dark:text-slate-300'}`}>\r\n                                                    {notif.title}\r\n                                                </p>\r\n                                                <p className=\"text-xs text-slate-500 dark:text-slate-400 mt-1 line-clamp-2\">\r\n                                                    {notif.message}\r\n                                                </p>\r\n                                                <div className=\"mt-2 flex items-center gap-2\">\r\n                                                    <span className=\"text-[10px] text-slate-400\">\r\n                                                        {new Date(notif.createdAt).toLocaleString([], { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}\r\n                                                    </span>\r\n                                                    {!notif.isRead && <span className=\"h-1.5 w-1.5 rounded-full bg-blue-500\"></span>}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </li>\r\n                                ))}\r\n                            </ul>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"p-2 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 text-center\">\r\n                        <button\r\n                            onClick={() => {\r\n                                const isHr = ['hr', 'admin'].includes(user?.role);\r\n                                const basePath = isHr ? '/hr' : '/employee';\r\n                                navigate(`${basePath}/my-requests`);\r\n                                setIsOpen(false);\r\n                            }}\r\n                            className=\"text-xs font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300\"\r\n                        >\r\n                            View all requests\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\OfferLetterEditor.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\OfferLetterPreview.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'hasHeader' is assigned a value but never used.","line":27,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"hasHeader"},"fix":{"range":[581,609],"text":""},"desc":"Remove unused variable 'hasHeader'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'hasFooter' is assigned a value but never used.","line":28,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"hasFooter"},"fix":{"range":[609,637],"text":""},"desc":"Remove unused variable 'hasFooter'."}]},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\n  74 |   </div>\n  75 |   <div class=\"text-right mb-6 text-xs text-slate-500\">\n> 76 |     Ref: ${companyInfo?.refPrefix || 'OFFER'}/${new Date().getFullYear()}/${Math.floor(Math.random() * 10000)}\n     |                                                                                        ^^^^^^^^^^^^^ Cannot call impure function\n  77 |   </div>\n  78 |   <div class=\"mb-6\">\n  79 |     <p class=\"font-semibold\">Ms./Mr. ${applicant?.name}</p>","line":76,"column":88,"nodeType":null,"endLine":76,"endColumn":101}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, {\r\n  forwardRef,\r\n  useImperativeHandle,\r\n  memo,\r\n  useMemo\r\n} from 'react';\r\nimport html2canvas from 'html2canvas';\r\nimport './editor/document.css';\r\nimport { API_ROOT } from '../utils/api';\r\n\r\n/**\r\n * FINAL MERGED OFFER LETTER PREVIEW\r\n * - LEFT: Full offer letter content (static, legal)\r\n * - RIGHT: Template engine + A4 preview + screenshot\r\n */\r\n\r\nconst OfferLetterPreview = memo(\r\n  forwardRef(\r\n    (\r\n      {\r\n        applicant,\r\n        offerData,\r\n        companyInfo,\r\n        templateType = 'NORMAL',\r\n        headerHeight = 0,\r\n        footerHeight = 0,\r\n        hasHeader = false,\r\n        hasFooter = false\r\n      },\r\n      ref\r\n    ) => {\r\n      const isLetterPad = templateType === 'LETTER_PAD';\r\n\r\n      /* ------------------ SCREENSHOT SUPPORT ------------------ */\r\n      useImperativeHandle(ref, () => ({\r\n        captureScreenshot: async () => {\r\n          const el = document.getElementById('offer-letter-preview');\r\n          if (!el) throw new Error('Preview element not found');\r\n          const canvas = await html2canvas(el, {\r\n            scale: 1,\r\n            backgroundColor: '#ffffff',\r\n            useCORS: true\r\n          });\r\n          return canvas.toDataURL('image/png');\r\n        }\r\n      }));\r\n\r\n      /* ------------------ DATE ------------------ */\r\n      const today = new Date().toLocaleDateString('en-IN', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric'\r\n      });\r\n\r\n      /* ------------------ LETTERHEAD BG ------------------ */\r\n      const rawBgPath = companyInfo?.branding?.letterheadBg;\r\n      const bgUrl = rawBgPath\r\n        ? (rawBgPath.startsWith('http')\r\n          ? rawBgPath\r\n          : `${API_ROOT}${rawBgPath.startsWith('/') ? '' : '/'}${rawBgPath}`\r\n        ).replace(/\\\\/g, '/')\r\n        : null;\r\n\r\n      /* ------------------ BODY HTML (LEFT CONTENT) ------------------ */\r\n      const previewHtml = useMemo(() => {\r\n        // Use the fetched template content if available, otherwise default fallback\r\n        let content = offerData.templateContent || `\r\n<div class=\"bg-white p-8 max-w-4xl mx-auto rounded-lg\">\r\n  <div class=\"flex justify-between items-start mb-8 pb-6 border-b-2 border-blue-600\">\r\n    <div>\r\n      <h1 class=\"text-3xl font-bold text-blue-600 mb-1\">${companyInfo?.name || 'Company Name'}</h1>\r\n      <p class=\"text-sm text-slate-600\">${companyInfo?.tagline || 'Technologies'}</p>\r\n    </div>\r\n  </div>\r\n  <div class=\"text-right mb-6 text-xs text-slate-500\">\r\n    Ref: ${companyInfo?.refPrefix || 'OFFER'}/${new Date().getFullYear()}/${Math.floor(Math.random() * 10000)}\r\n  </div>\r\n  <div class=\"mb-6\">\r\n    <p class=\"font-semibold\">Ms./Mr. ${applicant?.name}</p>\r\n    <p class=\"text-sm\">${applicant?.address || '-'}</p>\r\n  </div>\r\n  <p class=\"font-bold underline mb-4\">Offer to Join ${companyInfo?.name || 'Our Company'}</p>\r\n  <p class=\"mb-4\">Dear ${applicant?.name?.split(' ')[0]},</p>\r\n  <p class=\"mb-4\">\r\n    We are pleased to offer you the position of\r\n    <b> ${applicant?.requirementId?.jobTitle || offerData?.position}</b>\r\n    at our <b>${offerData?.location || 'Ahmedabad'}</b> office.\r\n  </p>\r\n  <ol class=\"list-decimal ml-6 space-y-2 text-sm\">\r\n    <li><b>Date of Joining:</b> ${offerData?.joiningDate || '_________'}</li>\r\n    <li><b>Probation:</b> ${offerData?.probationPeriod || '3 months'}</li>\r\n    <li><b>Compensation:</b> As per company policy.</li>\r\n    <li><b>Verification:</b> Subject to document verification.</li>\r\n  </ol>\r\n  <p class=\"mt-6\">We look forward to a long and mutually beneficial association.</p>\r\n  <div class=\"mt-12\">\r\n    <p>For ${companyInfo?.name}</p>\r\n    <p class=\"mt-6 font-semibold\">Authorized Signatory</p>\r\n  </div>\r\n  <div class=\"mt-12 border-t pt-4\">\r\n    <p class=\"font-semibold mb-2\">Acceptance of Offer</p>\r\n    <p>I accept the above terms.</p>\r\n    <p class=\"mt-6 font-semibold\">${applicant?.name?.toUpperCase()}</p>\r\n  </div>\r\n</div>\r\n        `;\r\n\r\n        // Get issued date (current date when letter is generated)\r\n        const issuedDate = new Date().toLocaleDateString('en-IN');\r\n\r\n        // Replacements Map\r\n        const replacements = {\r\n          '{{employee_name}}': applicant?.name || '',\r\n          '{{candidate_name}}': applicant?.name || '',\r\n          '{{father_name}}': applicant?.fatherName || '',\r\n          '{{designation}}': applicant?.requirementId?.jobTitle || offerData?.position || '',\r\n          '{{joining_date}}': offerData?.joiningDate || '',\r\n          '{{location}}': offerData?.location || applicant?.workLocation || '',\r\n          '{{address}}': applicant?.address || '',\r\n          '{{offer_ref_no}}': `OFFER/${new Date().getFullYear()}/${applicant?._id?.slice(-4).toUpperCase()}`,\r\n          // Issued Date - support multiple placeholder variations\r\n          '{{issued_date}}': issuedDate,\r\n          '{{issuedDate}}': issuedDate, // CamelCase alias\r\n          '{{ISSUED_DATE}}': issuedDate, // Uppercase alias\r\n          // Current date (legacy support)\r\n          '{{current_date}}': issuedDate\r\n        };\r\n\r\n        // Perform Replacements\r\n        Object.keys(replacements).forEach(key => {\r\n          const regex = new RegExp(key, 'g');\r\n          content = content.replace(regex, replacements[key]);\r\n        });\r\n\r\n        // Ensure content is wrapped if it's just raw HTML fragments\r\n        if (!content.trim().startsWith('<div') && !content.trim().startsWith('<html')) {\r\n          content = `<div class=\"p-8\">${content}</div>`;\r\n        }\r\n\r\n        return content;\r\n      }, [applicant, offerData, companyInfo]);\r\n\r\n      /* ------------------ RENDER ------------------ */\r\n      return (\r\n        <div className=\"bg-gray-100 p-8 flex justify-center overflow-auto\">\r\n          <div\r\n            id=\"offer-letter-preview\"\r\n            className=\"a4-page shadow-lg relative\"\r\n            style={{\r\n              width: '210mm',\r\n              minHeight: '297mm',\r\n              display: 'flex',\r\n              flexDirection: 'column',\r\n              backgroundColor: 'white',\r\n              ...(isLetterPad && bgUrl\r\n                ? {\r\n                  backgroundImage: `url('${bgUrl}')`,\r\n                  backgroundSize: '210mm 297mm',\r\n                  backgroundRepeat: 'no-repeat'\r\n                }\r\n                : {})\r\n            }}\r\n          >\r\n            {/* Issue Date - Only show if not in content */}\r\n            {!previewHtml.includes('Issue Date') && (\r\n              <div\r\n                style={{\r\n                  position: 'absolute',\r\n                  top: '5mm',\r\n                  left: '10mm',\r\n                  fontSize: '10px',\r\n                  color: '#9ca3af'\r\n                }}\r\n              >\r\n                Issue Date: {today}\r\n              </div>\r\n            )}\r\n\r\n\r\n            {/* Header Spacer */}\r\n            <div style={{ height: `${headerHeight}mm` }} />\r\n\r\n            {/* Body */}\r\n            <div\r\n              className=\"flex-1 formatted-content\"\r\n              style={{ padding: '10mm' }}\r\n              dangerouslySetInnerHTML={{ __html: previewHtml }}\r\n            />\r\n\r\n            {/* Footer Spacer */}\r\n            <div style={{ height: `${footerHeight}mm` }} />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n  )\r\n);\r\n\r\nexport default OfferLetterPreview;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\OrgChart\\OrgNode.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\Payroll\\ExcelUploader.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":21,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":17},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":21,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":21,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[822,822],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useState } from 'react';\r\nimport api from '../../utils/api';\r\n\r\n// Simple Excel uploader component to integrate with backend upload endpoint\r\n// Props:\r\n// - uploadUrl: string (required) - API endpoint to POST FormData to\r\n// - annualCTC: number (required) - numeric CTC to send\r\n// - onSuccess: function(responseData) - called when upload succeeds\r\n// - children: optional custom button/content\r\n\r\nexport default function ExcelUploader({ uploadUrl, annualCTC, onSuccess, children }) {\r\n  const fileRef = useRef(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [uploaded, setUploaded] = useState(false);\r\n\r\n  const resetInput = () => {\r\n    if (fileRef.current) {\r\n      try {\r\n        fileRef.current.value = null;\r\n      } catch (e) {}\r\n    }\r\n  };\r\n\r\n  const handleFileChange = async (e) => {\r\n    setError(null);\r\n    setUploaded(false);\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    if (!uploadUrl) {\r\n      setError('Upload URL not configured');\r\n      resetInput();\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      const form = new FormData();\r\n      form.append('file', file);\r\n      form.append('ctc', Number(annualCTC));\r\n      form.append('annualCTC', Number(annualCTC));\r\n\r\n      const res = await api.post(uploadUrl, form);\r\n\r\n      if (res.data && res.data.success) {\r\n        setUploaded(true);\r\n        if (window.showToast) window.showToast({ message: res.data.message || 'Excel uploaded successfully', type: 'success' });\r\n        if (onSuccess) onSuccess(res.data.data);\r\n      } else {\r\n        const message = (res.data && (res.data.message || res.data.error)) || 'Upload failed';\r\n        setError(message);\r\n        resetInput();\r\n      }\r\n    } catch (err) {\r\n      const backend = err.response && err.response.data;\r\n      if (backend) {\r\n        if (backend.errors && Array.isArray(backend.errors)) {\r\n          setError(`${backend.message || 'Validation failed'}: ${backend.errors.map(e => `Row ${e.row}: ${e.message}`).join('; ')}`);\r\n        } else {\r\n          setError(backend.message || backend.error || 'Upload failed');\r\n        }\r\n      } else {\r\n        setError(err.message || 'Upload failed');\r\n      }\r\n      resetInput();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <input\r\n        ref={fileRef}\r\n        type=\"file\"\r\n        accept=\".xlsx,.xls\"\r\n        onChange={handleFileChange}\r\n        disabled={loading || uploaded}\r\n      />\r\n      {children}\r\n      {loading && <div className=\"text-sm text-slate-500\">Uploading...</div>}\r\n      {uploaded && <div className=\"mt-2 text-green-600 text-sm flex items-center gap-1\">&#10003; Uploaded</div>}\r\n      {error && <div className=\"mt-2 text-sm text-rose-600\">{error}</div>}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\Payroll\\SalaryAssignmentModal.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":19,"column":8,"nodeType":"ArrayExpression","endLine":19,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [employee, loadData]","fix":{"range":[841,851],"text":"[employee, loadData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'ctcAmount'. Either include it or remove the dependency array.","line":30,"column":8,"nodeType":"ArrayExpression","endLine":30,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [ctcAmount, selectedTemplate, templates]","fix":{"range":[1275,1304],"text":"[ctcAmount, selectedTemplate, templates]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport api from '../../utils/api';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\n\r\nexport default function SalaryAssignmentModal({ employee, onClose, onSuccess }) {\r\n    const [templates, setTemplates] = useState([]);\r\n    const [history, setHistory] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [submitting, setSubmitting] = useState(false);\r\n\r\n    const [selectedTemplate, setSelectedTemplate] = useState('');\r\n    const [effectiveFrom, setEffectiveFrom] = useState(new Date().toISOString().split('T')[0]);\r\n    const [ctcAmount, setCtcAmount] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [selectedTemplateData, setSelectedTemplateData] = useState(null);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [employee]);\r\n\r\n    useEffect(() => {\r\n        // When template is selected, update the template data and set initial CTC\r\n        if (selectedTemplate) {\r\n            const template = templates.find(t => t._id === selectedTemplate);\r\n            setSelectedTemplateData(template);\r\n            if (template && !ctcAmount) {\r\n                setCtcAmount(template?.annualCTC || template?.ctc || '');\r\n            }\r\n        }\r\n    }, [selectedTemplate, templates]);\r\n\r\n    async function loadData() {\r\n        setLoading(true);\r\n        try {\r\n            // Fetch templates\r\n            const resTemp = await api.get('/payroll/salary-templates');\r\n            setTemplates(resTemp.data?.data || []);\r\n\r\n            // Fetch history for this employee\r\n            if (employee) {\r\n                const resHist = await api.get(`/payroll/history/${employee._id}`);\r\n                setHistory(resHist.data?.data || []);\r\n\r\n                // Pre-select current if exists\r\n                if (employee.salaryTemplateId) {\r\n                    const currentId = typeof employee.salaryTemplateId === 'object' ? employee.salaryTemplateId._id : employee.salaryTemplateId;\r\n                    setSelectedTemplate(currentId);\r\n                }\r\n\r\n                // Set current CTC if available\r\n                if (employee.ctcAnnual) {\r\n                    setCtcAmount(employee.ctcAnnual);\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Failed to load payroll data\", err);\r\n            setError(\"Failed to load templates or history\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    async function handleSubmit(e) {\r\n        e.preventDefault();\r\n        if (!selectedTemplate || !effectiveFrom) {\r\n            setError(\"Please select a template and effective date.\");\r\n            return;\r\n        }\r\n\r\n        if (!ctcAmount || ctcAmount <= 0) {\r\n            setError(\"Please enter a valid CTC amount.\");\r\n            return;\r\n        }\r\n\r\n        setSubmitting(true);\r\n        setError('');\r\n        try {\r\n            // Use the entered/modified CTC amount\r\n            const ctcAnnual = parseFloat(ctcAmount);\r\n\r\n            if (!ctcAnnual) {\r\n                setError(\"Invalid CTC amount. Please enter a valid number.\");\r\n                setSubmitting(false);\r\n                return;\r\n            }\r\n\r\n            // Call the modern salary assignment endpoint\r\n            await api.post('/salary/assign', {\r\n                employeeId: employee._id,\r\n                templateId: selectedTemplate,\r\n                ctcAnnual: ctcAnnual,\r\n                effectiveDate: effectiveFrom\r\n            });\r\n\r\n            if (onSuccess) onSuccess(\"Salary structure assigned as draft. Please confirm and lock to finalize.\");\r\n            onClose();\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError(err.response?.data?.message || \"Failed to assign salary structure. Please ensure the template is valid.\");\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    }\r\n\r\n    async function handleConfirm(assignmentId) {\r\n        if (!confirm(\"Confirming salary will lock this structure and create an immutable snapshot. You won't be able to edit this specific assignment once locked. Proceed?\")) return;\r\n\r\n        setSubmitting(true);\r\n        setError('');\r\n        try {\r\n            await api.post('/salary/confirm', {\r\n                employeeId: employee._id,\r\n                assignmentId: assignmentId,\r\n                reason: 'JOINING'\r\n            });\r\n            if (onSuccess) onSuccess();\r\n            onClose();\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError(err.response?.data?.message || \"Failed to confirm salary\");\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    }\r\n\r\n    if (!employee) return null;\r\n\r\n    const currentTemplate = history.length > 0 ? history[0].salaryTemplateId : null;\r\n    const currentCTC = employee.ctcAnnual || (currentTemplate?.annualCTC);\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-3xl overflow-hidden flex flex-col max-h-[90vh]\">\r\n                <div className=\"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gradient-to-r from-blue-50 to-indigo-50\">\r\n                    <h2 className=\"text-xl font-bold text-gray-800\">Assign Salary Structure</h2>\r\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 transition\">\r\n                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" /></svg>\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-6 overflow-y-auto space-y-6\">\r\n                    {/* Employee Info Card */}\r\n                    <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-lg border border-blue-200\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                            <div>\r\n                                <p className=\"text-xs text-blue-600 uppercase tracking-wider font-semibold\">Employee</p>\r\n                                <p className=\"text-lg font-bold text-gray-900 mt-1\">{employee.firstName} {employee.lastName}</p>\r\n                                <p className=\"text-sm text-gray-600 mt-1\">{employee.employeeId}</p>\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-xs text-blue-600 uppercase tracking-wider font-semibold\">Department</p>\r\n                                <p className=\"text-lg font-bold text-gray-900 mt-1\">{employee.department || '-'}</p>\r\n                                <p className=\"text-sm text-gray-600 mt-1\">{employee.role || '-'}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-4 pt-4 border-t border-blue-200 flex items-center justify-between\">\r\n                            <span className=\"text-sm font-medium text-gray-700\">Status:</span>\r\n                            <span className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-bold ${employee.salaryLocked ? 'bg-green-100 text-green-800' : employee.salaryAssigned ? 'bg-amber-100 text-amber-800' : 'bg-slate-100 text-slate-800'}`}>\r\n                                {employee.salaryLocked ? '‚úì Locked' : employee.salaryAssigned ? '‚ßó Pending Confirmation' : '‚óã No Salary Assigned'}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Current Salary Details (if exists) */}\r\n                    {currentTemplate && (\r\n                        <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 p-5 rounded-lg border border-green-200\">\r\n                            <h3 className=\"text-sm font-bold text-green-900 uppercase tracking-wider mb-3\">Current Salary Details</h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                                <div>\r\n                                    <p className=\"text-xs text-green-700 font-medium\">Template</p>\r\n                                    <p className=\"text-base font-semibold text-gray-900 mt-1\">{currentTemplate.templateName}</p>\r\n                                </div>\r\n                                {currentCTC && (\r\n                                    <div>\r\n                                        <p className=\"text-xs text-green-700 font-medium\">Annual CTC</p>\r\n                                        <p className=\"text-base font-semibold text-gray-900 mt-1\">‚Çπ{currentCTC.toLocaleString('en-IN')}</p>\r\n                                    </div>\r\n                                )}\r\n                                {history[0]?.effectiveFrom && (\r\n                                    <div>\r\n                                        <p className=\"text-xs text-green-700 font-medium\">Effective From</p>\r\n                                        <p className=\"text-base font-semibold text-gray-900 mt-1\">{formatDateDDMMYYYY(history[0].effectiveFrom)}</p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {error && (\r\n                        <div className=\"p-4 bg-red-50 text-red-700 rounded-lg border border-red-200 text-sm flex gap-2\">\r\n                            <svg className=\"w-5 h-5 flex-shrink-0 mt-0.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" /></svg>\r\n                            <span>{error}</span>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Form Section */}\r\n                    <form onSubmit={handleSubmit} className=\"space-y-5 bg-gray-50 p-5 rounded-lg border border-gray-200\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                                <span className=\"inline-flex items-center gap-2\">\r\n                                    Select Salary Template\r\n                                    <span className=\"text-red-500 font-bold\">*</span>\r\n                                </span>\r\n                            </label>\r\n                            <select\r\n                                value={selectedTemplate}\r\n                                onChange={e => setSelectedTemplate(e.target.value)}\r\n                                className=\"w-full rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 p-3 disabled:bg-gray-100 disabled:cursor-not-allowed transition\"\r\n                                required\r\n                                disabled={employee.salaryLocked || loading}\r\n                            >\r\n                                <option value=\"\">Choose a template...</option>\r\n                                {templates.map(t => (\r\n                                    <option key={t._id} value={t._id}>\r\n                                        {t.templateName} ‚Äî ‚Çπ{(t.annualCTC || t.ctc || 0).toLocaleString('en-IN')}/year\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                            {templates.length === 0 && !loading && (\r\n                                <p className=\"mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded border border-amber-100 flex gap-2\">\r\n                                    <svg className=\"w-4 h-4 flex-shrink-0 mt-0.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" /></svg>\r\n                                    <span>No salary templates available. Please create one first.</span>\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Template Details Preview */}\r\n                        {selectedTemplateData && (\r\n                            <div className=\"bg-white p-4 rounded-lg border border-gray-200\">\r\n                                <h4 className=\"font-semibold text-gray-700 mb-3 text-sm\">Template Preview</h4>\r\n                                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3 text-sm\">\r\n                                    <div className=\"bg-gradient-to-br from-blue-50 to-blue-100 p-3 rounded border border-blue-200\">\r\n                                        <p className=\"text-xs text-blue-700 font-medium uppercase\">Name</p>\r\n                                        <p className=\"font-bold text-gray-900 mt-1\">{selectedTemplateData.templateName}</p>\r\n                                    </div>\r\n                                    <div className=\"bg-gradient-to-br from-emerald-50 to-emerald-100 p-3 rounded border border-emerald-200\">\r\n                                        <p className=\"text-xs text-emerald-700 font-medium uppercase\">Template CTC</p>\r\n                                        <p className=\"font-bold text-gray-900 mt-1\">‚Çπ{(selectedTemplateData.annualCTC || selectedTemplateData.ctc || 0).toLocaleString('en-IN')}</p>\r\n                                    </div>\r\n                                    {selectedTemplateData.structure && (\r\n                                        <div className=\"bg-gradient-to-br from-purple-50 to-purple-100 p-3 rounded border border-purple-200\">\r\n                                            <p className=\"text-xs text-purple-700 font-medium uppercase\">Components</p>\r\n                                            <p className=\"font-bold text-gray-900 mt-1\">{Object.keys(selectedTemplateData.structure || {}).length}</p>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                                <span className=\"inline-flex items-center gap-2\">\r\n                                    Annual CTC\r\n                                    <span className=\"text-red-500 font-bold\">*</span>\r\n                                    {currentCTC && <span className=\"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded font-normal\">Current: ‚Çπ{currentCTC.toLocaleString('en-IN')}</span>}\r\n                                </span>\r\n                            </label>\r\n                            <div className=\"relative\">\r\n                                <span className=\"absolute left-3 top-3 text-gray-500 font-semibold text-lg\">‚Çπ</span>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={ctcAmount}\r\n                                    onChange={e => setCtcAmount(e.target.value)}\r\n                                    placeholder=\"Enter or modify CTC amount\"\r\n                                    className=\"w-full rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 pl-8 pr-3 py-3 disabled:bg-gray-100 disabled:cursor-not-allowed transition\"\r\n                                    required\r\n                                    disabled={employee.salaryLocked}\r\n                                    min=\"1\"\r\n                                    step=\"1\"\r\n                                />\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">You can modify the CTC from the template's default amount if needed.</p>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                                <span className=\"inline-flex items-center gap-2\">\r\n                                    Effective From\r\n                                    <span className=\"text-red-500 font-bold\">*</span>\r\n                                </span>\r\n                            </label>\r\n                            <input\r\n                                type=\"date\"\r\n                                value={effectiveFrom}\r\n                                onChange={e => setEffectiveFrom(e.target.value)}\r\n                                className=\"w-full rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 p-3 disabled:bg-gray-100 disabled:cursor-not-allowed transition\"\r\n                                required\r\n                                disabled={employee.salaryLocked}\r\n                            />\r\n                            <p className=\"text-xs text-gray-500 mt-1\">Salary assignment takes effect from this date onwards.</p>\r\n                        </div>\r\n\r\n                        {!employee.salaryLocked && (\r\n                            <div className=\"flex justify-end gap-3 pt-4 border-t border-gray-200\">\r\n                                <button \r\n                                    type=\"button\" \r\n                                    onClick={onClose} \r\n                                    className=\"px-6 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={submitting || !selectedTemplate || !ctcAmount || !effectiveFrom}\r\n                                    className=\"px-6 py-2.5 text-white bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg hover:from-blue-700 hover:to-blue-800 transition shadow-md disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center gap-2\"\r\n                                >\r\n                                    {submitting && (\r\n                                        <svg className=\"animate-spin h-4 w-4 text-white\" viewBox=\"0 0 24 24\">\r\n                                            <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\"></circle>\r\n                                            <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                                        </svg>\r\n                                    )}\r\n                                    {submitting ? 'Assigning...' : employee.salaryAssigned ? 'Update Assignment' : 'Assign Salary Structure'}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </form>\r\n\r\n                    {/* Assignment History Section */}\r\n                    {history.length > 0 && (\r\n                        <div className=\"border-t pt-6\">\r\n                            <h3 className=\"text-sm font-bold text-gray-900 mb-4 uppercase tracking-wider flex items-center gap-2\">\r\n                                <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\"></path><path fillRule=\"evenodd\" d=\"M4 5a2 2 0 012-2 1 1 0 000-2H6a6 6 0 016 6v3h1a1 1 0 100 2h-1v3a6 6 0 01-6 6H6a1 1 0 000 2h4a2 2 0 002-2v-2.93a6 6 0 006-5.07v-3h1a1 1 0 100-2h-1V9a6 6 0 00-6-6 2 2 0 01-2-2V5z\" clipRule=\"evenodd\"></path></svg>\r\n                                Assignment History\r\n                            </h3>\r\n                            <div className=\"overflow-hidden rounded-lg border border-gray-200 shadow-sm\">\r\n                                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                                    <thead className=\"bg-gray-50\">\r\n                                        <tr>\r\n                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase\">Template</th>\r\n                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase\">CTC</th>\r\n                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase\">Effective Date</th>\r\n                                            <th className=\"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase\">Status</th>\r\n                                            <th className=\"px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase\">Action</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                                        {history.map((h, idx) => (\r\n                                            <tr key={h._id} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>\r\n                                                <td className=\"px-4 py-3 text-sm font-medium text-gray-900\">{h.salaryTemplateId?.templateName || 'Unknown'}</td>\r\n                                                <td className=\"px-4 py-3 text-sm font-semibold text-gray-900\">‚Çπ{(h.ctcAnnual || h.salaryTemplateId?.annualCTC || 0).toLocaleString('en-IN')}</td>\r\n                                                <td className=\"px-4 py-3 text-sm text-gray-600\">{formatDateDDMMYYYY(h.effectiveFrom)}</td>\r\n                                                <td className=\"px-4 py-3 text-sm text-center\">\r\n                                                    <span className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-bold ${h.isConfirmed ? 'bg-green-100 text-green-800' : 'bg-amber-100 text-amber-800'}`}>\r\n                                                        {h.isConfirmed ? '‚úì Locked' : '‚ßó Draft'}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-4 py-3 text-sm text-right\">\r\n                                                    {!h.isConfirmed && !employee.salaryLocked && (\r\n                                                        <button\r\n                                                            onClick={() => handleConfirm(h._id)}\r\n                                                            disabled={submitting}\r\n                                                            className=\"text-xs bg-gradient-to-r from-green-600 to-green-700 text-white px-4 py-1.5 rounded-lg hover:from-green-700 hover:to-green-800 disabled:opacity-50 transition font-medium\"\r\n                                                        >\r\n                                                            Confirm & Lock\r\n                                                        </button>\r\n                                                    )}\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\Payroll\\SalaryAssignmentModal_Enhanced.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":19,"column":8,"nodeType":"ArrayExpression","endLine":19,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [employee, loadData]","fix":{"range":[841,851],"text":"[employee, loadData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'ctcAmount'. Either include it or remove the dependency array.","line":30,"column":8,"nodeType":"ArrayExpression","endLine":30,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [ctcAmount, selectedTemplate, templates]","fix":{"range":[1275,1304],"text":"[ctcAmount, selectedTemplate, templates]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport api from '../../utils/api';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\n\r\nexport default function SalaryAssignmentModal({ employee, onClose, onSuccess }) {\r\n    const [templates, setTemplates] = useState([]);\r\n    const [history, setHistory] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [submitting, setSubmitting] = useState(false);\r\n\r\n    const [selectedTemplate, setSelectedTemplate] = useState('');\r\n    const [effectiveFrom, setEffectiveFrom] = useState(new Date().toISOString().split('T')[0]);\r\n    const [ctcAmount, setCtcAmount] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [selectedTemplateData, setSelectedTemplateData] = useState(null);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [employee]);\r\n\r\n    useEffect(() => {\r\n        // When template is selected, update the template data and set initial CTC\r\n        if (selectedTemplate) {\r\n            const template = templates.find(t => t._id === selectedTemplate);\r\n            setSelectedTemplateData(template);\r\n            if (template && !ctcAmount) {\r\n                setCtcAmount(template?.annualCTC || template?.ctc || '');\r\n            }\r\n        }\r\n    }, [selectedTemplate, templates]);\r\n\r\n    async function loadData() {\r\n        setLoading(true);\r\n        try {\r\n            // Fetch templates\r\n            const resTemp = await api.get('/payroll/salary-templates');\r\n            setTemplates(resTemp.data?.data || []);\r\n\r\n            // Fetch history for this employee\r\n            if (employee) {\r\n                const resHist = await api.get(`/payroll/history/${employee._id}`);\r\n                setHistory(resHist.data?.data || []);\r\n\r\n                // Pre-select current if exists\r\n                if (employee.salaryTemplateId) {\r\n                    const currentId = typeof employee.salaryTemplateId === 'object' ? employee.salaryTemplateId._id : employee.salaryTemplateId;\r\n                    setSelectedTemplate(currentId);\r\n                }\r\n\r\n                // Set current CTC if available\r\n                if (employee.ctcAnnual) {\r\n                    setCtcAmount(employee.ctcAnnual);\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Failed to load payroll data\", err);\r\n            setError(\"Failed to load templates or history\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    async function handleSubmit(e) {\r\n        e.preventDefault();\r\n        if (!selectedTemplate || !effectiveFrom) {\r\n            setError(\"Please select a template and effective date.\");\r\n            return;\r\n        }\r\n\r\n        if (!ctcAmount || ctcAmount <= 0) {\r\n            setError(\"Please enter a valid CTC amount.\");\r\n            return;\r\n        }\r\n\r\n        setSubmitting(true);\r\n        setError('');\r\n        try {\r\n            // Use the entered/modified CTC amount\r\n            const ctcAnnual = parseFloat(ctcAmount);\r\n\r\n            if (!ctcAnnual) {\r\n                setError(\"Invalid CTC amount. Please enter a valid number.\");\r\n                setSubmitting(false);\r\n                return;\r\n            }\r\n\r\n            // Call the modern salary assignment endpoint\r\n            await api.post('/salary/assign', {\r\n                employeeId: employee._id,\r\n                templateId: selectedTemplate,\r\n                ctcAnnual: ctcAnnual,\r\n                effectiveDate: effectiveFrom\r\n            });\r\n\r\n            if (onSuccess) onSuccess(\"Salary structure assigned as draft. Please confirm and lock to finalize.\");\r\n            onClose();\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError(err.response?.data?.message || \"Failed to assign salary structure. Please ensure the template is valid.\");\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    }\r\n\r\n    async function handleConfirm(assignmentId) {\r\n        if (!confirm(\"Confirming salary will lock this structure and create an immutable snapshot. You won't be able to edit this specific assignment once locked. Proceed?\")) return;\r\n\r\n        setSubmitting(true);\r\n        setError('');\r\n        try {\r\n            await api.post('/salary/confirm', {\r\n                employeeId: employee._id,\r\n                assignmentId: assignmentId,\r\n                reason: 'JOINING'\r\n            });\r\n            if (onSuccess) onSuccess();\r\n            onClose();\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError(err.response?.data?.message || \"Failed to confirm salary\");\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    }\r\n\r\n    if (!employee) return null;\r\n\r\n    const currentTemplate = history.length > 0 ? history[0].salaryTemplateId : null;\r\n    const currentCTC = employee.ctcAnnual || (currentTemplate?.annualCTC);\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-3xl overflow-hidden flex flex-col max-h-[90vh]\">\r\n                <div className=\"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gradient-to-r from-blue-50 to-indigo-50\">\r\n                    <h2 className=\"text-xl font-bold text-gray-800\">Assign Salary Structure</h2>\r\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 transition\">\r\n                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" /></svg>\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-6 overflow-y-auto space-y-6\">\r\n                    {/* Employee Info Card */}\r\n                    <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-lg border border-blue-200\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                            <div>\r\n                                <p className=\"text-xs text-blue-600 uppercase tracking-wider font-semibold\">Employee</p>\r\n                                <p className=\"text-lg font-bold text-gray-900 mt-1\">{employee.firstName} {employee.lastName}</p>\r\n                                <p className=\"text-sm text-gray-600 mt-1\">{employee.employeeId}</p>\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-xs text-blue-600 uppercase tracking-wider font-semibold\">Department</p>\r\n                                <p className=\"text-lg font-bold text-gray-900 mt-1\">{employee.department || '-'}</p>\r\n                                <p className=\"text-sm text-gray-600 mt-1\">{employee.role || '-'}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-4 pt-4 border-t border-blue-200 flex items-center justify-between\">\r\n                            <span className=\"text-sm font-medium text-gray-700\">Status:</span>\r\n                            <span className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-bold ${employee.salaryLocked ? 'bg-green-100 text-green-800' : employee.salaryAssigned ? 'bg-amber-100 text-amber-800' : 'bg-slate-100 text-slate-800'}`}>\r\n                                {employee.salaryLocked ? '‚úì Locked' : employee.salaryAssigned ? '‚ßó Pending Confirmation' : '‚óã No Salary Assigned'}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Current Salary Details (if exists) */}\r\n                    {currentTemplate && (\r\n                        <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 p-5 rounded-lg border border-green-200\">\r\n                            <h3 className=\"text-sm font-bold text-green-900 uppercase tracking-wider mb-3\">Current Salary Details</h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                                <div>\r\n                                    <p className=\"text-xs text-green-700 font-medium\">Template</p>\r\n                                    <p className=\"text-base font-semibold text-gray-900 mt-1\">{currentTemplate.templateName}</p>\r\n                                </div>\r\n                                {currentCTC && (\r\n                                    <div>\r\n                                        <p className=\"text-xs text-green-700 font-medium\">Annual CTC</p>\r\n                                        <p className=\"text-base font-semibold text-gray-900 mt-1\">‚Çπ{currentCTC.toLocaleString('en-IN')}</p>\r\n                                    </div>\r\n                                )}\r\n                                {history[0]?.effectiveFrom && (\r\n                                    <div>\r\n                                        <p className=\"text-xs text-green-700 font-medium\">Effective From</p>\r\n                                        <p className=\"text-base font-semibold text-gray-900 mt-1\">{formatDateDDMMYYYY(history[0].effectiveFrom)}</p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {error && (\r\n                        <div className=\"p-4 bg-red-50 text-red-700 rounded-lg border border-red-200 text-sm flex gap-2\">\r\n                            <svg className=\"w-5 h-5 flex-shrink-0 mt-0.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" /></svg>\r\n                            <span>{error}</span>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Form Section */}\r\n                    <form onSubmit={handleSubmit} className=\"space-y-5 bg-gray-50 p-5 rounded-lg border border-gray-200\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                                <span className=\"inline-flex items-center gap-2\">\r\n                                    Select Salary Template\r\n                                    <span className=\"text-red-500 font-bold\">*</span>\r\n                                </span>\r\n                            </label>\r\n                            <select\r\n                                value={selectedTemplate}\r\n                                onChange={e => setSelectedTemplate(e.target.value)}\r\n                                className=\"w-full rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 p-3 disabled:bg-gray-100 disabled:cursor-not-allowed transition\"\r\n                                required\r\n                                disabled={employee.salaryLocked || loading}\r\n                            >\r\n                                <option value=\"\">Choose a template...</option>\r\n                                {templates.map(t => (\r\n                                    <option key={t._id} value={t._id}>\r\n                                        {t.templateName} ‚Äî ‚Çπ{(t.annualCTC || t.ctc || 0).toLocaleString('en-IN')}/year\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                            {templates.length === 0 && !loading && (\r\n                                <p className=\"mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded border border-amber-100 flex gap-2\">\r\n                                    <svg className=\"w-4 h-4 flex-shrink-0 mt-0.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" /></svg>\r\n                                    <span>No salary templates available. Please create one first.</span>\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Template Details Preview */}\r\n                        {selectedTemplateData && (\r\n                            <div className=\"bg-white p-4 rounded-lg border border-gray-200\">\r\n                                <h4 className=\"font-semibold text-gray-700 mb-3 text-sm\">Template Preview</h4>\r\n                                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3 text-sm\">\r\n                                    <div className=\"bg-gradient-to-br from-blue-50 to-blue-100 p-3 rounded border border-blue-200\">\r\n                                        <p className=\"text-xs text-blue-700 font-medium uppercase\">Name</p>\r\n                                        <p className=\"font-bold text-gray-900 mt-1\">{selectedTemplateData.templateName}</p>\r\n                                    </div>\r\n                                    <div className=\"bg-gradient-to-br from-emerald-50 to-emerald-100 p-3 rounded border border-emerald-200\">\r\n                                        <p className=\"text-xs text-emerald-700 font-medium uppercase\">Template CTC</p>\r\n                                        <p className=\"font-bold text-gray-900 mt-1\">‚Çπ{(selectedTemplateData.annualCTC || selectedTemplateData.ctc || 0).toLocaleString('en-IN')}</p>\r\n                                    </div>\r\n                                    {selectedTemplateData.structure && (\r\n                                        <div className=\"bg-gradient-to-br from-purple-50 to-purple-100 p-3 rounded border border-purple-200\">\r\n                                            <p className=\"text-xs text-purple-700 font-medium uppercase\">Components</p>\r\n                                            <p className=\"font-bold text-gray-900 mt-1\">{Object.keys(selectedTemplateData.structure || {}).length}</p>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                                <span className=\"inline-flex items-center gap-2\">\r\n                                    Annual CTC\r\n                                    <span className=\"text-red-500 font-bold\">*</span>\r\n                                    {currentCTC && <span className=\"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded font-normal\">Current: ‚Çπ{currentCTC.toLocaleString('en-IN')}</span>}\r\n                                </span>\r\n                            </label>\r\n                            <div className=\"relative\">\r\n                                <span className=\"absolute left-3 top-3 text-gray-500 font-semibold text-lg\">‚Çπ</span>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={ctcAmount}\r\n                                    onChange={e => setCtcAmount(e.target.value)}\r\n                                    placeholder=\"Enter or modify CTC amount\"\r\n                                    className=\"w-full rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 pl-8 pr-3 py-3 disabled:bg-gray-100 disabled:cursor-not-allowed transition\"\r\n                                    required\r\n                                    disabled={employee.salaryLocked}\r\n                                    min=\"1\"\r\n                                    step=\"1\"\r\n                                />\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">You can modify the CTC from the template's default amount if needed.</p>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                                <span className=\"inline-flex items-center gap-2\">\r\n                                    Effective From\r\n                                    <span className=\"text-red-500 font-bold\">*</span>\r\n                                </span>\r\n                            </label>\r\n                            <input\r\n                                type=\"date\"\r\n                                value={effectiveFrom}\r\n                                onChange={e => setEffectiveFrom(e.target.value)}\r\n                                className=\"w-full rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 p-3 disabled:bg-gray-100 disabled:cursor-not-allowed transition\"\r\n                                required\r\n                                disabled={employee.salaryLocked}\r\n                            />\r\n                            <p className=\"text-xs text-gray-500 mt-1\">Salary assignment takes effect from this date onwards.</p>\r\n                        </div>\r\n\r\n                        {!employee.salaryLocked && (\r\n                            <div className=\"flex justify-end gap-3 pt-4 border-t border-gray-200\">\r\n                                <button \r\n                                    type=\"button\" \r\n                                    onClick={onClose} \r\n                                    className=\"px-6 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={submitting || !selectedTemplate || !ctcAmount || !effectiveFrom}\r\n                                    className=\"px-6 py-2.5 text-white bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg hover:from-blue-700 hover:to-blue-800 transition shadow-md disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center gap-2\"\r\n                                >\r\n                                    {submitting && (\r\n                                        <svg className=\"animate-spin h-4 w-4 text-white\" viewBox=\"0 0 24 24\">\r\n                                            <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\"></circle>\r\n                                            <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                                        </svg>\r\n                                    )}\r\n                                    {submitting ? 'Assigning...' : employee.salaryAssigned ? 'Update Assignment' : 'Assign Salary Structure'}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </form>\r\n\r\n                    {/* Assignment History Section */}\r\n                    {history.length > 0 && (\r\n                        <div className=\"border-t pt-6\">\r\n                            <h3 className=\"text-sm font-bold text-gray-900 mb-4 uppercase tracking-wider flex items-center gap-2\">\r\n                                <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z\"></path><path fillRule=\"evenodd\" d=\"M4 5a2 2 0 012-2 1 1 0 000-2H6a6 6 0 016 6v3h1a1 1 0 100 2h-1v3a6 6 0 01-6 6H6a1 1 0 000 2h4a2 2 0 002-2v-2.93a6 6 0 006-5.07v-3h1a1 1 0 100-2h-1V9a6 6 0 00-6-6 2 2 0 01-2-2V5z\" clipRule=\"evenodd\"></path></svg>\r\n                                Assignment History\r\n                            </h3>\r\n                            <div className=\"overflow-hidden rounded-lg border border-gray-200 shadow-sm\">\r\n                                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                                    <thead className=\"bg-gray-50\">\r\n                                        <tr>\r\n                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase\">Template</th>\r\n                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase\">CTC</th>\r\n                                            <th className=\"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase\">Effective Date</th>\r\n                                            <th className=\"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase\">Status</th>\r\n                                            <th className=\"px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase\">Action</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                                        {history.map((h, idx) => (\r\n                                            <tr key={h._id} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>\r\n                                                <td className=\"px-4 py-3 text-sm font-medium text-gray-900\">{h.salaryTemplateId?.templateName || 'Unknown'}</td>\r\n                                                <td className=\"px-4 py-3 text-sm font-semibold text-gray-900\">‚Çπ{(h.ctcAnnual || h.salaryTemplateId?.annualCTC || 0).toLocaleString('en-IN')}</td>\r\n                                                <td className=\"px-4 py-3 text-sm text-gray-600\">{formatDateDDMMYYYY(h.effectiveFrom)}</td>\r\n                                                <td className=\"px-4 py-3 text-sm text-center\">\r\n                                                    <span className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-bold ${h.isConfirmed ? 'bg-green-100 text-green-800' : 'bg-amber-100 text-amber-800'}`}>\r\n                                                        {h.isConfirmed ? '‚úì Locked' : '‚ßó Draft'}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-4 py-3 text-sm text-right\">\r\n                                                    {!h.isConfirmed && !employee.salaryLocked && (\r\n                                                        <button\r\n                                                            onClick={() => handleConfirm(h._id)}\r\n                                                            disabled={submitting}\r\n                                                            className=\"text-xs bg-gradient-to-r from-green-600 to-green-700 text-white px-4 py-1.5 rounded-lg hover:from-green-700 hover:to-green-800 disabled:opacity-50 transition font-medium\"\r\n                                                        >\r\n                                                            Confirm & Lock\r\n                                                        </button>\r\n                                                    )}\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\Payroll\\SalaryComponentTable.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\ReportingTree.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\RequirementForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\Ruler.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\SearchFilterBar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\SidebarCompanyBlock.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\TeamAttendanceView.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":11,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"loading"},"fix":{"range":[522,529],"text":""},"desc":"Remove unused variable 'loading'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setCurrentYear' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":20,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"setCurrentYear"},"fix":{"range":[1060,1076],"text":""},"desc":"Remove unused variable 'setCurrentYear'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTeamAttendance'. Either include it or remove the dependency array.","line":28,"column":8,"nodeType":"ArrayExpression","endLine":28,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTeamAttendance, selectedDate]","fix":{"range":[1365,1379],"text":"[fetchTeamAttendance, selectedDate]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchEmployeeRegister'. Either include it or remove the dependency array.","line":44,"column":8,"nodeType":"ArrayExpression","endLine":44,"endColumn":52,"suggestions":[{"desc":"Update the dependencies array to be: [viewingEmployee, currentMonth, currentYear, fetchEmployeeRegister]","fix":{"range":[1853,1897],"text":"[viewingEmployee, currentMonth, currentYear, fetchEmployeeRegister]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport api from '../utils/api';\r\nimport { Search, MapPin, Clock, Calendar as CalendarIcon, User, ChevronLeft, ChevronRight, X, Eye } from 'lucide-react';\r\nimport AttendanceCalendar from './AttendanceCalendar';\r\nimport { formatDateDDMMYYYY } from '../utils/dateUtils';\r\nimport { DatePicker, Pagination } from 'antd';\r\nimport dayjs from 'dayjs';\r\n\r\nexport default function TeamAttendanceView() {\r\n    const [teamAttendance, setTeamAttendance] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [statusFilter, setStatusFilter] = useState('all');\r\n\r\n    // Register View for specific employee\r\n    const [viewingEmployee, setViewingEmployee] = useState(null);\r\n    const [employeeAttendance, setEmployeeAttendance] = useState([]);\r\n    const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());\r\n    const [currentYear, setCurrentYear] = useState(new Date().getFullYear());\r\n    const [holidays, setHolidays] = useState([]);\r\n    const [settings, setSettings] = useState({});\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const pageSize = 10;\r\n\r\n    useEffect(() => {\r\n        fetchTeamAttendance();\r\n    }, [selectedDate]);\r\n\r\n    const fetchTeamAttendance = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const res = await api.get(`/attendance/team?date=${selectedDate}`);\r\n            setTeamAttendance(res.data);\r\n        } catch (err) {\r\n            console.error(\"Failed to fetch team attendance\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (viewingEmployee) fetchEmployeeRegister();\r\n    }, [viewingEmployee, currentMonth, currentYear]);\r\n\r\n    const fetchEmployeeRegister = async () => {\r\n        try {\r\n            const [attRes, holidayRes, settingsRes] = await Promise.all([\r\n                api.get(`/attendance/my?employeeId=${viewingEmployee._id}&month=${currentMonth + 1}&year=${currentYear}`),\r\n                api.get('/holidays'),\r\n                api.get('/attendance/settings')\r\n            ]);\r\n            setEmployeeAttendance(attRes.data);\r\n            setHolidays(holidayRes.data || []);\r\n            setSettings(settingsRes.data || {});\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    const changeDate = (offset) => {\r\n        const d = new Date(selectedDate);\r\n        d.setDate(d.getDate() + offset);\r\n        setSelectedDate(d.toISOString().split('T')[0]);\r\n    };\r\n\r\n    const handleExport = () => {\r\n        if (!teamAttendance.length) return alert(\"No data to export\");\r\n        const headers = [\"ID\", \"Name\", \"In Time\", \"Out Time\", \"Hours\", \"Status\", \"Is Late\"];\r\n        const rows = teamAttendance.map(item => [\r\n            item.employee.employeeId,\r\n            `${item.employee.firstName} ${item.employee.lastName}`,\r\n            item.checkIn ? new Date(item.checkIn).toLocaleTimeString() : '-',\r\n            item.checkOut ? new Date(item.checkOut).toLocaleTimeString() : '-',\r\n            item.workingHours || 0,\r\n            item.status,\r\n            item.isLate ? \"YES\" : \"NO\"\r\n        ]);\r\n        const csv = [headers, ...rows].map(e => e.join(\",\")).join(\"\\n\");\r\n        const blob = new Blob([csv], { type: 'text/csv' });\r\n        const url = URL.createObjectURL(blob);\r\n        const link = document.createElement(\"a\");\r\n        link.href = url;\r\n        link.download = `Team_Attendance_${formatDateDDMMYYYY(selectedDate)}.csv`;\r\n        link.click();\r\n    };\r\n\r\n    const filteredData = teamAttendance.filter(item => {\r\n        const nameMatch = `${item.employee.firstName} ${item.employee.lastName}`.toLowerCase().includes(searchQuery.toLowerCase());\r\n        const statusMatch = statusFilter === 'all' || item.status.toLowerCase() === statusFilter.toLowerCase();\r\n        return nameMatch && statusMatch;\r\n    });\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-in fade-in duration-500\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-3xl font-black text-slate-800 dark:text-white tracking-tighter uppercase\">Team Daily Pulse</h2>\r\n                    <p className=\"text-xs font-bold text-slate-400 uppercase tracking-widest mt-1\">Live visibility into your team's presence</p>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3 bg-white dark:bg-slate-900 p-2 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm\">\r\n                    <button onClick={() => changeDate(-1)} className=\"p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition\"><ChevronLeft size={20} /></button>\r\n                    <DatePicker\r\n                        className=\"bg-transparent text-sm font-black text-slate-700 dark:text-slate-300 uppercase outline-none px-2 border-none shadow-none hover:bg-transparent focus:bg-transparent\"\r\n                        format=\"DD-MM-YYYY\"\r\n                        placeholder=\"DD-MM-YYYY\"\r\n                        allowClear={false}\r\n                        suffixIcon={null}\r\n                        value={selectedDate ? dayjs(selectedDate) : null}\r\n                        onChange={(d) => setSelectedDate(d ? d.format('YYYY-MM-DD') : '')}\r\n                    />\r\n                    <button onClick={() => changeDate(1)} className=\"p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition\"><ChevronRight size={20} /></button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6\">\r\n                <div className=\"bg-white dark:bg-slate-900 p-6 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/40 dark:shadow-none\">\r\n                    <div className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3\">Total Team</div>\r\n                    <div className=\"text-4xl font-black text-slate-800 dark:text-white tracking-tighter\">{teamAttendance.length}</div>\r\n                </div>\r\n                <div className=\"bg-white dark:bg-slate-900 p-6 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/40 dark:shadow-none\">\r\n                    <div className=\"text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-3\">Present Today</div>\r\n                    <div className=\"text-4xl font-black text-emerald-500 tracking-tighter\">{teamAttendance.filter(a => a.status === 'present').length}</div>\r\n                </div>\r\n                <div className=\"bg-white dark:bg-slate-900 p-6 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/40 dark:shadow-none\">\r\n                    <div className=\"text-[10px] font-black text-rose-500 uppercase tracking-widest mb-3\">Absent</div>\r\n                    <div className=\"text-4xl font-black text-rose-500 tracking-tighter\">{teamAttendance.filter(a => a.status === 'absent').length}</div>\r\n                </div>\r\n                <div className=\"bg-white dark:bg-slate-900 p-6 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/40 dark:shadow-none\">\r\n                    <div className=\"text-[10px] font-black text-amber-500 uppercase tracking-widest mb-3\">Late In</div>\r\n                    <div className=\"text-4xl font-black text-amber-500 tracking-tighter\">{teamAttendance.filter(a => a.isLate).length}</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex flex-col md:flex-row gap-4 items-center\">\r\n                <div className=\"flex-1 w-full relative\">\r\n                    <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search employee by name...\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                        className=\"w-full pl-12 pr-4 py-3 bg-white dark:bg-slate-900 rounded-2xl border border-slate-100 dark:border-slate-800 text-sm font-bold outline-none shadow-sm focus:border-blue-500 transition\"\r\n                    />\r\n                </div>\r\n                <div className=\"flex gap-3 w-full md:w-auto\">\r\n                    <select\r\n                        value={statusFilter}\r\n                        onChange={(e) => setStatusFilter(e.target.value)}\r\n                        className=\"bg-white dark:bg-slate-900 px-6 py-3 rounded-2xl border border-slate-100 dark:border-slate-800 text-sm font-bold uppercase outline-none shadow-sm\"\r\n                    >\r\n                        <option value=\"all\">All Status</option>\r\n                        <option value=\"present\">Present</option>\r\n                        <option value=\"absent\">Absent</option>\r\n                        <option value=\"late\">Late In</option>\r\n                    </select>\r\n                    <button\r\n                        onClick={handleExport}\r\n                        className=\"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl shadow-blue-500/20 hover:bg-blue-700 transition\"\r\n                    >\r\n                        <Clock size={16} /> Export CSV\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Team List Table */}\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-xl overflow-hidden\">\r\n                <table className=\"w-full text-left\">\r\n                    <thead className=\"bg-slate-50/50 dark:bg-slate-950/50 border-b border-slate-100 dark:border-slate-800\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Employee</th>\r\n                            <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">In/Out Time</th>\r\n                            <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Duration</th>\r\n                            <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Status</th>\r\n                            <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Location</th>\r\n                            <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right\">Register</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-slate-50 dark:divide-slate-800\">\r\n                        {filteredData.slice((currentPage - 1) * pageSize, currentPage * pageSize).map((item) => (\r\n                            <tr key={item._id} className=\"hover:bg-slate-50/50 dark:hover:bg-slate-800/30 transition-colors\">\r\n                                <td className=\"px-6 py-4\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"h-10 w-10 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400 overflow-hidden shadow-inner cursor-pointer\" onClick={() => setViewingEmployee(item.employee)}>\r\n                                            {item.employee.profilePic ? <img src={item.employee.profilePic} alt=\"\" className=\"h-full w-full object-cover\" /> : <User size={20} />}\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"text-sm font-black text-slate-800 dark:text-white uppercase tracking-tighter\">{item.employee.firstName} {item.employee.lastName}</div>\r\n                                            <div className=\"text-[10px] font-bold text-slate-400\">{item.employee.employeeId}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 text-xs font-bold text-slate-600 dark:text-slate-400\">\r\n                                    <div className=\"flex flex-col gap-1\">\r\n                                        <div className=\"flex items-center gap-1.5\">\r\n                                            <Clock size={12} className=\"text-emerald-500\" />\r\n                                            {item.checkIn ? new Date(item.checkIn).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '--:--'}\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-1.5\">\r\n                                            <Clock size={12} className=\"text-rose-500\" />\r\n                                            {item.checkOut ? new Date(item.checkOut).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '--:--'}\r\n                                        </div>\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-6 py-4\">\r\n                                    <span className=\"text-sm font-black text-slate-800 dark:text-white tracking-widest\">\r\n                                        {item.workingHours?.toFixed(1) || '0.0'} <span className=\"text-[10px] opacity-30\">HRS</span>\r\n                                    </span>\r\n                                </td>\r\n                                <td className=\"px-6 py-4\">\r\n                                    <div className=\"flex flex-col gap-1\">\r\n                                        <StatusBadge status={item.status} />\r\n                                        {item.isLate && <span className=\"text-[9px] font-black text-orange-500 uppercase tracking-widest\">Late Mark</span>}\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-6 py-4\">\r\n                                    <div className=\"flex items-center gap-1.5 text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest\">\r\n                                        <MapPin size={12} />\r\n                                        {item.logs?.[0]?.location || 'Remote'}\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 text-right\">\r\n                                    <button\r\n                                        onClick={() => setViewingEmployee(item.employee)}\r\n                                        className=\"p-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-slate-400 hover:text-blue-500 rounded-xl transition\"\r\n                                    >\r\n                                        <Eye size={18} />\r\n                                    </button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                        {filteredData.length === 0 && (\r\n                            <tr>\r\n                                <td colSpan=\"6\" className=\"px-6 py-12 text-center text-sm font-bold text-slate-400 italic\">No attendance records found for this date</td>\r\n                            </tr>\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n                {filteredData.length > pageSize && (\r\n                    <div className=\"px-6 py-4 border-t border-slate-100 dark:border-slate-800 flex justify-end\">\r\n                        <Pagination\r\n                            current={currentPage}\r\n                            pageSize={pageSize}\r\n                            total={filteredData.length}\r\n                            onChange={(page) => setCurrentPage(page)}\r\n                            showSizeChanger={false}\r\n                        />\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Employee Register Modal */}\r\n            {viewingEmployee && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"absolute inset-0 bg-slate-900/60 backdrop-blur-sm\" onClick={() => setViewingEmployee(null)}></div>\r\n                    <div className=\"relative w-full max-w-6xl max-h-[90vh] overflow-y-auto bg-slate-50 dark:bg-slate-950 rounded-[40px] shadow-2xl border border-white/20 p-8\">\r\n                        <div className=\"flex justify-between items-center mb-8\">\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className=\"h-14 w-14 rounded-2xl bg-white dark:bg-slate-800 flex items-center justify-center text-slate-300 font-black text-xl shadow-lg\">\r\n                                    {viewingEmployee.firstName[0]}\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">\r\n                                        {viewingEmployee.firstName} {viewingEmployee.lastName}'s Register\r\n                                    </h3>\r\n                                    <p className=\"text-xs font-bold text-slate-400 uppercase tracking-widest\">{viewingEmployee.employeeId}</p>\r\n                                </div>\r\n                            </div>\r\n                            <button onClick={() => setViewingEmployee(null)} className=\"p-3 bg-white dark:bg-slate-800 rounded-2xl text-slate-400 hover:text-rose-500 shadow-lg transition\">\r\n                                <X size={24} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"flex items-center gap-4 bg-white dark:bg-slate-900 p-3 rounded-2xl w-fit border border-slate-100 dark:border-slate-800 shadow-sm\">\r\n                                <button onClick={() => setCurrentMonth(m => m === 0 ? 11 : m - 1)} className=\"p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition\"><ChevronLeft size={20} /></button>\r\n                                <span className=\"text-sm font-black uppercase tracking-widest min-w-[120px] text-center\">\r\n                                    {new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long', year: 'numeric' })}\r\n                                </span>\r\n                                <button onClick={() => setCurrentMonth(m => m === 11 ? 0 : m + 1)} className=\"p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition\"><ChevronRight size={20} /></button>\r\n                            </div>\r\n\r\n                            <AttendanceCalendar\r\n                                data={employeeAttendance}\r\n                                holidays={holidays}\r\n                                settings={settings}\r\n                                currentMonth={currentMonth}\r\n                                currentYear={currentYear}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction StatusBadge({ status }) {\r\n    const config = {\r\n        present: 'bg-emerald-50 text-emerald-600 border-emerald-100',\r\n        absent: 'bg-rose-50 text-rose-600 border-rose-100',\r\n        leave: 'bg-blue-50 text-blue-600 border-blue-100',\r\n        half_day: 'bg-orange-50 text-orange-600 border-orange-100',\r\n        missed_punch: 'bg-purple-50 text-purple-600 border-purple-100',\r\n    };\r\n\r\n    return (\r\n        <span className={`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border w-fit ${config[status.toLowerCase()] || 'bg-slate-50 text-slate-500 border-slate-100'}`}>\r\n            {status}\r\n        </span>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\VerticalRuler.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\candidate\\Header.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\candidate\\Sidebar.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  10 |     useEffect(() => {\n  11 |         if (user?.companyName) {\n> 12 |             setCompanyName(user.companyName);\n     |             ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  13 |         } else {\n  14 |             const comp = localStorage.getItem('companyName');\n  15 |             if (comp) setCompanyName(comp);","line":12,"column":13,"nodeType":null,"endLine":12,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { NavLink } from 'react-router-dom';\r\nimport { LayoutDashboard, Briefcase, FileText, User, ChevronRight } from 'lucide-react';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\nexport default function Sidebar() {\r\n    const { user } = useAuth();\r\n    const [companyName, setCompanyName] = useState('Gitakshmi');\r\n\r\n    useEffect(() => {\r\n        if (user?.companyName) {\r\n            setCompanyName(user.companyName);\r\n        } else {\r\n            const comp = localStorage.getItem('companyName');\r\n            if (comp) setCompanyName(comp);\r\n        }\r\n    }, [user]);\r\n\r\n    const menuItems = [\r\n        { name: 'Dashboard Home', path: '/candidate/dashboard', icon: LayoutDashboard },\r\n        { name: 'Open Positions', path: '/candidate/open-positions', icon: Briefcase },\r\n        { name: 'My Applications', path: '/candidate/applications', icon: FileText },\r\n        { name: 'My Profile', path: '/candidate/profile', icon: User },\r\n    ];\r\n\r\n    return (\r\n        <aside className=\"w-72 bg-white flex flex-col border-r border-gray-100 hidden lg:flex h-screen sticky top-0 overflow-y-auto z-40\">\r\n            <div className=\"h-20 flex items-center px-8 border-b border-gray-50\">\r\n                <div className=\"bg-gradient-to-tr from-blue-600 to-indigo-600 p-2 rounded-xl\">\r\n                    <Briefcase className=\"w-6 h-6 text-white\" />\r\n                </div>\r\n                <span className=\"ml-3 text-xl font-black tracking-tight text-gray-900 uppercase\">\r\n                    {companyName}<span className=\"text-blue-600\">.</span>\r\n                </span>\r\n            </div>\r\n\r\n            <nav className=\"flex-1 px-4 py-8 space-y-2\">\r\n                <p className=\"px-4 text-[11px] font-black text-gray-400 uppercase tracking-widest mb-4\">Main Menu</p>\r\n                {menuItems.map((item) => (\r\n                    <NavLink\r\n                        key={item.path}\r\n                        to={item.path}\r\n                        end={item.path === '/candidate/dashboard'}\r\n                        className={({ isActive }) => `\r\n                            flex items-center justify-between px-4 py-4 rounded-2xl transition-all duration-300 group\r\n                            ${isActive\r\n                                ? 'bg-blue-600 text-white shadow-xl shadow-blue-500/30'\r\n                                : 'text-gray-500 hover:bg-blue-50 hover:text-blue-600'}\r\n                        `}\r\n                    >\r\n                        {({ isActive }) => (\r\n                            <>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <item.icon className={`w-5 h-5 transition-transform group-hover:scale-110 ${isActive ? 'text-white' : 'text-gray-400 group-hover:text-blue-600'}`} />\r\n                                    <span className=\"font-bold text-sm tracking-tight\">{item.name}</span>\r\n                                </div>\r\n                                <ChevronRight className={`w-4 h-4 opacity-0 transition-opacity duration-300 ${isActive ? 'opacity-100' : 'group-hover:opacity-100'}`} />\r\n                            </>\r\n                        )}\r\n                    </NavLink>\r\n                ))}\r\n            </nav>\r\n\r\n        </aside>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\common\\Button.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\common\\Card.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\common\\CommentSection.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchComments'. Either include it or remove the dependency array.","line":27,"column":8,"nodeType":"ArrayExpression","endLine":27,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [entityType, entityId, fetchComments]","fix":{"range":[962,984],"text":"[entityType, entityId, fetchComments]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport api from '../../utils/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\nconst BACKEND_URL = import.meta.env.VITE_BACKEND_URL || 'https://hrms.gitakshmi.com';\r\n\r\nexport default function CommentSection({ entityType, entityId }) {\r\n    const [comments, setComments] = useState([]);\r\n    const [newMessage, setNewMessage] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState(null);\r\n    const { user } = useAuth();\r\n\r\n    const fetchComments = async () => {\r\n        try {\r\n            const res = await api.get(`/comments/${entityType}/${entityId}`);\r\n            setComments(res.data);\r\n            setError(null);\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch comments\", error);\r\n            setError(\"Failed to load discussion.\");\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchComments();\r\n    }, [entityType, entityId]);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!newMessage.trim()) return;\r\n\r\n        setLoading(true);\r\n        try {\r\n            const res = await api.post(`/comments/${entityType}/${entityId}`, { message: newMessage });\r\n            setComments([...comments, res.data]);\r\n            setNewMessage('');\r\n        } catch (error) {\r\n            console.error(\"Failed to post comment\", error);\r\n            alert(\"Failed to post comment. Check permissions.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const getProfilePic = (pic) => {\r\n        if (!pic) return null;\r\n        if (pic.startsWith('http')) return pic;\r\n        return `${BACKEND_URL}${pic.startsWith('/') ? '' : '/'}${pic}`;\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col h-[500px]\">\r\n            <div className=\"p-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50\">\r\n                <h3 className=\"font-semibold text-slate-800 dark:text-white flex items-center gap-2\">\r\n                    <svg className=\"w-5 h-5 text-blue-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\" />\r\n                    </svg>\r\n                    Discussion\r\n                </h3>\r\n            </div>\r\n\r\n            <div className=\"flex-1 p-4 space-y-4 overflow-y-auto no-scrollbar\">\r\n                {error ? (\r\n                    <div className=\"text-center py-8\">\r\n                        <p className=\"text-red-500 text-sm mb-2 font-medium\">{error}</p>\r\n                        <button onClick={fetchComments} className=\"text-xs text-blue-600 hover:text-blue-700 underline\">Try again</button>\r\n                    </div>\r\n                ) : comments.length === 0 ? (\r\n                    <p className=\"text-center text-slate-500 text-sm py-8\">No comments yet. Start the discussion.</p>\r\n                ) : (\r\n                    comments.map((comment) => (\r\n                        <div key={comment._id} className={`flex gap-3 ${comment.commentedBy?._id === user?.id ? 'flex-row-reverse' : ''}`}>\r\n                            <div className=\"flex-shrink-0\">\r\n                                <div className=\"h-8 w-8 rounded-full bg-blue-100 dark:bg-slate-700 flex items-center justify-center text-blue-600 dark:text-blue-400 font-bold text-xs border border-slate-200 dark:border-slate-600 overflow-hidden shadow-sm\">\r\n                                    {comment.commentedBy?.profilePic ? (\r\n                                        <img src={getProfilePic(comment.commentedBy.profilePic)} alt=\"\" className=\"h-8 w-8 rounded-full object-cover\" />\r\n                                    ) : (\r\n                                        comment.commentedBy?.firstName?.charAt(0) || 'U'\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                            <div className={`flex flex-col max-w-[80%] ${comment.commentedBy?._id === user?.id ? 'items-end' : ''}`}>\r\n                                <div className=\"flex items-center gap-2 mb-1\">\r\n                                    <span className=\"text-xs font-semibold text-slate-700 dark:text-slate-300\">\r\n                                        {comment.commentedBy?.firstName} {comment.commentedBy?.lastName}\r\n                                    </span>\r\n                                    <span className=\"text-[10px] text-slate-400 capitalize bg-slate-100 dark:bg-slate-700 px-1.5 rounded-full\">\r\n                                        {comment.commentedByRole}\r\n                                    </span>\r\n                                </div>\r\n                                <div className={`p-3 rounded-2xl text-sm ${comment.commentedBy?._id === user?.id\r\n                                    ? 'bg-blue-600 text-white rounded-tr-none'\r\n                                    : 'bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-200 rounded-tl-none'\r\n                                    }`}>\r\n                                    {comment.message}\r\n                                </div>\r\n                                <span className=\"text-[10px] text-slate-400 mt-1\">\r\n                                    {new Date(comment.createdAt).toLocaleString([], { hour: '2-digit', minute: '2-digit', month: 'short', day: 'numeric' })}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"p-4 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-700\">\r\n                <form onSubmit={handleSubmit} className=\"flex gap-2\">\r\n                    <input\r\n                        type=\"text\"\r\n                        value={newMessage}\r\n                        onChange={(e) => setNewMessage(e.target.value)}\r\n                        placeholder=\"Write a comment...\"\r\n                        className=\"flex-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    />\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={loading || !newMessage.trim()}\r\n                        className=\"h-10 w-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition disabled:opacity-50\"\r\n                    >\r\n                        {loading ? (\r\n                            <svg className=\"animate-spin h-5 w-5\" viewBox=\"0 0 24 24\">\r\n                                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\" />\r\n                                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\r\n                            </svg>\r\n                        ) : (\r\n                            <svg className=\"w-5 h-5 rotate-90\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\r\n                            </svg>\r\n                        )}\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\common\\Loader.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\common\\Toast.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\editor\\OfferLetterEditor.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  274 |         if (isLetterPad) {\n  275 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 276 |             setShowHeader(true);\n      |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  277 |             setShowFooter(true);\n  278 |         } else {\n  279 |             setShowHeader(initialHasHeader);","line":276,"column":13,"nodeType":null,"endLine":276,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  286 |         if (bodyEditor && !activeEditor) {\n  287 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 288 |             setActiveEditor(bodyEditor);\n      |             ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  289 |         }\n  290 |     }, [bodyEditor, activeEditor]);\n  291 |","line":288,"column":13,"nodeType":null,"endLine":288,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\jobs\\BenefitsSection.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\jobs\\HeroSection.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\jobs\\JobCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\jobs\\JobFilters.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\jobs\\JobModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\layout\\ProtectedRoute.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\layout\\Sidebar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\layout\\Topbar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\nodes\\ResizableImageNode.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\ui\\Input.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\ui\\Modal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\components\\ui\\Select.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\context\\AuthContext.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":66,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":128,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":128,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":221,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":221,"endColumn":17}],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file.","line":7,"column":14,"nodeType":"Identifier","messageId":"reactContext","endLine":7,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":9,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":9,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable react-refresh/only-export-components */\r\nimport { createContext, useContext, useEffect, useState, useCallback } from \"react\";\r\nimport api from \"../utils/api\";\r\nimport { setToken, getToken, removeToken } from \"../utils/token\";\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [isInitialized, setIsInitialized] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // Initialize on mount\r\n  useEffect(() => {\r\n    const initializeAuth = () => {\r\n      const token = getToken();\r\n\r\n      if (!token) {\r\n        setUser(null);\r\n        setIsInitialized(true);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // Token exists - decode and validate\r\n        const payload = jwtDecode(token);\r\n\r\n        // Check token expiry\r\n        if (payload.exp && payload.exp * 1000 < Date.now()) {\r\n          console.warn('Token expired');\r\n          removeToken();\r\n          setUser(null);\r\n          setIsInitialized(true);\r\n          return;\r\n        }\r\n\r\n        // Token is valid - set it in axios headers\r\n        api.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n\r\n        // Extract user data from token\r\n        let userData = {\r\n          role: payload.role,\r\n          name: payload.name || payload.email || payload.employeeId || null,\r\n          email: payload.email,\r\n          tenantId: payload.tenantId,\r\n          employeeId: payload.employeeId,\r\n          id: payload.id || payload._id,\r\n        };\r\n\r\n        // Enrich candidate data\r\n        if (payload.role === 'candidate') {\r\n          const stored = localStorage.getItem('candidate');\r\n          if (stored) {\r\n            try {\r\n              const fullData = JSON.parse(stored);\r\n              userData = { ...userData, ...fullData };\r\n            } catch (e) { /* ignore */ }\r\n          }\r\n          if (!userData.companyName) {\r\n            userData.companyName = localStorage.getItem('companyName') || 'Company';\r\n          }\r\n        }\r\n\r\n        // Store tenantId for multi-tenant support\r\n        if (payload.tenantId) {\r\n          sessionStorage.setItem('tenantId', payload.tenantId);\r\n          localStorage.setItem('tenantId', payload.tenantId);\r\n        }\r\n\r\n        setUser(userData);\r\n      } catch (e) {\r\n        console.error('Auth initialization error:', e);\r\n        removeToken();\r\n        setUser(null);\r\n        delete api.defaults.headers.common[\"Authorization\"];\r\n      } finally {\r\n        setIsInitialized(true);\r\n      }\r\n    };\r\n\r\n    initializeAuth();\r\n\r\n    // Listen for 401 Unauthorized events\r\n    const handleUnauthorized = () => {\r\n      console.warn(\"Session expired. Logging out.\");\r\n      removeToken();\r\n      localStorage.removeItem(\"candidate\");\r\n      setUser(null);\r\n      delete api.defaults.headers.common[\"Authorization\"];\r\n    };\r\n\r\n    window.addEventListener('auth:unauthorized', handleUnauthorized);\r\n    return () => {\r\n      window.removeEventListener('auth:unauthorized', handleUnauthorized);\r\n    };\r\n  }, []);\r\n\r\n  const login = useCallback(async (email, password) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const res = await api.post(\"/auth/login\", { email, password });\r\n      const { token, user: userData } = res.data;\r\n\r\n      setToken(token);\r\n      api.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n\r\n      // Store tenantId if available\r\n      if (userData?.tenantId) {\r\n        localStorage.setItem('tenantId', userData.tenantId);\r\n        sessionStorage.setItem('tenantId', userData.tenantId);\r\n      } else {\r\n        // Try to decode from token if not in user object\r\n        try {\r\n          const decoded = jwtDecode(token);\r\n          if (decoded.tenantId) {\r\n            localStorage.setItem('tenantId', decoded.tenantId);\r\n            sessionStorage.setItem('tenantId', decoded.tenantId);\r\n          }\r\n        } catch (e) { /* ignore */ }\r\n      }\r\n\r\n      setUser(userData);\r\n      return { success: true };\r\n    } catch (error) {\r\n      const message = error.response?.data?.message\r\n        || (error.code === 'ERR_NETWORK' || error.message?.includes('timeout')\r\n          ? \"Server unreachable. Please check your connection.\"\r\n          : \"Invalid credentials\");\r\n      return { success: false, message };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loginHR = useCallback(async (companyCode, email, password) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const res = await api.post('/auth/login-hr', { companyCode, email, password });\r\n      const { token, user: userData } = res.data;\r\n\r\n      setToken(token);\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      setUser(userData);\r\n\r\n      try {\r\n        const decoded = jwtDecode(token);\r\n        if (decoded.tenantId) {\r\n          sessionStorage.setItem('tenantId', decoded.tenantId);\r\n          localStorage.setItem('tenantId', decoded.tenantId);\r\n        }\r\n      } catch (e) {\r\n        console.warn('Failed to decode token:', e.message);\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      return { success: false, message: error.response?.data?.message || 'Invalid credentials' };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loginEmployee = useCallback(async (companyCode, employeeId, password) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const res = await api.post('/auth/login-employee', { companyCode, employeeId, password });\r\n      const { token, user: userData } = res.data;\r\n\r\n      setToken(token);\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      setUser(userData);\r\n\r\n      try {\r\n        const decoded = jwtDecode(token);\r\n        if (decoded.tenantId) {\r\n          sessionStorage.setItem('tenantId', decoded.tenantId);\r\n          localStorage.setItem('tenantId', decoded.tenantId);\r\n        }\r\n      } catch (e) {\r\n        console.warn('Failed to decode token:', e.message);\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      return { success: false, message: error.response?.data?.message || 'Invalid credentials' };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loginCandidate = useCallback(async (tenantId, email, password) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const res = await api.post('/candidate/login', { tenantId, email, password });\r\n      const token = res.data.token;\r\n\r\n      setToken(token);\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n\r\n      let companyName = 'Company';\r\n      try {\r\n        const decoded = jwtDecode(token);\r\n        if (decoded.tenantId) {\r\n          sessionStorage.setItem('tenantId', decoded.tenantId);\r\n          localStorage.setItem('tenantId', decoded.tenantId);\r\n        }\r\n\r\n        // Best effort to get company name\r\n        const tenantRes = await api.get(`/public/tenant/${tenantId}`);\r\n        companyName = tenantRes.data.name;\r\n        localStorage.setItem('companyName', companyName);\r\n      } catch (e) { /* ignore */ }\r\n\r\n      const candidateData = { ...res.data.candidate, role: 'candidate', companyName };\r\n      setUser(candidateData);\r\n      localStorage.setItem(\"candidate\", JSON.stringify(candidateData));\r\n\r\n      return { success: true, candidate: candidateData };\r\n    } catch (error) {\r\n      return { success: false, message: error.response?.data?.error || 'Login failed' };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const logout = useCallback(() => {\r\n    removeToken();\r\n    sessionStorage.removeItem('tenantId');\r\n    localStorage.removeItem(\"candidate\");\r\n    localStorage.removeItem(\"companyName\");\r\n    setUser(null);\r\n    delete api.defaults.headers.common[\"Authorization\"];\r\n  }, []);\r\n\r\n  const refreshUser = async () => {\r\n    // Placeholder for refreshing user data from backend if needed\r\n    // Currently just relies on token state\r\n  };\r\n\r\n  const registerCandidate = useCallback(async (data) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const res = await api.post('/candidate/register', data);\r\n      return { success: true, ...res.data };\r\n    } catch (error) {\r\n      return { success: false, message: error.response?.data?.error || error.response?.data?.message || 'Registration failed' };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{\r\n      user,\r\n      isInitialized,\r\n      isLoading,\r\n      login,\r\n      loginHR,\r\n      loginEmployee,\r\n      loginCandidate,\r\n      registerCandidate,\r\n      refreshUser,\r\n      logout\r\n    }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport default AuthProvider;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\context\\TenantContext.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file.","line":4,"column":14,"nodeType":"Identifier","messageId":"reactContext","endLine":4,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\context\\UIContext.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file.","line":4,"column":14,"nodeType":"Identifier","messageId":"reactContext","endLine":4,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\BGVFormatter.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\FontSize.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\LineHeight.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\LineHeightExtension.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\PageBreak.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\PageBreakExtension.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\ParagraphIndent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\ParagraphSpacing.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\PlaceholderExtension.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\ResizableImage.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\extensions\\WordPasteHandler.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\hooks\\useApi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\hooks\\useAuth.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\hooks\\useOrgStructure.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\hooks\\useToast.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\layouts\\AuthLayout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\layouts\\CandidateLayout.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'companyName' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":9,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"companyName"},"fix":{"range":[349,360],"text":""},"desc":"Remove unused variable 'companyName'."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  11 |     useEffect(() => {\n  12 |         if (user?.companyName) {\n> 13 |             setCompanyName(user.companyName);\n     |             ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  14 |         } else {\n  15 |             const comp = localStorage.getItem('companyName');\n  16 |             if (comp) setCompanyName(comp);","line":13,"column":13,"nodeType":null,"endLine":13,"endColumn":27}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Outlet } from 'react-router-dom';\r\nimport Sidebar from '../components/candidate/Sidebar';\r\nimport Header from '../components/candidate/Header';\r\nimport { useAuth } from '../context/AuthContext';\r\n\r\nexport default function CandidateLayout() {\r\n    const { user } = useAuth();\r\n    const [companyName, setCompanyName] = useState('Gitakshmi');\r\n\r\n    useEffect(() => {\r\n        if (user?.companyName) {\r\n            setCompanyName(user.companyName);\r\n        } else {\r\n            const comp = localStorage.getItem('companyName');\r\n            if (comp) setCompanyName(comp);\r\n        }\r\n    }, [user]);\r\n\r\n    return (\r\n        <div className=\"flex bg-[#F8FAFC] min-h-screen\">\r\n            <Sidebar />\r\n\r\n            <div className=\"flex-1 flex flex-col min-h-screen\">\r\n                <Header />\r\n\r\n                <main className=\"flex-1 overflow-x-hidden p-6 lg:p-8\">\r\n                    <div className=\"max-w-full mx-auto px-4 lg:px-8\">\r\n                        <Outlet />\r\n                    </div>\r\n                </main>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\layouts\\EssLayout.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token `}`. Did you mean `&rbrace;` or `{\"}\"}`?","line":152,"column":1}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useContext } from 'react';\r\nimport { Outlet, useNavigate } from 'react-router-dom';\r\nimport api from '../utils/api';\r\nimport EmployeeSidebar from '../components/EmployeeSidebar';\r\nimport NotificationDropdown from '../components/NotificationDropdown';\r\nimport SidebarCompanyBlock from '../components/SidebarCompanyBlock';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { UIContext } from '../context/UIContext';\r\nimport { Sun, Moon, LogOut, Menu, ArrowLeft } from 'lucide-react';\r\n\r\nexport default function EssLayout() {\r\n  const { logout, user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const [activeTab, setActiveTab] = useState('dashboard');\r\n  const [profile, setProfile] = useState(null);\r\n\r\n  const uiContext = useContext(UIContext);\r\n  const { theme, toggleTheme } = uiContext || { theme: 'light', toggleTheme: () => { } };\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      api.get('/employee/profile').then(res => setProfile(res.data)).catch(() => { });\r\n    }\r\n  }, [user]);\r\n\r\n  const handleLogout = () => {\r\n    logout();\r\n    navigate('/login');\r\n  };\r\n\r\n  const fullName = profile ? `${profile.firstName} ${profile.lastName}` : user?.name || 'Employee';\r\n\r\n  return (\r\n    <div className={`flex h-screen bg-[#F8FAFC] dark:bg-[#0F172A] transition-colors duration-300 ${theme === 'dark' ? 'dark' : ''}`}>\r\n      {/* Mobile Sidebar Overlay */}\r\n      {sidebarOpen && (\r\n        <div\r\n          className=\"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-30 md:hidden transition-all duration-300\"\r\n          onClick={() => setSidebarOpen(false)}\r\n        />\r\n      )}\r\n\r\n      {/* Sidebar - Fixed on desktop */}\r\n      <div className={`fixed w-72 h-screen transform transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] z-40 ${sidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}`}>\r\n        <EmployeeSidebar\r\n          activeTab={activeTab}\r\n          setActiveTab={(tab) => {\r\n            setActiveTab(tab);\r\n            if (window.location.pathname !== '/employee') navigate('/employee');\r\n          }}\r\n          onClose={() => setSidebarOpen(false)}\r\n        />\r\n      </div>\r\n\r\n      {/* Main Content Wrapper */}\r\n      <div className=\"flex-1 flex flex-col w-full md:ml-72 min-h-screen overflow-hidden\">\r\n        {/* Header */}\r\n        <header className=\"flex justify-between items-center px-8 h-24 bg-white/60 dark:bg-slate-900/60 backdrop-blur-xl border-b border-slate-200/50 dark:border-slate-800/50 sticky top-0 z-20\">\r\n          <div className=\"flex items-center gap-6\">\r\n            <button\r\n              onClick={() => setSidebarOpen(!sidebarOpen)}\r\n              className=\"md:hidden p-3 rounded-2xl hover:bg-white dark:hover:bg-slate-800 transition-all text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700 shadow-sm\"\r\n            >\r\n              <Menu size={20} />\r\n            </button>\r\n            <div className=\"hidden md:flex items-center gap-4\">\r\n              <button\r\n                onClick={() => navigate(-1)}\r\n                className=\"p-2.5 rounded-xl hover:bg-white dark:hover:bg-slate-800 transition-all text-slate-400 dark:text-slate-500 group border border-transparent hover:border-slate-200 dark:hover:border-slate-700 shadow-hover\"\r\n                title=\"Go Back\"\r\n              >\r\n                <ArrowLeft size={18} className=\"group-hover:-translate-x-1 transition-transform\" />\r\n              </button>\r\n              <div className=\"h-6 w-px bg-slate-200 dark:bg-slate-800\"></div>\r\n              <div className=\"flex flex-col\">\r\n                <h2 className=\"text-[10px] font-black text-indigo-500 uppercase tracking-[0.2em] leading-none mb-1\">\r\n                  Security Protocol\r\n                </h2>\r\n                <p className=\"text-sm font-black text-slate-800 dark:text-white uppercase tracking-tighter italic\">\r\n                  Employee Intelligence Portal\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-5\">\r\n            <div className=\"flex items-center gap-2 bg-slate-50 dark:bg-slate-950 p-1.5 rounded-[1.25rem] border border-slate-200/50 dark:border-slate-800/50\">\r\n              <button\r\n                onClick={toggleTheme}\r\n                className=\"p-2.5 rounded-xl hover:bg-white dark:hover:bg-slate-800 transition-all shadow-sm group\"\r\n                title=\"Toggle Environment\"\r\n              >\r\n                {theme === 'dark' ? (\r\n                  <Sun className=\"w-4 h-4 text-amber-400 group-hover:rotate-90 transition-transform duration-700\" />\r\n                ) : (\r\n                  <Moon className=\"w-4 h-4 text-slate-600 group-hover:-rotate-12 transition-transform duration-700\" />\r\n                )}\r\n              </button>\r\n\r\n              <div className=\"h-4 w-px bg-slate-200 dark:bg-slate-800\"></div>\r\n\r\n              <div className=\"relative\">\r\n                <NotificationDropdown />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"h-10 w-px bg-slate-200 dark:bg-slate-800\"></div>\r\n\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"hidden lg:block text-right\">\r\n                <p className=\"text-xs font-black text-slate-800 dark:text-white leading-none uppercase tracking-tighter italic\">{fullName}</p>\r\n                <p className=\"text-[9px] font-black text-indigo-500 dark:text-indigo-400 uppercase tracking-[0.2em] mt-1.5\">{user?.role} NODE</p>\r\n              </div>\r\n\r\n              <div className=\"relative group cursor-pointer\">\r\n                <div className=\"h-12 w-12 rounded-2xl bg-gradient-to-tr from-indigo-600 to-violet-600 p-[2px] shadow-2xl shadow-indigo-600/20 group-hover:scale-110 transition-all duration-500\">\r\n                  <div className=\"w-full h-full rounded-[14px] bg-white dark:bg-slate-900 overflow-hidden flex items-center justify-center relative\">\r\n                    {profile?.profilePic ? (\r\n                      <img src={profile.profilePic} alt=\"profile\" className=\"w-full h-full object-cover\" />\r\n                    ) : (\r\n                      <span className=\"text-sm font-black text-indigo-600 dark:text-indigo-400 italic\">{fullName?.[0]?.toUpperCase()}</span>\r\n                    )}\r\n                    <div className=\"absolute inset-0 bg-indigo-600/10 opacity-0 group-hover:opacity-100 transition-opacity\"></div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"absolute -bottom-1 -right-1 w-4 h-4 bg-emerald-500 border-4 border-white dark:border-slate-900 rounded-full\"></div>\r\n              </div>\r\n\r\n              <button\r\n                onClick={handleLogout}\r\n                className=\"p-3 text-slate-400 hover:text-rose-500 bg-slate-50 dark:bg-slate-950 hover:bg-rose-50 dark:hover:bg-rose-950/30 rounded-2xl transition-all border border-slate-200/50 dark:border-slate-800/50 hover:border-rose-200 dark:hover:border-rose-900/40 group shadow-sm\"\r\n                title=\"Terminate Session\"\r\n              >\r\n                <LogOut size={18} className=\"group-hover:translate-x-1 transition-transform\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </header>\r\n\r\n        {/* Page Content Area */}\r\n        <main className=\"flex-1 overflow-y-auto bg-slate-50 dark:bg-slate-900 p-0 md:p-0 w-full\">\r\n          <div className=\"p-3 md:p-6 w-full\">\r\n        <main className=\"flex-1 overflow-y-auto bg-[#F8FAFC] dark:bg-[#0F172A] p-6 lg:p-10 custom-scrollbar\">\r\n          <div className=\"max-w-[1600px] mx-auto animate-in fade-in slide-in-from-bottom-4 duration-700\">\r\n            <Outlet context={{ activeTab, setActiveTab }} />\r\n          </div>\r\n        </main>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\layouts\\HrLayout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\layouts\\PsaLayout.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Expected corresponding JSX closing tag for <div>","line":179,"column":7}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from \"react\";\r\nimport { NavLink, Outlet, useNavigate, useLocation } from \"react-router-dom\";\r\nimport \"@fortawesome/fontawesome-free/css/all.min.css\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\nimport logoSrc from \"../assets/logonew.png\";\r\nimport { ChevronDown, ChevronRight, Briefcase, Plus, List } from \"lucide-react\";\r\n\r\nexport default function PsaLayout() {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { user, logout } = useAuth();\r\n\r\n  // Mobile menu state\r\n  const [open, setOpen] = useState(false);\r\n\r\n  // Sidebar Accordion State (Companies)\r\n  // Default to open if currently on a companies page\r\n  const [isCompaniesOpen, setIsCompaniesOpen] = useState(\r\n    location.pathname.includes('/psa/companies')\r\n  );\r\n\r\n  // üîê PROTECT PSA ROUTE\r\n  useEffect(() => {\r\n    if (!user) {\r\n      navigate(\"/login\", { replace: true });\r\n    }\r\n  }, [user, navigate]);\r\n\r\n  // üî¥ LOGOUT\r\n  function handleLogout() {\r\n    logout();\r\n    navigate(\"/login\", { replace: true });\r\n  }\r\n\r\n  const toggleCompanies = () => setIsCompaniesOpen(!isCompaniesOpen);\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-slate-50 overflow-hidden font-sans\">\r\n\r\n      {/* SIDEBAR - desktop (dark theme) */}\r\n      <aside className={`hidden sm:flex w-64 bg-slate-900 text-white flex-col flex-shrink-0 transition-all shadow-xl`}>\r\n        <div className=\"h-16 flex items-center px-6 border-b border-slate-800 bg-slate-900\">\r\n          <img src={logoSrc} alt=\"logo\" className=\"w-32 object-contain\" />\r\n        </div>\r\n\r\n        <nav className=\"flex-1 p-4 space-y-2 overflow-y-auto\">\r\n          {/* Dashboard */}\r\n          <NavLink to=\"/psa\" end className={({ isActive }) => `w-full flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 ${isActive ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>\r\n            <i className=\"fa-solid fa-chart-line w-5 text-center\"></i>\r\n            <span className=\"truncate\">Dashboard</span>\r\n          </NavLink>\r\n\r\n          {/* Companies Accordion */}\r\n          <div className=\"space-y-1\">\r\n            <button\r\n              onClick={toggleCompanies}\r\n              className={`w-full flex items-center justify-between gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 ${isCompaniesOpen || location.pathname.includes('/psa/companies') ? 'text-white bg-slate-800' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}\r\n            >\r\n              <div className=\"flex items-center gap-3\">\r\n                <Briefcase className=\"w-5 h-5 opacity-90\" />\r\n                <span>Companies</span>\r\n              </div>\r\n              {isCompaniesOpen ? <ChevronDown /> : <ChevronRight />}\r\n            </button>\r\n\r\n            {/* Sub-menu */}\r\n            {isCompaniesOpen && (\r\n              <div className=\"pl-4 space-y-1 animate-fadeIn\">\r\n                <div className=\"border-l-2 border-slate-700 pl-2 space-y-1 mt-1\">\r\n                  <NavLink to=\"/psa/companies/add\" className={({ isActive }) => `block w-full text-left px-3 py-2 text-sm rounded-md transition-colors ${isActive ? 'text-blue-400 font-semibold bg-slate-800/50' : 'text-slate-400 hover:text-white hover:bg-slate-800/30'}`}>\r\n                    <span className=\"flex items-center gap-2\">\r\n                      <Plus size={14} /> Add Company\r\n                    </span>\r\n                  </NavLink>\r\n                  <NavLink to=\"/psa/companies\" end className={({ isActive }) => `block w-full text-left px-3 py-2 text-sm rounded-md transition-colors ${isActive ? 'text-blue-400 font-semibold bg-slate-800/50' : 'text-slate-400 hover:text-white hover:bg-slate-800/30'}`}>\r\n                    <span className=\"flex items-center gap-2\">\r\n                      <List size={14} /> All Companies\r\n                    </span>\r\n                  </NavLink>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <NavLink to=\"/psa/activities\" className={({ isActive }) => `w-full flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 ${isActive ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>\r\n            <i className=\"fa-regular fa-clock w-5 text-center\"></i>\r\n            <span className=\"truncate\">Recent Activity</span>\r\n          </NavLink>\r\n          <NavLink to=\"/psa/modules\" className={({ isActive }) => `w-full flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 ${isActive ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>\r\n            <i className=\"fa-solid fa-sliders w-5 text-center\"></i>\r\n            <span className=\"truncate\">Module Config</span>\r\n          </NavLink>\r\n        </nav>\r\n\r\n        <div className=\"p-4 border-t border-slate-800 bg-slate-900\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"w-10 h-10 rounded-full bg-gradient-to-tr from-blue-600 to-blue-400 text-white flex items-center justify-center text-sm font-bold shadow-lg\">SA</div>\r\n            <div className=\"overflow-hidden\">\r\n              <div className=\"text-sm font-bold text-white truncate\">Super Admin</div>\r\n              <div className=\"text-xs text-slate-400 truncate\">System Owner</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </aside>\r\n\r\n      {/* SIDEBAR - mobile overlay */}\r\n      <div className={`sm:hidden fixed inset-0 z-40 ${open ? '' : 'pointer-events-none'}`} aria-hidden={!open}>\r\n        <div className={`fixed inset-0 bg-black/50 transition-opacity backdrop-blur-sm ${open ? 'opacity-100' : 'opacity-0'}`} onClick={() => setOpen(false)}></div>\r\n        <aside className={`fixed inset-y-0 left-0 w-64 bg-slate-900 text-white shadow-2xl transform transition-transform ${open ? 'translate-x-0' : '-translate-x-full'}`}>\r\n          <div className=\"h-16 flex items-center px-6 border-b border-slate-800\">\r\n            <img src={logoSrc} alt=\"logo\" className=\"w-32\" />\r\n          </div>\r\n          <nav className=\"p-4 space-y-2\">\r\n            <NavLink to=\"/psa\" end onClick={() => setOpen(false)} className={({ isActive }) => `w-full flex items-center gap-3 px-3 py-2 rounded-lg ${isActive ? 'bg-blue-600 text-white' : 'text-slate-400'}`}>\r\n              <i className=\"fa-solid fa-chart-line w-5\"></i> Dashboard\r\n            </NavLink>\r\n\r\n            {/* Mobile Accordion */}\r\n            <div className=\"space-y-1\">\r\n              <button\r\n                onClick={toggleCompanies}\r\n                className={`w-full flex items-center justify-between gap-3 px-3 py-2 text-sm font-medium rounded-lg ${isCompaniesOpen ? 'text-white bg-slate-800' : 'text-slate-400'}`}\r\n              >\r\n                <div className=\"flex items-center gap-3\">\r\n                  <Briefcase className=\"w-5 h-5\" />\r\n                  <span>Companies</span>\r\n                </div>\r\n                {isCompaniesOpen ? <ChevronDown /> : <ChevronRight />}\r\n              </button>\r\n              {isCompaniesOpen && (\r\n                <div className=\"pl-4 space-y-1\">\r\n                  <div className=\"border-l-2 border-slate-700 pl-2 mt-1 space-y-1\">\r\n                    <NavLink to=\"/psa/companies/add\" onClick={() => setOpen(false)} className={({ isActive }) => `block px-3 py-2 text-sm rounded ${isActive ? 'text-blue-400' : 'text-slate-400'}`}>\r\n                      + Add Company\r\n                    </NavLink>\r\n                    <NavLink to=\"/psa/companies\" end onClick={() => setOpen(false)} className={({ isActive }) => `block px-3 py-2 text-sm rounded ${isActive ? 'text-blue-400' : 'text-slate-400'}`}>\r\n                      ‚Ä¢ All Companies\r\n                    </NavLink>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <NavLink to=\"/psa/activities\" onClick={() => setOpen(false)} className={({ isActive }) => `w-full flex items-center gap-3 px-3 py-2 rounded-lg ${isActive ? 'bg-blue-600 text-white' : 'text-slate-400'}`}>\r\n              <i className=\"fa-regular fa-clock w-5\"></i> Recent Activity\r\n            </NavLink>\r\n            <NavLink to=\"/psa/modules\" onClick={() => setOpen(false)} className={({ isActive }) => `w-full flex items-center gap-3 px-3 py-2 rounded-lg ${isActive ? 'bg-blue-600 text-white' : 'text-slate-400'}`}>\r\n              <i className=\"fa-solid fa-sliders w-5\"></i> Module Config\r\n            </NavLink>\r\n          </nav>\r\n        </aside>\r\n      </div>\r\n\r\n      {/* MAIN CONTENT */}\r\n      <main className=\"flex-1 flex flex-col min-w-0 overflow-hidden bg-slate-50\">\r\n        <header className=\"h-16 bg-white border-b border-slate-200 flex items-center justify-between px-4 sm:px-8 shadow-sm z-10\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <button onClick={() => navigate(-1)} className=\"p-2 rounded-full text-slate-500 hover:bg-slate-100 transition\">\r\n              <i className=\"fa-solid fa-arrow-left\"></i>\r\n            </button>\r\n            <button className=\"sm:hidden p-2 text-slate-600\" onClick={() => setOpen(true)}>\r\n              <i className=\"fa-solid fa-bars text-xl\"></i>\r\n            </button>\r\n            <h1 className=\"text-xl font-bold text-slate-800 tracking-tight\">Product Super Admin</h1>\r\n          </div>\r\n          <button onClick={handleLogout} className=\"px-4 py-2 bg-red-50 text-red-600 text-sm font-medium rounded-lg hover:bg-red-100 transition-colors\">\r\n            Logout\r\n          </button>\r\n        </header>\r\n\r\n        {/* PAGE CONTENT */}\r\n        <div className=\"flex-1 overflow-auto p-0 sm:p-0 w-full\">\r\n          <div className=\"p-4 sm:p-8 w-full\">\r\n            <Outlet />\r\n          </div>\r\n        <div className=\"flex-1 overflow-auto p-4 sm:p-8\">\r\n          <Outlet />\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Admin\\IdConfiguration.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'selectedEntity' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":26,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"selectedEntity"},"fix":{"range":[811,825],"text":""},"desc":"Remove unused variable 'selectedEntity'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setSelectedEntity' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":26,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":45,"suggestions":[{"messageId":"removeVar","data":{"varName":"setSelectedEntity"},"fix":{"range":[825,844],"text":""},"desc":"Remove unused variable 'setSelectedEntity'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'previewId' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":27,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"previewId"},"fix":{"range":[876,885],"text":""},"desc":"Remove unused variable 'previewId'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'onPreview'. Either include it or remove the dependency array. If 'onPreview' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":228,"column":8,"nodeType":"ArrayExpression","endLine":228,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [expanded, config, onPreview]","fix":{"range":[7997,8015],"text":"[expanded, config, onPreview]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n * COMPANY ID CONFIGURATION PAGE\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n * \r\n * Professional admin UI for configuring custom ID formats.\r\n * Allows company admins to customize ID patterns for all HRMS entities.\r\n * \r\n * Features:\r\n * - Real-time preview\r\n * - Locked configuration warning\r\n * - Validation\r\n * - Reset to defaults\r\n * \r\n * @version 2.0\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport api from '../../utils/api';\r\nimport './IdConfiguration.css';\r\n\r\nconst IdConfiguration = () => {\r\n    const [configurations, setConfigurations] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [selectedEntity, setSelectedEntity] = useState(null);\r\n    const [previewId, setPreviewId] = useState('');\r\n    const [error, setError] = useState(null);\r\n    const [success, setSuccess] = useState(null);\r\n\r\n    // Entity type labels\r\n    const entityLabels = {\r\n        job: 'Job Opening',\r\n        candidate: 'Candidate',\r\n        application: 'Application',\r\n        interview: 'Interview',\r\n        offer: 'Offer Letter',\r\n        employee: 'Employee',\r\n        payslip: 'Payslip'\r\n    };\r\n\r\n    // Entity type icons\r\n    const entityIcons = {\r\n        job: 'üíº',\r\n        candidate: 'üë§',\r\n        application: 'üìù',\r\n        interview: 'üé§',\r\n        offer: 'üìÑ',\r\n        employee: 'üë®‚Äçüíº',\r\n        payslip: 'üí∞'\r\n    };\r\n\r\n    // Load configuration on mount\r\n    useEffect(() => {\r\n        loadConfiguration();\r\n    }, []);\r\n\r\n    const loadConfiguration = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const res = await api.get('/id-config');\r\n            setConfigurations(res.data.data.configurations);\r\n            setError(null);\r\n        } catch (err) {\r\n            console.error('Error loading configuration:', err);\r\n            setError('Failed to load ID configuration');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleConfigChange = (entityType, field, value) => {\r\n        setConfigurations(prev =>\r\n            prev.map(config =>\r\n                config.entityType === entityType\r\n                    ? { ...config, [field]: value }\r\n                    : config\r\n            )\r\n        );\r\n\r\n        // Update preview\r\n        updatePreview(entityType);\r\n    };\r\n\r\n    const updatePreview = async (entityType) => {\r\n        try {\r\n            const config = configurations.find(c => c.entityType === entityType);\r\n            if (!config) return;\r\n\r\n            const params = new URLSearchParams();\r\n            if (config.includeDepartment) params.append('department', 'HR');\r\n            if (config.includeYear) params.append('year', new Date().getFullYear());\r\n            if (config.includeMonth) params.append('month', new Date().getMonth() + 1);\r\n\r\n            const res = await api.get(`/id-config/${entityType}/preview?${params.toString()}`);\r\n            setPreviewId(res.data.data.format);\r\n        } catch (err) {\r\n            console.error('Error updating preview:', err);\r\n        }\r\n    };\r\n\r\n    const handleSave = async (entityType) => {\r\n        try {\r\n            setSaving(true);\r\n            setError(null);\r\n            setSuccess(null);\r\n\r\n            const config = configurations.find(c => c.entityType === entityType);\r\n            if (!config) return;\r\n\r\n            const updates = {\r\n                prefix: config.prefix,\r\n                separator: config.separator,\r\n                includeYear: config.includeYear,\r\n                yearFormat: config.yearFormat,\r\n                includeMonth: config.includeMonth,\r\n                monthFormat: config.monthFormat,\r\n                includeDepartment: config.includeDepartment,\r\n                departmentFormat: config.departmentFormat,\r\n                paddingLength: config.paddingLength,\r\n                resetPolicy: config.resetPolicy,\r\n                startingNumber: config.startingNumber\r\n            };\r\n\r\n            await api.patch(`/id-config/${entityType}`, updates);\r\n\r\n            setSuccess(`Configuration saved successfully for ${entityLabels[entityType]}`);\r\n\r\n            // Reload to get updated lock status\r\n            await loadConfiguration();\r\n\r\n            setTimeout(() => setSuccess(null), 3000);\r\n        } catch (err) {\r\n            console.error('Error saving configuration:', err);\r\n\r\n            if (err.response?.data?.code === 'CONFIGURATION_LOCKED') {\r\n                setError(`Cannot modify configuration. IDs have already been generated for ${entityLabels[entityType]}.`);\r\n            } else {\r\n                setError(err.response?.data?.message || 'Failed to save configuration');\r\n            }\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleReset = async (entityType) => {\r\n        if (!window.confirm(`Reset ${entityLabels[entityType]} ID configuration to defaults?`)) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setSaving(true);\r\n            await api.post(`/id-config/${entityType}/reset`);\r\n            setSuccess(`Configuration reset to defaults for ${entityLabels[entityType]}`);\r\n            await loadConfiguration();\r\n            setTimeout(() => setSuccess(null), 3000);\r\n        } catch (err) {\r\n            console.error('Error resetting configuration:', err);\r\n            setError(err.response?.data?.message || 'Failed to reset configuration');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"id-config-loading\">\r\n                <div className=\"spinner\"></div>\r\n                <p>Loading ID Configuration...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"id-configuration-page\">\r\n            <div className=\"page-header\">\r\n                <div>\r\n                    <h1>üîß ID Configuration</h1>\r\n                    <p className=\"page-subtitle\">\r\n                        Customize ID formats for all HRMS entities. Changes apply to new IDs only.\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {error && (\r\n                <div className=\"alert alert-error\">\r\n                    <span className=\"alert-icon\">‚ö†Ô∏è</span>\r\n                    <span>{error}</span>\r\n                    <button onClick={() => setError(null)} className=\"alert-close\">√ó</button>\r\n                </div>\r\n            )}\r\n\r\n            {success && (\r\n                <div className=\"alert alert-success\">\r\n                    <span className=\"alert-icon\">‚úÖ</span>\r\n                    <span>{success}</span>\r\n                    <button onClick={() => setSuccess(null)} className=\"alert-close\">√ó</button>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"config-grid\">\r\n                {configurations.map(config => (\r\n                    <ConfigurationCard\r\n                        key={config.entityType}\r\n                        config={config}\r\n                        label={entityLabels[config.entityType]}\r\n                        icon={entityIcons[config.entityType]}\r\n                        onChange={(field, value) => handleConfigChange(config.entityType, field, value)}\r\n                        onSave={() => handleSave(config.entityType)}\r\n                        onReset={() => handleReset(config.entityType)}\r\n                        saving={saving}\r\n                        onPreview={() => updatePreview(config.entityType)}\r\n                    />\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// Configuration Card Component\r\nconst ConfigurationCard = ({ config, label, icon, onChange, onSave, onReset, saving, onPreview }) => {\r\n    const [expanded, setExpanded] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (expanded) {\r\n            onPreview();\r\n        }\r\n    }, [expanded, config]);\r\n\r\n    return (\r\n        <div className={`config-card ${config.isLocked ? 'locked' : ''}`}>\r\n            <div className=\"config-card-header\" onClick={() => setExpanded(!expanded)}>\r\n                <div className=\"config-card-title\">\r\n                    <span className=\"config-icon\">{icon}</span>\r\n                    <div>\r\n                        <h3>{label}</h3>\r\n                        <p className=\"config-example\">{config.exampleFormat}</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"config-card-actions\">\r\n                    {config.isLocked && (\r\n                        <span className=\"lock-badge\" title=\"Configuration locked - IDs already generated\">\r\n                            üîí Locked\r\n                        </span>\r\n                    )}\r\n                    <button className=\"expand-btn\">\r\n                        {expanded ? '‚ñº' : '‚ñ∂'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {expanded && (\r\n                <div className=\"config-card-body\">\r\n                    {config.isLocked && (\r\n                        <div className=\"lock-warning\">\r\n                            <span className=\"warning-icon\">‚ö†Ô∏è</span>\r\n                            <div>\r\n                                <strong>Configuration Locked</strong>\r\n                                <p>\r\n                                    {config.generatedCount} {label} ID(s) have been generated.\r\n                                    Configuration cannot be modified to maintain data integrity.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"config-form\">\r\n                        {/* Prefix */}\r\n                        <div className=\"form-group\">\r\n                            <label>Prefix</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={config.prefix}\r\n                                onChange={(e) => onChange('prefix', e.target.value.toUpperCase())}\r\n                                disabled={config.isLocked}\r\n                                maxLength={10}\r\n                                className=\"form-control\"\r\n                                placeholder=\"e.g., JOB, EMP\"\r\n                            />\r\n                            <small>Uppercase letters only, max 10 characters</small>\r\n                        </div>\r\n\r\n                        {/* Separator */}\r\n                        <div className=\"form-group\">\r\n                            <label>Separator</label>\r\n                            <select\r\n                                value={config.separator}\r\n                                onChange={(e) => onChange('separator', e.target.value)}\r\n                                disabled={config.isLocked}\r\n                                className=\"form-control\"\r\n                            >\r\n                                <option value=\"-\">Hyphen (-)</option>\r\n                                <option value=\"_\">Underscore (_)</option>\r\n                                <option value=\"\">None</option>\r\n                                <option value=\"/\">Slash (/)</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        {/* Include Year */}\r\n                        <div className=\"form-group checkbox-group\">\r\n                            <label className=\"checkbox-label\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    checked={config.includeYear}\r\n                                    onChange={(e) => onChange('includeYear', e.target.checked)}\r\n                                    disabled={config.isLocked}\r\n                                />\r\n                                <span>Include Year</span>\r\n                            </label>\r\n                            {config.includeYear && (\r\n                                <select\r\n                                    value={config.yearFormat}\r\n                                    onChange={(e) => onChange('yearFormat', e.target.value)}\r\n                                    disabled={config.isLocked}\r\n                                    className=\"form-control inline-select\"\r\n                                >\r\n                                    <option value=\"YYYY\">Full Year (2026)</option>\r\n                                    <option value=\"YY\">Short Year (26)</option>\r\n                                </select>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Include Month (Payslip only) */}\r\n                        {config.entityType === 'payslip' && (\r\n                            <div className=\"form-group checkbox-group\">\r\n                                <label className=\"checkbox-label\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={config.includeMonth}\r\n                                        onChange={(e) => onChange('includeMonth', e.target.checked)}\r\n                                        disabled={config.isLocked}\r\n                                    />\r\n                                    <span>Include Month</span>\r\n                                </label>\r\n                                {config.includeMonth && (\r\n                                    <select\r\n                                        value={config.monthFormat}\r\n                                        onChange={(e) => onChange('monthFormat', e.target.value)}\r\n                                        disabled={config.isLocked}\r\n                                        className=\"form-control inline-select\"\r\n                                    >\r\n                                        <option value=\"MM\">2-digit (01, 02)</option>\r\n                                        <option value=\"M\">1-digit (1, 2)</option>\r\n                                    </select>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Include Department (Employee only) */}\r\n                        {config.entityType === 'employee' && (\r\n                            <div className=\"form-group checkbox-group\">\r\n                                <label className=\"checkbox-label\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={config.includeDepartment}\r\n                                        onChange={(e) => onChange('includeDepartment', e.target.checked)}\r\n                                        disabled={config.isLocked}\r\n                                    />\r\n                                    <span>Include Department</span>\r\n                                </label>\r\n                                {config.includeDepartment && (\r\n                                    <select\r\n                                        value={config.departmentFormat}\r\n                                        onChange={(e) => onChange('departmentFormat', e.target.value)}\r\n                                        disabled={config.isLocked}\r\n                                        className=\"form-control inline-select\"\r\n                                    >\r\n                                        <option value=\"CODE\">Code (HR, IT)</option>\r\n                                        <option value=\"FULL\">Full Name</option>\r\n                                    </select>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Padding Length */}\r\n                        <div className=\"form-group\">\r\n                            <label>Sequence Padding</label>\r\n                            <select\r\n                                value={config.paddingLength}\r\n                                onChange={(e) => onChange('paddingLength', parseInt(e.target.value))}\r\n                                disabled={config.isLocked}\r\n                                className=\"form-control\"\r\n                            >\r\n                                <option value=\"2\">2 digits (01, 02)</option>\r\n                                <option value=\"3\">3 digits (001, 002)</option>\r\n                                <option value=\"4\">4 digits (0001, 0002)</option>\r\n                                <option value=\"5\">5 digits (00001, 00002)</option>\r\n                                <option value=\"6\">6 digits (000001, 000002)</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        {/* Reset Policy */}\r\n                        <div className=\"form-group\">\r\n                            <label>Reset Policy</label>\r\n                            <select\r\n                                value={config.resetPolicy}\r\n                                onChange={(e) => onChange('resetPolicy', e.target.value)}\r\n                                disabled={config.isLocked}\r\n                                className=\"form-control\"\r\n                            >\r\n                                <option value=\"YEARLY\">Reset Yearly</option>\r\n                                <option value=\"MONTHLY\">Reset Monthly</option>\r\n                                <option value=\"NEVER\">Never Reset</option>\r\n                            </select>\r\n                            <small>\r\n                                {config.resetPolicy === 'YEARLY' && 'Counter resets every year'}\r\n                                {config.resetPolicy === 'MONTHLY' && 'Counter resets every month'}\r\n                                {config.resetPolicy === 'NEVER' && 'Counter never resets'}\r\n                            </small>\r\n                        </div>\r\n\r\n                        {/* Preview */}\r\n                        <div className=\"preview-section\">\r\n                            <h4>Preview</h4>\r\n                            <div className=\"preview-box\">\r\n                                <code>{config.exampleFormat}</code>\r\n                            </div>\r\n                            <small className=\"preview-note\">\r\n                                This is how new IDs will look. Existing IDs will not change.\r\n                            </small>\r\n                        </div>\r\n\r\n                        {/* Actions */}\r\n                        <div className=\"config-actions\">\r\n                            <button\r\n                                onClick={onSave}\r\n                                disabled={config.isLocked || saving}\r\n                                className=\"btn btn-primary\"\r\n                            >\r\n                                {saving ? 'Saving...' : 'Save Configuration'}\r\n                            </button>\r\n                            <button\r\n                                onClick={onReset}\r\n                                disabled={config.isLocked || saving}\r\n                                className=\"btn btn-secondary\"\r\n                            >\r\n                                Reset to Default\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default IdConfiguration;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Admin\\PayrollRules.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\ApplicationTrack.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Auth\\EmployeeLogin.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Auth\\ForgotPassword.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Auth\\HRLogin.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Auth\\Login.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Auth\\RegisterTenant.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\CandidateDashboard.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'candidate'. Either include it or remove the dependency array.","line":38,"column":8,"nodeType":"ArrayExpression","endLine":38,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [candidate]","fix":{"range":[1398,1400],"text":"[candidate]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { getCandidate } from '../utils/auth';\r\nimport api from '../utils/api';\r\nimport {\r\n    User, Mail, Phone, Calendar, Briefcase, ChevronRight,\r\n    FileText, Edit2, LogOut, CheckCircle2, Clock, XCircle,\r\n    AlertCircle, MapPin, TrendingUp, Award, Layers\r\n} from 'lucide-react';\r\n\r\nexport default function CandidateDashboard() {\r\n    const navigate = useNavigate();\r\n    const { logout } = useAuth();\r\n    const candidate = getCandidate();\r\n    const [applications, setApplications] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [currentTime, setCurrentTime] = useState(new Date());\r\n\r\n    useEffect(() => {\r\n        if (!candidate) return;\r\n\r\n        async function fetchDashboard() {\r\n            try {\r\n                const res = await api.get('/candidate/dashboard');\r\n                setApplications(res.data.applications || []);\r\n            } catch (err) {\r\n                console.error(\"Failed to load dashboard\", err);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        }\r\n        fetchDashboard();\r\n\r\n        // Update greeting time\r\n        const timer = setInterval(() => setCurrentTime(new Date()), 60000);\r\n        return () => clearInterval(timer);\r\n    }, []);\r\n\r\n    const getGreeting = () => {\r\n        const hour = currentTime.getHours();\r\n        if (hour < 12) return \"Good Morning\";\r\n        if (hour < 17) return \"Good Afternoon\";\r\n        return \"Good Evening\";\r\n    };\r\n\r\n    const handleLogout = () => {\r\n        logout();\r\n        localStorage.removeItem('candidate');\r\n        navigate('/jobs');\r\n    };\r\n\r\n    const getStatusStyle = (status) => {\r\n        switch (status) {\r\n            case 'Hired': return 'bg-emerald-50 text-emerald-600 border-emerald-100';\r\n            case 'Rejected': return 'bg-rose-50 text-rose-600 border-rose-100';\r\n            case 'Offered': return 'bg-violet-50 text-violet-600 border-violet-100';\r\n            case 'Interview': return 'bg-orange-50 text-orange-600 border-orange-100';\r\n            default: return 'bg-blue-50 text-blue-600 border-blue-100';\r\n        }\r\n    };\r\n\r\n    const stats = [\r\n        { label: 'Total Applications', value: applications.length, icon: Layers, color: 'text-blue-600', bg: 'bg-blue-50' },\r\n        { label: 'In Progress', value: applications.filter(a => !['Hired', 'Rejected'].includes(a.status)).length, icon: TrendingUp, color: 'text-amber-600', bg: 'bg-amber-50' },\r\n        { label: 'Offers Received', value: applications.filter(a => a.status === 'Offered' || a.status === 'Hired').length, icon: Award, color: 'text-emerald-600', bg: 'bg-emerald-50' },\r\n    ];\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n                <div className=\"relative\">\r\n                    <div className=\"h-16 w-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin\"></div>\r\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                        <Briefcase className=\"w-5 h-5 text-blue-600\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-[#F8FAFC] font-sans pb-20\">\r\n\r\n            {/* Navigation */}\r\n            <nav className=\"bg-white/70 backdrop-blur-xl border-b border-gray-100 sticky top-0 z-50\">\r\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n                    <div className=\"flex justify-between h-16 items-center\">\r\n                        <div className=\"flex items-center gap-3 group cursor-pointer\" onClick={() => navigate('/jobs')}>\r\n                            <div className=\"bg-gradient-to-tr from-blue-600 to-indigo-600 p-2 rounded-xl shadow-lg shadow-blue-500/20 group-hover:scale-110 transition-transform\">\r\n                                <Briefcase className=\"w-5 h-5 text-white\" />\r\n                            </div>\r\n                            <span className=\"text-lg font-black tracking-tight text-gray-900\">GITAKSHMI<span className=\"text-blue-600\">.</span></span>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <button\r\n                                onClick={handleLogout}\r\n                                className=\"text-sm font-bold text-gray-500 hover:text-red-600 transition-colors px-4 py-2\"\r\n                            >\r\n                                Sign Out\r\n                            </button>\r\n                            <div className=\"h-10 w-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full border-2 border-white shadow-md flex items-center justify-center text-white font-bold\">\r\n                                {candidate?.name?.charAt(0) || 'C'}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </nav>\r\n\r\n            <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-10\">\r\n\r\n                {/* Header Section */}\r\n                <div className=\"mb-10\">\r\n                    <h1 className=\"text-3xl font-black text-gray-900 tracking-tight\">\r\n                        {getGreeting()}, {candidate?.name.split(' ')[0]}! üëã\r\n                    </h1>\r\n                    <p className=\"text-gray-500 mt-1 font-medium italic\">Here's what's happening with your job search today.</p>\r\n                </div>\r\n\r\n                {/* Main Content Grid */}\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start\">\r\n\r\n                    {/* Left Panel: Profile & Stats */}\r\n                    <div className=\"lg:col-span-4 space-y-6\">\r\n\r\n                        {/* Profile Card */}\r\n                        <div className=\"bg-white rounded-[2rem] shadow-xl shadow-blue-900/5 border border-gray-100 overflow-hidden relative group\">\r\n                            <div className=\"h-32 bg-gradient-to-br from-gray-900 via-blue-900 to-indigo-900 animate-gradient-x\"></div>\r\n                            <div className=\"px-8 pb-8 relative\">\r\n                                <div className=\"absolute -top-12 left-8 p-1 bg-white rounded-3xl shadow-2xl\">\r\n                                    <div className=\"h-24 w-24 bg-gray-100 rounded-2xl flex items-center justify-center border border-gray-50\">\r\n                                        <User className=\"w-10 h-10 text-gray-400\" />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-16\">\r\n                                    <h2 className=\"text-2xl font-black text-gray-900\">{candidate?.name}</h2>\r\n                                    <div className=\"flex items-center gap-2 mt-2 text-blue-600 bg-blue-50 w-fit px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider\">\r\n                                        <Award className=\"w-3 h-3\" /> Professional Candidate\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-8 space-y-4\">\r\n                                    {[\r\n                                        { icon: Mail, label: 'Email', value: candidate?.email },\r\n                                        { icon: Phone, label: 'Phone', value: candidate?.mobile || 'Not set' },\r\n                                        { icon: MapPin, label: 'Location', value: 'Remote / India' }\r\n                                    ].map((item, idx) => (\r\n                                        <div key={idx} className=\"flex items-center gap-4 py-1\">\r\n                                            <div className=\"bg-gray-50 p-2.5 rounded-xl text-gray-400\">\r\n                                                <item.icon className=\"w-4 h-4\" />\r\n                                            </div>\r\n                                            <div>\r\n                                                <p className=\"text-[10px] text-gray-400 font-bold uppercase tracking-widest\">{item.label}</p>\r\n                                                <p className=\"text-sm font-bold text-gray-700 truncate max-w-[200px]\">{item.value}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                <button className=\"w-full mt-8 py-4 bg-gray-900 text-white rounded-2xl font-bold shadow-xl shadow-gray-200 hover:bg-black hover:-translate-y-1 transition-all active:scale-95\">\r\n                                    Manage Profile\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Resume Status Card */}\r\n                        <div className=\"bg-gradient-to-br from-blue-600 to-violet-700 rounded-[2rem] p-8 text-white relative overflow-hidden group shadow-xl shadow-blue-500/20\">\r\n                            <div className=\"absolute top-0 right-0 -mr-6 -mt-6 w-32 h-32 bg-white/10 rounded-full blur-3xl group-hover:scale-150 transition-transform duration-700\"></div>\r\n                            <div className=\"relative z-10\">\r\n                                <FileText className=\"w-8 h-8 text-blue-100 mb-4\" />\r\n                                <h3 className=\"text-xl font-bold\">Resume Boost</h3>\r\n                                <p className=\"text-blue-100 text-sm mt-2 leading-relaxed opacity-80\">Your resume is up to date and correctly formatted for ATS scanner.</p>\r\n                                <div className=\"mt-6 flex items-center gap-3 bg-white/10 backdrop-blur-md p-3 rounded-2xl border border-white/20\">\r\n                                    <div className=\"bg-emerald-400 p-1 rounded-full\"><CheckCircle2 className=\"w-3 h-3 text-white\" /></div>\r\n                                    <span className=\"text-xs font-bold tracking-tight\">resume_candidate_2024.pdf</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Right Panel: Stats & Applications */}\r\n                    <div className=\"lg:col-span-8 space-y-8\">\r\n\r\n                        {/* Stats Summary */}\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                            {stats.map((stat, idx) => (\r\n                                <div key={idx} className=\"bg-white p-6 rounded-3xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow\">\r\n                                    <div className={`${stat.bg} ${stat.color} w-12 h-12 rounded-2xl flex items-center justify-center mb-4 ring-4 ring-transparent hover:ring-white transition-all`}>\r\n                                        <stat.icon className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                    <p className=\"text-xs font-bold text-gray-400 uppercase tracking-widest\">{stat.label}</p>\r\n                                    <h4 className=\"text-3xl font-black text-gray-900 mt-1\">{stat.value}</h4>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Applications Section */}\r\n                        <div>\r\n                            <div className=\"flex items-center justify-between mb-6 px-2\">\r\n                                <h3 className=\"text-xl font-black text-gray-900 tracking-tight\">Active Applications</h3>\r\n                                <button onClick={() => navigate('/jobs')} className=\"text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-full hover:bg-blue-100 transition-colors\">\r\n                                    Find Jobs\r\n                                </button>\r\n                            </div>\r\n\r\n                            {applications.length > 0 ? (\r\n                                <div className=\"space-y-4\">\r\n                                    {applications.map((app) => (\r\n                                        <div\r\n                                            key={app._id}\r\n                                            onClick={() => navigate(`/candidate/application/${app._id}`)}\r\n                                            className=\"group bg-white rounded-3xl p-6 border border-gray-100 shadow-sm hover:shadow-2xl hover:shadow-blue-900/10 hover:-translate-y-1 transition-all cursor-pointer relative\"\r\n                                        >\r\n                                            <div className=\"flex flex-col md:flex-row justify-between md:items-center gap-6\">\r\n                                                <div className=\"flex items-center gap-5\">\r\n                                                    <div className=\"h-16 w-16 rounded-[1.25rem] bg-gray-50 flex items-center justify-center group-hover:bg-blue-600 transition-colors duration-500\">\r\n                                                        <Briefcase className=\"w-8 h-8 text-gray-400 group-hover:text-white transition-colors\" />\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <h4 className=\"text-lg font-black text-gray-900 group-hover:text-blue-600 transition-colors\">\r\n                                                            {app.requirementId?.jobTitle}\r\n                                                        </h4>\r\n                                                        <div className=\"flex items-center gap-3 mt-1.5\">\r\n                                                            <span className=\"text-sm text-gray-400 font-bold\">{app.requirementId?.companyName || 'Global IT'}</span>\r\n                                                            <div className=\"w-1.5 h-1.5 rounded-full bg-gray-200\"></div>\r\n                                                            <span className=\"text-sm text-gray-400 font-bold\">{app.requirementId?.department}</span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                <div className=\"flex items-center justify-between md:justify-end gap-6 border-t md:border-t-0 pt-4 md:pt-0\">\r\n                                                    <div className=\"text-right hidden sm:block\">\r\n                                                        <p className=\"text-[10px] text-gray-400 font-bold uppercase tracking-widest leading-none\">Status</p>\r\n                                                        <div className=\"mt-2\">\r\n                                                            <span className={`px-4 py-1.5 rounded-full text-xs font-black border flex items-center gap-2 shadow-sm ${getStatusStyle(app.status)}`}>\r\n                                                                <span className=\"w-1.5 h-1.5 rounded-full bg-current\"></span>\r\n                                                                {app.status}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className=\"bg-gray-50 p-3 rounded-2xl group-hover:bg-blue-600 group-hover:text-white transition-all duration-300\">\r\n                                                        <ChevronRight className=\"w-5 h-5\" />\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"bg-white rounded-[2.5rem] p-16 text-center border-2 border-dashed border-gray-100\">\r\n                                    <div className=\"h-24 w-24 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-8 animate-bounce\">\r\n                                        <Briefcase className=\"w-12 h-12 text-gray-300\" />\r\n                                    </div>\r\n                                    <h3 className=\"text-2xl font-black text-gray-900\">Your future starts here.</h3>\r\n                                    <p className=\"text-gray-400 mt-2 font-medium max-w-sm mx-auto leading-relaxed\">You haven't applied to any roles yet. Let's find your dream job together.</p>\r\n                                    <button\r\n                                        onClick={() => navigate('/jobs')}\r\n                                        className=\"mt-10 bg-blue-600 text-white px-10 py-4 rounded-[1.5rem] font-black shadow-xl shadow-blue-500/30 hover:bg-blue-700 hover:-translate-y-1 transition-all\"\r\n                                    >\r\n                                        Explore Opportunities\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\CandidateLogin.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\CandidateSignup.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Candidate\\CandidateApplications.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Candidate\\CandidateDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'activeTab' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":15,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"activeTab"},"fix":{"range":[588,597],"text":""},"desc":"Remove unused variable 'activeTab'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'tenantId' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":20,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"tenantId"},"fix":{"range":[923,931],"text":""},"desc":"Remove unused variable 'tenantId'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setTenantId' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":20,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":33,"suggestions":[{"messageId":"removeVar","data":{"varName":"setTenantId"},"fix":{"range":[931,944],"text":""},"desc":"Remove unused variable 'setTenantId'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'handleTabChange' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":24,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"handleTabChange"},"fix":{"range":[1130,1235],"text":""},"desc":"Remove unused variable 'handleTabChange'."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport api from '../../utils/api';\r\nimport { getCompany, getTenantId } from '../../utils/auth';\r\nimport {\r\n    Briefcase, MapPin, Clock, ArrowRight, Layers,\r\n    TrendingUp, CheckCircle, XCircle\r\n} from 'lucide-react';\r\n\r\nexport default function CandidateDashboard() {\r\n    const navigate = useNavigate();\r\n    const { user } = useAuth();\r\n    const [searchParams, setSearchParams] = useSearchParams();\r\n    const [activeTab, setActiveTab] = useState(searchParams.get('tab') || 'dashboard');\r\n    const [stats, setStats] = useState({ total: 0, pending: 0, selected: 0, rejected: 0 });\r\n    const [jobs, setJobs] = useState([]);\r\n    const [applications, setApplications] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [tenantId, setTenantId] = useState(user?.tenantId || sessionStorage.getItem('tenantId'));\r\n    const [companyName, setCompanyName] = useState('Careers');\r\n\r\n    // Update URL when tab changes internally\r\n    const handleTabChange = (tab) => {\r\n        setActiveTab(tab);\r\n        setSearchParams({ tab });\r\n    };\r\n\r\n    const handleApply = (jobId) => {\r\n        navigate(`/apply-job/${jobId}`);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const company = getCompany();\r\n        if (company && company.name) {\r\n            setCompanyName(company.name);\r\n        }\r\n\r\n        async function fetchData() {\r\n            try {\r\n                const dashRes = await api.get('/candidate/dashboard');\r\n                const apps = dashRes.data.applications || [];\r\n                setApplications(apps);\r\n                setStats({\r\n                    total: apps.length,\r\n                    pending: apps.filter(a => !['Hired', 'Rejected', 'Selected'].includes(a.status)).length,\r\n                    selected: apps.filter(a => ['Hired', 'Selected', 'Offered'].includes(a.status)).length,\r\n                    rejected: apps.filter(a => a.status === 'Rejected').length\r\n                });\r\n\r\n                const tId = getTenantId();\r\n                if (tId) {\r\n                    const jobsRes = await api.get(`/public/jobs?tenantId=${tId}`);\r\n                    setJobs(jobsRes.data || []);\r\n                }\r\n            } catch (err) {\r\n                console.error(err);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        }\r\n        fetchData();\r\n    }, []);\r\n\r\n    if (loading) return (\r\n        <div className=\"h-[60vh] flex items-center justify-center\">\r\n            <div className=\"h-12 w-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin\"></div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n\r\n        <div className=\"space-y-12 animate-fade-in pb-20\">\r\n            <div className=\"space-y-8\">\r\n                <div>\r\n                    <h1 className=\"text-4xl font-black text-gray-900 tracking-tight\">\r\n                        {companyName}<span className=\"text-blue-600\">.</span>\r\n                    </h1>\r\n                    <p className=\"text-gray-500 font-medium mt-2 italic\">Welcome back, {user?.name}. Here's your application summary.</p>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n                    {[\r\n                        { label: 'Total Applied', value: stats.total, icon: Layers, color: 'blue' },\r\n                        { label: 'In Progress', value: stats.pending, icon: TrendingUp, color: 'amber' },\r\n                        { label: 'Selected', value: stats.selected, icon: CheckCircle, color: 'emerald' },\r\n                        { label: 'Rejected', value: stats.rejected, icon: XCircle, color: 'rose' },\r\n                    ].map((stat, idx) => (\r\n                        <div key={idx} className=\"bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100 hover:shadow-xl transition-all duration-300\">\r\n                            <div className={`w-12 h-12 rounded-2xl bg-${stat.color}-50 text-${stat.color}-600 flex items-center justify-center mb-4`}>\r\n                                <stat.icon className=\"w-6 h-6\" />\r\n                            </div>\r\n                            <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest\">{stat.label}</p>\r\n                            <h3 className=\"text-3xl font-black text-gray-900 mt-1\">{stat.value}</h3>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-8\">\r\n                <div className=\"flex items-center justify-between px-2\">\r\n                    <h2 className=\"text-2xl font-black text-gray-900 tracking-tight\">Explore Open Positions</h2>\r\n                    <span className=\"bg-blue-50 text-blue-600 px-4 py-1.5 rounded-full text-xs font-black uppercase tracking-widest border border-blue-100\">\r\n                        {jobs.length} Opportunities\r\n                    </span>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n                    {jobs.slice(0, 6).map(job => (\r\n                        <div key={job._id} className=\"bg-white rounded-[2.5rem] p-8 border border-gray-50 shadow-sm hover:shadow-2xl hover:-translate-y-2 transition-all duration-500 flex flex-col group relative overflow-hidden\">\r\n                            <div className=\"absolute top-0 right-0 w-20 h-20 bg-blue-50 rounded-bl-[3rem] flex items-center justify-center group-hover:bg-blue-600 transition-colors\">\r\n                                <Briefcase className=\"w-6 h-6 text-blue-600 group-hover:text-white transition-colors\" />\r\n                            </div>\r\n\r\n                            <div className=\"pr-10\">\r\n                                <h3 className=\"text-xl font-black text-gray-900 line-clamp-2 leading-tight tracking-tight group-hover:text-blue-600 transition-colors\">\r\n                                    {job.jobTitle}\r\n                                </h3>\r\n                                <div className=\"mt-2 text-xs font-black text-blue-600 bg-blue-50 px-3 py-1 rounded-full uppercase tracking-wider w-fit\">\r\n                                    {job.department}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-8 space-y-3 flex-grow\">\r\n                                <div className=\"flex items-center gap-3 text-gray-500\">\r\n                                    <MapPin className=\"w-4 h-4 text-gray-300\" />\r\n                                    <span className=\"text-sm font-bold tracking-tight\">{job.location || 'Remote'}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3 text-gray-500\">\r\n                                    <Clock className=\"w-4 h-4 text-gray-300\" />\r\n                                    <span className=\"text-sm font-bold tracking-tight\">{job.employmentType}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3 text-gray-500\">\r\n                                    <Layers className=\"w-4 h-4 text-gray-300\" />\r\n                                    <span className=\"text-sm font-bold tracking-tight\">{job.vacancy || 1} Openings</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-10 pt-8 border-t border-gray-50\">\r\n                                {applications.some(app => (app.requirementId?._id || app.requirementId) === job._id) ? (\r\n                                    <div className=\"w-full bg-green-50 text-green-600 rounded-2xl py-4 font-black flex items-center justify-center gap-2 border border-green-100\">\r\n                                        Applied <CheckCircle className=\"w-4 h-4\" />\r\n                                    </div>\r\n                                ) : (\r\n                                    <button\r\n                                        onClick={() => handleApply(job._id)}\r\n                                        className=\"w-full bg-gray-900 text-white rounded-2xl py-4 font-black shadow-lg shadow-gray-200 hover:bg-black transition-all active:scale-95 flex items-center justify-center gap-2\"\r\n                                    >\r\n                                        Apply Now <ArrowRight className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {jobs.length > 6 && (\r\n                    <div className=\"text-center pt-4\">\r\n                        <button\r\n                            onClick={() => navigate('/candidate/open-positions')}\r\n                            className=\"bg-white border border-gray-200 text-gray-700 px-10 py-4 rounded-2xl font-black text-sm hover:bg-gray-50 transition-all shadow-sm\"\r\n                        >\r\n                            View All Positions\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Candidate\\CandidateLogin.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Candidate\\CandidateOpenPositions.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Candidate\\CandidateProfile.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'uploading' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":13,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"uploading"},"fix":{"range":[442,451],"text":""},"desc":"Remove unused variable 'uploading'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setUploading' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":13,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":35,"suggestions":[{"messageId":"removeVar","data":{"varName":"setUploading"},"fix":{"range":[451,465],"text":""},"desc":"Remove unused variable 'setUploading'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport api from '../../utils/api';\r\nimport {\r\n    User, Mail, Phone, MapPin, FileText,\r\n    Edit3, CheckCircle2, CloudUpload, ShieldCheck,\r\n    Calendar, Shield\r\n} from 'lucide-react';\r\n\r\nexport default function CandidateProfile() {\r\n    const { user } = useAuth();\r\n    const [profile, setProfile] = useState(user || {});\r\n    const [uploading, setUploading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        async function fetchProfile() {\r\n            try {\r\n                const res = await api.get('/candidate/dashboard');\r\n                if (res.data.profile) {\r\n                    setProfile(prev => ({ ...prev, ...res.data.profile }));\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to fetch profile:\", err);\r\n            }\r\n        }\r\n        fetchProfile();\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"space-y-10 animate-fade-in pb-20\">\r\n            {/* Page Header */}\r\n            <div>\r\n                <h1 className=\"text-4xl font-black text-gray-900 tracking-tight\">Professional Profile<span className=\"text-blue-600\">.</span></h1>\r\n                <p className=\"text-gray-500 font-medium mt-2 italic\">Update your information to stand out to employers.</p>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start\">\r\n\r\n                {/* Information Card */}\r\n                <div className=\"lg:col-span-12 space-y-8 max-w-full mx-auto w-full\">\r\n                    <div className=\"bg-white rounded-[2.5rem] shadow-xl shadow-blue-900/5 border border-gray-100 overflow-hidden relative\">\r\n                        {/* Decorative Header */}\r\n                        <div className=\"h-44 bg-gradient-to-r from-blue-700 via-indigo-600 to-purple-600 relative overflow-hidden\">\r\n                            <div className=\"absolute inset-0 opacity-10 bg-[url('https://grainy-gradients.vercel.app/noise.svg')]\"></div>\r\n                            <div className=\"absolute top-0 right-0 p-10\">\r\n                                <ShieldCheck className=\"w-16 h-16 text-white/20\" />\r\n                            </div>\r\n                            <div className=\"absolute bottom-6 left-10 text-white\">\r\n                                <h2 className=\"text-3xl font-black tracking-tight\">{profile?.name}</h2>\r\n                                <p className=\"text-blue-100/80 font-bold text-sm mt-1 uppercase tracking-widest\">{profile?.email}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-10\">\r\n                            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6 pb-8 border-b border-gray-50\">\r\n                                <div>\r\n                                    <div className=\"flex items-center gap-2 bg-emerald-50 text-emerald-600 w-fit px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-widest border border-emerald-100 shadow-sm\">\r\n                                        <CheckCircle2 className=\"w-3 h-3\" /> Verified Candidate\r\n                                    </div>\r\n                                </div>\r\n                                <button className=\"bg-gray-900 text-white px-8 py-4 rounded-2xl font-black text-sm shadow-xl shadow-gray-200 hover:bg-black transition-all active:scale-95 flex items-center gap-2\">\r\n                                    <Edit3 className=\"w-4 h-4\" /> Update Profile\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"mt-10 grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-8\">\r\n                                {[\r\n                                    { label: 'E-mail Address', value: profile?.email, icon: Mail },\r\n                                    { label: 'Primary Mobile', value: profile?.mobile || 'No Phone Number', icon: Phone },\r\n                                    { label: 'Father\\'s Name', value: profile?.fatherName || 'Not Provided', icon: User },\r\n                                    { label: 'Permanent Address', value: profile?.address || 'Not Provided', icon: MapPin },\r\n                                    { label: 'Date of Birth', value: profile?.dob ? new Date(profile.dob).toLocaleDateString() : 'Not Provided', icon: Calendar },\r\n                                    {\r\n                                        label: 'Account Since',\r\n                                        value: profile?.createdAt\r\n                                            ? new Date(profile.createdAt).toLocaleDateString('en-US', { month: 'long', year: 'numeric' })\r\n                                            : 'N/A',\r\n                                        icon: Calendar\r\n                                    },\r\n                                ].map((item, idx) => (\r\n                                    <div key={idx} className=\"flex items-center gap-5 p-4 rounded-3xl hover:bg-gray-50 transition-colors group\">\r\n                                        <div className=\"h-12 w-12 rounded-2xl bg-gray-50 flex items-center justify-center text-gray-400 group-hover:bg-blue-600 group-hover:text-white transition-all shadow-sm\">\r\n                                            <item.icon className=\"w-5 h-5\" />\r\n                                        </div>\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <p className=\"text-[10px] text-gray-400 font-black uppercase tracking-widest\">{item.label}</p>\r\n                                            <p className=\"font-bold text-gray-700 tracking-tight mt-0.5 truncate\">{item.value}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Resume Section */}\r\n                    <div className=\"bg-white rounded-[2.5rem] p-10 shadow-sm border border-gray-100 flex flex-col md:flex-row items-center gap-8 group\">\r\n                        <div className=\"h-24 w-24 rounded-3xl bg-blue-50 flex items-center justify-center text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-all duration-500 shadow-inner\">\r\n                            <FileText className=\"w-10 h-10\" />\r\n                        </div>\r\n                        <div className=\"flex-1 text-center md:text-left\">\r\n                            <h3 className=\"text-xl font-black text-gray-900 leading-tight\">Your Primary Resume</h3>\r\n                            <p className=\"text-gray-400 font-medium mt-1 leading-relaxed text-sm\">PDF format is recommended for ATS compatibility.</p>\r\n                            <div className=\"mt-4 flex items-center gap-2 justify-center md:justify-start\">\r\n                                <CheckCircle2 className=\"w-4 h-4 text-emerald-500\" />\r\n                                <span className=\"text-sm font-black text-emerald-600 italic\">\r\n                                    {user?.resume ? user.resume : 'No Resume Uploaded'}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                        <button className=\"bg-gradient-to-tr from-blue-600 to-indigo-600 text-white px-10 py-5 rounded-2xl font-black shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40 hover:-translate-y-1 transition-all active:scale-95 flex items-center gap-2 uppercase tracking-tight\">\r\n                            <CloudUpload className=\"w-5 h-5\" /> Replace PDF\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst ArrowRight = ({ className }) => (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" className={className} width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M5 12h14m-7-7 7 7-7 7\" /></svg>\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Candidate\\CandidateRegister.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\CareersPage.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\ESS\\Attendance.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\ESS\\Dashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\ESS\\Leaves.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\ESS\\Payslips.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\ESS\\Profile.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Employee\\EmployeeDashboard.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token `}`. Did you mean `&rbrace;` or `{\"}\"}`?","line":508,"column":8}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useContext } from 'react';\r\nimport { Pagination } from 'antd';\r\nimport { showToast, showConfirmToast } from '../../utils/uiNotifications';\r\nimport { useOutletContext, useNavigate } from 'react-router-dom';\r\nimport api from '../../utils/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { UIContext } from '../../context/UIContext';\r\nimport { FileText, Calendar as CalendarIcon, Users, Clock, CheckCircle, AlertCircle, RefreshCw, LogIn, LogOut, Briefcase } from 'lucide-react';\r\nimport { formatDateDDMMYYYY, formatDateTimeDDMMYYYY } from '../../utils/dateUtils';\r\n\r\nimport RegularizationRequest from '../Leaves/RegularizationRequest';\r\nimport ApplyLeaveForm from '../../components/ApplyLeaveForm';\r\nimport AttendanceClock from '../../components/AttendanceClock';\r\nimport LeaveApprovals from '../HR/LeaveApprovals';\r\nimport RegularizationApprovals from '../HR/RegularizationApprovals';\r\nimport EmployeeProfileView from '../../components/EmployeeProfileView';\r\nimport MyAttendanceView from '../../components/MyAttendanceView';\r\nimport TeamAttendanceView from '../../components/TeamAttendanceView';\r\nimport ReportingTree from '../../components/ReportingTree';\r\n\r\nimport InternalJobs from './InternalJobs';\r\nimport MyApplications from './MyApplications';\r\nimport FaceAttendance from './FaceAttendance';\r\n\r\nexport default function EmployeeDashboard() {\r\n  const { user } = useAuth();\r\n  const { activeTab, setActiveTab } = useOutletContext();\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Data States\r\n  const [profile, setProfile] = useState(null);\r\n  const [attendance, setAttendance] = useState([]);\r\n  const [leaves, setLeaves] = useState([]);\r\n  const [balances, setBalances] = useState([]);\r\n  const [hasLeavePolicy, setHasLeavePolicy] = useState(true); // Default true to avoid flash\r\n  const [stats, setStats] = useState({\r\n    presentDays: 0,\r\n    leavesTaken: 0,\r\n    pendingRequests: 0,\r\n    nextHoliday: null\r\n  });\r\n\r\n  // Attendance States\r\n  const [clocking, setClocking] = useState(false);\r\n  const [isCheckedIn, setIsCheckedIn] = useState(false);\r\n  const [isCheckedOut, setIsCheckedOut] = useState(false);\r\n  const [todayRecord, setTodayRecord] = useState(null);\r\n  const [todaySummary, setTodaySummary] = useState(null);\r\n  const [attendanceSettings, setAttendanceSettings] = useState(null);\r\n  const [editLeave, setEditLeave] = useState(null);\r\n  const [clockError, setClockError] = useState(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const pageSize = 5;\r\n\r\n  const handleCancelLeave = async (id) => {\r\n    showConfirmToast({\r\n      title: 'Cancel Leave Request',\r\n      description: 'Are you sure you want to cancel this leave request?',\r\n      okText: 'Yes, Cancel',\r\n      cancelText: 'No',\r\n      danger: true,\r\n      onConfirm: async () => {\r\n        try {\r\n          await api.post(`/employee/leaves/cancel/${id}`);\r\n          showToast('success', 'Success', 'Leave request cancelled successfully');\r\n          fetchDashboardData();\r\n        } catch (err) {\r\n          showToast('error', 'Error', err.response?.data?.error || 'Failed to cancel leave');\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchDashboardData();\r\n  }, []);\r\n\r\n  const fetchDashboardData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const t = new Date().getTime(); // Anti-cache\r\n      const [profileRes, attRes, leaveRes, balanceRes, holidayRes, settingsRes, summaryRes] = await Promise.all([\r\n        api.get(`/employee/profile?t=${t}`),\r\n        api.get(`/attendance/my?t=${t}`), // Use unified attendance history\r\n        api.get(`/employee/leaves/history?t=${t}`),\r\n        api.get(`/employee/leaves/balances?t=${t}`),\r\n        api.get(`/holidays?t=${t}`).catch(() => ({ data: [] })),\r\n        api.get(`/attendance/settings?t=${t}`).catch(() => ({ data: null })),\r\n        api.get(`/attendance/today-summary?t=${t}`).catch(() => ({ data: null }))\r\n      ]);\r\n\r\n      setProfile(profileRes.data);\r\n      setAttendance(attRes.data);\r\n      setLeaves(leaveRes.data);\r\n      const balanceData = balanceRes.data?.balances || (Array.isArray(balanceRes.data) ? balanceRes.data : []);\r\n      setBalances(balanceData);\r\n      setHasLeavePolicy(balanceRes.data?.hasLeavePolicy ?? (balanceData.length > 0));\r\n      setAttendanceSettings(settingsRes?.data);\r\n      setTodaySummary(summaryRes?.data); // New Stats Data\r\n\r\n      // Calculate stats\r\n      const currentMonth = new Date().getMonth();\r\n      const currentYear = new Date().getFullYear();\r\n\r\n      const presentDays = attRes.data.filter(a => {\r\n        const d = new Date(a.date);\r\n        const status = (a.status || '').toLowerCase();\r\n        return d.getMonth() === currentMonth && d.getFullYear() === currentYear &&\r\n          ['present', 'half_day'].includes(status);\r\n      }).length;\r\n\r\n      // Calculate YTD leaves taken from approved leave requests of the current year\r\n      const leavesTaken = leaveRes.data\r\n        .filter(l => l.status === 'Approved')\r\n        .filter(l => {\r\n          const startYear = new Date(l.startDate).getFullYear();\r\n          const endYear = new Date(l.endDate).getFullYear();\r\n          const currentYear = new Date().getFullYear();\r\n          return startYear === currentYear || endYear === currentYear;\r\n        })\r\n        .reduce((sum, l) => sum + (l.daysCount || 0), 0);\r\n      const pendingRequests = leaveRes.data.filter(l => l.status === 'Pending').length;\r\n\r\n      // Find next holiday (string based comparison to avoid timezone issues)\r\n      const todayStr = new Date().toISOString().split('T')[0];\r\n      const upcomingHolidays = (holidayRes.data || [])\r\n        .map(h => ({ ...h, dateObj: new Date(h.date) }))\r\n        .filter(h => {\r\n          const hStr = h.dateObj.toISOString().split('T')[0];\r\n          return hStr >= todayStr;\r\n        })\r\n        .sort((a, b) => a.dateObj - b.dateObj);\r\n\r\n      const nextHoliday = upcomingHolidays[0] || null;\r\n\r\n      setStats({\r\n        presentDays,\r\n        leavesTaken,\r\n        pendingRequests,\r\n        nextHoliday\r\n      });\r\n\r\n      const todayLocalStr = formatDateDDMMYYYY(new Date());\r\n      const todayEntry = attRes.data.find(a =>\r\n        formatDateDDMMYYYY(a.date) === todayLocalStr\r\n      );\r\n\r\n      setTodayRecord(todayEntry);\r\n      if (todayEntry) {\r\n        setIsCheckedIn(!!todayEntry.checkIn);\r\n\r\n        // Logical check for checked out\r\n        // In multiple punch mode, \"checked out\" is true only if the LAST punch was an OUT\r\n        if (settingsRes?.data?.punchMode === 'multiple') {\r\n          const lastLog = todayEntry.logs?.[todayEntry.logs.length - 1];\r\n          setIsCheckedOut(lastLog?.type === 'OUT');\r\n        } else {\r\n          setIsCheckedOut(!!todayEntry.checkOut);\r\n        }\r\n      } else {\r\n        setIsCheckedIn(false);\r\n        setIsCheckedOut(false);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Fetch error\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClockInOut = async () => {\r\n    try {\r\n      setClocking(true);\r\n      setClockError(null);\r\n\r\n      // Helper to get location\r\n      const getLocation = () => {\r\n        return new Promise((resolve) => {\r\n          if (!navigator.geolocation) {\r\n            resolve(null);\r\n          } else {\r\n            navigator.geolocation.getCurrentPosition(\r\n              (position) => {\r\n                resolve({\r\n                  latitude: position.coords.latitude,\r\n                  longitude: position.coords.longitude\r\n                });\r\n              },\r\n              (error) => {\r\n                console.warn(\"Location access denied or failed\", error);\r\n                // Don't block, just resolve null (Remote)\r\n                resolve(null);\r\n              },\r\n              { timeout: 8000 }\r\n            );\r\n          }\r\n        });\r\n      };\r\n\r\n      const locationData = await getLocation();\r\n      const now = new Date();\r\n      const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;\r\n\r\n      const payload = locationData\r\n        ? { ...locationData, location: 'Office/Remote', device: 'Web', dateStr }\r\n        : { location: 'Remote', device: 'Web', dateStr };\r\n\r\n      // Use unified punch endpoint\r\n      // Use unified punch endpoint\r\n      const res = await api.post('/attendance/punch', payload);\r\n      showToast('success', 'Success', res.data?.message || 'Attendance Updated');\r\n\r\n      await fetchDashboardData();\r\n    } catch (err) {\r\n      const errorMsg = err.response?.data?.error || \"Failed to punch in/out. Please try again.\";\r\n      setClockError(errorMsg);\r\n      showToast('error', 'Error', errorMsg);\r\n    } finally {\r\n      setClocking(false);\r\n    }\r\n  };\r\n\r\n  if (loading) return <div className=\"flex h-screen items-center justify-center bg-slate-50 dark:bg-slate-900 text-slate-500 font-black uppercase tracking-widest text-xs animate-pulse\">Establishing Secure Session...</div>;\r\n\r\n  const StatCard = ({ title, value, color, icon: Icon, trend }) => (\r\n    <div className=\"bg-white dark:bg-slate-800/50 p-6 rounded-2xl border border-slate-200/60 dark:border-slate-800/60 shadow-sm hover:shadow-xl hover:shadow-indigo-500/5 transition-all duration-300 group overflow-hidden relative\">\r\n      <div className=\"absolute -right-4 -top-4 w-20 h-20 bg-current opacity-[0.03] rounded-full scale-150 group-hover:scale-[1.7] transition-transform duration-500\"></div>\r\n      <div className=\"flex justify-between items-start mb-4 relative z-10\">\r\n        <div className=\"p-2.5 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-slate-800 group-hover:bg-indigo-600 group-hover:text-white transition-colors duration-300\">\r\n          {Icon && <Icon size={20} className={color} />}\r\n        </div>\r\n        {trend && (\r\n          <div className=\"flex items-center gap-1 px-2 py-1 rounded-lg bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 text-[10px] font-bold\">\r\n            {trend}\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"relative z-10\">\r\n        <div className=\"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.15em] mb-1\">{title}</div>\r\n        <div className={`text-3xl font-black text-slate-800 dark:text-white tracking-tight`}>{value}</div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"w-full space-y-6 pb-10\">\r\n\r\n      {/* DASHBOARD TAB */}\r\n      {activeTab === 'dashboard' && (\r\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-1000\">\r\n          {/* Header Section */}\r\n          <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-4\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-black text-slate-800 dark:text-white tracking-tight\">Bonjour, {profile?.firstName || 'User'}!</h1>\r\n              <p className=\"text-sm font-medium text-slate-500 dark:text-slate-400 mt-1\">Here's what's happening with your workspace today.</p>\r\n            </div>\r\n            <div className=\"flex items-center gap-2 bg-white dark:bg-slate-800 px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm\">\r\n              <div className=\"w-2 h-2 rounded-full bg-emerald-500\"></div>\r\n              <span className=\"text-xs font-bold text-slate-600 dark:text-slate-300\">Shift Started: {todayRecord?.checkIn ? new Date(todayRecord.checkIn).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 'Not yet'}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Stats Cards */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            <StatCard\r\n              title=\"Attendance (MTD)\"\r\n              value={stats.presentDays}\r\n              color=\"text-indigo-600\"\r\n              icon={Clock}\r\n              trend=\"+2.4%\"\r\n            />\r\n            <StatCard\r\n              title=\"Leaves (YTD)\"\r\n              value={stats.leavesTaken}\r\n              color=\"text-emerald-600\"\r\n              icon={CalendarIcon}\r\n            />\r\n            <StatCard\r\n              title=\"Pending Approval\"\r\n              value={stats.pendingRequests}\r\n              color=\"text-amber-600\"\r\n              icon={AlertCircle}\r\n            />\r\n            <div className=\"bg-gradient-to-br from-indigo-600 to-violet-700 p-6 rounded-2xl shadow-xl shadow-indigo-500/20 text-white flex flex-col justify-between overflow-hidden relative group\">\r\n              <div className=\"absolute top-[-20px] right-[-20px] opacity-10 transform rotate-12 group-hover:rotate-45 transition-transform duration-700\">\r\n                <CalendarIcon size={120} />\r\n              </div>\r\n              <div className=\"relative z-10\">\r\n                <div className=\"text-[10px] font-black uppercase tracking-widest opacity-70 mb-3\">Upcoming Holiday</div>\r\n                {stats.nextHoliday ? (\r\n                  <>\r\n                    <div className=\"text-xl font-black leading-tight tracking-tight\">{stats.nextHoliday.name}</div>\r\n                    <div className=\"flex items-center gap-2 mt-2 opacity-80 text-xs font-bold bg-white/10 w-fit px-3 py-1 rounded-lg backdrop-blur-sm\">\r\n                      <Clock size={12} />\r\n                      {formatDateDDMMYYYY(stats.nextHoliday.date)}\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <div className=\"text-xs font-bold\">No upcoming holidays</div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-3\">\r\n            {/* Left Column: Clock */}\r\n            <div className=\"space-y-3\">\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-6\">\r\n                {/* Left Column: Clock + Stats */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                  <AttendanceClock\r\n                    isCheckedIn={isCheckedIn}\r\n                    isCheckedOut={isCheckedOut}\r\n                    checkInTime={todayRecord?.checkIn}\r\n                    onAction={handleClockInOut}\r\n                    isLoading={clocking}\r\n                    location={profile?.meta?.location || \"Headquarters\"}\r\n                    settings={attendanceSettings}\r\n                    error={clockError}\r\n                  />\r\n                </div>\r\n\r\n                {/* Right Column: Policy + Activity + Today's Stats */}\r\n                <div className=\"flex flex-col gap-3\">\r\n                  {/* Applied Policy Summary (Read-only) */}\r\n                  <div className=\"bg-gradient-to-br from-indigo-600 to-blue-500 text-white p-4 rounded-xl shadow-xl overflow-hidden relative border border-indigo-400/30\">\r\n                    <div className=\"absolute top-[-20%] right-[-10%] opacity-10\">\r\n                      <Clock size={140} />\r\n                    </div>\r\n                    <div className=\"relative z-10\">\r\n                      <h3 className=\"text-[10px] font-black uppercase tracking-widest text-indigo-100 mb-3 flex items-center gap-2\">\r\n                        <CheckCircle size={12} className=\"text-emerald-500\" />\r\n                        Applied Attendance Policy\r\n                      </h3>\r\n                      <div className=\"grid grid-cols-2 gap-x-6 gap-y-3\">\r\n                        <div>\r\n                          <p className=\"text-[9px] font-bold text-indigo-100 uppercase tracking-widest\">Shift Timings</p>\r\n                          <p className=\"text-xs font-black text-indigo-400\">{attendanceSettings?.shiftStartTime} - {attendanceSettings?.shiftEndTime}</p>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-[9px] font-bold text-indigo-100 uppercase tracking-widest\">Punch Mode</p>\r\n                          <p className=\"text-xs font-black text-blue-400 uppercase tracking-tight\">{attendanceSettings?.punchMode} Punch</p>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-[9px] font-bold text-indigo-100 uppercase tracking-widest\">Late Threshold</p>\r\n                          <p className=\"text-xs font-black text-emerald-400\">{attendanceSettings?.lateMarkThresholdMinutes} Minutes</p>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-[9px] font-bold text-indigo-100 uppercase tracking-widest\">Working Target</p>\r\n                          <p className=\"text-xs font-black text-amber-400\">{attendanceSettings?.fullDayThresholdHours} Hours / Day</p>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"mt-4 pt-3 border-t border-white/10 flex items-center justify-between\">\r\n                        <span className=\"text-[9px] font-bold text-indigo-100 uppercase tracking-widest\">Location Restriction</span>\r\n                        <span className={`text-[9px] font-black uppercase tracking-widest px-2 py-0.5 rounded ${attendanceSettings?.locationRestrictionMode === 'none' ? 'bg-indigo-700/40 text-indigo-200' : 'bg-emerald-500/20 text-emerald-300'}`}>\r\n                          {attendanceSettings?.locationRestrictionMode === 'none' ? 'Disabled' : attendanceSettings?.locationRestrictionMode}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Today's Stats Grid */}\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    {[\r\n                      { label: 'Total Punches', value: todaySummary?.totalPunches || 0, icon: RefreshCw, color: 'text-slate-400' },\r\n                      { label: 'Punches In', value: todaySummary?.totalIn || 0, icon: LogIn, color: 'text-emerald-500' },\r\n                      { label: 'Punches Out', value: todaySummary?.totalOut || 0, icon: LogOut, color: 'text-blue-500' },\r\n                      { label: 'Working Hours', value: `${todaySummary?.workingHours || 0}h`, icon: Clock, color: 'text-indigo-500' },\r\n                    ].map((item, idx) => (\r\n                      <div key={idx} className=\"bg-white dark:bg-slate-800/50 p-5 rounded-2xl border border-slate-200/60 dark:border-slate-800/60 shadow-sm flex flex-col items-center justify-center text-center group hover:border-indigo-500/30 transition-colors\">\r\n                        <item.icon size={16} className={`${item.color} mb-3 opacity-60 group-hover:opacity-100 transition-opacity`} />\r\n                        <p className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1\">{item.label}</p>\r\n                        <p className=\"text-2xl font-black text-slate-800 dark:text-white tracking-tight\">{item.value}</p>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Policy Summary & Recent Log */}\r\n                <div className=\"lg:col-span-3 space-y-6\">\r\n                  {/* Applied Policy Summary */}\r\n                  <div className=\"bg-slate-900 border border-slate-800 text-white p-6 rounded-2xl shadow-2xl overflow-hidden relative group\">\r\n                    <div className=\"absolute top-[-40px] right-[-40px] opacity-[0.03] group-hover:opacity-[0.05] transition-opacity\">\r\n                      <Clock size={240} />\r\n                    </div>\r\n                    <div className=\"relative z-10\">\r\n                      <div className=\"flex items-center justify-between mb-6\">\r\n                        <h3 className=\"text-[10px] font-black uppercase tracking-[0.2em] text-indigo-400 flex items-center gap-2\">\r\n                          <div className=\"w-1.5 h-1.5 rounded-full bg-indigo-500 shadow-[0_0_8px_indigo]\"></div>\r\n                          Policy Framework\r\n                        </h3>\r\n                        <span className=\"text-[10px] bg-white/5 border border-white/10 px-3 py-1 rounded-full text-slate-400 font-bold tracking-widest\">v2.1 Active</span>\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-8\">\r\n                        {[\r\n                          { label: 'Shift Windows', value: `${attendanceSettings?.shiftStartTime} - ${attendanceSettings?.shiftEndTime}`, color: 'text-indigo-400' },\r\n                          { label: 'Punch Architecture', value: `${attendanceSettings?.punchMode} PUNCH`, color: 'text-blue-400' },\r\n                          { label: 'Late Grace Period', value: `${attendanceSettings?.lateMarkThresholdMinutes} MINUTES`, color: 'text-emerald-400' },\r\n                          { label: 'Min. Full Day', value: `${attendanceSettings?.fullDayThresholdHours} HOURS`, color: 'text-amber-400' },\r\n                        ].map((config, i) => (\r\n                          <div key={i} className=\"group/item\">\r\n                            <p className=\"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1 group-hover/item:text-slate-400 transition-colors\">{config.label}</p>\r\n                            <p className={`text-sm font-black tracking-tight ${config.color}`}>{config.value}</p>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n\r\n                      <div className=\"mt-8 pt-6 border-t border-white/5 flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center\">\r\n                            <Briefcase size={14} className=\"text-slate-400\" />\r\n                          </div>\r\n                          <span className=\"text-[10px] font-bold text-slate-500 uppercase tracking-widest leading-none\">Geo-Fencing System</span>\r\n                        </div>\r\n                        <span className={`text-[10px] font-black uppercase tracking-widest px-4 py-1.5 rounded-xl border transition-all ${attendanceSettings?.locationRestrictionMode === 'none'\r\n                          ? 'bg-slate-800/50 text-slate-500 border-slate-700/50'\r\n                          : 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20 shadow-[0_0_15px_rgba(52,211,153,0.1)]'}`}>\r\n                          {attendanceSettings?.locationRestrictionMode === 'none' ? 'Bypassed' : `Restricted: ${attendanceSettings?.locationRestrictionMode}`}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Recent Attendance Log */}\r\n                  <div className=\"bg-white dark:bg-slate-800/50 p-6 rounded-2xl border border-slate-200/60 dark:border-slate-800/60 shadow-sm\">\r\n                    <div className=\"flex justify-between items-center mb-6\">\r\n                      <h3 className=\"text-xs font-black text-slate-800 dark:text-white uppercase tracking-widest flex items-center gap-2\">\r\n                        <AlertCircle size={12} className=\"text-blue-500\" />\r\n                        Recent Activity\r\n                        <span className=\"w-4 h-4 rounded-full bg-slate-100 dark:bg-slate-900 text-[8px] flex items-center justify-center font-black\">5</span>\r\n                      </h3>\r\n                      <button onClick={() => setActiveTab('attendance')} className=\"text-[10px] font-black text-indigo-500 hover:text-indigo-600 uppercase tracking-widest border-b-2 border-transparent hover:border-indigo-500 transition-all\">View All History</button>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3\">\r\n                      {attendance.slice(0, 5).map(att => (\r\n                        <div key={att._id} className=\"flex items-center justify-between p-4 rounded-2xl bg-white dark:bg-slate-900/40 border border-slate-100 dark:border-slate-800/50 hover:border-indigo-500/30 hover:shadow-md transition-all group\">\r\n                          <div className=\"flex items-center gap-4\">\r\n                            <div className=\"flex flex-col items-center justify-center w-12 h-12 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 group-hover:bg-indigo-50 dark:group-hover:bg-indigo-900/20 transition-colors\">\r\n                              <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-tighter leading-none\">{new Date(att.date).toLocaleDateString([], { month: 'short' })}</span>\r\n                              <span className=\"text-lg font-black text-slate-800 dark:text-white leading-none mt-0.5\">{new Date(att.date).getDate()}</span>\r\n                            </div>\r\n                            <div className=\"flex flex-col\">\r\n                              <span className=\"text-xs font-bold text-slate-400 dark:text-slate-500 uppercase tracking-widest\">\r\n                                {att.checkIn ? new Date(att.checkIn).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '--:--'} ¬∑ {att.checkOut ? new Date(att.checkOut).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '--:--'}\r\n                              </span>\r\n                              <div className=\"flex items-center gap-2 mt-1\">\r\n                                {att.isLate && <span className=\"text-[8px] font-black text-amber-500 bg-amber-500/10 px-1.5 py-0.5 rounded tracking-widest\">LATE</span>}\r\n                                {att.isEarlyOut && <span className=\"text-[8px] font-black text-orange-500 bg-orange-500/10 px-1.5 py-0.5 rounded tracking-widest\">EARLY</span>}\r\n                                <span className=\"text-xs font-black text-slate-700 dark:text-slate-200 tracking-tight\">{att.workingHours || 0}h Total</span>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className={`px-4 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest border ${att.status?.toLowerCase() === 'present'\r\n                              ? 'bg-emerald-50 text-emerald-600 border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-800/50'\r\n                              : 'bg-rose-50 text-rose-600 border-rose-200 dark:bg-rose-900/20 dark:text-rose-400 dark:border-rose-800/50'\r\n                              }`}>\r\n                              {att.status || 'present'}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                      {attendance.length === 0 && (\r\n                        <div className=\"text-center py-12 rounded-3xl border-2 border-dashed border-slate-200 dark:border-slate-800 flex flex-col items-center gap-4\">\r\n                          <Clock size={40} className=\"text-slate-200 dark:text-slate-800\" />\r\n                          <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">No recent data available</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Today's Stats Grid */}\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/40 dark:shadow-none flex flex-col items-center justify-center text-center\">\r\n                      <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1\">Total Punches</p>\r\n                      <p className=\"text-2xl font-black text-slate-800 dark:text-white\">{todaySummary?.totalPunches || 0}</p>\r\n                    </div>\r\n                    <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/40 dark:shadow-none flex flex-col items-center justify-center text-center\">\r\n                      <p className=\"text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-1\">Punches In</p>\r\n                      <p className=\"text-2xl font-black text-emerald-600 dark:text-emerald-400\">{todaySummary?.totalIn || 0}</p>\r\n                    </div>\r\n                    <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/40 dark:shadow-none flex flex-col items-center justify-center text-center\">\r\n                      <p className=\"text-[10px] font-black text-blue-500 uppercase tracking-widest mb-1\">Punches Out</p>\r\n                      <p className=\"text-2xl font-black text-blue-600 dark:text-blue-400\">{todaySummary?.totalOut || 0}</p>\r\n                    </div>\r\n                    <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/40 dark:shadow-none flex flex-col items-center justify-center text-center\">\r\n                      <p className=\"text-[10px] font-black text-indigo-500 uppercase tracking-widest mb-1\">Working Hours</p>\r\n                      <p className=\"text-2xl font-black text-indigo-600 dark:text-indigo-400\">{todaySummary?.workingHours || 0}h</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                <ReportingTree />\r\n                <div className=\"lg:col-span-2 bg-gradient-to-br from-indigo-500/5 to-purple-500/5 p-8 rounded-2xl border border-slate-200/60 dark:border-slate-800/60 shadow-sm flex flex-col justify-center items-center text-center group\">\r\n                  <div className=\"w-16 h-16 rounded-full bg-white dark:bg-slate-800 border-4 border-slate-50 dark:border-slate-900 shadow-xl flex items-center justify-center mb-6 transform group-hover:scale-110 transition-transform duration-500\">\r\n                    <Users className=\"text-indigo-500\" size={32} />\r\n                  </div>\r\n                  <h4 className=\"text-lg font-black text-slate-800 dark:text-white uppercase tracking-tighter\">Team Synergy Network</h4>\r\n                  <p className=\"text-sm text-slate-500 dark:text-slate-400 max-w-md mt-2\">Connecting people and simplifying operations through our centralized HR intelligence platform.</p>\r\n                  <button className=\"mt-6 px-6 py-2.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-xs font-black uppercase tracking-widest text-indigo-500 hover:bg-indigo-500 hover:text-white transition-all shadow-sm\">Explore Directory</button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n      )}\r\n\r\n            {/* MY LEAVES TAB */}\r\n            {\r\n              activeTab === 'leaves' && (\r\n                <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-700\">\r\n\r\n                  {/* Leave Balance Cards */}\r\n                  {balances.length > 0 && (\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                      {balances.map(b => {\r\n                        const leaveKey = b.leaveType.toLowerCase();\r\n                        const isPaid = leaveKey.includes('paid') || leaveKey.includes('privilege');\r\n                        const isSick = leaveKey.includes('sick') || leaveKey.includes('medical');\r\n                        const isCasual = leaveKey.includes('casual');\r\n\r\n                        let gradient = 'from-indigo-500 to-blue-600';\r\n                        let iconColor = 'text-indigo-500';\r\n                        if (isPaid) { gradient = 'from-emerald-500 to-teal-600'; iconColor = 'text-emerald-500'; }\r\n                        if (isSick) { gradient = 'from-rose-500 to-pink-600'; iconColor = 'text-rose-500'; }\r\n                        if (isCasual) { gradient = 'from-amber-400 to-orange-500'; iconColor = 'text-amber-500'; }\r\n\r\n                        return (\r\n                          <div key={b._id} className=\"relative group\">\r\n                            <div className=\"absolute inset-0 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 transition-all duration-300 group-hover:shadow-xl group-hover:shadow-indigo-500/5 group-hover:-translate-y-1\"></div>\r\n                            <div className=\"relative p-5\">\r\n                              <div className=\"flex justify-between items-center mb-4\">\r\n                                <div className={`p-2 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-slate-800 ${iconColor}`}>\r\n                                  <CalendarIcon size={14} />\r\n                                </div>\r\n                                <div className={`px-2 py-0.5 rounded-full text-[8px] font-black uppercase tracking-widest text-white bg-gradient-to-r ${gradient}`}>Available</div>\r\n                              </div>\r\n\r\n                              <div className=\"flex items-baseline gap-1.5\">\r\n                                <span className=\"text-3xl font-black text-slate-800 dark:text-white tracking-tighter\">{b.available || 0}</span>\r\n                                <span className=\"text-xs font-bold text-slate-400\">/ {b.total || 0} Total</span>\r\n                              </div>\r\n                              <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1\">{b.leaveType}</p>\r\n\r\n                              <div className=\"mt-5 grid grid-cols-2 gap-4\">\r\n                                <div className=\"p-2 rounded-xl bg-slate-50 dark:bg-slate-900/50 border border-slate-100 dark:border-slate-800\">\r\n                                  <p className=\"text-[8px] font-black text-slate-400 uppercase tracking-widest mb-0.5\">Utilized</p>\r\n                                  <p className=\"text-xs font-black text-slate-700 dark:text-slate-300\">{b.used || 0} Days</p>\r\n                                </div>\r\n                                <div className=\"p-2 rounded-xl bg-slate-50 dark:bg-slate-900/50 border border-slate-100 dark:border-slate-800\">\r\n                                  <p className=\"text-[8px] font-black text-slate-400 uppercase tracking-widest mb-0.5\">Processing</p>\r\n                                  <p className=\"text-xs font-black text-slate-700 dark:text-slate-300\">{b.pending || 0} Days</p>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  )}\r\n\r\n                  {!hasLeavePolicy && (\r\n                    <div className=\"p-6 bg-amber-50 dark:bg-amber-900/10 border border-amber-200/50 dark:border-amber-800/50 rounded-2xl text-center shadow-sm\">\r\n                      <div className=\"w-12 h-12 bg-amber-100 dark:bg-amber-900/30 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n                        <AlertCircle className=\"text-amber-600 dark:text-amber-500\" size={20} />\r\n                      </div>\r\n                      <h4 className=\"text-sm font-black text-amber-800 dark:text-amber-300 uppercase tracking-widest\">Policy Restriction</h4>\r\n                      <p className=\"text-xs font-medium text-amber-600 dark:text-amber-500 mt-1 uppercase tracking-tight\">No leave policy assigned yet. Please contact your HR administrator.</p>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-6 items-start\">\r\n                    {/* Apply Form */}\r\n                    <div className=\"lg:col-span-2 sticky top-24\">\r\n                      <ApplyLeaveForm\r\n                        balances={balances}\r\n                        existingLeaves={leaves}\r\n                        editData={editLeave}\r\n                        onCancelEdit={() => setEditLeave(null)}\r\n                        onSuccess={() => {\r\n                          setEditLeave(null);\r\n                          fetchDashboardData();\r\n                        }}\r\n                      />\r\n\r\n                      {/* Leave History */}\r\n                      <div className=\"lg:col-span-2 bg-white dark:bg-slate-800 p-4 rounded-xl border border-gray-100 dark:border-slate-700 shadow-sm\">\r\n                        <h3 className=\"text-base font-bold text-slate-800 dark:text-white mb-4\">Leave History</h3>\r\n\r\n                        <div className=\"overflow-x-auto\">\r\n                          <table className=\"w-full text-sm\">\r\n                            <thead>\r\n                              <tr className=\"border-b border-gray-100 dark:border-slate-700\">\r\n                                <th className=\"text-left py-3 text-xs font-semibold text-slate-500 uppercase\">Type</th>\r\n                                <th className=\"text-left py-3 text-xs font-semibold text-slate-500 uppercase\">Dates</th>\r\n                                <th className=\"text-center py-3 text-xs font-semibold text-slate-500 uppercase\">Days</th>\r\n                                <th className=\"text-center py-3 text-xs font-semibold text-slate-500 uppercase\">Status</th>\r\n                                <th className=\"text-center py-3 text-xs font-semibold text-slate-500 uppercase\">Actions</th>\r\n                              </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-gray-50 dark:divide-slate-700\">\r\n                              {leaves.length === 0 ? (\r\n                                <tr><td colSpan=\"4\" className=\"text-center py-8 text-slate-400\">No leave history</td></tr>\r\n                              ) : (\r\n                                leaves.slice((currentPage - 1) * pageSize, currentPage * pageSize).map(l => (\r\n                                  <tr key={l._id} className=\"hover:bg-gray-50 dark:hover:bg-slate-700/50\">\r\n                                    <td className=\"py-3 text-slate-700 dark:text-slate-300 font-medium\">{l.leaveType}</td>\r\n                                    <td className=\"py-3 text-slate-600 dark:text-slate-400\">\r\n                                      <div className=\"flex flex-col\">\r\n                                        <span>{formatDateDDMMYYYY(l.startDate)} - {formatDateDDMMYYYY(l.endDate)}</span>\r\n                                        {l.isHalfDay && (\r\n                                          <span className=\"text-[10px] font-black text-blue-500 uppercase tracking-tight mt-0.5\">\r\n                                            Half-day on {l.halfDayTarget || 'Start'} ({l.halfDaySession})\r\n                                          </span>\r\n                                        )}\r\n                                      </div>\r\n                                    </td>\r\n                                    <td className=\"py-3 text-center text-slate-600 dark:text-slate-400\">{l.daysCount}</td>\r\n                                    <td className=\"py-3 text-center\">\r\n                                      <span className={`px-2.5 py-1 rounded text-xs font-medium ${l.status === 'Approved' ? 'bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300' :\r\n                                        l.status === 'Rejected' ? 'bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300' :\r\n                                          l.status === 'Cancelled' ? 'bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400' :\r\n                                            'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-300'\r\n                                        }`}>\r\n                                        {l.status}\r\n                                      </span>\r\n                                    </td>\r\n                                    <td className=\"py-3 text-center\">\r\n                                      {l.status === 'Pending' ? (\r\n                                        <div className=\"flex justify-center gap-3\">\r\n                                          <button\r\n                                            onClick={() => {\r\n                                              setEditLeave(l);\r\n                                              window.scrollTo({ top: 0, behavior: 'smooth' });\r\n                                            }}\r\n                                            className=\"text-[10px] font-black text-blue-600 hover:text-blue-700 uppercase tracking-widest bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded transition-colors\"\r\n                                          >\r\n                                            Edit\r\n                                          </button>\r\n                                          <button\r\n                                            onClick={() => handleCancelLeave(l._id)}\r\n                                            className=\"text-[10px] font-black text-rose-600 hover:text-rose-700 uppercase tracking-widest bg-rose-50 dark:bg-rose-900/20 px-2 py-1 rounded transition-colors\"\r\n                                          >\r\n                                            Cancel\r\n                                          </button>\r\n                                        </div>\r\n                                      ) : (\r\n                                        <span className=\"text-[9px] font-bold text-slate-400 uppercase tracking-widest italic\">\r\n                                          {l.status}\r\n                                        </span>\r\n                                      )}\r\n                                    </td>\r\n                                  </tr>\r\n                                ))\r\n                              )}\r\n                            </tbody>\r\n                          </table>\r\n                        </div>\r\n\r\n                        {/* Leave History */}\r\n                        <div className=\"lg:col-span-3 bg-white dark:bg-slate-800/50 rounded-2xl border border-slate-200/60 dark:border-slate-800/60 shadow-sm overflow-hidden\">\r\n                          <div className=\"px-6 py-5 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center\">\r\n                            <h3 className=\"text-sm font-black text-slate-800 dark:text-white uppercase tracking-widest flex items-center gap-3\">\r\n                              <FileText size={16} className=\"text-indigo-500\" />\r\n                              Request Timeline\r\n                            </h3>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <span className=\"w-2 h-2 rounded-full bg-emerald-500\"></span>\r\n                              <span className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest\">Live Updates</span>\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full\">\r\n                              <thead>\r\n                                <tr className=\"bg-slate-50 dark:bg-slate-900/50\">\r\n                                  <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Type</th>\r\n                                  <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Schedule</th>\r\n                                  <th className=\"px-6 py-4 text-center text-[10px] font-black text-slate-400 uppercase tracking-widest\">Units</th>\r\n                                  <th className=\"px-6 py-4 text-center text-[10px] font-black text-slate-400 uppercase tracking-widest\">Status</th>\r\n                                  <th className=\"px-6 py-4 text-right text-[10px] font-black text-slate-400 uppercase tracking-widest\">Control</th>\r\n                                </tr>\r\n                              </thead>\r\n                              <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800\">\r\n                                {leaves.length === 0 ? (\r\n                                  <tr>\r\n                                    <td colSpan=\"5\" className=\"py-20 text-center\">\r\n                                      <div className=\"flex flex-col items-center gap-3\">\r\n                                        <CalendarIcon size={40} className=\"text-slate-100 dark:text-slate-800\" />\r\n                                        <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">No transaction history found</p>\r\n                                      </div>\r\n                                    </td>\r\n                                  </tr>\r\n                                ) : (\r\n                                  leaves.slice((currentPage - 1) * pageSize, currentPage * pageSize).map(l => (\r\n                                    <tr key={l._id} className=\"group hover:bg-slate-50 dark:hover:bg-slate-900/50 transition-colors\">\r\n                                      <td className=\"px-6 py-4\">\r\n                                        <div className=\"flex flex-col\">\r\n                                          <span className=\"text-sm font-black text-slate-700 dark:text-slate-200\">{l.leaveType}</span>\r\n                                          <span className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-0.5 line-clamp-1\">{l.reason || 'No reason provided'}</span>\r\n                                        </div>\r\n                                      </td>\r\n                                      <td className=\"px-6 py-4\">\r\n                                        <div className=\"flex flex-col\">\r\n                                          <span className=\"text-xs font-bold text-slate-600 dark:text-slate-400 tracking-tight\">{formatDateDDMMYYYY(l.startDate)} - {formatDateDDMMYYYY(l.endDate)}</span>\r\n                                          {l.isHalfDay && (\r\n                                            <span className=\"text-[9px] font-black text-indigo-500 uppercase tracking-widest mt-1 bg-indigo-50 dark:bg-indigo-900/20 px-1.5 py-0.5 rounded w-fit\">\r\n                                              {l.halfDaySession} Session\r\n                                            </span>\r\n                                          )}\r\n                                        </div>\r\n                                      </td>\r\n                                      <td className=\"px-6 py-4 text-center\">\r\n                                        <div className=\"inline-flex items-center justify-center w-8 h-8 rounded-lg bg-slate-100 dark:bg-slate-800 text-xs font-black text-slate-700 dark:text-slate-300\">\r\n                                          {l.daysCount}\r\n                                        </div>\r\n                                      </td>\r\n                                      <td className=\"px-6 py-4 text-center\">\r\n                                        <span className={`px-3 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest border shadow-sm ${l.status === 'Approved' ? 'bg-emerald-50 text-emerald-600 border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-800/50' :\r\n                                          l.status === 'Rejected' ? 'bg-rose-50 text-rose-600 border-rose-200 dark:bg-rose-900/20 dark:text-rose-400 dark:border-rose-800/50' :\r\n                                            l.status === 'Cancelled' ? 'bg-slate-100 text-slate-500 border-slate-200 dark:bg-slate-800 dark:text-slate-500 dark:border-slate-700' :\r\n                                              'bg-amber-50 text-amber-600 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-800/50'\r\n                                          }`}>\r\n                                          {l.status}\r\n                                        </span>\r\n                                      </td>\r\n                                      <td className=\"px-6 py-4 text-right\">\r\n                                        {l.status === 'Pending' ? (\r\n                                          <div className=\"flex justify-end gap-2\">\r\n                                            <button\r\n                                              onClick={() => {\r\n                                                setEditLeave(l);\r\n                                                window.scrollTo({ top: 0, behavior: 'smooth' });\r\n                                              }}\r\n                                              className=\"p-2 text-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition-colors border border-transparent hover:border-indigo-100 dark:hover:border-indigo-800/40\"\r\n                                              title=\"Edit Request\"\r\n                                            >\r\n                                              <FileText size={16} />\r\n                                            </button>\r\n                                            <button\r\n                                              onClick={() => handleCancelLeave(l._id)}\r\n                                              className=\"p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/30 rounded-lg transition-colors border border-transparent hover:border-rose-100 dark:hover:border-rose-800/40\"\r\n                                              title=\"Cancel Request\"\r\n                                            >\r\n                                              <AlertCircle size={16} />\r\n                                            </button>\r\n                                          </div>\r\n                                        ) : (\r\n                                          <div className=\"text-[10px] font-black text-slate-300 dark:text-slate-600 uppercase tracking-widest italic pr-2\">\r\n                                            Locked\r\n                                          </div>\r\n                                        )}\r\n                                      </td>\r\n                                    </tr>\r\n                                  ))\r\n                                )}\r\n                              </tbody>\r\n                            </table>\r\n                          </div>\r\n                          {leaves.length > pageSize && (\r\n                            <div className=\"px-6 py-4 border-t border-slate-100 dark:border-slate-800 flex justify-end\">\r\n                              <Pagination\r\n                                current={currentPage}\r\n                                pageSize={pageSize}\r\n                                total={leaves.length}\r\n                                onChange={(page) => setCurrentPage(page)}\r\n                                showSizeChanger={false}\r\n                                className=\"custom-pagination\"\r\n                              />\r\n                            </div>\r\n                {leaves.length > pageSize && (\r\n                            <div className=\"mt-4 flex justify-end\">\r\n                              <Pagination\r\n                                current={currentPage}\r\n                                pageSize={pageSize}\r\n                                total={leaves.length}\r\n                                onChange={(page) => setCurrentPage(page)}\r\n                                showSizeChanger={false}\r\n                              />\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    )\r\n      }\r\n\r\n                    {/* MY PROFILE TAB */}\r\n                    {\r\n                      activeTab === 'profile' && (\r\n                        <EmployeeProfileView profile={profile} balances={balances} />\r\n                      )\r\n                    }\r\n\r\n                    {/* PAYSLIPS TAB */}\r\n                    {\r\n                      activeTab === 'payslips' && (\r\n                        <div className=\"flex flex-col items-center justify-center h-96 text-slate-400\">\r\n                          <FileText size={64} className=\"mb-4 opacity-30\" />\r\n                          <p className=\"text-lg\">Payslips module coming soon...</p>\r\n                        </div>\r\n                      )\r\n                    }\r\n\r\n                    {/* REGULARIZATION TAB */}\r\n                    {\r\n                      activeTab === 'regularization' && (\r\n                        <RegularizationRequest />\r\n                      )\r\n                    }\r\n\r\n                    {/* FaceAttendance Tab */}\r\n                    {activeTab === 'face-attendance' && (\r\n                      <FaceAttendance />\r\n                    )}\r\n\r\n                    {/* TEAM LEAVES TAB */}\r\n                    {\r\n                      activeTab === 'team-leaves' && (\r\n                        <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-gray-100 dark:border-slate-700 shadow-sm\">\r\n                          <LeaveApprovals isManagerView={true} endpoint=\"/employee/leaves/team-requests\" actionEndpoint=\"/employee/leaves/requests\" />\r\n                        </div>\r\n                      )\r\n                    }\r\n\r\n                    {/* TEAM REGULARIZATION TAB */}\r\n                    {\r\n                      activeTab === 'team-regularization' && (\r\n                        <div className=\"space-y-6\">\r\n                          <div className=\"bg-white dark:bg-slate-800 p-8 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-sm\">\r\n                            <h3 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter mb-6\">Team Attendance Correction</h3>\r\n                            <RegularizationApprovals\r\n                              isManagerView={true}\r\n                              category=\"Attendance\"\r\n                              endpoint=\"/employee/regularization/team-requests\"\r\n                              actionEndpoint=\"/employee/regularization/requests\"\r\n                            />\r\n                          </div>\r\n\r\n                          <div className=\"bg-white dark:bg-slate-800 p-8 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-sm\">\r\n                            <h3 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter mb-6\">Team Leave Adjustment</h3>\r\n                            <RegularizationApprovals\r\n                              isManagerView={true}\r\n                              category=\"Leave\"\r\n                              endpoint=\"/employee/regularization/team-requests\"\r\n                              actionEndpoint=\"/employee/regularization/requests\"\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      )\r\n                    }\r\n\r\n                    {/* MY ATTENDANCE TAB */}\r\n                    {\r\n                      activeTab === 'attendance' && (\r\n                        <MyAttendanceView />\r\n                      )\r\n                    }\r\n\r\n                    {/* TEAM ATTENDANCE TAB */}\r\n                    {\r\n                      activeTab === 'team-attendance' && (\r\n                        <TeamAttendanceView />\r\n                      )\r\n                    }\r\n\r\n                    {/* INTERNAL JOBS TAB */}\r\n                    {\r\n                      activeTab === 'internal-jobs' && (\r\n                        <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-gray-100 dark:border-slate-700 shadow-sm\">\r\n                          <InternalJobs />\r\n                        </div>\r\n                      )\r\n                    }\r\n\r\n                    {/* MY APPLICATIONS TAB */}\r\n                    {\r\n                      activeTab === 'my-applications' && (\r\n                        <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-gray-100 dark:border-slate-700 shadow-sm\">\r\n                          <MyApplications />\r\n                        </div>\r\n                      )\r\n                    }\r\n\r\n                  </div>\r\n                  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Employee\\FaceAttendance.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":12,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"user"},"fix":{"range":[403,430],"text":""},"desc":"Remove unused variable 'user'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'location' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":16,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"location"},"fix":{"range":[636,644],"text":""},"desc":"Remove unused variable 'location'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect } from 'react';\r\nimport {\r\n  Camera, MapPin, CheckCircle, XCircle, User, UserPlus, Clock, AlertCircle,\r\n  Loader2, Navigation, LogOut, RotateCcw, Shield, Smartphone\r\n} from 'lucide-react';\r\nimport api from '../../utils/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport * as faceapi from 'face-api.js';\r\n\r\n\r\nconst FaceAttendance = () => {\r\n  const { user } = useAuth();\r\n  const [mode, setMode] = useState('attendance'); // 'attendance' or 'register'\r\n  const [cameraActive, setCameraActive] = useState(false);\r\n  const [capturing, setCapturing] = useState(false);\r\n  const [location, setLocation] = useState(null);\r\n  const [status, setStatus] = useState(null);\r\n  const [message, setMessage] = useState('');\r\n  const [faceRegistered, setFaceRegistered] = useState(false);\r\n  const [registrationName, setRegistrationName] = useState('');\r\n  const [registrationId, setRegistrationId] = useState('');\r\n  const [consentGiven, setConsentGiven] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [modelsLoaded, setModelsLoaded] = useState(false);\r\n\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const streamRef = useRef(null);\r\n\r\n  // Load face-api.js models on mount\r\n  useEffect(() => {\r\n    const loadModels = async () => {\r\n      try {\r\n        console.log('Loading face-api.js models...');\r\n\r\n        await Promise.all([\r\n          faceapi.nets.tinyFaceDetector.loadFromUri('/models'),\r\n          faceapi.nets.faceLandmark68Net.loadFromUri('/models'),\r\n          faceapi.nets.faceRecognitionNet.loadFromUri('/models')\r\n        ]);\r\n        console.log('‚úì All face-api.js models loaded successfully');\r\n        setModelsLoaded(true);\r\n      } catch (err) {\r\n        console.error('Error loading face-api.js models:', err);\r\n        setStatus('error');\r\n        setMessage('Failed to load face recognition models. Please refresh the page.');\r\n      }\r\n    };\r\n\r\n    loadModels();\r\n  }, []);\r\n\r\n  // Check face registration status on mount\r\n  useEffect(() => {\r\n    checkFaceStatus();\r\n    return () => {\r\n      if (streamRef.current) {\r\n        streamRef.current.getTracks().forEach(track => track.stop());\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const checkFaceStatus = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await api.get('/attendance/face/status');\r\n      setFaceRegistered(res.data.isRegistered);\r\n      if (!res.data.isRegistered) {\r\n        setMode('register');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error checking face status:', err);\r\n      setFaceRegistered(false);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      setStatus(null);\r\n      setMessage('');\r\n      setCapturing(false);\r\n\r\n      console.log('Starting camera initialization...');\r\n\r\n      // Step 1: Set camera active FIRST to render the video element\r\n      setCameraActive(true);\r\n      console.log('Set cameraActive to true - waiting for DOM to update...');\r\n\r\n      // Step 2: Wait for React to render the video element\r\n      await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n      // Step 3: Now request camera stream\r\n      console.log('Requesting camera access...');\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: {\r\n          facingMode: 'user',\r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 }\r\n        }\r\n      });\r\n\r\n      console.log('Camera stream obtained:', stream);\r\n\r\n      // Step 4: Attach stream to video element (should exist now)\r\n      let retries = 0;\r\n      const maxRetries = 10;\r\n\r\n      const attachStream = () => {\r\n        console.log(`Attempt ${retries + 1} to attach stream...`);\r\n\r\n        if (!videoRef?.current) {\r\n          console.warn(`videoRef.current not available yet (attempt ${retries + 1}/${maxRetries})`);\r\n\r\n          if (retries < maxRetries) {\r\n            retries++;\r\n            setTimeout(attachStream, 150);\r\n            return;\r\n          } else {\r\n            console.error('Failed to attach stream after max retries');\r\n            setStatus('error');\r\n            setMessage('Camera element not ready. Please refresh the page and try again.');\r\n            setCameraActive(false);\r\n            stream.getTracks().forEach(track => track.stop());\r\n            return;\r\n          }\r\n        }\r\n\r\n        try {\r\n          console.log('Attaching stream to video element...');\r\n          videoRef.current.srcObject = stream;\r\n          streamRef.current = stream;\r\n          console.log('‚úì Stream attached successfully');\r\n\r\n          // Ensure video plays\r\n          setTimeout(() => {\r\n            if (videoRef?.current && videoRef.current.paused) {\r\n              console.log('Starting video playback...');\r\n              videoRef.current.play()\r\n                .then(() => {\r\n                  console.log('‚úì Video playback started');\r\n                })\r\n                .catch(err => {\r\n                  console.error('‚úó Video play error:', err);\r\n                  setStatus('error');\r\n                  setMessage('Failed to start video playback.');\r\n                });\r\n            }\r\n          }, 100);\r\n\r\n        } catch (err) {\r\n          console.error('Error attaching stream:', err);\r\n          setStatus('error');\r\n          setMessage('Failed to attach camera stream.');\r\n          setCameraActive(false);\r\n          stream.getTracks().forEach(track => track.stop());\r\n        }\r\n      };\r\n\r\n      attachStream();\r\n\r\n    } catch (err) {\r\n      console.error('Camera access error:', err);\r\n      console.error('Error name:', err.name);\r\n      console.error('Error message:', err.message);\r\n\r\n      setCameraActive(false);\r\n      setStatus('error');\r\n\r\n      // Provide specific error messages\r\n      if (err.name === 'NotAllowedError') {\r\n        setMessage('Camera permission denied. Please enable camera in your browser settings.');\r\n      } else if (err.name === 'NotFoundError') {\r\n        setMessage('No camera found on this device.');\r\n      } else if (err.name === 'NotSupportedError') {\r\n        setMessage('Camera not supported in this browser. Try Chrome, Firefox, or Edge.');\r\n      } else if (err.name === 'SecurityError') {\r\n        setMessage('HTTPS is required for camera access.');\r\n      } else {\r\n        setMessage('Unable to access camera: ' + err.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach(track => track.stop());\r\n      streamRef.current = null;\r\n    }\r\n    if (videoRef.current) {\r\n      videoRef.current.srcObject = null;\r\n    }\r\n    setCameraActive(false);\r\n  };\r\n\r\n  const getLocation = () => {\r\n    return new Promise((resolve, reject) => {\r\n      if (!navigator.geolocation) {\r\n        reject(new Error('Geolocation not supported on this device'));\r\n        return;\r\n      }\r\n\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          const loc = {\r\n            lat: position.coords.latitude,\r\n            lng: position.coords.longitude,\r\n            accuracy: position.coords.accuracy\r\n          };\r\n          setLocation(loc);\r\n          resolve(loc);\r\n        },\r\n        (error) => {\r\n          reject(error);\r\n        },\r\n        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }\r\n      );\r\n    });\r\n  };\r\n\r\n  const captureImage = () => {\r\n    const canvas = canvasRef.current;\r\n    const video = videoRef.current;\r\n\r\n    if (canvas && video && video.videoWidth > 0 && video.videoHeight > 0) {\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.drawImage(video, 0, 0);\r\n      return canvas.toDataURL('image/jpeg', 0.9);\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const handleAttendance = async () => {\r\n    if (!faceRegistered) {\r\n      setStatus('error');\r\n      setMessage('Please register your face first');\r\n      return;\r\n    }\r\n\r\n    if (!modelsLoaded) {\r\n      setStatus('error');\r\n      setMessage('Face recognition models are still loading. Please wait...');\r\n      return;\r\n    }\r\n\r\n    setCapturing(true);\r\n    setStatus(null);\r\n    setMessage('Processing attendance...');\r\n\r\n    try {\r\n      // Get location\r\n      const loc = await getLocation();\r\n\r\n      // Capture image\r\n      const imageData = captureImage();\r\n      if (!imageData) {\r\n        throw new Error('Failed to capture image. Please ensure camera is working.');\r\n      }\r\n      console.log('üìç Location obtained:', loc);\r\n\r\n      const videoEl = videoRef.current;\r\n      if (!videoEl) {\r\n        throw new Error('Video element not ready');\r\n      }\r\n\r\n      if (!videoEl.srcObject) {\r\n        throw new Error('Camera is not active. Please start the camera first.');\r\n      }\r\n\r\n      // Wait for video to be fully ready\r\n      if (videoEl.readyState < 2) {\r\n        console.log('‚è≥ Waiting for video to be ready...');\r\n        await new Promise((resolve) => {\r\n          videoEl.onloadeddata = resolve;\r\n          setTimeout(resolve, 2000); // Timeout after 2 seconds\r\n        });\r\n      }\r\n\r\n      console.log('üîç Detecting face...', {\r\n        videoWidth: videoEl.videoWidth,\r\n        videoHeight: videoEl.videoHeight,\r\n        readyState: videoEl.readyState\r\n      });\r\n\r\n      // Use more lenient detection options\r\n      const detectionOptions = new faceapi.TinyFaceDetectorOptions({\r\n        inputSize: 416,  // Larger input size for better detection\r\n        scoreThreshold: 0.3  // Lower threshold to detect faces more easily\r\n      });\r\n\r\n      const detection = await faceapi\r\n        .detectSingleFace(videoEl, detectionOptions)\r\n        .withFaceLandmarks()\r\n        .withFaceDescriptor();\r\n\r\n      if (!detection) {\r\n        throw new Error('No face detected. Please ensure your face is clearly visible in the camera and well-lit.');\r\n      }\r\n\r\n      console.log('‚úì Face detected successfully');\r\n\r\n      // Get face embeddings (128-dimensional vector)\r\n      const faceEmbedding = Array.from(detection.descriptor);\r\n\r\n      console.log('üì∑ ATTENDANCE - Face embedding generated:');\r\n      console.log('   Length:', faceEmbedding.length);\r\n      console.log('   First 10 values:', faceEmbedding.slice(0, 10).map(v => parseFloat(v.toFixed(6))));\r\n      console.log('   Last 10 values:', faceEmbedding.slice(118).map(v => parseFloat(v.toFixed(6))));\r\n      console.log('   Sum:', faceEmbedding.reduce((a, b) => a + b, 0).toFixed(4));\r\n      console.log('   Mean:', (faceEmbedding.reduce((a, b) => a + b, 0) / faceEmbedding.length).toFixed(4));\r\n\r\n      // Validate embedding\r\n      if (!Array.isArray(faceEmbedding) || faceEmbedding.length !== 128) {\r\n        throw new Error(`Invalid embedding: expected 128 dimensions, got ${faceEmbedding?.length || 0}`);\r\n      }\r\n\r\n      const isValidEmbedding = faceEmbedding.every(val => typeof val === 'number' && !isNaN(val));\r\n      if (!isValidEmbedding) {\r\n        throw new Error('Invalid embedding: contains non-numeric values');\r\n      }\r\n\r\n      console.log('‚úÖ Embedding validation passed, sending to backend');\r\n\r\n      // Prepare request data with embeddings\r\n      const requestData = {\r\n        faceEmbedding: faceEmbedding,\r\n        location: {\r\n          lat: loc.lat,\r\n          lng: loc.lng,\r\n          accuracy: loc.accuracy,\r\n          timestamp: new Date().toISOString()\r\n        }\r\n      };\r\n      console.log('üì§ Sending attendance verification request:', {\r\n        faceEmbeddingLength: requestData.faceEmbedding.length,\r\n        location: requestData.location\r\n      });\r\n\r\n      // Call face verify API\r\n      const res = await api.post('/attendance/face/verify', requestData, {\r\n        headers: { 'Content-Type': 'application/json' }\r\n      });\r\n\r\n      if (res.data.success) {\r\n        setStatus('success');\r\n        setMessage(res.data.message);\r\n\r\n        setTimeout(() => {\r\n          stopCamera();\r\n          setCapturing(false);\r\n        }, 3000);\r\n      }\r\n    } catch (err) {\r\n      console.error('Attendance error:', err);\r\n      setStatus('error');\r\n      // Show detailed error message if available\r\n      let errorMessage = 'Failed to mark attendance';\r\n\r\n      // Handle different error response structures\r\n      if (err.response?.data?.details) {\r\n        // If details is an object with a message property\r\n        if (typeof err.response.data.details === 'object' && err.response.data.details.message) {\r\n          errorMessage = err.response.data.details.message;\r\n        }\r\n        // If details is a string directly\r\n        else if (typeof err.response.data.details === 'string') {\r\n          errorMessage = err.response.data.details;\r\n        }\r\n      } else if (err.response?.data?.message) {\r\n        errorMessage = err.response.data.message;\r\n      } else if (err.message) {\r\n        errorMessage = err.message;\r\n      }\r\n\r\n      setMessage(errorMessage);\r\n      setCapturing(false);\r\n    }\r\n  };\r\n\r\n  // const handleRegistration = async () => {\r\n  //   // Validate inputs\r\n  //   if (!registrationName.trim()) {\r\n  //     setStatus('error');\r\n  //     setMessage('Please enter your full name');\r\n  //     return;\r\n  //   }\r\n\r\n  //   if (!registrationId.trim()) {\r\n  //     setStatus('error');\r\n  //     setMessage('Please enter your employee ID');\r\n  //     return;\r\n  //   }\r\n\r\n  //   if (!consentGiven) {\r\n  //     setStatus('error');\r\n  //     setMessage('Please accept the consent to proceed with face registration');\r\n  //     return;\r\n  //   }\r\n\r\n  //   setCapturing(true);\r\n  //   setStatus(null);\r\n  //   setMessage('Registering your face...');\r\n\r\n  //   try {\r\n  //     // Capture image\r\n  //     const imageData = captureImage();\r\n\r\n  //     if (!imageData) {\r\n  //       throw new Error('Failed to capture image. Please ensure camera is working.');\r\n  //     }\r\n\r\n  //     console.log('üì∏ Face image captured, size:', imageData.length, 'bytes');\r\n  //     console.log('üì§ Sending registration request with payload:', {\r\n  //       faceImageData: imageData.substring(0, 100) + '...',\r\n  //       registrationNotes: `Self registration - ${registrationName}`,\r\n  //       consentGiven: true\r\n  //     });\r\n\r\n  //     // Call face register API\r\n  //     const res = await api.post('/attendance/face/register', {\r\n  //       faceImageData: imageData,\r\n  //       headers: { 'Content-Type': 'application/json' },\r\n  //       registrationNotes: `Self registration - ${registrationName}`,\r\n  //       consentGiven: true\r\n  //     });\r\n\r\n  //     console.log('‚úÖ Registration response:', res.data);\r\n\r\n  //     if (res.data.success) {\r\n  //       setStatus('success');\r\n  //       setMessage('Face registered successfully! You can now mark attendance.');\r\n  //       setFaceRegistered(true);\r\n  //       setRegistrationName('');\r\n  //       setRegistrationId('');\r\n  //       setConsentGiven(false);\r\n\r\n  //       setTimeout(() => {\r\n  //         stopCamera();\r\n  //         setCapturing(false);\r\n  //         setMode('attendance');\r\n  //       }, 3000);\r\n  //     }\r\n  //   } catch (err) {\r\n  //     console.error('‚ùå Registration error:', err);\r\n  //     console.error('Error response:', err.response?.data);\r\n  //     setStatus('error');\r\n  //     setMessage(err.response?.data?.message || err.message || 'Face registration failed');\r\n  //     setCapturing(false);\r\n  //   }\r\n  // };\r\n\r\n  const handleRegistration = async () => {\r\n    // 1Ô∏è‚É£ Basic validation\r\n    if (!registrationName.trim()) {\r\n      setStatus('error');\r\n      setMessage('Please enter your full name');\r\n      return;\r\n    }\r\n\r\n    if (!registrationId.trim()) {\r\n      setStatus('error');\r\n      setMessage('Please enter your employee ID');\r\n      return;\r\n    }\r\n\r\n    if (!consentGiven) {\r\n      setStatus('error');\r\n      setMessage('Please accept the consent to proceed with face registration');\r\n      return;\r\n    }\r\n\r\n    setCapturing(true);\r\n    setStatus(null);\r\n    setMessage('Registering your face...');\r\n\r\n    try {\r\n      // 2Ô∏è‚É£ Detect face & generate embedding\r\n      console.log('üîç Detecting face with options...');\r\n      const detection = await faceapi\r\n        .detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions({\r\n          inputSize: 416,\r\n          scoreThreshold: 0.5  // More lenient threshold\r\n        }))\r\n        .withFaceLandmarks()\r\n        .withFaceDescriptor();\r\n\r\n      if (!detection) {\r\n        throw new Error('No face detected. Please look at the camera clearly.');\r\n      }\r\n\r\n      // 3Ô∏è‚É£ Convert descriptor to normal array\r\n      const faceEmbedding = Array.from(detection.descriptor);\r\n\r\n      console.log('üß† REGISTRATION - Face embedding generated:');\r\n      console.log('   Length:', faceEmbedding.length);\r\n      console.log('   First 10 values:', faceEmbedding.slice(0, 10).map(v => parseFloat(v.toFixed(6))));\r\n      console.log('   Last 10 values:', faceEmbedding.slice(118).map(v => parseFloat(v.toFixed(6))));\r\n      console.log('   Sum:', faceEmbedding.reduce((a, b) => a + b, 0).toFixed(4));\r\n      console.log('   Mean:', (faceEmbedding.reduce((a, b) => a + b, 0) / faceEmbedding.length).toFixed(4));\r\n\r\n      // Validate embedding\r\n      if (!Array.isArray(faceEmbedding) || faceEmbedding.length !== 128) {\r\n        throw new Error(`Invalid embedding: expected 128 dimensions, got ${faceEmbedding.length}`);\r\n      }\r\n\r\n      const isValidEmbedding = faceEmbedding.every(val => typeof val === 'number' && !isNaN(val));\r\n      if (!isValidEmbedding) {\r\n        throw new Error('Invalid embedding: contains non-numeric values');\r\n      }\r\n\r\n      console.log('‚úÖ Embedding validation passed');\r\n\r\n      // 4Ô∏è‚É£ Call registration API (CORRECT axios usage)\r\n      const res = await api.post(\r\n        '/attendance/face/register',\r\n        {\r\n          employeeId: registrationId,\r\n          employeeName: registrationName,\r\n          faceEmbedding,\r\n          registrationNotes: `Self registration - ${registrationName}`,\r\n          consentGiven: true\r\n        },\r\n        {\r\n          headers: { 'Content-Type': 'application/json' }\r\n        }\r\n      );\r\n\r\n      console.log('‚úÖ Registration response:', res.data);\r\n\r\n      // 5Ô∏è‚É£ Success handling\r\n      if (res.data?.success) {\r\n        setStatus('success');\r\n        setMessage('Face registered successfully! You can now mark attendance.');\r\n        setFaceRegistered(true);\r\n\r\n        setRegistrationName('');\r\n        setRegistrationId('');\r\n        setConsentGiven(false);\r\n\r\n        setTimeout(() => {\r\n          stopCamera();\r\n          setCapturing(false);\r\n          setMode('attendance');\r\n        }, 3000);\r\n      } else {\r\n        throw new Error(res.data?.message || 'Face registration failed');\r\n      }\r\n    } catch (err) {\r\n      console.error('‚ùå Registration error:', err);\r\n      console.error('Error response:', err.response?.data);\r\n\r\n      setStatus('error');\r\n      setMessage(\r\n        err.response?.data?.message ||\r\n        err.message ||\r\n        'Face registration failed'\r\n      );\r\n      setCapturing(false);\r\n    }\r\n  };\r\n\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4\">\r\n        <div className=\"text-center\">\r\n          <Loader2 className=\"w-12 h-12 text-blue-400 animate-spin mx-auto mb-4\" />\r\n          <p className=\"text-white text-lg\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-8 animate-in fade-in duration-700\">\r\n      {/* Header section with glassmorphism */}\r\n      <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl p-8 rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-2xl relative overflow-hidden\">\r\n        <div className=\"absolute top-0 right-0 w-64 h-64 bg-indigo-500/5 blur-[80px] rounded-full -mr-20 -mt-20\"></div>\r\n        <div className=\"relative flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n          <div>\r\n            <div className=\"flex items-center gap-3 mb-2\">\r\n              <div className=\"p-2 rounded-xl bg-indigo-500/10 text-indigo-500\">\r\n                <Shield size={20} />\r\n              </div>\r\n              <h2 className=\"text-3xl font-black text-slate-800 dark:text-white tracking-tighter uppercase italic\">Biometric Portal</h2>\r\n            </div>\r\n            <p className=\"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.3em] ml-11\">Advanced Pulse Identity Verification</p>\r\n          </div>\r\n\r\n          <div className=\"inline-flex bg-slate-50 dark:bg-slate-950 p-1.5 rounded-2xl border border-slate-200/50 dark:border-slate-800/50\">\r\n            {faceRegistered && (\r\n              <button\r\n                onClick={() => { setMode('attendance'); setStatus(null); setMessage(''); }}\r\n                className={`flex items-center gap-2 px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all duration-500 ${mode === 'attendance'\r\n                  ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/20'\r\n                  : 'text-slate-400 hover:text-slate-600 dark:hover:text-slate-300'\r\n                  }`}\r\n              >\r\n                <CheckCircle size={14} />\r\n                Deploy\r\n              </button>\r\n            )}\r\n            <button\r\n              onClick={() => { setMode('register'); setStatus(null); setMessage(''); }}\r\n              className={`flex items-center gap-2 px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all duration-500 ${mode === 'register'\r\n                ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/20'\r\n                : 'text-slate-400 hover:text-slate-600 dark:hover:text-slate-300'\r\n                }`}\r\n            >\r\n              <UserPlus size={14} />\r\n              {faceRegistered ? 'Re-Sync' : 'Enroll'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid lg:grid-cols-5 gap-8\">\r\n        {/* Hardware Interface */}\r\n        <div className=\"lg:col-span-3 space-y-6\">\r\n          <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl p-6 rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-2xl relative\">\r\n            <div className=\"relative aspect-video bg-slate-100 dark:bg-black rounded-3xl overflow-hidden border-4 border-slate-200/50 dark:border-slate-800/50 group/vid\">\r\n              {!cameraActive ? (\r\n                <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n                  <div className=\"w-24 h-24 rounded-full bg-slate-200/50 dark:bg-slate-800/50 flex items-center justify-center mb-4 animate-pulse\">\r\n                    <Camera size={40} className=\"text-slate-400\" />\r\n                  </div>\r\n                  <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">Hardware Station Offline</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"absolute inset-0\">\r\n                  <video\r\n                    ref={videoRef}\r\n                    autoPlay\r\n                    muted\r\n                    playsInline\r\n                    className=\"w-full h-full object-cover\"\r\n                    style={{ transform: 'scaleX(-1)' }}\r\n                  />\r\n                  {/* Scanner HUD Overlay */}\r\n                  <div className=\"absolute inset-0 pointer-events-none\">\r\n                    <div className=\"absolute top-8 left-8 w-12 h-12 border-t-4 border-l-4 border-indigo-500 rounded-tl-2xl\"></div>\r\n                    <div className=\"absolute top-8 right-8 w-12 h-12 border-t-4 border-r-4 border-indigo-500 rounded-tr-2xl\"></div>\r\n                    <div className=\"absolute bottom-8 left-8 w-12 h-12 border-b-4 border-l-4 border-indigo-500 rounded-bl-2xl\"></div>\r\n                    <div className=\"absolute bottom-8 right-8 w-12 h-12 border-b-4 border-r-4 border-indigo-500 rounded-br-2xl\"></div>\r\n\r\n                    {/* Scanning Line */}\r\n                    {capturing && (\r\n                      <div className=\"absolute top-0 left-0 w-full h-1 bg-indigo-500/50 shadow-[0_0_15px_rgba(99,102,241,0.8)] animate-[scan_2s_ease-in-out_infinite]\"></div>\r\n                    )}\r\n\r\n                    <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.2)_100%)]\"></div>\r\n\r\n                    <div className=\"absolute bottom-6 left-1/2 -translate-x-1/2 px-4 py-1.5 rounded-full bg-black/40 backdrop-blur-md border border-white/10 flex items-center gap-2\">\r\n                      <div className=\"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse\"></div>\r\n                      <span className=\"text-[8px] font-black text-white uppercase tracking-widest\">Feed Active: 1080p_FHD</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              <canvas ref={canvasRef} className=\"hidden\" />\r\n            </div>\r\n\r\n            <div className=\"mt-8 grid grid-cols-2 gap-4\">\r\n              {!cameraActive ? (\r\n                <button\r\n                  onClick={startCamera}\r\n                  className=\"col-span-2 group relative overflow-hidden bg-indigo-600 hover:bg-indigo-700 text-white font-black py-5 rounded-2xl text-[10px] uppercase tracking-[0.3em] transition-all duration-500 shadow-xl shadow-indigo-600/30\"\r\n                >\r\n                  <div className=\"absolute inset-0 bg-white/10 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 ease-in-out\"></div>\r\n                  Initialize Hardware\r\n                </button>\r\n              ) : (\r\n                <>\r\n                  <button\r\n                    onClick={mode === 'attendance' ? handleAttendance : handleRegistration}\r\n                    disabled={capturing}\r\n                    className={`relative overflow-hidden group font-black py-5 rounded-2xl text-[10px] uppercase tracking-[0.3em] transition-all duration-500 disabled:opacity-50 ${capturing ? 'bg-slate-100 text-slate-400 dark:bg-slate-800' : 'bg-emerald-600 hover:bg-emerald-700 text-white shadow-xl shadow-emerald-600/20'\r\n                      }`}\r\n                  >\r\n                    {capturing ? (\r\n                      <div className=\"flex items-center justify-center gap-2\">\r\n                        <div className=\"w-3 h-3 border-2 border-slate-300 border-t-indigo-500 rounded-full animate-spin\"></div>\r\n                        Processing\r\n                      </div>\r\n                    ) : (\r\n                      'Capture Token'\r\n                    )}\r\n                  </button>\r\n                  <button\r\n                    onClick={stopCamera}\r\n                    disabled={capturing}\r\n                    className=\"bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 font-black py-5 rounded-2xl text-[10px] uppercase tracking-[0.3em] transition-all\"\r\n                  >\r\n                    Sleep System\r\n                  </button>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl p-8 rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-2xl\">\r\n            <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6 flex items-center gap-2\">\r\n              <Smartphone size={12} className=\"text-indigo-500\" />\r\n              Operational Protocol\r\n            </h4>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              {[\r\n                { title: 'Frame Alignment', desc: 'Secure facial features within the scanning HUD' },\r\n                { title: 'Luminescence', desc: 'Ensure ambient light supports biometric capture' },\r\n                { title: 'Geo-Verification', desc: 'Active GPS needed for deployment clearance' },\r\n                { title: 'Single Instance', desc: 'Only one operator allowed per session' }\r\n              ].map((item, idx) => (\r\n                <div key={idx} className=\"flex gap-4\">\r\n                  <div className=\"flex-shrink-0 w-6 h-6 rounded-lg bg-indigo-50 dark:bg-indigo-950/40 text-indigo-500 flex items-center justify-center text-[10px] font-black font-mono\">\r\n                    {idx + 1}\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-[10px] font-black text-slate-700 dark:text-slate-200 uppercase tracking-widest leading-none mb-1.5\">{item.title}</p>\r\n                    <p className=\"text-[10px] font-bold text-slate-400 leading-relaxed uppercase tracking-tight\">{item.desc}</p>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right Side Panel */}\r\n        <div className=\"lg:col-span-2 space-y-6\">\r\n\r\n          {/* Form Section */}\r\n          {mode === 'register' && (\r\n            <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl p-8 rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-2xl animate-in slide-in-from-right-4 duration-500\">\r\n              <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-6\">Credential Enrollment</h3>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-[8px] font-black text-slate-400 uppercase tracking-widest mb-2 px-1\">Full Legal Name</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={registrationName}\r\n                    onChange={(e) => setRegistrationName(e.target.value)}\r\n                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-100 dark:border-slate-800 rounded-xl px-4 py-3.5 text-xs font-bold text-slate-800 dark:text-white placeholder-slate-400 outline-none focus:ring-2 focus:ring-indigo-500/20 transition-all\"\r\n                    placeholder=\"E.g. JASON BOURNE\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-[8px] font-black text-slate-400 uppercase tracking-widest mb-2 px-1\">Operator ID</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={registrationId}\r\n                    onChange={(e) => setRegistrationId(e.target.value)}\r\n                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-100 dark:border-slate-800 rounded-xl px-4 py-3.5 text-xs font-bold text-slate-800 dark:text-white placeholder-slate-400 outline-none focus:ring-2 focus:ring-indigo-500/20 transition-all\"\r\n                    placeholder=\"EMP-XXXX\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Alert Display */}\r\n          {status && (\r\n            <div className={`p-6 rounded-[2rem] border-2 shadow-2xl animate-in zoom-in-95 duration-300 ${status === 'success'\r\n              ? 'bg-emerald-50/80 border-emerald-500/30 text-emerald-800 dark:bg-emerald-900/20 dark:border-emerald-500/20 dark:text-emerald-400'\r\n              : 'bg-rose-50/80 border-rose-500/30 text-rose-800 dark:bg-rose-900/20 dark:border-rose-500/20 dark:text-rose-400'\r\n              }`}>\r\n              <div className=\"flex gap-4\">\r\n                <div className={`p-2 rounded-xl h-fit ${status === 'success' ? 'bg-emerald-500 text-white' : 'bg-rose-500 text-white'}`}>\r\n                  {status === 'success' ? <CheckCircle size={20} /> : <AlertCircle size={20} />}\r\n                </div>\r\n                <div>\r\n                  <h5 className=\"text-[10px] font-black uppercase tracking-widest mb-1\">{status === 'success' ? 'Authorized' : 'Session Terminated'}</h5>\r\n                  <p className=\"text-xs font-bold tracking-tight uppercase leading-relaxed\">{message}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <style>{`\r\n          @keyframes scan {\r\n            0% { transform: translateY(0); opacity: 0; }\r\n            50% { opacity: 1; }\r\n            100% { transform: translateY(320px); opacity: 0; }\r\n          }\r\n       `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FaceAttendance;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Employee\\FaceAttendanceAdvanced.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":19,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":57,"suggestions":[{"messageId":"removeVar","data":{"varName":"useCallback"},"fix":{"range":[656,669],"text":""},"desc":"Remove unused variable 'useCallback'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":56,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"user"},"fix":{"range":[1884,1911],"text":""},"desc":"Remove unused variable 'user'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'location' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":62,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"location"},"fix":{"range":[2170,2178],"text":""},"desc":"Remove unused variable 'location'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'faceMeshRef' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":95,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"faceMeshRef"},"fix":{"range":[3227,3260],"text":""},"desc":"Remove unused variable 'faceMeshRef'."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ADVANCED FACE ATTENDANCE FRONTEND COMPONENT\r\n * \r\n * Features:\r\n * - Real-time face detection & quality monitoring\r\n * - Auto-capture when face is centered, stable, and good quality\r\n * - Liveness detection (blink detection, head movement)\r\n * - Multi-frame capture for liveness validation\r\n * - Progressive quality feedback (lighting, sharpness, angle)\r\n * - Secure image handling (never stores raw images)\r\n * - Mobile-optimized with responsive design\r\n * \r\n * Dependencies:\r\n * - face-api.js (TensorFlow.js) for face detection\r\n * - canvas-based image processing\r\n * - WebRTC for camera access\r\n */\r\n\r\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport {\r\n  Camera, CheckCircle, XCircle, User, UserPlus, AlertCircle,\r\n  Loader2, Navigation, LogOut, Shield, Smartphone, Eye, Move\r\n} from 'lucide-react';\r\nimport api from '../../utils/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\n// ============ CONFIGURATION ============\r\nconst FACE_DETECTION_CONFIG = {\r\n  // Face detection model\r\n  modelPath: 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.13/dist/models/',\r\n  \r\n  // Quality thresholds\r\n  QUALITY_REQUIREMENTS: {\r\n    sharpness: 40,        // Min sharpness (0-100)\r\n    brightness: 20,       // Min brightness (0-255 scale)\r\n    confidence: 85,       // Face detection confidence (%)\r\n    faceWidth: 80,        // Min face width in pixels\r\n    faceHeight: 80        // Min face height in pixels\r\n  },\r\n  \r\n  // Auto-capture settings\r\n  AUTO_CAPTURE: {\r\n    enabled: true,\r\n    stabilityFrames: 10,  // Frames must be stable before auto-capture\r\n    minFramesForLiveness: 5  // Minimum frames to detect blink/movement\r\n  },\r\n  \r\n  // Liveness settings\r\n  LIVENESS_REQUIREMENTS: {\r\n    minBlinkCount: 1,\r\n    minHeadMovement: 5    // Pixels of movement required\r\n  }\r\n};\r\n\r\nconst FaceAttendanceAdvanced = () => {\r\n  const { user } = useAuth();\r\n  \r\n  // ============ STATE MANAGEMENT ============\r\n  const [mode, setMode] = useState('attendance'); // 'attendance' or 'register'\r\n  const [cameraActive, setCameraActive] = useState(false);\r\n  const [capturing, setCapturing] = useState(false);\r\n  const [location, setLocation] = useState(null);\r\n  const [status, setStatus] = useState(null);\r\n  const [message, setMessage] = useState('');\r\n  const [faceRegistered, setFaceRegistered] = useState(false);\r\n  const [registrationName, setRegistrationName] = useState('');\r\n  const [registrationId, setRegistrationId] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  // Quality monitoring state\r\n  const [currentQuality, setCurrentQuality] = useState({\r\n    sharpness: 0,\r\n    brightness: 0,\r\n    confidence: 0,\r\n    faceDetected: false,\r\n    faceSize: { width: 0, height: 0 }\r\n  });\r\n  \r\n  // Liveness detection state\r\n  const [livenessState, setLivenessState] = useState({\r\n    frameCount: 0,\r\n    blinkDetected: false,\r\n    movementDetected: false,\r\n    stable: false\r\n  });\r\n  \r\n  // Captured frames for liveness\r\n  const [capturedFrames, setCapturedFrames] = useState([]);\r\n  \r\n  // Refs\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const streamRef = useRef(null);\r\n  const animationFrameRef = useRef(null);\r\n  const faceMeshRef = useRef(null);\r\n  const previousDetectionRef = useRef(null);\r\n  const stabilityCounterRef = useRef(0);\r\n  \r\n  // ============ LIFECYCLE ============\r\n  \r\n  /**\r\n   * Initialize on component mount\r\n   * Load face detection models asynchronously\r\n   */\r\n  useEffect(() => {\r\n    checkFaceStatus();\r\n    loadFaceDetectionModels();\r\n    \r\n    return () => {\r\n      if (streamRef.current) {\r\n        streamRef.current.getTracks().forEach(track => track.stop());\r\n      }\r\n      if (animationFrameRef.current) {\r\n        cancelAnimationFrame(animationFrameRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n  \r\n  /**\r\n   * Load TensorFlow.js face detection models\r\n   * Using face-api.js which combines multiple models\r\n   */\r\n  const loadFaceDetectionModels = async () => {\r\n    try {\r\n      console.log('üì¶ Loading face detection models...');\r\n      \r\n      // TODO: Load actual models\r\n      // const MODEL_URL = FACE_DETECTION_CONFIG.modelPath;\r\n      // await Promise.all([\r\n      //   faceapi.nets.tinyFaceDetector.load(MODEL_URL),\r\n      //   faceapi.nets.faceLandmark68Net.load(MODEL_URL),\r\n      //   faceapi.nets.faceRecognitionNet.load(MODEL_URL),\r\n      //   faceapi.nets.faceExpressionNet.load(MODEL_URL)\r\n      // ]);\r\n      \r\n      console.log('‚úÖ Models loaded successfully');\r\n    } catch (err) {\r\n      console.error('‚ùå Failed to load models:', err);\r\n      setMessage('Failed to load face detection models. Please refresh the page.');\r\n    }\r\n  };\r\n  \r\n  /**\r\n   * Check if employee has registered face\r\n   */\r\n  const checkFaceStatus = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await api.get('/attendance/face/status');\r\n      setFaceRegistered(res.data.isRegistered);\r\n      if (!res.data.isRegistered) {\r\n        setMode('register');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error checking face status:', err);\r\n      setFaceRegistered(false);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // ============ CAMERA OPERATIONS ============\r\n  \r\n  /**\r\n   * Start camera with quality monitoring\r\n   */\r\n  const startCamera = async () => {\r\n    try {\r\n      setStatus(null);\r\n      setMessage('');\r\n      setCameraActive(true);\r\n      \r\n      // Wait for DOM to render video element\r\n      await new Promise(resolve => setTimeout(resolve, 300));\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: {\r\n          facingMode: 'user',\r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 }\r\n        }\r\n      });\r\n      \r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        streamRef.current = stream;\r\n        \r\n        // Start monitoring video quality\r\n        videoRef.current.onloadedmetadata = () => {\r\n          startQualityMonitoring();\r\n        };\r\n      }\r\n    } catch (err) {\r\n      console.error('Camera error:', err);\r\n      setCameraActive(false);\r\n      setStatus('error');\r\n      \r\n      if (err.name === 'NotAllowedError') {\r\n        setMessage('Camera permission denied. Please enable camera access.');\r\n      } else if (err.name === 'NotFoundError') {\r\n        setMessage('No camera found on this device.');\r\n      } else {\r\n        setMessage('Unable to access camera: ' + err.message);\r\n      }\r\n    }\r\n  };\r\n  \r\n  /**\r\n   * Stop camera and cleanup\r\n   */\r\n  const stopCamera = () => {\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach(track => track.stop());\r\n      streamRef.current = null;\r\n    }\r\n    if (videoRef.current) {\r\n      videoRef.current.srcObject = null;\r\n    }\r\n    if (animationFrameRef.current) {\r\n      cancelAnimationFrame(animationFrameRef.current);\r\n    }\r\n    setCameraActive(false);\r\n    setCapturedFrames([]);\r\n    setLivenessState({\r\n      frameCount: 0,\r\n      blinkDetected: false,\r\n      movementDetected: false,\r\n      stable: false\r\n    });\r\n  };\r\n  \r\n  // ============ REAL-TIME QUALITY MONITORING ============\r\n  \r\n  /**\r\n   * Continuous quality monitoring loop\r\n   * Analyzes each frame and provides feedback\r\n   */\r\n  const startQualityMonitoring = () => {\r\n    const monitorFrame = async () => {\r\n      try {\r\n        if (!videoRef.current || !canvasRef.current) return;\r\n        \r\n        // Draw video to canvas\r\n        const canvas = canvasRef.current;\r\n        const ctx = canvas.getContext('2d');\r\n        canvas.width = videoRef.current.videoWidth;\r\n        canvas.height = videoRef.current.videoHeight;\r\n        \r\n        ctx.drawImage(videoRef.current, 0, 0);\r\n        \r\n        // Detect faces\r\n        // TODO: Replace with actual face-api detection\r\n        // const detections = await faceapi\r\n        //   .detectAllFaces(canvas)\r\n        //   .withFaceLandmarks()\r\n        //   .withFaceDescriptors();\r\n        \r\n        // Mock detection\r\n        const detections = [{\r\n          detection: {\r\n            box: {\r\n              x: 200,\r\n              y: 100,\r\n              width: 250,\r\n              height: 300\r\n            }\r\n          },\r\n          landmarks: []\r\n        }];\r\n        \r\n        if (detections.length === 0) {\r\n          // No face detected\r\n          setCurrentQuality(prev => ({\r\n            ...prev,\r\n            faceDetected: false\r\n          }));\r\n          setMessage('üì∏ No face detected. Position your face in the center.');\r\n        } else if (detections.length > 1) {\r\n          // Multiple faces\r\n          setMessage('‚ö†Ô∏è Multiple faces detected. Please ensure only your face is visible.');\r\n        } else {\r\n          // Single face detected\r\n          const detection = detections[0];\r\n          \r\n          // Analyze quality\r\n          const quality = analyzeFrameQuality(canvas, detection);\r\n          setCurrentQuality(quality);\r\n          \r\n          // Track liveness (blink, movement)\r\n          trackLiveness(detection);\r\n          \r\n          // Auto-capture if conditions are met\r\n          if (FACE_DETECTION_CONFIG.AUTO_CAPTURE.enabled) {\r\n            checkAutoCapture(quality);\r\n          }\r\n          \r\n          // Store frame for liveness validation\r\n          if (capturedFrames.length < FACE_DETECTION_CONFIG.AUTO_CAPTURE.minFramesForLiveness) {\r\n            const imageData = canvas.toDataURL('image/jpeg', 0.8);\r\n            setCapturedFrames(prev => [...prev, {\r\n              imageData,\r\n              detection: quality,\r\n              timestamp: new Date()\r\n            }]);\r\n          }\r\n        }\r\n        \r\n      } catch (err) {\r\n        console.error('Quality monitoring error:', err);\r\n      }\r\n      \r\n      // Continue monitoring\r\n      animationFrameRef.current = requestAnimationFrame(monitorFrame);\r\n    };\r\n    \r\n    monitorFrame();\r\n  };\r\n  \r\n  /**\r\n   * Analyze image quality from frame\r\n   * Returns quality metrics and recommendations\r\n   */\r\n  const analyzeFrameQuality = (canvas, detection) => {\r\n    // Extract face region\r\n    const box = detection.detection.box;\r\n    \r\n    // Calculate sharpness using Laplacian variance\r\n    const sharpness = calculateSharpness(canvas, box);\r\n    \r\n    // Calculate brightness\r\n    const brightness = calculateBrightness(canvas, box);\r\n    \r\n    // Calculate face size\r\n    const faceSize = {\r\n      width: box.width,\r\n      height: box.height\r\n    };\r\n    \r\n    // Check if face is properly positioned and sized\r\n    const isSuitable =\r\n      sharpness >= FACE_DETECTION_CONFIG.QUALITY_REQUIREMENTS.sharpness &&\r\n      brightness >= FACE_DETECTION_CONFIG.QUALITY_REQUIREMENTS.brightness &&\r\n      faceSize.width >= FACE_DETECTION_CONFIG.QUALITY_REQUIREMENTS.faceWidth &&\r\n      faceSize.height >= FACE_DETECTION_CONFIG.QUALITY_REQUIREMENTS.faceHeight;\r\n    \r\n    return {\r\n      sharpness,\r\n      brightness,\r\n      confidence: 92,  // Mock: should come from model\r\n      faceDetected: true,\r\n      faceSize,\r\n      suitable: isSuitable,\r\n      feedback: generateQualityFeedback(sharpness, brightness, faceSize)\r\n    };\r\n  };\r\n  \r\n  /**\r\n   * Calculate image sharpness\r\n   * Using Laplacian variance (higher = sharper)\r\n   */\r\n  const calculateSharpness = (canvas, box) => {\r\n    const ctx = canvas.getContext('2d');\r\n    const imageData = ctx.getImageData(box.x, box.y, box.width, box.height);\r\n    const data = imageData.data;\r\n    \r\n    // Apply Laplacian kernel\r\n    let variance = 0;\r\n    // Simplified calculation\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      variance += data[i];  // Simplified\r\n    }\r\n    \r\n    return Math.min(100, (variance / (data.length / 4)) / 2.55);\r\n  };\r\n  \r\n  /**\r\n   * Calculate average brightness\r\n   */\r\n  const calculateBrightness = (canvas, box) => {\r\n    const ctx = canvas.getContext('2d');\r\n    const imageData = ctx.getImageData(box.x, box.y, box.width, box.height);\r\n    const data = imageData.data;\r\n    \r\n    let sum = 0;\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      sum += (data[i] + data[i + 1] + data[i + 2]) / 3;  // Average RGB\r\n    }\r\n    \r\n    return sum / (data.length / 4);\r\n  };\r\n  \r\n  /**\r\n   * Generate user-friendly feedback based on quality\r\n   */\r\n  const generateQualityFeedback = (sharpness, brightness, faceSize) => {\r\n    const feedback = [];\r\n    \r\n    if (sharpness < FACE_DETECTION_CONFIG.QUALITY_REQUIREMENTS.sharpness) {\r\n      feedback.push('üì∑ Image is blurry. Hold steady.');\r\n    }\r\n    \r\n    if (brightness < FACE_DETECTION_CONFIG.QUALITY_REQUIREMENTS.brightness) {\r\n      feedback.push('‚òÄÔ∏è Too dark. Improve lighting.');\r\n    }\r\n    \r\n    if (faceSize.width < FACE_DETECTION_CONFIG.QUALITY_REQUIREMENTS.faceWidth) {\r\n      feedback.push('üìç Move closer to camera.');\r\n    } else if (faceSize.width > 400) {\r\n      feedback.push('üìç Move away from camera.');\r\n    }\r\n    \r\n    if (feedback.length === 0) {\r\n      feedback.push('‚úÖ Quality looks good!');\r\n    }\r\n    \r\n    return feedback;\r\n  };\r\n  \r\n  // ============ LIVENESS DETECTION ============\r\n  \r\n  /**\r\n   * Track liveness indicators\r\n   * Detects blink and head movement\r\n   */\r\n  const trackLiveness = (detection) => {\r\n    // Extract eye landmarks\r\n    const landmarks = detection.landmarks || [];\r\n    \r\n    // Calculate eye aspect ratio (EAR) for blink detection\r\n    // EAR = (||p2-p6|| + ||p3-p5||) / (2 * ||p1-p4||)\r\n    const leftEyeAR = calculateEyeAspectRatio(landmarks.slice(36, 42));\r\n    const rightEyeAR = calculateEyeAspectRatio(landmarks.slice(42, 48));\r\n    \r\n    // Blink detection (significant drop in EAR)\r\n    if (previousDetectionRef.current) {\r\n      const prevLeftEAR = previousDetectionRef.current.leftEAR;\r\n      const prevRightEAR = previousDetectionRef.current.rightEAR;\r\n      \r\n      if (\r\n        (prevLeftEAR > 0.2 && leftEyeAR < 0.1) ||\r\n        (prevRightEAR > 0.2 && rightEyeAR < 0.1)\r\n      ) {\r\n        console.log('üëÅÔ∏è Blink detected!');\r\n        setLivenessState(prev => ({\r\n          ...prev,\r\n          blinkDetected: true\r\n        }));\r\n      }\r\n    }\r\n    \r\n    // Head movement detection\r\n    if (previousDetectionRef.current) {\r\n      const movement = Math.sqrt(\r\n        Math.pow(detection.detection.box.x - previousDetectionRef.current.boxX, 2) +\r\n        Math.pow(detection.detection.box.y - previousDetectionRef.current.boxY, 2)\r\n      );\r\n      \r\n      if (movement > FACE_DETECTION_CONFIG.LIVENESS_REQUIREMENTS.minHeadMovement) {\r\n        console.log('üîÑ Head movement detected!');\r\n        setLivenessState(prev => ({\r\n          ...prev,\r\n          movementDetected: true\r\n        }));\r\n      }\r\n    }\r\n    \r\n    // Update previous detection\r\n    previousDetectionRef.current = {\r\n      leftEAR: leftEyeAR,\r\n      rightEAR: rightEyeAR,\r\n      boxX: detection.detection.box.x,\r\n      boxY: detection.detection.box.y\r\n    };\r\n    \r\n    setLivenessState(prev => ({\r\n      ...prev,\r\n      frameCount: prev.frameCount + 1\r\n    }));\r\n  };\r\n  \r\n  /**\r\n   * Calculate eye aspect ratio\r\n   */\r\n  const calculateEyeAspectRatio = (eyeLandmarks) => {\r\n    if (eyeLandmarks.length < 6) return 0;\r\n    \r\n    const p1 = eyeLandmarks[0];\r\n    const p2 = eyeLandmarks[1];\r\n    const p3 = eyeLandmarks[2];\r\n    const p4 = eyeLandmarks[3];\r\n    const p5 = eyeLandmarks[4];\r\n    const p6 = eyeLandmarks[5];\r\n    \r\n    const distance = (a, b) => Math.sqrt(\r\n      Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2)\r\n    );\r\n    \r\n    return (distance(p2, p6) + distance(p3, p5)) / (2 * distance(p1, p4));\r\n  };\r\n  \r\n  /**\r\n   * Check if conditions are met for auto-capture\r\n   */\r\n  const checkAutoCapture = (quality) => {\r\n    if (!quality.suitable) return;\r\n    \r\n    stabilityCounterRef.current += 1;\r\n    \r\n    if (stabilityCounterRef.current >= FACE_DETECTION_CONFIG.AUTO_CAPTURE.stabilityFrames) {\r\n      console.log('üéØ Auto-capturing...');\r\n      // Trigger automatic capture\r\n      if (mode === 'register') {\r\n        handleRegistration();\r\n      } else {\r\n        handleAttendance();\r\n      }\r\n      stabilityCounterRef.current = 0;\r\n    }\r\n  };\r\n  \r\n  // ============ CAPTURE OPERATIONS ============\r\n  \r\n  /**\r\n   * Capture image from video\r\n   */\r\n  const captureImage = () => {\r\n    const canvas = canvasRef.current;\r\n    const video = videoRef.current;\r\n    \r\n    if (canvas && video && video.videoWidth > 0 && video.videoHeight > 0) {\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.drawImage(video, 0, 0);\r\n      return canvas.toDataURL('image/jpeg', 0.9);\r\n    }\r\n    return null;\r\n  };\r\n  \r\n  /**\r\n   * Get current location\r\n   */\r\n  const getLocation = () => {\r\n    return new Promise((resolve, reject) => {\r\n      if (!navigator.geolocation) {\r\n        reject(new Error('Geolocation not supported'));\r\n        return;\r\n      }\r\n      \r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          const loc = {\r\n            lat: position.coords.latitude,\r\n            lng: position.coords.longitude,\r\n            accuracy: position.coords.accuracy\r\n          };\r\n          setLocation(loc);\r\n          resolve(loc);\r\n        },\r\n        (error) => reject(error),\r\n        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }\r\n      );\r\n    });\r\n  };\r\n  \r\n  /**\r\n   * Handle attendance marking\r\n   */\r\n  const handleAttendance = async () => {\r\n    if (!faceRegistered) {\r\n      setStatus('error');\r\n      setMessage('Please register your face first');\r\n      return;\r\n    }\r\n    \r\n    setCapturing(true);\r\n    setStatus(null);\r\n    setMessage('Processing attendance...');\r\n    \r\n    try {\r\n      const loc = await getLocation();\r\n      const imageData = captureImage();\r\n      \r\n      if (!imageData) {\r\n        throw new Error('Failed to capture image');\r\n      }\r\n      \r\n      // Send to backend with liveness frames\r\n      const res = await api.post('/attendance/face/verify', {\r\n        faceImageData: imageData,\r\n        liveFrames: capturedFrames,\r\n        location: {\r\n          lat: loc.lat,\r\n          lng: loc.lng,\r\n          accuracy: loc.accuracy,\r\n          timestamp: new Date().toISOString()\r\n        }\r\n      });\r\n      \r\n      if (res.data.success) {\r\n        setStatus('success');\r\n        setMessage(res.data.message);\r\n        \r\n        setTimeout(() => {\r\n          stopCamera();\r\n          setCapturing(false);\r\n        }, 3000);\r\n      }\r\n    } catch (err) {\r\n      console.error('Attendance error:', err);\r\n      setStatus('error');\r\n      const errorMsg = err.response?.data?.details || err.response?.data?.message || err.message;\r\n      setMessage(errorMsg);\r\n      setCapturing(false);\r\n    }\r\n  };\r\n  \r\n  /**\r\n   * Handle face registration\r\n   */\r\n  const handleRegistration = async () => {\r\n    if (!registrationName.trim() || !registrationId.trim()) {\r\n      setStatus('error');\r\n      setMessage('Please enter your name and employee ID');\r\n      return;\r\n    }\r\n    \r\n    setCapturing(true);\r\n    setStatus(null);\r\n    setMessage('Registering your face...');\r\n    \r\n    try {\r\n      const imageData = captureImage();\r\n      \r\n      if (!imageData) {\r\n        throw new Error('Failed to capture image');\r\n      }\r\n      \r\n      // Send to backend with liveness frames\r\n      const res = await api.post('/attendance/face/register', {\r\n        faceImageData: imageData,\r\n        liveFrames: capturedFrames,\r\n        consentGiven: true\r\n      });\r\n      \r\n      if (res.data.success) {\r\n        setStatus('success');\r\n        setMessage('Face registered successfully!');\r\n        setFaceRegistered(true);\r\n        setRegistrationName('');\r\n        setRegistrationId('');\r\n        \r\n        setTimeout(() => {\r\n          stopCamera();\r\n          setCapturing(false);\r\n          setMode('attendance');\r\n        }, 3000);\r\n      }\r\n    } catch (err) {\r\n      console.error('Registration error:', err);\r\n      setStatus('error');\r\n      const errorMsg = err.response?.data?.details || err.response?.data?.message || err.message;\r\n      setMessage(errorMsg);\r\n      setCapturing(false);\r\n    }\r\n  };\r\n  \r\n  // ============ RENDER ============\r\n  \r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <Loader2 className=\"w-12 h-12 text-blue-400 animate-spin mx-auto mb-4\" />\r\n          <p className=\"text-white text-lg\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-4 sm:p-6\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"text-center mb-8\">\r\n          <h1 className=\"text-4xl font-bold text-white mb-2\">Face Recognition Attendance</h1>\r\n          <p className=\"text-blue-200\">Advanced biometric verification system</p>\r\n        </div>\r\n        \r\n        <div className=\"grid lg:grid-cols-2 gap-8\">\r\n          {/* Camera Section */}\r\n          <div className=\"bg-slate-800/40 backdrop-blur-xl rounded-3xl p-6\">\r\n            <div className=\"aspect-video bg-slate-900/50 rounded-2xl overflow-hidden mb-6\">\r\n              {!cameraActive ? (\r\n                <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n                  <Camera className=\"w-12 h-12 text-slate-500 mb-4\" />\r\n                  <p className=\"text-slate-400\">Camera is off</p>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <video\r\n                    ref={videoRef}\r\n                    autoPlay\r\n                    muted\r\n                    playsInline\r\n                    className=\"absolute inset-0 w-full h-full object-cover\"\r\n                    style={{ transform: 'scaleX(-1)', WebkitTransform: 'scaleX(-1)' }}\r\n                  />\r\n                  {capturing && (\r\n                    <div className=\"absolute inset-0 bg-blue-500/20 flex items-center justify-center\">\r\n                      <Loader2 className=\"w-16 h-16 text-white animate-spin\" />\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n              <canvas ref={canvasRef} className=\"hidden\" />\r\n            </div>\r\n            \r\n            {/* Quality Indicators */}\r\n            {cameraActive && currentQuality.faceDetected && (\r\n              <div className=\"space-y-3 mb-6\">\r\n                <div>\r\n                  <div className=\"flex justify-between mb-1\">\r\n                    <span className=\"text-sm font-medium text-slate-300\">Sharpness</span>\r\n                    <span className=\"text-sm text-slate-400\">{Math.round(currentQuality.sharpness)}%</span>\r\n                  </div>\r\n                  <div className=\"w-full bg-slate-700 rounded-full h-2\">\r\n                    <div\r\n                      className={`h-2 rounded-full transition-all ${\r\n                        currentQuality.sharpness >= FACE_DETECTION_CONFIG.QUALITY_REQUIREMENTS.sharpness\r\n                          ? 'bg-emerald-500'\r\n                          : 'bg-orange-500'\r\n                      }`}\r\n                      style={{ width: `${currentQuality.sharpness}%` }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                \r\n                <div>\r\n                  <div className=\"flex justify-between mb-1\">\r\n                    <span className=\"text-sm font-medium text-slate-300\">Brightness</span>\r\n                    <span className=\"text-sm text-slate-400\">{Math.round(currentQuality.brightness / 2.55)}%</span>\r\n                  </div>\r\n                  <div className=\"w-full bg-slate-700 rounded-full h-2\">\r\n                    <div\r\n                      className={`h-2 rounded-full transition-all ${\r\n                        currentQuality.brightness >= FACE_DETECTION_CONFIG.QUALITY_REQUIREMENTS.brightness\r\n                          ? 'bg-emerald-500'\r\n                          : 'bg-orange-500'\r\n                      }`}\r\n                      style={{ width: `${(currentQuality.brightness / 255) * 100}%` }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Liveness Indicators */}\r\n            {cameraActive && livenessState.frameCount > 0 && (\r\n              <div className=\"mb-6 p-4 bg-slate-700/50 rounded-xl\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <Eye className=\"w-4 h-4\" />\r\n                  <span className=\"text-sm text-slate-300\">Blink: {livenessState.blinkDetected ? '‚úÖ' : '‚è≥'}</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Move className=\"w-4 h-4\" />\r\n                  <span className=\"text-sm text-slate-300\">Movement: {livenessState.movementDetected ? '‚úÖ' : '‚è≥'}</span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Feedback Message */}\r\n            {currentQuality.feedback && currentQuality.feedback.length > 0 && (\r\n              <div className=\"mb-6 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20\">\r\n                <p className=\"text-sm text-blue-300\">{currentQuality.feedback[0]}</p>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Controls */}\r\n            <div className=\"space-y-3\">\r\n              {!cameraActive ? (\r\n                <button\r\n                  onClick={startCamera}\r\n                  className=\"w-full bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold py-3 rounded-xl flex items-center justify-center gap-2\"\r\n                >\r\n                  <Camera className=\"w-5 h-5\" />\r\n                  Start Camera\r\n                </button>\r\n              ) : (\r\n                <>\r\n                  <button\r\n                    onClick={mode === 'attendance' ? handleAttendance : handleRegistration}\r\n                    disabled={capturing || (currentQuality.faceDetected && !currentQuality.suitable)}\r\n                    className=\"w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 disabled:from-slate-600 disabled:to-slate-600 text-white font-semibold py-3 rounded-xl flex items-center justify-center gap-2 disabled:cursor-not-allowed\"\r\n                  >\r\n                    {capturing ? (\r\n                      <>\r\n                        <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                        Processing...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <CheckCircle className=\"w-5 h-5\" />\r\n                        {mode === 'attendance' ? 'Capture & Mark' : 'Capture & Register'}\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                  <button\r\n                    onClick={stopCamera}\r\n                    disabled={capturing}\r\n                    className=\"w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-2 rounded-xl flex items-center justify-center gap-2\"\r\n                  >\r\n                    <LogOut className=\"w-4 h-4\" />\r\n                    Stop Camera\r\n                  </button>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Info Section */}\r\n          <div className=\"space-y-6\">\r\n            {/* Status */}\r\n            {status && (\r\n              <div className={`bg-slate-800/40 backdrop-blur-xl rounded-3xl p-6 border-2 ${\r\n                status === 'success' ? 'border-emerald-500/50' : 'border-red-500/50'\r\n              }`}>\r\n                <div className=\"flex items-start gap-4\">\r\n                  {status === 'success' ? (\r\n                    <CheckCircle className=\"w-8 h-8 text-emerald-400 flex-shrink-0\" />\r\n                  ) : (\r\n                    <XCircle className=\"w-8 h-8 text-red-400 flex-shrink-0\" />\r\n                  )}\r\n                  <div>\r\n                    <h3 className={`text-lg font-bold mb-1 ${\r\n                      status === 'success' ? 'text-emerald-400' : 'text-red-400'\r\n                    }`}>\r\n                      {status === 'success' ? 'Success!' : 'Error'}\r\n                    </h3>\r\n                    <p className=\"text-slate-300 text-sm\">{message}</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Registration Form */}\r\n            {mode === 'register' && (\r\n              <div className=\"bg-slate-800/40 backdrop-blur-xl rounded-3xl p-6\">\r\n                <h3 className=\"text-lg font-bold text-white mb-4\">Your Details</h3>\r\n                <div className=\"space-y-4\">\r\n                  <input\r\n                    type=\"text\"\r\n                    value={registrationName}\r\n                    onChange={(e) => setRegistrationName(e.target.value)}\r\n                    placeholder=\"Full Name\"\r\n                    className=\"w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    value={registrationId}\r\n                    onChange={(e) => setRegistrationId(e.target.value)}\r\n                    placeholder=\"Employee ID\"\r\n                    className=\"w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Instructions */}\r\n            <div className=\"bg-gradient-to-br from-blue-500/10 to-cyan-500/10 backdrop-blur-xl rounded-3xl p-6 border border-blue-500/20\">\r\n              <h3 className=\"text-lg font-bold text-white mb-3\">Instructions</h3>\r\n              <ul className=\"space-y-2 text-slate-300 text-sm\">\r\n                <li>‚úì Position your face in center of frame</li>\r\n                <li>‚úì Ensure adequate lighting (not too bright or dark)</li>\r\n                <li>‚úì Keep face steady and stable</li>\r\n                <li>‚úì Blink naturally (liveness check)</li>\r\n                <li>‚úì Allow location access for verification</li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FaceAttendanceAdvanced;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Employee\\InternalJobs.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token `}`. Did you mean `&rbrace;` or `{\"}\"}`?","line":154,"column":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport api from '../../utils/api';\r\nimport { Briefcase, MapPin, Users, Clock, Zap, ChevronRight, X, Check } from 'lucide-react';\r\n\r\nexport default function InternalJobs() {\r\n    const [jobs, setJobs] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [appliedJobIds, setAppliedJobIds] = useState(new Set());\r\n    const [selectedJob, setSelectedJob] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            setLoading(true);\r\n            await Promise.all([fetchInternalJobs(), fetchAppliedJobs()]);\r\n            setLoading(false);\r\n        };\r\n        loadData();\r\n    }, []);\r\n\r\n    async function fetchInternalJobs() {\r\n        try {\r\n            const res = await api.get('/requirements/internal-jobs');\r\n            setJobs(res.data);\r\n        } catch (error) {\r\n            console.error(\"Failed to load internal jobs\", error);\r\n        }\r\n    }\r\n\r\n    async function fetchAppliedJobs() {\r\n        try {\r\n            const res = await api.get('/requirements/my-applications');\r\n            const ids = new Set(res.data.map(app => app.requirementId ? app.requirementId._id : null).filter(id => id));\r\n            setAppliedJobIds(ids);\r\n        } catch (error) {\r\n            console.error(\"Failed to load applications\", error);\r\n        }\r\n    }\r\n\r\n    const handleApply = async (jobId) => {\r\n        if (!window.confirm(\"Are you sure you want to apply for this position internally? HR will be notified.\")) return;\r\n\r\n        try {\r\n            await api.post(`/requirements/internal-apply/${jobId}`);\r\n            setAppliedJobIds(prev => new Set(prev).add(jobId));\r\n            alert(\"Successfully applied! HR has been notified.\");\r\n            if (selectedJob) setSelectedJob(null);\r\n        } catch (error) {\r\n            console.error(error);\r\n            const msg = error.response?.data?.message || \"Application failed\";\r\n            alert(msg);\r\n        }\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className=\"flex flex-col items-center justify-center p-20 animate-pulse\">\r\n            <div className=\"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mb-4\"></div>\r\n            <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">Scanning Opportunities...</p>\r\n        </div>\r\n    );\r\n\r\n    const isJobApplied = (jobId) => appliedJobIds.has(jobId);\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-in fade-in duration-700\">\r\n            {/* Header section with glassmorphism */}\r\n            <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl p-8 rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-2xl relative overflow-hidden\">\r\n                <div className=\"absolute top-0 right-0 w-64 h-64 bg-indigo-500/5 blur-[80px] rounded-full -mr-20 -mt-20\"></div>\r\n                <div className=\"relative flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                    <div>\r\n                        <div className=\"flex items-center gap-3 mb-2\">\r\n                            <div className=\"p-2 rounded-xl bg-indigo-500/10 text-indigo-500\">\r\n                                <Zap size={20} />\r\n                            </div>\r\n                            <h2 className=\"text-3xl font-black text-slate-800 dark:text-white tracking-tighter uppercase italic\">Internal Career Hub</h2>\r\n                        </div>\r\n                        <p className=\"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.3em] ml-11\">Exclusive openings for Gitakshmi ecosystem</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {jobs.length === 0 ? (\r\n                <div className=\"p-20 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md rounded-[2.5rem] border-2 border-dashed border-slate-200 dark:border-slate-800 text-center\">\r\n                    <div className=\"w-20 h-20 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                        <Briefcase size={32} className=\"text-slate-300 dark:text-slate-700\" />\r\n                    </div>\r\n                    <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">No active internal recruitment streams</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                    {jobs.map(job => (\r\n                        <div\r\n                            key={job._id}\r\n                            className=\"group relative bg-white dark:bg-slate-900 rounded-[2rem] p-6 border border-slate-200/60 dark:border-slate-800/60 shadow-lg hover:shadow-2xl hover:-translate-y-1 transition-all duration-500 flex flex-col justify-between overflow-hidden\"\r\n                        >\r\n                            <div className=\"absolute top-0 right-0 w-32 h-32 bg-indigo-500/5 blur-3xl rounded-full -mr-10 -mt-10 group-hover:bg-indigo-500/20 transition-colors\"></div>\r\n                            <div className=\"relative space-y-4\">\r\n                                <div className=\"flex justify-between items-start\">\r\n                                    <div className=\"p-3 rounded-2xl bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-all duration-500 shadow-sm\">\r\n                                        <Briefcase size={18} />\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        <span className=\"font-semibold text-slate-700\">Exp:</span> {job.minExperienceMonths ? `${Math.floor(job.minExperienceMonths / 12)}Y ${job.minExperienceMonths % 12}M` : 'Fresher'}\r\n                                    <div className=\"flex flex-col items-end gap-1.5\">\r\n                                        <span className=\"bg-indigo-50/50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 text-[8px] font-black uppercase px-3 py-1 rounded-full border border-indigo-100 dark:border-indigo-800/50 tracking-widest\">\r\n                                            {job.employmentType || 'Full-Time'}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-1\">\r\n                                    <h3 className=\"text-lg font-black text-slate-800 dark:text-white uppercase tracking-tighter leading-tight group-hover:text-indigo-600 transition-colors\">\r\n                                        {job.jobTitle}\r\n                                    </h3>\r\n                                    <p className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest\">{job.department} Unit</p>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-2 gap-3 pt-2\">\r\n                                    <div className=\"flex items-center gap-2 text-slate-500 dark:text-slate-400\">\r\n                                        <MapPin size={12} className=\"text-indigo-500 group-hover:animate-bounce\" />\r\n                                        <span className=\"text-[9px] font-black uppercase tracking-tight truncate\">{job.location?.city || 'HQ'}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2 text-slate-500 dark:text-slate-400\">\r\n                                        <Clock size={12} className=\"text-indigo-500\" />\r\n                                        <span className=\"text-[9px] font-black uppercase tracking-tight\">\r\n                                            {job.minExperienceMonths ? `${(job.minExperienceMonths / 12).toFixed(1)}+ Yrs` : 'Fresher'}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-8 flex gap-3 pt-4 border-t border-slate-50 dark:border-slate-800/50 relative z-10\">\r\n                                <button\r\n                                    onClick={() => setSelectedJob(job)}\r\n                                    className=\"flex-1 px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-800 text-slate-600 dark:text-slate-400 font-black text-[9px] uppercase tracking-widest hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center gap-2 group/btn\"\r\n                                >\r\n                                    Portal View\r\n                                    <ChevronRight size={10} className=\"group-hover/btn:translate-x-1 transition-transform\" />\r\n                                </button>\r\n                                {isJobApplied(job._id) ? (\r\n                                    <div className=\"flex-1 px-4 py-3 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 rounded-xl font-black text-[9px] uppercase tracking-widest border border-emerald-100 dark:border-emerald-800/50 flex items-center justify-center gap-2\">\r\n                                        <Check size={12} />\r\n                                        Active\r\n                                    </div>\r\n                                ) : (\r\n                                    <button\r\n                                        onClick={() => handleApply(job._id)}\r\n                                        className=\"flex-1 px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-black text-[9px] uppercase tracking-widest transition-all shadow-lg shadow-indigo-600/20 active:scale-95\"\r\n                                    >\r\n                                        Deploy CV\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* JOB DETAILS MODAL */}\r\n            {selectedJob && (\r\n                <div className=\"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-md animate-in fade-in duration-300\">\r\n                    <div className=\"bg-white dark:bg-slate-900 rounded-[2.5rem] shadow-[0_0_50px_rgba(0,0,0,0.5)] w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-300 border border-white/10\">\r\n                        {/* Modal Header */}\r\n                        <div className=\"p-8 border-b border-slate-100 dark:border-slate-800 relative bg-slate-50/50 dark:bg-slate-950/50\">\r\n                            <div className=\"flex justify-between items-start mb-4\">\r\n                                <div className=\"p-3 rounded-2xl bg-indigo-600 text-white shadow-xl shadow-indigo-600/30\">\r\n                                    <Briefcase size={22} />\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => setSelectedJob(null)}\r\n                                    className=\"p-2.5 bg-white dark:bg-slate-800 shadow-sm border border-slate-200 dark:border-slate-700 rounded-xl hover:rotate-90 transition-all duration-500 text-slate-400 hover:text-rose-500\"\r\n                                >\r\n                                    <X size={20} />\r\n                                </button>\r\n                            </div>\r\n                            <h3 className=\"text-3xl font-black text-slate-900 dark:text-white tracking-tighter uppercase italic\">{selectedJob.jobTitle}</h3>\r\n                            <div className=\"flex flex-wrap items-center gap-4 mt-3\">\r\n                                <span className=\"text-[10px] font-black text-indigo-600 dark:text-indigo-400 uppercase tracking-widest\">{selectedJob.department} Division</span>\r\n                                <div className=\"w-1 h-1 rounded-full bg-slate-300\"></div>\r\n                                <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">{selectedJob.location?.city || 'Onsite HQ'}</span>\r\n                                <div className=\"w-1 h-1 rounded-full bg-slate-300\"></div>\r\n                                <span className=\"bg-emerald-500/10 text-emerald-500 text-[8px] font-black uppercase px-2 py-0.5 rounded tracking-[0.2em]\">{selectedJob.employmentType || 'FULL-TIME'}</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Scrollable Content */}\r\n                        <div className=\"flex-1 overflow-y-auto p-10 space-y-10 custom-scrollbar\">\r\n                            <section>\r\n                                <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-6 flex items-center gap-2\">\r\n                                    <div className=\"w-8 h-[1px] bg-indigo-500/50\"></div> Operational Scope\r\n                                </h4>\r\n                                <div className=\"text-sm font-bold text-slate-600 dark:text-slate-300 whitespace-pre-wrap leading-relaxed tracking-tight italic\">\r\n                                    {selectedJob.jobDescription || \"No detailed dossier available for this position.\"}\r\n                                </div>\r\n                            </section>\r\n\r\n                            <div className=\"grid md:grid-cols-2 gap-10\">\r\n                                <section>\r\n                                    <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-6 flex items-center gap-2\">\r\n                                        <div className=\"w-8 h-[1px] bg-emerald-500/50\"></div> Core Arsenal\r\n                                    </h4>\r\n                                    <div className=\"flex flex-wrap gap-2\">\r\n                                        {selectedJob.mandatorySkills?.map((skill, i) => (\r\n                                            <span key={i} className=\"px-4 py-1.5 bg-slate-50 dark:bg-slate-950 text-slate-700 dark:text-slate-300 text-[9px] font-black uppercase tracking-widest rounded-lg border border-slate-100 dark:border-slate-800\">\r\n                                                {skill}\r\n                                            </span>\r\n                                        ))}\r\n                                    </div>\r\n                                </section>\r\n                                <section>\r\n                                    <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-6 flex items-center gap-2\">\r\n                                        <div className=\"w-8 h-[1px] bg-blue-500/50\"></div> Elite Mods\r\n                                    </h4>\r\n                                    <div className=\"flex flex-wrap gap-2\">\r\n                                        {selectedJob.goodToHaveSkills?.map((skill, i) => (\r\n                                            <span key={i} className=\"px-4 py-1.5 bg-indigo-50/50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 text-[9px] font-black uppercase tracking-widest rounded-lg border border-indigo-100 dark:border-indigo-800/40 shadow-sm\">\r\n                                                {skill}\r\n                                            </span>\r\n                                        ))}\r\n                                    </div>\r\n                                </section>\r\n                            </div>\r\n\r\n                            <section className=\"bg-slate-50 dark:bg-slate-950/50 p-8 rounded-[2rem] border border-slate-100 dark:border-slate-800 mt-4\">\r\n                                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-8\">\r\n                                    {[\r\n                                        { label: 'Intelligence', value: selectedJob.minExperienceMonths ? `${(selectedJob.minExperienceMonths / 12).toFixed(1)}+ Yrs` : 'Fresher', icon: Users },\r\n                                        { label: 'Capacity', value: `${selectedJob.vacancy} Units`, icon: Users },\r\n                                        { label: 'Environment', value: selectedJob.workMode || 'Hybrid', icon: MapPin },\r\n                                        { label: 'Cycle', value: selectedJob.shift || 'Day_Delta', icon: Clock }\r\n                                    ].map((stat, i) => (\r\n                                        <div key={i} className=\"space-y-2\">\r\n                                            <p className=\"text-[8px] font-black text-slate-400 uppercase tracking-[0.2em]\">{stat.label}</p>\r\n                                            <p className=\"text-xs font-black text-slate-800 dark:text-white uppercase tracking-tighter\">{stat.value}</p>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Additional Info */}\r\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t border-slate-100 bg-slate-50/50 p-4 rounded-xl\">\r\n                                <div>\r\n                                    <p className=\"text-sm font-bold text-slate-700 mt-1\">\r\n                                        {selectedJob.minExperienceMonths ? `${Math.floor(selectedJob.minExperienceMonths / 12)} Years ${selectedJob.minExperienceMonths % 12} Months` : 'Fresher'}\r\n                                    </p>\r\n                                    ))}\r\n                                </div>\r\n                            </section>\r\n                        </div>\r\n\r\n                        {/* Modal Footer */}\r\n                        <div className=\"p-6 bg-slate-50 dark:bg-slate-950 border-t border-slate-100 dark:border-slate-800 flex justify-end gap-3\">\r\n                            <button\r\n                                onClick={() => setSelectedJob(null)}\r\n                                className=\"px-8 py-3.5 text-slate-500 dark:text-slate-400 font-black text-[10px] uppercase tracking-widest hover:bg-slate-200 dark:hover:bg-slate-800 rounded-2xl transition-all\"\r\n                            >\r\n                                Abort\r\n                            </button>\r\n                            {isJobApplied(selectedJob._id) ? (\r\n                                <button\r\n                                    disabled\r\n                                    className=\"px-10 py-3.5 bg-emerald-500 text-white font-black text-[10px] uppercase tracking-widest rounded-2xl shadow-xl shadow-emerald-500/20 flex items-center gap-2\"\r\n                                >\r\n                                    <Check size={14} />\r\n                                    Active Stream\r\n                                </button>\r\n                            ) : (\r\n                                <button\r\n                                    onClick={() => handleApply(selectedJob._id)}\r\n                                    className=\"px-10 py-3.5 bg-indigo-600 text-white font-black text-[10px] uppercase tracking-widest rounded-2xl hover:bg-indigo-700 transition-all shadow-xl shadow-indigo-600/30 active:scale-95\"\r\n                                >\r\n                                    Deploy Signature\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Employee\\MyApplications.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Global\\EntityDetail.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Global\\MyRequests.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\AccessControl.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Applicants.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Identifier 'api' has already been declared","line":10,"column":8}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport api from '../../utils/api'; // Centralized axios instance with auth & tenant headers\r\nimport { getToken } from '../../utils/token';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport OfferLetterPreview from '../../components/OfferLetterPreview';\r\nimport AssignSalaryModal from '../../components/AssignSalaryModal';\r\nimport { DatePicker, Pagination, Select, Modal, notification } from 'antd';\r\nimport { showToast, showConfirmToast } from '../../utils/uiNotifications';\r\nimport api, { API_ROOT } from '../../utils/api'; // Centralized axios instance with auth & tenant headers\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport OfferLetterPreview from '../../components/OfferLetterPreview';\r\nimport AssignSalaryModal from '../../components/AssignSalaryModal';\r\nimport { DatePicker, Pagination, Select, Modal, TimePicker, notification } from 'antd';\r\nimport { showToast, showConfirmToast } from '../../utils/uiNotifications'; // Imports fixed\r\nimport dayjs from 'dayjs';\r\nimport { Eye, Download, Edit2, RefreshCw, IndianRupee, Upload, FileText, CheckCircle, Settings, Plus, Trash2, X, GripVertical, Star, XCircle, Clock, ShieldCheck, Lock } from 'lucide-react';\r\n\r\nexport default function Applicants() {\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const [applicants, setApplicants] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const [requirements, setRequirements] = useState([]);\r\n    const [selectedRequirement, setSelectedRequirement] = useState(null); // Full requirement object\r\n    const [selectedReqId, setSelectedReqId] = useState('all');\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [timeFilter, setTimeFilter] = useState('all'); // Added Time Filter State\r\n\r\n    // Tab State: Dynamic based on Requirement Workflow\r\n    // Start with default tabs for 'all' view\r\n    const [activeTab, setActiveTab] = useState('new');\r\n    const [workflowTabs, setWorkflowTabs] = useState(['new', 'interview', 'final']);\r\n\r\n\r\n\r\n    // Workflow Editing State\r\n    const [companyHolidays, setCompanyHolidays] = useState([]);\r\n\r\n    useEffect(() => {\r\n        const fetchHolidays = async () => {\r\n            try {\r\n                const year = new Date().getFullYear();\r\n                const res = await api.get(`/holidays?year=${year}`);\r\n                if (res.data) {\r\n                    setCompanyHolidays(res.data.map(h => dayjs(h.date).format('YYYY-MM-DD')));\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to fetch holidays\", err);\r\n            }\r\n        };\r\n        fetchHolidays();\r\n    }, []);\r\n    const [showWorkflowEditModal, setShowWorkflowEditModal] = useState(false);\r\n    const [editingWorkflow, setEditingWorkflow] = useState([]);\r\n    const [newStageName, setNewStageName] = useState('');\r\n\r\n    // Selection & Review State\r\n    const [selectedApplicant, setSelectedApplicant] = useState(null);\r\n    const [selectedStatusForReview, setSelectedStatusForReview] = useState(null);\r\n    const [reviewRating, setReviewRating] = useState(0);\r\n    const [reviewFeedback, setReviewFeedback] = useState('');\r\n    const [isFinishingInterview, setIsFinishingInterview] = useState(false);\r\n\r\n\r\n    const openWorkflowEditor = () => {\r\n        if (!selectedRequirement) return;\r\n        // Ensure we have at least the basic structure if empty\r\n        const current = selectedRequirement.workflow && selectedRequirement.workflow.length > 0\r\n            ? [...selectedRequirement.workflow]\r\n            : ['Applied', 'Shortlisted', 'Interview', 'Finalized'];\r\n        setEditingWorkflow(current);\r\n        setShowWorkflowEditModal(true);\r\n    };\r\n\r\n    const handleStageAdd = () => {\r\n        if (newStageName.trim()) {\r\n            // Insert before 'Finalized' if it exists to keep logical order, or just append\r\n            const newList = [...editingWorkflow];\r\n            const finalIdx = newList.indexOf('Finalized');\r\n            if (finalIdx !== -1) {\r\n                newList.splice(finalIdx, 0, newStageName.trim());\r\n            } else {\r\n                newList.push(newStageName.trim());\r\n            }\r\n            setEditingWorkflow(newList);\r\n            setNewStageName('');\r\n        }\r\n    };\r\n\r\n    const handleStageRemove = (index) => {\r\n        const newList = [...editingWorkflow];\r\n        newList.splice(index, 1);\r\n        setEditingWorkflow(newList);\r\n    };\r\n\r\n    const saveWorkflowChanges = async () => {\r\n        if (!selectedRequirement) return;\r\n        try {\r\n            setLoading(true);\r\n            await api.put(`/requirements/${selectedRequirement._id}`, {\r\n                workflow: editingWorkflow\r\n            });\r\n\r\n            // Refresh requirements to reflect changes\r\n            const res = await api.get('/requirements');\r\n            const data = res.data.requirements || res.data || [];\r\n            setRequirements(data);\r\n\r\n            // Update current selection\r\n            const updatedReq = data.find(r => r._id === selectedRequirement._id);\r\n            setSelectedRequirement(updatedReq);\r\n\r\n            // Trigger tab recalc\r\n            // logic in useEffect will handle it based on updated selectedRequirement\r\n\r\n            setShowWorkflowEditModal(false);\r\n            showToast('success', 'Success', 'Workflow updated successfully!');\r\n        } catch (err) {\r\n            console.error(err);\r\n            showToast('error', 'Error', 'Failed to update workflow');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n\r\n    useEffect(() => {\r\n        // Fetch Requirements for dropdown\r\n        async function fetchReqs() {\r\n            try {\r\n                const res = await api.get('/requirements');\r\n                if (res.data.requirements) {\r\n                    setRequirements(res.data.requirements);\r\n                } else {\r\n                    setRequirements(res.data || []);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to load requirements\", err);\r\n            }\r\n        }\r\n        fetchReqs();\r\n    }, []);\r\n\r\n    // Handle auto-opening joining letter modal from salary assignment\r\n    useEffect(() => {\r\n        if (location.state?.openJoiningLetterFor && applicants.length > 0) {\r\n            // Find the applicant\r\n            const applicant = applicants.find(a => a._id === location.state.openJoiningLetterFor);\r\n            if (applicant) {\r\n                if (location.state.message) {\r\n                    showToast('info', 'Info', location.state.message);\r\n                }\r\n                openJoiningModal(applicant);\r\n            }\r\n            // Clear the state to prevent re-triggering\r\n            navigate('/hr/applicants', { replace: true });\r\n        }\r\n    }, [applicants, location.state]);\r\n\r\n    // Handle Requirement Selection\r\n    const handleRequirementChange = (reqId) => {\r\n        setSelectedReqId(reqId);\r\n        if (reqId === 'all') {\r\n            setSelectedRequirement(null);\r\n            // setWorkflowTabs handle by useEffect\r\n            setActiveTab('all');\r\n        } else {\r\n            const req = requirements.find(r => r._id === reqId);\r\n            setSelectedRequirement(req);\r\n\r\n            // Set default active tab\r\n            if (req && req.workflow && req.workflow.length > 0) {\r\n                setActiveTab(req.workflow[0]);\r\n            } else {\r\n                setActiveTab('Applied');\r\n            }\r\n        }\r\n    };\r\n\r\n    // Dynamic Tab Calculation (Includes Custom/Ad-hoc Stages)\r\n    useEffect(() => {\r\n        if (selectedReqId === 'all') {\r\n            setWorkflowTabs(['all', 'final']); // Removed 'new' tab\r\n            if (activeTab === 'interview') setActiveTab('all'); // specific fallback\r\n        } else if (selectedRequirement) {\r\n            let baseParams = selectedRequirement.workflow && selectedRequirement.workflow.length > 0\r\n                ? [...selectedRequirement.workflow]\r\n                : ['Applied', 'Shortlisted', 'Interview', 'Finalized'];\r\n\r\n            // Find \"Ad-hoc\" statuses from current applicants for this job\r\n            const relevantApplicants = applicants.filter(a => a.requirementId?._id === selectedReqId || a.requirementId === selectedReqId);\r\n            const foundStatuses = [...new Set(relevantApplicants.map(a => a.status))];\r\n\r\n            const extraStatuses = foundStatuses.filter(s =>\r\n                !baseParams.includes(s) &&\r\n                !['Selected', 'Rejected', 'Finalized', 'Offer Generated', 'Salary Assigned', 'Interview Scheduled', 'Interview Rescheduled', 'Interview Completed', 'New Round'].includes(s)\r\n            );\r\n\r\n            // Insert extra statuses before 'Finalized' if present, else append\r\n            const finalIndex = baseParams.indexOf('Finalized');\r\n            if (finalIndex > -1) {\r\n                baseParams.splice(finalIndex, 0, ...extraStatuses);\r\n            } else {\r\n                baseParams.push(...extraStatuses);\r\n            }\r\n\r\n            setWorkflowTabs(baseParams);\r\n        }\r\n    }, [selectedReqId, selectedRequirement, applicants]);\r\n\r\n    // Custom Stage State\r\n    const [isCustomStageModalVisible, setIsCustomStageModalVisible] = useState(false);\r\n    const [customStageName, setCustomStageName] = useState('');\r\n    const [candidateForCustomStage, setCandidateForCustomStage] = useState(null);\r\n\r\n    const handleAddCustomStage = async () => {\r\n        if (!customStageName.trim() || !candidateForCustomStage) return;\r\n\r\n        showConfirmToast({\r\n            title: 'Add Custom Stage',\r\n            description: `Update status to ${customStageName}? This will trigger an email.`,\r\n            okText: 'Yes, Update',\r\n            cancelText: 'Cancel',\r\n            onConfirm: async () => {\r\n                try {\r\n                    await updateStatus(candidateForCustomStage, customStageName);\r\n                    setIsCustomStageModalVisible(false);\r\n                    setCustomStageName('');\r\n                    setCandidateForCustomStage(null);\r\n                } catch (e) {\r\n                    console.error(e);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    // Drag and Drop Refs\r\n    const dragItem = React.useRef(null);\r\n    const dragOverItem = React.useRef(null);\r\n\r\n    const handleSort = () => {\r\n        // duplicate items\r\n        let _workflowItems = [...editingWorkflow];\r\n\r\n        // remove and save the dragged item content\r\n        const draggedItemContent = _workflowItems.splice(dragItem.current, 1)[0];\r\n\r\n        // switch the position\r\n        _workflowItems.splice(dragOverItem.current, 0, draggedItemContent);\r\n\r\n        // reset the position ref\r\n        dragItem.current = null;\r\n        dragOverItem.current = null;\r\n\r\n        // update the actual array\r\n        setEditingWorkflow(_workflowItems);\r\n    };\r\n\r\n    // Cumulative Filtering Logic: Check if a candidate's status has reached or passed a specific tab\r\n    const checkStatusPassage = (applicantStatus, targetTab, tabsArray) => {\r\n        const interviewStatuses = ['Interview Scheduled', 'Interview Rescheduled', 'Interview Completed', 'New Round'];\r\n\r\n        let normalizedApp = applicantStatus;\r\n        let normalizedTarget = targetTab;\r\n\r\n        if (['Selected', 'Rejected', 'Finalized', 'final'].includes(normalizedApp)) {\r\n            normalizedApp = tabsArray.includes('Finalized') ? 'Finalized' : (tabsArray.includes('final') ? 'final' : normalizedApp);\r\n        }\r\n        if (['Selected', 'Rejected', 'Finalized', 'final'].includes(normalizedTarget)) {\r\n            normalizedTarget = tabsArray.includes('Finalized') ? 'Finalized' : (tabsArray.includes('final') ? 'final' : normalizedTarget);\r\n        }\r\n\r\n        if (interviewStatuses.includes(normalizedApp)) {\r\n            if (tabsArray.includes('interview')) normalizedApp = 'interview';\r\n            else if (tabsArray.includes('Interview')) normalizedApp = 'Interview';\r\n            else if (tabsArray.includes('Shortlisted')) normalizedApp = 'Shortlisted';\r\n        }\r\n\r\n        if (normalizedApp === 'Applied' && tabsArray.includes('new')) normalizedApp = 'new';\r\n        if (normalizedTarget === 'Applied' && tabsArray.includes('new')) normalizedTarget = 'new';\r\n\r\n        const statusIdx = tabsArray.indexOf(normalizedApp);\r\n        const targetIdx = tabsArray.indexOf(normalizedTarget);\r\n\r\n        if (statusIdx === -1 || targetIdx === -1) {\r\n            return applicantStatus === targetTab;\r\n        }\r\n\r\n        return statusIdx >= targetIdx;\r\n    };\r\n\r\n    const getFilteredApplicants = () => {\r\n        let filtered = applicants;\r\n\r\n        // 1. Filter by Search Query\r\n        if (searchQuery) {\r\n            const query = searchQuery.toLowerCase();\r\n            filtered = filtered.filter(a =>\r\n                a.name.toLowerCase().includes(query) ||\r\n                a.email.toLowerCase().includes(query) ||\r\n                (a.mobile && a.mobile.includes(query))\r\n            );\r\n        }\r\n\r\n        // 2. Filter by Requirement ID\r\n        if (selectedReqId !== 'all') {\r\n            filtered = filtered.filter(a => a.requirementId?._id === selectedReqId || a.requirementId === selectedReqId);\r\n        }\r\n\r\n        // 3. Filter by Time Range\r\n        if (timeFilter !== 'all') {\r\n            const now = dayjs();\r\n            let startDate;\r\n            if (timeFilter === 'today') startDate = now.startOf('day');\r\n            else if (timeFilter === 'week') startDate = now.subtract(7, 'days');\r\n            else if (timeFilter === '15days') startDate = now.subtract(15, 'days');\r\n            else if (timeFilter === 'month') startDate = now.subtract(1, 'month');\r\n\r\n            if (startDate) {\r\n                filtered = filtered.filter(a => dayjs(a.createdAt).isAfter(startDate));\r\n            }\r\n        }\r\n\r\n        // 4. Filter by Active Tab (Stage)\r\n        if (selectedReqId === 'all') {\r\n            // Global Pipeline: USE EXACT/EXCLUSIVE FILTERING (User request)\r\n            if (activeTab === 'all') return filtered; // Show everyone\r\n            if (activeTab === 'new') return filtered.filter(a => a.status === 'Applied');\r\n            if (activeTab === 'interview') return filtered.filter(a => ['Shortlisted', 'Interview Scheduled', 'Interview Rescheduled', 'Interview Completed', 'New Round'].some(s => a.status.includes(s) || a.status.includes('Round')));\r\n            if (activeTab === 'final') return filtered.filter(a => ['Selected', 'Rejected', 'Finalized'].includes(a.status));\r\n            return filtered;\r\n        }\r\n\r\n        // Specific Job Workflow: USE INCLUSIVE LOGIC (Preserve history)\r\n        return filtered.filter(a => checkStatusPassage(a.status, activeTab, workflowTabs));\r\n    };\r\n\r\n    // Modal State\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [showPreview, setShowPreview] = useState(false);\r\n    const [showCandidateModal, setShowCandidateModal] = useState(false);\r\n\r\n    // File Upload State\r\n    const fileInputRef = React.useRef(null);\r\n    const [uploading, setUploading] = useState(false);\r\n\r\n    const triggerFileUpload = (applicant) => {\r\n        setSelectedApplicant(applicant);\r\n        if (fileInputRef.current) {\r\n            fileInputRef.current.value = ''; // Reset\r\n            fileInputRef.current.click();\r\n        }\r\n    };\r\n\r\n    const handleFileSelect = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file || !selectedApplicant) return;\r\n\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n\r\n        setUploading(true);\r\n        try {\r\n            await api.post(`/requirements/applicants/${selectedApplicant._id}/upload-salary-excel`, formData, {\r\n                headers: { 'Content-Type': 'multipart/form-data' }\r\n            });\r\n            showToast('success', 'Success', \"Excel uploaded successfully! Variables are now available for Letter Templates.\");\r\n            loadApplicants(); // Refresh incase we show status\r\n        } catch (error) {\r\n            console.error(error);\r\n            showToast('error', 'Error', \"Upload failed: \" + (error.response?.data?.error || error.message));\r\n        } finally {\r\n            setUploading(false);\r\n        }\r\n    };\r\n    // State moved to top\r\n    const [offerData, setOfferData] = useState({\r\n        joiningDate: '',\r\n        location: '',\r\n        templateId: '',\r\n        position: '',\r\n        probationPeriod: '3 months',\r\n        templateContent: '',\r\n        isWordTemplate: false,\r\n        refNo: '',\r\n        fatherName: '',\r\n        salutation: '',\r\n        address: '',\r\n        issueDate: dayjs().format('YYYY-MM-DD'), // Default to today\r\n        name: '',\r\n        dearName: '',\r\n        dateFormat: 'Do MMM. YYYY' // Default format\r\n    });\r\n    const [previewPdfUrl, setPreviewPdfUrl] = useState(null);\r\n\r\n    // Joining Letter State\r\n    const [showJoiningModal, setShowJoiningModal] = useState(false);\r\n    const [joiningTemplateId, setJoiningTemplateId] = useState('');\r\n    const [joiningTemplates, setJoiningTemplates] = useState([]);\r\n    const [joiningPreviewUrl, setJoiningPreviewUrl] = useState(null);\r\n    const [showJoiningPreview, setShowJoiningPreview] = useState(false);\r\n\r\n    // Salary Assignment State\r\n    const [showSalaryModal, setShowSalaryModal] = useState(false);\r\n    const [showSalaryPreview, setShowSalaryPreview] = useState(false);\r\n\r\n\r\n    // Review Modal State\r\n    const [showReviewModal, setShowReviewModal] = useState(false);\r\n    const [reviewForm, setReviewForm] = useState({ rating: 0, feedback: '', scorecard: {} });\r\n    const [showEvaluationDrawer, setShowEvaluationDrawer] = useState(false);\r\n\r\n    // Document Upload States\r\n    const [showDocumentModal, setShowDocumentModal] = useState(false);\r\n    const [documentApplicant, setDocumentApplicant] = useState(null);\r\n    const [uploadedDocuments, setUploadedDocuments] = useState([]);\r\n    const [documentName, setDocumentName] = useState('');\r\n    const [documentFile, setDocumentFile] = useState(null);\r\n    const [evalActiveRound, setEvalActiveRound] = useState(0);\r\n    const [evaluationData, setEvaluationData] = useState({\r\n        rounds: [\r\n            {\r\n                id: \"screening\",\r\n                name: \"HR Screening\",\r\n                categories: [\r\n                    {\r\n                        name: \"Communication & Professionalism\",\r\n                        skills: [\r\n                            { name: \"Verbal Communication\", rating: 0, comment: \"\" },\r\n                            { name: \"Clarity of Thought\", rating: 0, comment: \"\" },\r\n                            { name: \"Professional Attitude\", rating: 0, comment: \"\" },\r\n                        ],\r\n                    },\r\n                ],\r\n            },\r\n            {\r\n                id: \"technical\",\r\n                name: \"Technical Interview\",\r\n                categories: [\r\n                    {\r\n                        name: \"Technical Skills\",\r\n                        skills: [\r\n                            { name: \"Problem Solving\", rating: 0, comment: \"\" },\r\n                            { name: \"System Design\", rating: 0, comment: \"\" },\r\n                            { name: \"Coding Skills\", rating: 0, comment: \"\" },\r\n                        ],\r\n                    },\r\n                ],\r\n            },\r\n            {\r\n                id: \"managerial\",\r\n                name: \"Hiring Manager Round\",\r\n                categories: [\r\n                    {\r\n                        name: \"Leadership & Ownership\",\r\n                        skills: [\r\n                            { name: \"Decision Making\", rating: 0, comment: \"\" },\r\n                            { name: \"Culture Fit\", rating: 0, comment: \"\" },\r\n                        ],\r\n                    },\r\n                ],\r\n            }\r\n        ]\r\n    });\r\n\r\n    const [generating, setGenerating] = useState(false);\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const pageSize = 10;\r\n    const [templates, setTemplates] = useState([]);\r\n    const [companyInfo, setCompanyInfo] = useState({\r\n        name: 'Gitakshmi Technologies',\r\n        tagline: 'TECHNOLOGIES',\r\n        address: 'Ahmedabad, Gujarat - 380051',\r\n        phone: '+91 1234567890',\r\n        email: 'hr@gitakshmi.com',\r\n        website: 'www.gitakshmi.com',\r\n        refPrefix: 'GITK',\r\n        signatoryName: 'HR Manager',\r\n        logo: 'https://via.placeholder.com/150x60/4F46E5/FFFFFF?text=COMPANY+LOGO' // Placeholder logo\r\n    });\r\n\r\n    // Interview State\r\n    const [showInterviewModal, setShowInterviewModal] = useState(false);\r\n    const [isReschedule, setIsReschedule] = useState(false);\r\n    const [interviewData, setInterviewData] = useState({\r\n        date: '',\r\n        time: '',\r\n        mode: 'Online',\r\n        location: '',\r\n        interviewerName: '',\r\n        notes: ''\r\n    });\r\n\r\n    const openScheduleModal = (applicant, reschedule = false) => {\r\n        setSelectedApplicant(applicant);\r\n        setIsReschedule(reschedule);\r\n        // Pre-fill if rescheduling\r\n        if (reschedule && applicant.interview) {\r\n            setInterviewData({\r\n                date: applicant.interview.date ? dayjs(applicant.interview.date).format('YYYY-MM-DD') : '',\r\n                time: applicant.interview.time || '',\r\n                mode: applicant.interview.mode || 'Online',\r\n                location: applicant.interview.location || '',\r\n                interviewerName: applicant.interview.interviewerName || '',\r\n                notes: applicant.interview.notes || ''\r\n            });\r\n        } else {\r\n            setInterviewData({ date: '', time: '', mode: 'Online', location: '', interviewerName: '', notes: '' });\r\n        }\r\n        setShowInterviewModal(true);\r\n    };\r\n\r\n    const handleInterviewSubmit = async () => {\r\n        if (!interviewData.date || !interviewData.time) {\r\n            showToast('error', 'Error', \"Please select both Date and Time for the interview.\");\r\n            return;\r\n        }\r\n\r\n        // Conflict Detection Logic\r\n        const conflict = applicants.find(a =>\r\n            a._id !== selectedApplicant._id && // Not the same person\r\n            a.interview?.date &&\r\n            dayjs(a.interview.date).format('YYYY-MM-DD') === interviewData.date &&\r\n            // Compare times (assuming 'h:mm a' or standard 24h string in DB)\r\n            // We normalize both to 24h for comparison if needed, but strict string match is effective if format is consistent.\r\n            // Safe bet: Convert both to dayjs objects or just compare strings if consistent.\r\n            a.interview.time === interviewData.time\r\n        );\r\n\r\n        if (conflict) {\r\n            const confirmMsg = `Conflict Detected!\\n\\nYou have already scheduled an interview for ${conflict.name} at ${interviewData.time} on this date.\\n\\nAre you sure you want to schedule another one at the same time?`;\r\n            if (!confirm(confirmMsg)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Proceed if no conflict or user confirmed\r\n        setLoading(true);\r\n        console.log('[DEBUG] Submitting Interview:', interviewData);\r\n        try {\r\n            const url = isReschedule\r\n                ? `/requirements/applicants/${selectedApplicant._id}/interview/reschedule`\r\n                : `/requirements/applicants/${selectedApplicant._id}/interview/schedule`;\r\n\r\n            console.log('[DEBUG] Request URL:', url);\r\n            const method = isReschedule ? 'put' : 'post';\r\n\r\n            await api[method](url, { ...interviewData, stage: activeTab });\r\n\r\n            // Auto-move to next stage on initial schedule\r\n            if (!isReschedule) {\r\n                const currentIndex = workflowTabs.indexOf(activeTab);\r\n                const nextStage = workflowTabs[currentIndex + 1];\r\n                // Only move if next stage exists and is not 'Finalized' (which usually requires distinct action)\r\n                if (nextStage && nextStage !== 'Finalized') {\r\n                    // Use PATCH, not PUT, as defined in backend routes\r\n                    await api.patch(`/requirements/applicants/${selectedApplicant._id}/status`, { status: nextStage });\r\n                }\r\n            }\r\n\r\n            showToast('success', 'Success', isReschedule ? 'Interview Rescheduled Successfully!' : 'Interview Scheduled Successfully!');\r\n            setShowInterviewModal(false);\r\n            loadApplicants();\r\n        } catch (error) {\r\n            console.error(error);\r\n            showToast('error', 'Error', \"Operation failed: \" + (error.response?.data?.message || error.message));\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const markInterviewCompleted = async (applicant) => {\r\n        showConfirmToast({\r\n            title: 'Complete Interview',\r\n            description: \"Confirm interview completion? This will be logged in history.\",\r\n            okText: 'Yes, Complete',\r\n            cancelText: 'Cancel',\r\n            onConfirm: async () => {\r\n                setLoading(true);\r\n                try {\r\n                    await api.put(`/requirements/applicants/${applicant._id}/interview/complete`);\r\n                    // showToast('success', 'Success', \"Interview Marked Completed\");\r\n                    loadApplicants();\r\n                } catch (err) {\r\n                    console.error(err);\r\n                    showToast('error', 'Error', \"Error: \" + (err.response?.data?.message || err.message));\r\n                } finally {\r\n                    setLoading(false);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const updateStatus = async (applicant, status, review = null) => {\r\n        try {\r\n            const payload = { status };\r\n            if (review) {\r\n                payload.rating = review.rating;\r\n                payload.feedback = review.feedback;\r\n                payload.scorecard = review.scorecard; // Added scorecard\r\n                payload.stageName = activeTab;\r\n            }\r\n            await api.patch(`/requirements/applicants/${applicant._id}/status`, payload);\r\n            showToast('success', 'Success', `Status updated to ${status}`);\r\n            loadApplicants();\r\n            return true;\r\n        } catch (error) {\r\n            showToast('error', 'Error', \"Failed: \" + error.message);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    const handleStatusChangeRequest = (applicant, status) => {\r\n        if (status === 'custom_add') {\r\n            setCandidateForCustomStage(applicant);\r\n            setIsCustomStageModalVisible(true);\r\n            return;\r\n        }\r\n\r\n        showConfirmToast({\r\n            title: 'Update Status',\r\n            description: `Update status to ${status}? This will trigger an email.`,\r\n            okText: 'Yes, Update',\r\n            cancelText: 'Cancel',\r\n            onConfirm: async () => {\r\n                await updateStatus(applicant, status);\r\n            }\r\n        });\r\n    };\r\n\r\n    const openReviewPrompt = (applicant, status) => {\r\n        setSelectedApplicant(applicant);\r\n        setSelectedStatusForReview(status);\r\n        setReviewRating(0);\r\n        setReviewFeedback('');\r\n        setShowEvaluationDrawer(true);\r\n    };\r\n\r\n    const submitReviewAndStatus = async () => {\r\n        if (!selectedApplicant || !selectedStatusForReview) return;\r\n\r\n        setLoading(true);\r\n        try {\r\n            // 1. If finishing interview, mark it complete in DB first\r\n            if (isFinishingInterview) {\r\n                await api.put(`/requirements/applicants/${selectedApplicant._id}/interview/complete`);\r\n            }\r\n\r\n            // 2. Update status with review and full scorecard\r\n            const success = await updateStatus(selectedApplicant, selectedStatusForReview, {\r\n                rating: reviewRating,\r\n                feedback: reviewFeedback,\r\n                scorecard: evaluationData\r\n            });\r\n\r\n            if (success) {\r\n                const status = selectedStatusForReview; // Save before clear\r\n                const applicant = selectedApplicant;\r\n\r\n                setShowEvaluationDrawer(false);\r\n                setShowReviewModal(false);\r\n                setIsFinishingInterview(false);\r\n                setReviewRating(0);\r\n                setReviewFeedback('');\r\n                setSelectedStatusForReview('');\r\n                setEvalActiveRound(0);\r\n\r\n                // Trigger scheduling if appropriate\r\n                if (status === 'Shortlisted' || status.includes('Interview')) {\r\n                    openScheduleModal(applicant);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            showToast('error', 'Error', \"Failed to complete action: \" + error.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    async function loadApplicants() {\r\n        setLoading(true);\r\n        try {\r\n            // Uses centralized api instance - automatically includes Authorization & X-Tenant-ID headers\r\n            const res = await api.get('/requirements/applicants');\r\n            setApplicants(res.data || []);\r\n        } catch (err) {\r\n            console.error(err);\r\n            showToast('error', 'Error', 'Failed to load applicants');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    async function fetchTemplates() {\r\n        // Fetch Offer Templates\r\n        try {\r\n            const offerRes = await api.get('/letters/templates?type=offer');\r\n            setTemplates(offerRes.data || []);\r\n        } catch (err) {\r\n            console.error(\"Failed to load offer templates\", err);\r\n        }\r\n\r\n        // Fetch Joining Templates (independently)\r\n        try {\r\n            const joiningRes = await api.get('/letters/templates?type=joining');\r\n            setJoiningTemplates(joiningRes.data || []);\r\n        } catch (err) {\r\n            // Non-critical, just log\r\n            console.warn(\"Failed to load joining templates (might be empty or missing permission)\", err.message);\r\n        }\r\n    }\r\n\r\n    // Auth check for loading data\r\n    const { user } = useAuth(); // Ensure useAuth is imported if not already, or use context if available in scope.\r\n    // Wait, useAuth hook is not imported in this file. I need to add it first.\r\n\r\n    // Unified data refresh function\r\n    const refreshData = async () => {\r\n        setLoading(true);\r\n        await Promise.all([\r\n            loadApplicants(),\r\n            fetchTemplates()\r\n        ]);\r\n        setLoading(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Load data on mount if user is authenticated\r\n        // We check if user exists (context) OR if we have a token in local storage to avoid waiting for context if unnecessary\r\n        const token = getToken();\r\n        if (user || token) {\r\n            refreshData();\r\n        }\r\n    }, [user]); // Keep user as dependency to re-run if auth state changes\r\n\r\n    // ==================== DOCUMENT HELPER FUNCTIONS ====================\r\n\r\n    // Helper function to check if all documents are verified\r\n    const areAllDocumentsVerified = (applicant) => {\r\n        if (!applicant.customDocuments || applicant.customDocuments.length === 0) {\r\n            return false; // No documents uploaded, so CTC button should be disabled\r\n        }\r\n        return applicant.customDocuments.every(doc => doc.verified === true);\r\n    };\r\n\r\n    // Open document upload modal\r\n    const openDocumentModal = (applicant) => {\r\n        setDocumentApplicant(applicant);\r\n        setUploadedDocuments(applicant.customDocuments || []);\r\n        setDocumentName('');\r\n        setDocumentFile(null);\r\n        setShowDocumentModal(true);\r\n    };\r\n\r\n    // Handle document file selection\r\n    const handleDocumentFileChange = (e) => {\r\n        const file = e.target.files[0];\r\n        if (file) {\r\n            const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];\r\n            if (!allowedTypes.includes(file.type)) {\r\n                notification.error({ message: 'Error', description: 'Only PDF, JPG, and PNG files are allowed', placement: 'topRight' });\r\n                return;\r\n            }\r\n\r\n            if (file.size > 5 * 1024 * 1024) {\r\n                notification.error({ message: 'Error', description: 'File size must be less than 5MB', placement: 'topRight' });\r\n                return;\r\n            }\r\n\r\n            setDocumentFile(file);\r\n        }\r\n    };\r\n\r\n    // Add document to list\r\n    const addDocumentToList = () => {\r\n        if (!documentName.trim()) {\r\n            notification.error({ message: 'Error', description: 'Please enter document name', placement: 'topRight' });\r\n            return;\r\n        }\r\n\r\n        if (!documentFile) {\r\n            notification.error({ message: 'Error', description: 'Please select a file', placement: 'topRight' });\r\n            return;\r\n        }\r\n\r\n        const newDoc = {\r\n            name: documentName.trim(),\r\n            fileName: documentFile.name,\r\n            fileSize: documentFile.size,\r\n            fileType: documentFile.type,\r\n            file: documentFile,\r\n            verified: false,\r\n            uploadedAt: new Date()\r\n        };\r\n\r\n        setUploadedDocuments(prev => [...prev, newDoc]);\r\n        setDocumentName('');\r\n        setDocumentFile(null);\r\n\r\n        if (fileInput) fileInput.value = '';\r\n\r\n        notification.success({ message: 'Success', description: 'Document added to list', placement: 'topRight' });\r\n    };\r\n\r\n    // Remove document from list\r\n    const removeDocumentFromList = (index) => {\r\n        setUploadedDocuments(prev => prev.filter((_, idx) => idx !== index));\r\n    };\r\n\r\n    // Save all documents to backend\r\n    const saveDocuments = async () => {\r\n        if (uploadedDocuments.length === 0) {\r\n            notification.error({ message: 'Error', description: 'Please add at least one document', placement: 'topRight' });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const formData = new FormData();\r\n\r\n            uploadedDocuments.forEach((doc, index) => {\r\n                if (doc.file) {\r\n                    formData.append('documents', doc.file);\r\n                    formData.append(`documentNames[${index}]`, doc.name);\r\n                }\r\n            });\r\n\r\n            await api.post(\r\n                `/requirements/applicants/${documentApplicant._id}/documents`,\r\n                formData,\r\n                {\r\n                    headers: { 'Content-Type': 'multipart/form-data' }\r\n                }\r\n            );\r\n\r\n            notification.success({ message: 'Success', description: 'Documents uploaded successfully', placement: 'topRight' });\r\n            setShowDocumentModal(false);\r\n            loadApplicants();\r\n        } catch (err) {\r\n            console.error('Document upload error:', err);\r\n            notification.error({ message: 'Error', description: err.response?.data?.message || 'Failed to upload documents', placement: 'topRight' });\r\n        }\r\n    };\r\n\r\n    // Verify a specific document\r\n    const verifyDocument = async (applicantId, documentIndex) => {\r\n        try {\r\n            await api.patch(\r\n                `/requirements/applicants/${applicantId}/documents/${documentIndex}/verify`\r\n            );\r\n\r\n            notification.success({ message: 'Success', description: 'Document verified', placement: 'topRight' });\r\n            loadApplicants();\r\n        } catch (err) {\r\n            console.error('Document verification error:', err);\r\n            notification.error({ message: 'Error', description: 'Failed to verify document', placement: 'topRight' });\r\n        }\r\n    };\r\n\r\n    // ==================== END DOCUMENT FUNCTIONS ====================\r\n\r\n    // Ensure templates are fresh when opening the modal\r\n    useEffect(() => {\r\n        if (showModal) {\r\n            fetchTemplates();\r\n        }\r\n    }, [showModal]);\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'Applied': return 'bg-blue-100 text-blue-800';\r\n            case 'Shortlisted': return 'bg-yellow-100 text-yellow-800';\r\n            case 'Selected': return 'bg-green-100 text-green-800';\r\n            case 'Rejected': return 'bg-red-100 text-red-800';\r\n            default: return 'bg-gray-100 text-gray-800';\r\n        }\r\n    };\r\n\r\n    const getStatusStyles = (status) => {\r\n        switch (status) {\r\n            case 'Applied': return 'bg-blue-50/50 text-blue-600 border-blue-100';\r\n            case 'Shortlisted': return 'bg-indigo-50/50 text-indigo-600 border-indigo-100';\r\n            case 'Interview Scheduled':\r\n            case 'Interview Rescheduled':\r\n            case 'New Round':\r\n                return 'bg-amber-50/50 text-amber-600 border-amber-100';\r\n            case 'Interview Completed': return 'bg-emerald-50/50 text-emerald-600 border-emerald-100';\r\n            case 'Selected': return 'bg-emerald-500 text-white border-emerald-600';\r\n            case 'Rejected': return 'bg-red-50/50 text-red-600 border-red-100';\r\n            default: return 'bg-slate-50/50 text-slate-600 border-slate-100';\r\n        }\r\n    };\r\n\r\n    const openOfferModal = (applicant) => {\r\n        setSelectedApplicant(applicant);\r\n\r\n        // Auto-generate a default reference number\r\n        const currentYear = new Date().getFullYear();\r\n        const randomNum = Math.floor(1000 + Math.random() * 9000);\r\n        const refNo = `${companyInfo.refPrefix || 'OFFER'}/${currentYear}/${randomNum}`;\r\n\r\n        setOfferData({\r\n            joiningDate: '',\r\n            location: applicant.workLocation || 'Ahmedabad',\r\n            templateId: '',\r\n            position: applicant.requirementId?.jobTitle || '',\r\n            probationPeriod: '3 months',\r\n            templateContent: '',\r\n            isWordTemplate: false,\r\n            refNo: refNo,\r\n            salutation: applicant.salutation || '',\r\n            address: applicant.address || '',\r\n            issueDate: dayjs().format('YYYY-MM-DD'),\r\n            name: applicant.name,\r\n            dearName: applicant.name, // Default to full name\r\n            dateFormat: 'Do MMM. YYYY'\r\n        });\r\n        setPreviewPdfUrl(null);\r\n        setShowModal(true);\r\n        setShowPreview(false);\r\n    };\r\n\r\n    const handleOfferChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setOfferData(prev => {\r\n            const updates = { ...prev, [name]: value };\r\n\r\n            // If template selected, save its content for preview\r\n            if (name === 'templateId') {\r\n                const selectedTemplate = templates.find(t => t._id === value);\r\n                if (selectedTemplate) {\r\n                    updates.templateContent = selectedTemplate.bodyContent;\r\n                    updates.isWordTemplate = (selectedTemplate.templateType === 'WORD');\r\n                    setPreviewPdfUrl(null); // Reset when template changes\r\n                }\r\n            }\r\n            return updates;\r\n        });\r\n    };\r\n\r\n    const handlePreview = async () => {\r\n        if (!offerData.joiningDate) {\r\n            notification.error({ message: 'Error', description: 'Please select a joining date first', placement: 'topRight' });\r\n            return;\r\n        }\r\n\r\n        if (offerData.isWordTemplate) {\r\n            setGenerating(true);\r\n            try {\r\n                const payload = {\r\n                    applicantId: selectedApplicant._id,\r\n                    templateId: offerData.templateId,\r\n                    joiningDate: offerData.joiningDate,\r\n                    location: offerData.location,\r\n                    address: offerData.address,\r\n                    refNo: offerData.refNo, // Pass the user-edited Ref No\r\n                    salutation: offerData.salutation,\r\n                    issueDate: offerData.issueDate,\r\n                    // issueDate: offerData.issueDate,\r\n                    name: offerData.name,\r\n                    dearName: offerData.dearName,\r\n                    dateFormat: offerData.dateFormat,\r\n                    preview: true // Tell backend this is just a preview\r\n                };\r\n\r\n                const res = await api.post('/letters/generate-offer', payload, { timeout: 30000 });\r\n\r\n                if (res.data.downloadUrl) {\r\n                    const url = `${API_ROOT}${res.data.downloadUrl}`;\r\n                    setPreviewPdfUrl(url);\r\n                    setShowPreview(true);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Preview generation failed\", err);\r\n                const msg = err.response?.data?.message || err.message || \"Failed to generate preview\";\r\n\r\n                if (err.response?.status === 404 && !err.response?.data?.message) {\r\n                    notification.error({ message: 'Error', description: `Preview failed: Server endpoint not found (404). Please ensure the backend server is running and the route '/api/letters/generate-offer' exists.`, placement: 'topRight' });\r\n                } else {\r\n                    notification.error({ message: 'Error', description: `Preview failed: ${msg}`, placement: 'topRight' });\r\n                }\r\n            } finally {\r\n                setGenerating(false);\r\n            }\r\n        } else {\r\n            setShowPreview(true);\r\n        }\r\n    };\r\n\r\n    const submitOffer = async (e) => {\r\n        if (e) e.preventDefault();\r\n        if (!selectedApplicant) return;\r\n\r\n        // Open window immediately to bypass popup blockers\r\n        const newWindow = window.open('', '_blank');\r\n        if (newWindow) {\r\n            newWindow.document.write('<html><body style=\"display:flex;justify-content:center;align-items:center;height:100vh;font-family:system-ui,sans-serif;\"><div style=\"text-align:center;\"><h3>Generating Offer Letter...</h3><p>Please wait, do not close this window.</p></div></body></html>');\r\n        }\r\n\r\n        setGenerating(true);\r\n        try {\r\n            // Use unified letter generation endpoint\r\n            const payload = {\r\n                applicantId: selectedApplicant._id,\r\n                templateId: offerData.templateId,\r\n                joiningDate: offerData.joiningDate,\r\n                location: offerData.location,\r\n                address: offerData.address,\r\n                refNo: offerData.refNo, // Pass user-edited Ref No\r\n                salutation: offerData.salutation,\r\n                issueDate: offerData.issueDate,\r\n                name: offerData.name,\r\n                dearName: offerData.dearName,\r\n                dateFormat: offerData.dateFormat,\r\n                // Pass other fields if needed for specific templates\r\n            };\r\n\r\n            const res = await api.post('/letters/generate-offer', payload, { timeout: 30000 });\r\n\r\n            if (res.data.downloadUrl) {\r\n                const url = `${API_ROOT}${res.data.downloadUrl}`;\r\n\r\n                if (newWindow) {\r\n                    newWindow.location.href = url;\r\n                } else {\r\n                    // Fallback if reference lost\r\n                    window.open(url, '_blank');\r\n                }\r\n\r\n                setShowModal(false);\r\n                setShowPreview(false); // Close preview if open\r\n                loadApplicants(); // Refresh to show status change\r\n                notification.success({ message: 'Success', description: 'Offer Letter Generated Successfully', placement: 'topRight' });\r\n            } else {\r\n                if (newWindow) newWindow.close();\r\n                notification.warning({ message: 'Warning', description: 'Offer generated but no download URL returned', placement: 'topRight' });\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n            if (newWindow) {\r\n                newWindow.close();\r\n            }\r\n            notification.error({ message: 'Error', description: err.response?.data?.message || 'Failed to generate offer letter', placement: 'topRight' });\r\n        } finally {\r\n            setGenerating(false);\r\n        }\r\n    };\r\n\r\n    const downloadOffer = (filePath) => {\r\n        // Handle both cases: just filename or full path\r\n        let cleanPath = filePath;\r\n        if (filePath && filePath.includes('/')) {\r\n            // If path contains slashes, extract just the filename\r\n            cleanPath = filePath.split('/').pop();\r\n        }\r\n        const url = `${API_ROOT}/uploads/offers/${cleanPath}`;\r\n        window.open(url, '_blank');\r\n    };\r\n\r\n    const viewOfferLetter = (filePath) => {\r\n        // Handle both cases: just filename or full path\r\n        let cleanPath = filePath;\r\n        if (filePath && filePath.includes('/')) {\r\n            // If path contains slashes, extract just the filename\r\n            cleanPath = filePath.split('/').pop();\r\n        }\r\n        const url = `${API_ROOT}/uploads/offers/${cleanPath}`;\r\n        window.open(url, '_blank');\r\n    };\r\n\r\n    const viewJoiningLetter = async (applicantId) => {\r\n        try {\r\n            const response = await api.get(`/requirements/joining-letter/${applicantId}/preview`);\r\n            if (response.data.downloadUrl) {\r\n                const url = `${API_ROOT}${response.data.downloadUrl}`;\r\n                window.open(url, '_blank');\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to view joining letter:', err);\r\n            notification.error({ message: 'Error', description: 'Failed to view joining letter', placement: 'topRight' });\r\n        }\r\n    };\r\n\r\n    const downloadJoiningLetter = async (applicantId) => {\r\n        try {\r\n            const response = await api.get(`/requirements/joining-letter/${applicantId}/download`);\r\n            if (response.data.downloadUrl) {\r\n                const url = `${API_ROOT}${response.data.downloadUrl}`;\r\n                const link = document.createElement('a');\r\n                link.href = url;\r\n                link.download = `Joining_Letter_${applicantId}.pdf`;\r\n                document.body.appendChild(link);\r\n                link.click();\r\n                document.body.removeChild(link);\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to download joining letter:', err);\r\n            notification.error({ message: 'Error', description: 'Failed to download joining letter', placement: 'topRight' });\r\n        }\r\n    };\r\n\r\n    const getResumeUrl = (filePath) => {\r\n        if (!filePath) return null;\r\n        let cleanPath = filePath;\r\n        if (filePath.includes('/') || filePath.includes('\\\\')) {\r\n            cleanPath = filePath.split(/[/\\\\]/).pop();\r\n        }\r\n        return `${API_ROOT}/uploads/${cleanPath}`;\r\n    };\r\n\r\n    const viewResume = (filePath) => {\r\n        const url = getResumeUrl(filePath);\r\n        if (url) window.open(url, '_blank');\r\n    };\r\n\r\n    const downloadResume = (filePath) => {\r\n        viewResume(filePath);\r\n    };\r\n\r\n    const openCandidateModal = (applicant) => {\r\n        setSelectedApplicant(applicant);\r\n        setShowCandidateModal(true);\r\n    };\r\n\r\n    const openJoiningModal = (applicant) => {\r\n        if (!applicant.offerLetterPath) {\r\n            notification.warning({ message: 'Warning', description: \"Please generate an Offer Letter first.\", placement: 'topRight' });\r\n            return;\r\n        }\r\n        // Check if salary is assigned (either via snapshot or flat ctc field)\r\n        const isSalaryAssigned = applicant.salarySnapshotId || applicant.salarySnapshot || (applicant.ctc && applicant.ctc > 0);\r\n        if (!isSalaryAssigned) {\r\n            notification.warning({ message: 'Warning', description: \"Please assign salary before generating joining letter.\", placement: 'topRight' });\r\n            return;\r\n        }\r\n        setSelectedApplicant(applicant);\r\n        setJoiningTemplateId('');\r\n        setShowJoiningModal(true);\r\n        setJoiningPreviewUrl(null);\r\n        setShowJoiningPreview(false);\r\n    };\r\n\r\n    const openSalaryModal = (applicant) => {\r\n        navigate(`/hr/salary-structure/${applicant._id}`);\r\n    };\r\n\r\n    const openSalaryPreview = (applicant) => {\r\n        setSelectedApplicant(applicant);\r\n        setShowSalaryPreview(true);\r\n    };\r\n\r\n    const handleSalaryAssigned = () => {\r\n        loadApplicants(); // Refresh list to show updated salary status\r\n    };\r\n\r\n    const confirmSalary = async (applicant) => {\r\n        if (!confirm(\"Confirm and Lock this salary structure? This will create an immutable snapshot and enable letter generation.\")) return;\r\n        try {\r\n            setLoading(true);\r\n            await api.post('/payroll-engine/salary/confirm', {\r\n                applicantId: applicant._id,\r\n                reason: 'JOINING'\r\n            });\r\n            alert(\"‚úÖ Salary confirmed and locked!\");\r\n            loadApplicants();\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert(\"‚ùå Lock failed: \" + (err.response?.data?.message || err.message));\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleJoiningPreview = async () => {\r\n        if (!joiningTemplateId) {\r\n            notification.error({ message: 'Error', description: 'Please select a Joining Letter Template', placement: 'topRight' });\r\n            return;\r\n        }\r\n\r\n        setGenerating(true);\r\n        try {\r\n            const res = await api.post('/letters/preview-joining', {\r\n                applicantId: selectedApplicant._id,\r\n                templateId: joiningTemplateId\r\n            }, { timeout: 90000 }); // 90 second timeout for PDF conversion\r\n\r\n            if (res.data.previewUrl) {\r\n                const url = `${API_ROOT}${res.data.previewUrl}`;\r\n\r\n                setJoiningPreviewUrl(url);\r\n                setShowJoiningPreview(true);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Failed to preview joining letter\", err);\r\n\r\n            // FORCE DISPLAY OF BACKEND ERROR MESSAGE\r\n            if (err.response && err.response.data && err.response.data.message) {\r\n                alert(`SERVER ERROR: ${err.response.data.message}`);\r\n            } else {\r\n                alert(`Failed to preview joining letter: ${err.message}`);\r\n            }\r\n        } finally {\r\n            setGenerating(false);\r\n        }\r\n    };\r\n\r\n    const handleJoiningGenerate = async () => {\r\n        if (!joiningTemplateId) {\r\n            notification.error({ message: 'Error', description: 'Please select a Joining Letter Template', placement: 'topRight' });\r\n            return;\r\n        }\r\n\r\n        setGenerating(true);\r\n        try {\r\n            const res = await api.post('/letters/generate-joining', {\r\n                applicantId: selectedApplicant._id,\r\n                templateId: joiningTemplateId\r\n            });\r\n\r\n            if (res.data.downloadUrl) {\r\n                const url = `${API_ROOT}${res.data.downloadUrl}`;\r\n\r\n                // Download the PDF\r\n                const link = document.createElement('a');\r\n                link.href = url;\r\n                link.download = `Joining_Letter_${selectedApplicant._id}.pdf`;\r\n                document.body.appendChild(link);\r\n                link.click();\r\n                document.body.removeChild(link);\r\n\r\n                setShowJoiningModal(false);\r\n                setShowJoiningPreview(false);\r\n                loadApplicants();\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Failed to generate joining letter\", err);\r\n            const errorMsg = err.response?.data?.message ||\r\n                err.response?.data?.error ||\r\n                'Failed to generate joining letter';\r\n\r\n            // Check if it's a salary not assigned error\r\n            if (errorMsg.toLowerCase().includes('salary not assigned') ||\r\n                err.response?.data?.code === 'SALARY_NOT_ASSIGNED') {\r\n                notification.error({ message: 'Error', description: 'Please assign salary before generating joining letter.', placement: 'topRight' });\r\n            } else {\r\n                notification.error({ message: 'Error', description: errorMsg, placement: 'topRight' });\r\n            }\r\n        } finally {\r\n            setGenerating(false);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"space-y-6 sm:space-y-8 relative pb-20\">\r\n            {/* Premium Header Section */}\r\n            <div className=\"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6\">\r\n                <div>\r\n                    <div className=\"flex items-center gap-2 text-[10px] font-black uppercase tracking-[2px] text-slate-400 mb-2\">\r\n                        <span>Recruiting</span>\r\n                        <span className=\"opacity-30\">/</span>\r\n                        <span className=\"text-blue-600\">Applicants</span>\r\n                    </div>\r\n                    <h1 className=\"text-3xl font-black text-slate-900 tracking-tight\">Candidate Pipeline</h1>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap items-center gap-3 w-full lg:w-auto\">\r\n                    {/* Search Bar - PMG Style */}\r\n                    <div className=\"relative flex-grow lg:flex-grow-0 lg:w-64\">\r\n                        <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\">üîç</span>\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search name, email...\"\r\n                            value={searchQuery}\r\n                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                            className=\"w-full pl-9 pr-4 py-2.5 bg-white border border-slate-100 shadow-sm rounded-xl text-sm focus:ring-2 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all placeholder:text-slate-300\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"lg:w-64\">\r\n                        <select\r\n                            className=\"w-full border border-slate-100 shadow-sm rounded-xl px-4 py-2.5 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500/10 outline-none bg-white cursor-pointer\"\r\n                            value={selectedReqId}\r\n                            onChange={(e) => handleRequirementChange(e.target.value)}\r\n                        >\r\n                            <option value=\"all\">Global Pipeline</option>\r\n                            <optgroup label=\"Active Requirements\">\r\n                                {requirements.filter(r => r.status === 'Open').map(req => (\r\n                                    <option key={req._id} value={req._id}>{req.jobTitle}</option>\r\n                                ))}\r\n                            </optgroup>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div className=\"lg:w-48\">\r\n                        <select\r\n                            className=\"w-full border border-slate-100 shadow-sm rounded-xl px-4 py-2.5 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500/10 outline-none bg-white cursor-pointer\"\r\n                            value={timeFilter}\r\n                            onChange={(e) => setTimeFilter(e.target.value)}\r\n                        >\r\n                            <option value=\"all\">All Time</option>\r\n                            <option value=\"today\">Today</option>\r\n                            <option value=\"week\">This Week</option>\r\n                            <option value=\"15days\">Past 15 Days</option>\r\n                            <option value=\"month\">This Month</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-2\">\r\n                        <button\r\n                            onClick={() => notification.info({ message: 'Info', description: 'Exporting...', placement: 'topRight' })}\r\n                            className=\"flex items-center gap-2 px-4 py-2.5 bg-white text-slate-600 border border-slate-100 shadow-sm rounded-xl hover:bg-slate-50 transition font-bold text-xs uppercase tracking-wider\"\r\n                        >\r\n                            <Download size={16} />\r\n                            <span>Export</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={refreshData}\r\n                            className=\"p-2.5 bg-white text-slate-400 border border-slate-100 shadow-sm rounded-xl hover:text-blue-600 transition\"\r\n                            title=\"Refresh Data\"\r\n                        >\r\n                            <RefreshCw size={18} className={loading ? 'animate-spin' : ''} />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-[24px] border border-slate-100 shadow-[0_20px_60px_-15px_rgba(0,0,0,0.05)] overflow-hidden\">\r\n                {loading ? (\r\n                    <div className=\"p-12 text-center text-slate-500 flex flex-col items-center\">\r\n                        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-slate-500 mb-3\"></div>\r\n                        Loading applicants...\r\n                    </div>\r\n                ) : applicants.length === 0 ? (\r\n                    <div className=\"p-12 text-center text-slate-500 bg-slate-50/50\">\r\n                        <p>No applicants found.</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"overflow-x-auto\">\r\n                        <div className=\"inline-block min-w-full align-middle\">\r\n                            {/* Dynamic Tabs */}\r\n                            <div className=\"flex gap-2 mb-0 border-b border-slate-200 overflow-x-auto px-4 pt-4\">\r\n                                {workflowTabs.map(tab => {\r\n                                    // Count Logic - uses a local filtered copy for search awareness\r\n                                    let sub = applicants;\r\n                                    if (searchQuery) {\r\n                                        const query = searchQuery.toLowerCase();\r\n                                        sub = sub.filter(a => a.name.toLowerCase().includes(query) || a.email.toLowerCase().includes(query));\r\n                                    }\r\n\r\n                                    let count = sub.filter(a => {\r\n                                        // 1. Filter by Job if not \"all\"\r\n                                        if (selectedReqId !== 'all') {\r\n                                            if (!(a.requirementId?._id === selectedReqId || a.requirementId === selectedReqId)) return false;\r\n                                        }\r\n\r\n                                        // Time Filtering for counts\r\n                                        if (timeFilter !== 'all') {\r\n                                            const now = dayjs();\r\n                                            let startDate;\r\n                                            if (timeFilter === 'today') startDate = now.startOf('day');\r\n                                            else if (timeFilter === 'week') startDate = now.subtract(7, 'days');\r\n                                            else if (timeFilter === '15days') startDate = now.subtract(15, 'days');\r\n                                            else if (timeFilter === 'month') startDate = now.subtract(1, 'month');\r\n                                            if (startDate && !dayjs(a.createdAt).isAfter(startDate)) return false;\r\n                                        }\r\n\r\n                                        // 2. Exact filtering for Global Pipeline\r\n                                        if (selectedReqId === 'all') {\r\n                                            if (tab === 'all') return true; // Show all count\r\n                                            if (tab === 'new') return a.status === 'Applied';\r\n                                            if (tab === 'interview') return ['Shortlisted', 'Interview Scheduled', 'Interview Rescheduled', 'Interview Completed', 'New Round'].some(s => a.status.includes(s) || a.status.includes('Round'));\r\n                                            if (tab === 'final') return ['Selected', 'Rejected', 'Finalized'].includes(a.status);\r\n                                            return false;\r\n                                        }\r\n\r\n                                        return checkStatusPassage(a.status, tab, workflowTabs);\r\n                                    }).length;\r\n\r\n                                    const label = tab === 'new' ? 'New Applications' :\r\n                                        tab === 'all' ? 'All Applicants' :\r\n                                            tab === 'interview' ? 'Interviews' :\r\n                                                tab === 'final' ? 'Finalized' : tab;\r\n\r\n                                    return (\r\n                                        <button\r\n                                            key={tab}\r\n                                            onClick={() => { setActiveTab(tab); setCurrentPage(1); }}\r\n                                            className={`pb-3 px-4 font-medium text-sm transition-colors relative whitespace-nowrap flex-shrink-0 border-b-2 ${activeTab === tab\r\n                                                ? 'text-blue-600 border-blue-600'\r\n                                                : 'text-slate-500 border-transparent hover:text-slate-700 hover:border-slate-300'\r\n                                                }`}\r\n                                        >\r\n                                            {label}\r\n                                            <span className={`ml-2 py-0.5 px-2 rounded-full text-xs ${activeTab === tab ? 'bg-blue-100 text-blue-700' : 'bg-slate-100 text-slate-600'}`}>\r\n                                                {count}\r\n                                            </span>\r\n                                        </button>\r\n                                    );\r\n\r\n                                })}\r\n\r\n                                {/* Edit Workflow Button (Only for specific job view) */}\r\n                                {selectedReqId !== 'all' && (\r\n                                    <button\r\n                                        onClick={openWorkflowEditor}\r\n                                        className=\"sticky right-0 ml-auto mb-1 flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-md transition border border-blue-200 shadow-sm z-10\"\r\n                                        title=\"Update Hiring Steps\"\r\n                                    >\r\n                                        <Settings size={14} />\r\n                                        <span>Update Hiring</span>\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"table-responsive mobile-card-hide\">\r\n                                <table className=\"w-full text-left border-collapse\">\r\n                                    <thead className=\"bg-slate-50 border-b border-slate-200 sticky top-0 z-10\">\r\n                                        <tr>\r\n                                            <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[280px]\">Candidate</th>\r\n                                            <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Role</th>\r\n                                            <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Status</th>\r\n\r\n                                            {/* Dynamic Columns */}\r\n                                            {selectedReqId !== 'all' && (\r\n                                                <>\r\n                                                    {/* Active Process Column */}\r\n                                                    {activeTab !== 'Finalized' && (\r\n                                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[220px]\">\r\n                                                            Process\r\n                                                        </th>\r\n                                                    )}\r\n\r\n                                                    {/* Finalized Columns */}\r\n                                                    {activeTab === 'Finalized' && (\r\n                                                        <>\r\n                                                            <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Outcome</th>\r\n                                                            {applicants.some(a => a.status === 'Selected') && (\r\n                                                                <>\r\n                                                                    <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Offer</th>\r\n                                                                    <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Documents</th>\r\n                                                                    <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Salary</th>\r\n                                                                    <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Joining</th>\r\n                                                                </>\r\n                                                            )\r\n                                                            }\r\n                                                        </>\r\n                                                    )}\r\n                                                </>\r\n                                            )}\r\n\r\n                                            {/* Fallback for All View */}\r\n                                            {\r\n                                                selectedReqId === 'all' && (\r\n                                                    <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Applied</th>\r\n                                                )\r\n                                            }\r\n                                        </tr >\r\n                                    </thead >\r\n                                    <tbody className=\"bg-white\">\r\n                                        {getFilteredApplicants().slice((currentPage - 1) * pageSize, currentPage * pageSize).map(app => (\r\n                                            <tr key={app._id} className=\"hover:bg-slate-50/80 transition-colors group\">\r\n                                                {/* Common Columns */}\r\n                                                <td className=\"px-6 py-4 align-top\">\r\n                                                    <div className=\"flex gap-4\">\r\n                                                        <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 text-blue-600 flex items-center justify-center font-bold text-sm shadow-sm ring-2 ring-white flex-shrink-0\">\r\n                                                            {app.name.charAt(0).toUpperCase()}\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <div className=\"font-semibold text-slate-900 leading-tight\">{app.name}</div>\r\n                                                            <div className=\"text-xs text-slate-500 mt-0.5\">{app.email}</div>\r\n                                                            <div className=\"text-[10px] text-slate-400 mt-1 flex items-center gap-2\">\r\n                                                                {app.mobile && <span>üì± {app.mobile}</span>}\r\n                                                                {app.resume && (\r\n                                                                    <button\r\n                                                                        onClick={() => viewResume(app.resume)}\r\n                                                                        className=\"text-blue-600 hover:text-blue-800 hover:underline font-medium flex items-center gap-1 bg-blue-50 px-1.5 py-0.5 rounded\"\r\n                                                                    >\r\n                                                                        <FileText size={10} /> Resume\r\n                                                                    </button>\r\n                                                                )}\r\n                                                                <button onClick={() => openCandidateModal(app)} className=\"text-slate-400 hover:text-blue-600 ml-1\" title=\"View Details\"><Eye size={12} /></button>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 align-top\">\r\n                                                    <div className=\"inline-flex items-center px-2.5 py-1 rounded-md bg-slate-100 border border-slate-200 text-xs font-medium text-slate-700\">\r\n                                                        {app.requirementId?.jobTitle || 'N/A'}\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 align-top\">\r\n                                                    <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-semibold border ${getStatusStyles(app.status)}`}>\r\n                                                        <span className=\"w-1.5 h-1.5 rounded-full bg-current\"></span>\r\n                                                        {app.status}\r\n                                                    </div>\r\n                                                    {selectedReqId !== 'all' && (\r\n                                                        <div className=\"text-[10px] text-slate-400 mt-2 pl-1\">\r\n                                                            Applied: {dayjs(app.createdAt).format('DD MMM')}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </td>\r\n\r\n                                                {/* Applied Only Date Column for All View */}\r\n                                                {selectedReqId === 'all' && (\r\n                                                    <td className=\"px-6 py-4 text-sm text-slate-600\">\r\n                                                        {dayjs(app.createdAt).format('DD MMM, YYYY')}\r\n                                                        <div className=\"text-xs text-slate-400\">{dayjs(app.createdAt).format('hh:mm A')}</div>\r\n                                                    </td>\r\n                                                )}\r\n\r\n                                                {/* Logic for 'Custom Workflow' View */}\r\n                                                {selectedReqId !== 'all' && (\r\n                                                    <>\r\n                                                        {activeTab !== 'Finalized' && activeTab !== 'final' && (\r\n                                                            <td className=\"px-6 py-4 align-top w-[250px]\">\r\n                                                                <div className=\"flex flex-col gap-3\">\r\n                                                                    {/* Interview Status Block */}\r\n                                                                    {app.interview?.date ? (\r\n                                                                        <div className={`p-3 rounded-xl border ${app.interview.completed ? 'bg-emerald-50 border-emerald-100' : 'bg-white border-blue-200 shadow-sm'}`}>\r\n                                                                            <div className=\"flex justify-between items-start mb-2\">\r\n                                                                                <div className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wider\">Interview</div>\r\n                                                                                {app.interview.completed && <CheckCircle size={14} className=\"text-emerald-500\" />}\r\n                                                                            </div>\r\n                                                                            <div className=\"text-xs font-semibold text-slate-900 flex items-center gap-2\">\r\n                                                                                <Clock size={12} className=\"text-slate-400\" />\r\n                                                                                {dayjs(app.interview.date).format('DD MMM')} ‚Ä¢ {app.interview.time}\r\n                                                                            </div>\r\n                                                                            {!app.interview.completed && (\r\n                                                                                <button\r\n                                                                                    onClick={() => markInterviewCompleted(app)}\r\n                                                                                    className=\"mt-2 w-full py-1 text-[10px] bg-emerald-100 text-emerald-700 font-bold rounded hover:bg-emerald-200 transition\"\r\n                                                                                >\r\n                                                                                    MARK COMPLETE\r\n                                                                                </button>\r\n                                                                            )}\r\n                                                                        </div>\r\n                                                                    ) : (\r\n                                                                        <button\r\n                                                                            onClick={() => openScheduleModal(app)}\r\n                                                                            className=\"flex items-center justify-center gap-2 w-full py-2 bg-white border border-dashed border-slate-300 text-slate-600 text-xs font-semibold rounded-lg hover:border-blue-500 hover:text-blue-600 transition shadow-sm\"\r\n                                                                        >\r\n                                                                            <Plus size={14} /> Schedule Interview\r\n                                                                        </button>\r\n                                                                    )}\r\n\r\n                                                                    {/* Stage Move Dropdown */}\r\n                                                                    <div className=\"relative\">\r\n                                                                        <Select\r\n                                                                            placeholder=\"Move Candidate...\"\r\n                                                                            className=\"w-full\"\r\n                                                                            size=\"middle\"\r\n                                                                            onChange={(val) => handleStatusChangeRequest(app, val)}\r\n                                                                            value={null}\r\n                                                                            style={{ width: '100%' }}\r\n                                                                        >\r\n                                                                            <Select.OptGroup label=\"Move to Stage\">\r\n                                                                                {workflowTabs.filter(t => t !== 'Finalized' && t !== app.status).map(stage => (\r\n                                                                                    <Select.Option key={stage} value={stage}>{stage}</Select.Option>\r\n                                                                                ))}\r\n                                                                            </Select.OptGroup>\r\n                                                                            <Select.Option value=\"custom_add\" className=\"text-blue-600 font-bold\">+ Add Custom Stage</Select.Option>\r\n                                                                            <Select.OptGroup label=\"Decision\">\r\n                                                                                <Select.Option value=\"Selected\" className=\"text-emerald-600 font-bold\">Hire Candidate</Select.Option>\r\n                                                                                <Select.Option value=\"Rejected\" className=\"text-red-600 font-bold\">Reject</Select.Option>\r\n                                                                            </Select.OptGroup>\r\n                                                                        </Select>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                        )}\r\n\r\n                                                        {activeTab === 'Finalized' && (\r\n                                                            <>\r\n                                                                <td className=\"px-6 py-4 align-top\">\r\n                                                                    <div className={`inline-flex px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-widest ${app.status === 'Selected' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}`}>\r\n                                                                        {app.status}\r\n                                                                    </div>\r\n                                                                </td>\r\n                                                                {applicants.some(a => a.status === 'Selected') && (\r\n                                                                    <>\r\n                                                                        <td className=\"px-6 py-4 align-top\">\r\n                                                                            {app.status === 'Selected' ? (\r\n                                                                                <div className=\"flex gap-2\">\r\n                                                                                    {app.offerLetterPath ? (\r\n                                                                                        <>\r\n                                                                                            <button onClick={() => viewOfferLetter(app.offerLetterPath)} className=\"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-blue-50 rounded transition\" title=\"View Offer\"><Eye size={16} /></button>\r\n                                                                                            <button onClick={() => downloadOffer(app.offerLetterPath)} className=\"p-1.5 text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 rounded transition\" title=\"Download Offer\"><Download size={16} /></button>\r\n                                                                                        </>\r\n                                                                                    ) : (\r\n                                                                                        <button onClick={() => openOfferModal(app)} className=\"text-xs font-medium text-blue-600 hover:underline\">Generate Offer</button>\r\n                                                                                    )}\r\n                                                                                </div>\r\n                                                                            ) : <span className=\"text-slate-300\">N/A</span>}\r\n                                                                        </td>\r\n                                                                        <td className=\"px-6 py-4 align-top\">\r\n                                                                            {app.status === 'Selected' ? (\r\n                                                                                <div className=\"flex flex-col gap-1.5\">\r\n                                                                                    {app.customDocuments && app.customDocuments.length > 0 ? (\r\n                                                                                        <>\r\n                                                                                            <div className=\"flex flex-wrap gap-1.5\">\r\n                                                                                                {app.customDocuments.map((doc, idx) => (\r\n                                                                                                    <div key={idx} className={`flex items-center gap-1 text-[10px] px-1.5 py-0.5 rounded border ${doc.verified ? 'bg-emerald-50 border-emerald-100 text-emerald-700' : 'bg-amber-50 border-amber-100 text-amber-700'}`}>\r\n                                                                                                        {doc.verified ? <CheckCircle size={10} /> : <Clock size={10} />}\r\n                                                                                                        <span className=\"truncate max-w-[80px]\">{doc.name}</span>\r\n                                                                                                        {!doc.verified && (\r\n                                                                                                            <button\r\n                                                                                                                onClick={() => verifyDocument(app._id, idx)}\r\n                                                                                                                className=\"ml-1 text-emerald-600 hover:text-emerald-700\"\r\n                                                                                                            >\r\n                                                                                                                ‚úì\r\n                                                                                                            </button>\r\n                                                                                                        )}\r\n                                                                                                    </div>\r\n                                                                                                ))}\r\n                                                                                            </div>\r\n                                                                                            <button onClick={() => openDocumentModal(app)} className=\"text-[10px] text-blue-600 font-medium hover:underline flex items-center gap-1\">+ Upload Docs</button>\r\n                                                                                        </>\r\n                                                                                    ) : (\r\n                                                                                        <button onClick={() => openDocumentModal(app)} className=\"text-[10px] text-blue-600 font-medium hover:underline flex items-center gap-1\">+ Upload Docs</button>\r\n                                                                                    )}\r\n                                                                                </div>\r\n                                                                            ) : <span className=\"text-slate-300\">N/A</span>}\r\n                                                                        </td>\r\n                                                                        <td className=\"px-6 py-4 align-top\">\r\n                                                                            {app.status === 'Selected' ? (\r\n                                                                                app.salarySnapshot?.ctc?.yearly > 0 ? (\r\n                                                                                    <div className=\"group/ctc cursor-pointer\" onClick={() => openSalaryModal(app)}>\r\n                                                                                        <div className=\"text-xs font-bold text-slate-900\">‚Çπ{(app.salarySnapshot.ctc.yearly / 100000).toFixed(2)} LPA</div>\r\n                                                                                        <div className=\"text-[10px] text-slate-400 group-hover/ctc:text-blue-500 transition-colors\">Edit Structure</div>\r\n                                                                                    </div>\r\n                                                                                ) : (\r\n                                                                                    <button\r\n                                                                                        onClick={() => openSalaryModal(app)}\r\n                                                                                        className=\"text-[10px] font-bold px-3 py-1.5 rounded-lg border transition-all text-emerald-600 bg-emerald-50 border-emerald-100 hover:bg-emerald-100 cursor-pointer\"\r\n                                                                                        title=\"Set CTC\"\r\n                                                                                    >\r\n                                                                                        SET CTC\r\n                                                                                    </button>\r\n                                                                                )\r\n                                                                            ) : <span className=\"text-slate-300\">N/A</span>}\r\n                                                                        </td>\r\n                                                                        <td className=\"px-6 py-4 align-top\">\r\n                                                                            {app.status === 'Selected' ? (\r\n                                                                                app.joiningLetterPath ? (\r\n                                                                                    <div className=\"flex gap-2\">\r\n                                                                                        <button onClick={() => viewJoiningLetter(app._id)} className=\"p-1.5 text-slate-500 hover:text-purple-600 hover:bg-purple-50 rounded transition\" title=\"View Joining\"><Eye size={16} /></button>\r\n                                                                                        <button onClick={() => downloadJoiningLetter(app._id)} className=\"p-1.5 text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 rounded transition\" title=\"Download Joining\"><Download size={16} /></button>\r\n                                                                                    </div>\r\n                                                                                ) : (\r\n                                                                                    <button onClick={() => openJoiningModal(app)} className=\"text-xs font-medium text-purple-600 hover:underline\">Generate Joining</button>\r\n                                                                                )\r\n                                                                            ) : <span className=\"text-slate-300\">N/A</span>}\r\n                                                                        </td>\r\n                                                                    </>\r\n                                                                )}\r\n                                                            </>\r\n                                                        )}\r\n                                                    </>\r\n                                                )}\r\n                                            </tr>\r\n                                        ))}\r\n                                    </tbody>\r\n                                </table >\r\n                            </div >\r\n\r\n                            {/* Mobile Card View */}\r\n                            < div className=\"mobile-card-show p-4 space-y-4\" >\r\n                                {\r\n                                    getFilteredApplicants().slice((currentPage - 1) * pageSize, currentPage * pageSize).map(app => (\r\n                                        <div key={app._id} className=\"bg-white rounded-[20px] border border-slate-100 shadow-sm p-5 space-y-4\">\r\n                                            <div className=\"flex justify-between items-start gap-3\">\r\n                                                <div className=\"flex gap-3\">\r\n                                                    <div className=\"w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-bold text-sm shadow-sm ring-2 ring-white flex-shrink-0\">\r\n                                                        {app.name.charAt(0).toUpperCase()}\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <h3 className=\"font-bold text-slate-900 text-sm leading-tight\">{app.name}</h3>\r\n                                                        <p className=\"text-[10px] text-slate-400 mt-0.5\">{app.requirementId?.jobTitle || 'N/A'}</p>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div className={`px-2.5 py-1 rounded-full text-[10px] font-bold border ${getStatusStyles(app.status)}`}>\r\n                                                    {app.status}\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"grid grid-cols-2 gap-4 py-3 border-y border-slate-50\">\r\n                                                <div>\r\n                                                    <div className=\"text-[9px] uppercase font-black text-slate-400 tracking-wider\">Contact</div>\r\n                                                    <div className=\"text-[11px] font-medium text-slate-700 truncate\">{app.email}</div>\r\n                                                    <div className=\"text-[11px] font-medium text-slate-700\">{app.mobile || '-'}</div>\r\n                                                </div>\r\n                                                <div className=\"text-right\">\r\n                                                    <div className=\"text-[9px] uppercase font-black text-slate-400 tracking-wider\">Applied On</div>\r\n                                                    <div className=\"text-[11px] font-medium text-slate-700\">{dayjs(app.createdAt).format('DD MMM, YYYY')}</div>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Mobile Process/Actions Area */}\r\n                                            <div className=\"space-y-3\">\r\n                                                {selectedReqId !== 'all' && activeTab !== 'Finalized' && (\r\n                                                    <div className=\"bg-slate-50/50 p-3 rounded-xl border border-slate-100\">\r\n                                                        {app.interview?.date ? (\r\n                                                            <div className=\"flex justify-between items-center text-xs\">\r\n                                                                <div>\r\n                                                                    <span className=\"font-black text-slate-400 uppercase text-[9px] block\">Interview</span>\r\n                                                                    <span className=\"font-bold text-slate-900\">{dayjs(app.interview.date).format('DD MMM')} ‚Ä¢ {app.interview.time}</span>\r\n                                                                </div>\r\n                                                                {!app.interview.completed ? (\r\n                                                                    <button onClick={() => markInterviewCompleted(app)} className=\"px-2 py-1 bg-emerald-500 text-white text-[10px] font-black rounded uppercase\">Complete</button>\r\n                                                                ) : <CheckCircle size={14} className=\"text-emerald-500\" />}\r\n                                                            </div>\r\n                                                        ) : (\r\n                                                            <button onClick={() => openScheduleModal(app)} className=\"w-full py-2 bg-white border border-dashed border-slate-200 text-blue-600 text-[10px] font-black rounded-lg uppercase\">Schedule Interview</button>\r\n                                                        )}\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                <div className=\"flex flex-wrap items-center gap-2\">\r\n                                                    <button onClick={() => openCandidateModal(app)} className=\"flex-1 flex items-center justify-center gap-2 py-2 bg-slate-50 text-slate-600 rounded-lg text-[10px] font-black uppercase tracking-wider\">\r\n                                                        <Eye size={14} /> Profile\r\n                                                    </button>\r\n                                                    {app.resume && (\r\n                                                        <button onClick={() => viewResume(app.resume)} className=\"flex-1 flex items-center justify-center gap-2 py-2 bg-blue-50 text-blue-600 rounded-lg text-[10px] font-black uppercase tracking-wider\">\r\n                                                            <FileText size={14} /> Resume\r\n                                                        </button>\r\n                                                    )}\r\n                                                </div>\r\n\r\n                                                {selectedReqId !== 'all' && activeTab !== 'Finalized' && (\r\n                                                    <div className=\"relative\">\r\n                                                        <Select\r\n                                                            placeholder=\"Quick Move Stage...\"\r\n                                                            className=\"w-full h-10 rounded-lg\"\r\n                                                            onChange={(val) => handleStatusChangeRequest(app, val)}\r\n                                                            value={null}\r\n                                                        >\r\n                                                            {workflowTabs.filter(t => t !== 'Finalized' && t !== app.status).map(stage => (\r\n                                                                <Select.Option key={stage} value={stage}>{stage}</Select.Option>\r\n                                                            ))}\r\n                                                            <Select.Option value=\"Selected\" className=\"text-emerald-600 font-bold\">Offer / Hire</Select.Option>\r\n                                                            <Select.Option value=\"Rejected\" className=\"text-red-600 font-bold\">Reject</Select.Option>\r\n                                                        </Select>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                }\r\n                            </div >\r\n                            <table className=\"w-full text-left border-collapse\">\r\n                                <thead className=\"bg-slate-50 border-b border-slate-200 sticky top-0 z-10\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[280px] border-r border-slate-200\">Candidate</th>\r\n                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider border-r border-slate-200\">Role</th>\r\n                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider border-r border-slate-200\">Status</th>\r\n\r\n                                        {/* Dynamic Columns */}\r\n                                        {selectedReqId !== 'all' && (\r\n                                            <>\r\n                                                {/* Active Process Columns - Split for better workflow */}\r\n                                                {activeTab !== 'Finalized' && (\r\n                                                    ['new', 'Applied'].includes(activeTab) ? (\r\n                                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[220px]\">\r\n                                                            Action\r\n                                                        </th>\r\n                                                    ) : (\r\n                                                        <>\r\n                                                            <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[240px] border-r border-slate-200\">\r\n                                                                Interview Stage\r\n                                                            </th>\r\n                                                            <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider w-[220px]\">\r\n                                                                Next Step\r\n                                                            </th>\r\n                                                        </>\r\n                                                    )\r\n                                                )}\r\n\r\n                                                {/* Finalized Columns */}\r\n                                                {activeTab === 'Finalized' && (\r\n                                                    <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider border-r border-slate-200\">Outcome</th>\r\n                                                )}\r\n                                                {activeTab === 'Finalized' && applicants.some(a => a.status === 'Selected') && (\r\n                                                    <>\r\n                                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider border-r border-slate-200\">Offer Letter</th>\r\n                                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider border-r border-slate-200\">Documents</th>\r\n                                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider border-r border-slate-200\">Salary</th>\r\n                                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Joining</th>\r\n                                                    </>\r\n                                                )}\r\n                                            </>\r\n                                        )}\r\n\r\n                                        {/* Fallback for All View */}\r\n                                        {selectedReqId === 'all' && (\r\n                                            <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Applied</th>\r\n                                        )}\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"bg-white\">\r\n                                    {getFilteredApplicants().slice((currentPage - 1) * pageSize, currentPage * pageSize).map(app => (\r\n                                        <tr key={app._id} className=\"hover:bg-slate-50/80 transition-colors group\">\r\n                                            {/* Common Columns */}\r\n                                            <td className=\"px-6 py-4 align-top border-r border-slate-100/50\">\r\n                                                <div className=\"flex gap-4\">\r\n                                                    <div className=\"w-10 h-10 rounded-full bg-slate-100 text-blue-600 flex items-center justify-center font-bold text-sm shadow-sm\">\r\n                                                        {app.name.charAt(0).toUpperCase()}\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <div className=\"font-semibold text-slate-900 leading-tight\">{app.name}</div>\r\n                                                        <div className=\"text-xs text-slate-500 mt-0.5\">{app.email}</div>\r\n                                                        <div className=\"text-[10px] text-slate-400 mt-1 flex items-center gap-2\">\r\n                                                            {app.mobile && <span>üì± {app.mobile}</span>}\r\n                                                            {app.resume && (\r\n                                                                <a href={`${API_ROOT}/${app.resume.replace(/\\\\/g, '/')}`} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 hover:text-blue-800 hover:underline font-medium flex items-center gap-1 bg-blue-50 px-1.5 py-0.5 rounded\">\r\n                                                                    <FileText size={10} /> View CV\r\n                                                                </a>\r\n                                                            )}\r\n                                                            <button onClick={() => openCandidateModal(app)} className=\"text-slate-400 hover:text-blue-600 ml-1\" title=\"View Details\"><Eye size={12} /></button>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 align-top border-r border-slate-100/50\">\r\n                                                <div className=\"inline-flex items-center px-2.5 py-1 rounded-md bg-slate-100 border border-slate-200 text-xs font-medium text-slate-700\">\r\n                                                    {app.requirementId?.jobTitle || 'N/A'}\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 align-top border-r border-slate-100/50\">\r\n                                                <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-semibold border ${app.status === 'Selected' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' :\r\n                                                    app.status === 'Rejected' ? 'bg-red-50 text-red-600 border-red-100' :\r\n                                                        app.status === 'Shortlisted' ? 'bg-purple-50 text-purple-600 border-purple-100' :\r\n                                                            'bg-slate-50 text-slate-600 border-slate-100'\r\n                                                    }`}>\r\n                                                    <span className={`w-1.5 h-1.5 rounded-full ${app.status === 'Selected' ? 'bg-emerald-500' :\r\n                                                        app.status === 'Rejected' ? 'bg-red-500' :\r\n                                                            app.status === 'Shortlisted' ? 'bg-purple-500' : 'bg-slate-400'\r\n                                                        }`}></span>\r\n                                                    {app.status}\r\n                                                </div>\r\n                                                {selectedReqId !== 'all' && (\r\n                                                    <div className=\"text-[10px] text-slate-400 mt-2 pl-1\">\r\n                                                        Applied: {dayjs(app.createdAt).format('DD MMM')}\r\n                                                    </div>\r\n                                                )}\r\n                                            </td>\r\n\r\n                                            {/* Applied Only Date Column for All View */}\r\n                                            {selectedReqId === 'all' && (\r\n                                                <td className=\"px-6 py-4 text-sm text-slate-600 border-r border-slate-100\">\r\n                                                    {dayjs(app.createdAt).format('DD MMM, YYYY')}\r\n                                                    <div className=\"text-xs text-slate-400\">{dayjs(app.createdAt).format('hh:mm A')}</div>\r\n                                                </td>\r\n                                            )}\r\n\r\n                                            {/* Logic for 'Custom Workflow' View */}\r\n                                            {selectedReqId !== 'all' && (\r\n                                                <>\r\n                                                    {/* Active Process Columns Body */}\r\n                                                    {activeTab !== 'Finalized' && (\r\n                                                        ['new', 'Applied'].includes(activeTab) ? (\r\n                                                            /* 1. New/Applied Tab - Single Action Column */\r\n                                                            <td className=\"px-6 py-4 align-top\">\r\n                                                                {app.status === 'Applied' && (\r\n                                                                    <button\r\n                                                                        onClick={() => updateStatus(app, 'Shortlisted')}\r\n                                                                        className=\"w-full py-2 bg-blue-600 text-white text-xs font-bold rounded-lg hover:bg-blue-700 transition shadow-sm\"\r\n                                                                    >\r\n                                                                        SHORTLIST CANDIDATE\r\n                                                                    </button>\r\n                                                                )}\r\n                                                                {app.status !== 'Applied' && (\r\n                                                                    <div className=\"flex items-center gap-2 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-500 text-xs font-semibold\">\r\n                                                                        <div className=\"w-1.5 h-1.5 rounded-full bg-slate-400\"></div>\r\n                                                                        {app.status}\r\n                                                                    </div>\r\n                                                                )}\r\n                                                            </td>\r\n                                                        ) : (\r\n                                                            /* 2. Shortlisted/Interview Tabs - Two Columns */\r\n                                                            <>\r\n                                                                {/* COL 1: Interview Actions */}\r\n                                                                <td className=\"px-6 py-4 align-top border-r border-slate-100/50 min-w-[200px]\">\r\n                                                                    {['Selected', 'Rejected', 'Finalized'].includes(app.status) ? (\r\n                                                                        <div className=\"flex items-center h-full pl-2\">\r\n                                                                            <span className=\"text-slate-300 text-xs font-light tracking-wide\">-</span>\r\n                                                                        </div>\r\n                                                                    ) : (\r\n                                                                        <>\r\n                                                                            {app.interview?.date ? (\r\n                                                                                <div className={`p-2.5 rounded-lg border flex flex-col gap-2 shadow-sm transition-all hover:shadow-md ${app.interview.completed ? 'bg-emerald-50/50 border-emerald-100' : 'bg-white border-slate-200'}`}>\r\n                                                                                    <div className=\"flex justify-between items-center\">\r\n                                                                                        <div className=\"flex items-center gap-1.5 text-slate-500 font-medium text-[10px] bg-slate-100 px-1.5 py-0.5 rounded\">\r\n                                                                                            <Clock size={10} />\r\n                                                                                            {dayjs(app.interview.date).format('MMM D, h:mm A')}\r\n                                                                                        </div>\r\n                                                                                        {app.interview.completed && <div className=\"text-[10px] font-bold text-emerald-600 flex items-center gap-1 bg-emerald-100 px-1.5 py-0.5 rounded-full\"><CheckCircle size={10} /> Done</div>}\r\n                                                                                    </div>\r\n\r\n\r\n                                                                                    {\r\n                                                                                        !app.interview.completed && (\r\n                                                                                            <div className=\"flex gap-2 items-center\">\r\n                                                                                                <button\r\n                                                                                                    onClick={() => markInterviewCompleted(app)}\r\n                                                                                                    className=\"flex-1 py-1.5 text-[10px] bg-emerald-600 text-white font-semibold rounded hover:bg-emerald-700 transition flex items-center justify-center gap-1\"\r\n                                                                                                >\r\n                                                                                                    <CheckCircle size={12} /> Complete\r\n                                                                                                </button>\r\n                                                                                                <button\r\n                                                                                                    onClick={() => openScheduleModal(app, true)} // Reschedule\r\n                                                                                                    className=\"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded transition\"\r\n                                                                                                    title=\"Reschedule\"\r\n                                                                                                >\r\n                                                                                                    <Edit2 size={12} />\r\n                                                                                                </button>\r\n                                                                                            </div>\r\n                                                                                        )\r\n                                                                                    }\r\n                                                                                </div >\r\n                                                                            ) : (\r\n                                                                                <button\r\n                                                                                    onClick={() => openScheduleModal(app)}\r\n                                                                                    className=\"group flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 text-slate-600 text-xs font-semibold rounded-lg hover:border-blue-400 hover:text-blue-600 hover:shadow-sm transition-all w-full justify-start\"\r\n                                                                                >\r\n                                                                                    <div className=\"w-6 h-6 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center group-hover:bg-blue-500 group-hover:text-white transition-colors\">\r\n                                                                                        <Plus size={14} />\r\n                                                                                    </div>\r\n                                                                                    <span>Schedule Interview</span>\r\n                                                                                </button>\r\n                                                                            )\r\n                                                                            }\r\n                                                                        </>\r\n                                                                    )}\r\n                                                                </td >\r\n\r\n                                                                {/* COL 2: Next Step / Decision */}\r\n                                                                < td className=\"px-6 py-4 align-top\" >\r\n                                                                    {\r\n                                                                        ['Selected', 'Rejected', 'Finalized'].includes(app.status) ? (\r\n                                                                            <div className=\"flex items-center\">\r\n                                                                                <span className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold border shadow-sm ${app.status === 'Selected' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :\r\n                                                                                    app.status === 'Rejected' ? 'bg-red-50 text-red-700 border-red-200' :\r\n                                                                                        'bg-slate-50 text-slate-600 border-slate-200'\r\n                                                                                    }`}>\r\n                                                                                    {app.status === 'Selected' && <CheckCircle size={12} strokeWidth={2.5} />}\r\n                                                                                    {app.status === 'Rejected' && <X size={12} strokeWidth={2.5} />}\r\n                                                                                    {app.status === 'Finalized' && <ShieldCheck size={12} strokeWidth={2.5} />}\r\n                                                                                    {app.status === 'Selected' ? 'HIRED' : app.status.toUpperCase()}\r\n                                                                                </span>\r\n                                                                            </div>\r\n                                                                        ) : (\r\n                                                                            <>\r\n                                                                                {(!app.interview?.date || app.interview.completed) ? (\r\n                                                                                    <div className=\"relative w-full max-w-[200px]\">\r\n                                                                                        <Select\r\n                                                                                            placeholder={app.interview?.completed ? \"Decide Next Step\" : \"Move Stage...\"}\r\n                                                                                            className=\"w-full shadow-sm rounded-md\"\r\n                                                                                            size=\"middle\"\r\n                                                                                            onChange={(val) => val === 'custom_add' ? (setCandidateForCustomStage(app), setIsCustomStageModalVisible(true)) : updateStatus(app, val)}\r\n                                                                                            value={null}\r\n                                                                                            style={{ width: '100%' }}\r\n                                                                                            bordered={false}\r\n                                                                                            dropdownStyle={{ borderRadius: '8px', padding: '4px' }}\r\n                                                                                            suffixIcon={<div className=\"bg-slate-100 p-1 rounded-md text-slate-400\"><GripVertical size={12} /></div>}\r\n                                                                                        >\r\n                                                                                            <Select.OptGroup label=\"Move to Stage\">\r\n                                                                                                {workflowTabs.filter(t => t !== 'Finalized' && t !== app.status).map(stage => (\r\n                                                                                                    <Select.Option key={stage} value={stage}>{stage}</Select.Option>\r\n                                                                                                ))}\r\n                                                                                            </Select.OptGroup>\r\n                                                                                            <Select.Option value=\"custom_add\" className=\"text-blue-600 font-bold\">+ Add Custom Stage</Select.Option>\r\n                                                                                            <Select.OptGroup label=\"Decision\">\r\n                                                                                                <Select.Option value=\"Selected\" className=\"text-emerald-600 font-bold\">Hire Candidate</Select.Option>\r\n                                                                                                <Select.Option value=\"Rejected\" className=\"text-red-600 font-bold\">Reject</Select.Option>\r\n                                                                                            </Select.OptGroup>\r\n                                                                                        </Select>\r\n                                                                                        {/* Simulate border for cleaner look with borderless select */}\r\n                                                                                        <div className=\"absolute inset-0 border border-slate-200 rounded-lg pointer-events-none hover:border-blue-400 transition-colors\"></div>\r\n                                                                                    </div>\r\n                                                                                ) : (\r\n                                                                                    <div className=\"flex items-center h-full\">\r\n                                                                                        <span className=\"text-[10px] font-medium text-slate-400 italic bg-slate-50 px-2 py-1 rounded\">\r\n                                                                                            Awaiting Result\r\n                                                                                        </span>\r\n                                                                                    </div>\r\n                                                                                )}\r\n                                                                            </>\r\n                                                                        )\r\n                                                                    }\r\n                                                                </td >\r\n                                                            </>\r\n                                                        )\r\n\r\n                                                    )}\r\n\r\n                                                    {\r\n                                                        activeTab === 'Finalized' && (\r\n                                                            <>\r\n                                                                <td className=\"px-6 py-4 align-top border-r border-slate-100\">\r\n                                                                    <div className={`inline-flex px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-widest ${app.status === 'Selected' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}`}>\r\n                                                                        {app.status}\r\n                                                                    </div>\r\n                                                                </td>\r\n                                                                {applicants.some(a => a.status === 'Selected') && (\r\n                                                                    <>\r\n                                                                        <td className=\"px-6 py-4 align-top border-r border-slate-100\">\r\n                                                                            {app.status === 'Selected' ? (\r\n                                                                                <div className=\"flex gap-2\">\r\n                                                                                    {app.offerLetterPath ? (\r\n                                                                                        <>\r\n                                                                                            <button onClick={() => viewOfferLetter(app.offerLetterPath)} className=\"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-blue-50 rounded transition\" title=\"View Offer\"><Eye size={16} /></button>\r\n                                                                                            <button onClick={() => downloadOffer(app.offerLetterPath)} className=\"p-1.5 text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 rounded transition\" title=\"Download Offer\"><Download size={16} /></button>\r\n                                                                                            <button onClick={() => openOfferModal(app)} className=\"p-1.5 text-slate-500 hover:text-amber-600 hover:bg-amber-50 rounded transition\" title=\"Edit Offer\"><Edit2 size={16} /></button>\r\n                                                                                            <button onClick={() => openOfferModal(app)} className=\"p-1.5 text-slate-500 hover:text-amber-600 hover:bg-amber-50 rounded transition\" title=\"Edit & Regenerate Offer\"><Edit2 size={16} /></button>\r\n                                                                                        </>\r\n                                                                                    ) : (\r\n                                                                                        <button onClick={() => openOfferModal(app)} className=\"text-xs font-medium text-blue-600 hover:underline\">Generate Offer</button>\r\n                                                                                    )}\r\n                                                                                </div>\r\n                                                                            ) : <span className=\"text-slate-300\">N/A</span>}\r\n                                                                        </td>\r\n                                                                        <td className=\"px-6 py-4 align-top\">\r\n                                                                            {app.status === 'Selected' ? (\r\n                                                                                <div className=\"flex flex-col gap-1.5\">\r\n                                                                                    {app.customDocuments && app.customDocuments.length > 0 ? (\r\n                                                                                        <>\r\n                                                                                            <div className=\"flex flex-wrap gap-1.5\">\r\n                                                                                                {app.customDocuments.map((doc, idx) => (\r\n                                                                                                    <div key={idx} className={`flex items-center gap-1 text-[10px] px-1.5 py-0.5 rounded border ${doc.verified ? 'bg-emerald-50 border-emerald-100 text-emerald-700' : 'bg-amber-50 border-amber-100 text-amber-700'}`}>\r\n                                                                                                        {doc.verified ? <CheckCircle size={10} /> : <Clock size={10} />}\r\n                                                                                                        <span className=\"truncate max-w-[80px]\">{doc.name}</span>\r\n                                                                                                        {!doc.verified && (\r\n                                                                                                            <button\r\n                                                                                                                onClick={() => verifyDocument(app._id, idx)}\r\n                                                                                                                className=\"ml-1 text-emerald-600 hover:text-emerald-700\"\r\n                                                                                                            >\r\n                                                                                                                ‚úì\r\n                                                                                                            </button>\r\n                                                                                                        )}\r\n                                                                                                    </div>\r\n                                                                                                ))}\r\n                                                                                            </div>\r\n                                                                                            <button onClick={() => openDocumentModal(app)} className=\"text-[10px] text-blue-600 font-medium hover:underline flex items-center gap-1\">+ Upload Docs</button>\r\n                                                                                        </>\r\n                                                                                    ) : (\r\n                                                                                        <button onClick={() => openDocumentModal(app)} className=\"text-[10px] text-blue-600 font-medium hover:underline flex items-center gap-1\">+ Upload Docs</button>\r\n                                                                                    )}\r\n                                                                                </div>\r\n                                                                            ) : <span className=\"text-slate-300\">N/A</span>}\r\n                                                                        </td>\r\n                                                                        <td className=\"px-6 py-4 align-top\">\r\n                                                                            {app.status === 'Selected' ? (\r\n                                                                                (app.salarySnapshot || app.salaryAssigned) ? (\r\n                                                                                    <div className=\"flex items-center gap-2\">\r\n                                                                                        <button\r\n                                                                                            onClick={() => { setSelectedApplicant(app); setShowSalaryPreview(true); }}\r\n                                                                                            className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-200 bg-white text-slate-700 hover:border-blue-300 hover:text-blue-600 transition shadow-sm group\"\r\n                                                                                            title=\"View Salary Breakdown\"\r\n                                                                                        >\r\n                                                                                            <Eye size={14} className=\"text-slate-400 group-hover:text-blue-500\" />\r\n                                                                                            <span className=\"text-[11px] font-bold\">View Salary</span>\r\n                                                                                        </button>\r\n                                                                                    </div>\r\n                                                                                ) : (\r\n                                                                                    <button\r\n                                                                                        onClick={() => openSalaryModal(app)}\r\n                                                                                        className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 hover:border-emerald-300 transition shadow-sm\"\r\n                                                                                        title=\"Assign Salary Structure\"\r\n                                                                                    >\r\n                                                                                        <IndianRupee size={14} />\r\n                                                                                        <span className=\"text-[11px] font-bold\">Assign Salary</span>\r\n                                                                                    </button>\r\n                                                                                )\r\n                                                                            ) : <span className=\"text-slate-300\">N/A</span>}\r\n                                                                        </td>\r\n                                                                        <td className=\"px-6 py-4 align-top\">\r\n                                                                            {app.status === 'Selected' ? (\r\n                                                                                app.joiningLetterPath ? (\r\n                                                                                    <div className=\"flex gap-2\">\r\n                                                                                        <button onClick={() => viewJoiningLetter(app.joiningLetterPath)} className=\"p-1.5 text-slate-500 hover:text-purple-600 hover:bg-purple-50 rounded transition\" title=\"View Joining\"><Eye size={16} /></button>\r\n                                                                                        <button onClick={() => downloadJoiningLetter(app._id)} className=\"p-1.5 text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 rounded transition\" title=\"Download Joining\"><Download size={16} /></button>\r\n                                                                                    </div>\r\n                                                                                ) : <button\r\n                                                                                    onClick={() => openJoiningModal(app)}\r\n                                                                                    disabled={(!app.salarySnapshot && !app.salaryAssigned)}\r\n                                                                                    className={`px-3 py-1.5 text-[10px] font-bold rounded-lg shadow-lg transition-transform active:scale-95 ${(app.salarySnapshot || app.salaryAssigned) ? 'bg-indigo-600 text-white shadow-indigo-100 hover:bg-indigo-700' : 'bg-gray-100 text-gray-400 cursor-not-allowed shadow-none border border-gray-200'}`}\r\n                                                                                    title={(app.salarySnapshot || app.salaryAssigned) ? \"Generate Joining Letter\" : \"Assign salary before generating joining letter\"}\r\n                                                                                >\r\n                                                                                    JOINING LETTER\r\n                                                                                </button>\r\n                                                                            ) : <span className=\"text-slate-200\">/</span>}\r\n                                                                        </td>\r\n                                                                    </>\r\n                                                                )}\r\n                                                            </>\r\n                                                        )\r\n                                                    }\r\n                                                </>\r\n                                            )}\r\n                                        </tr >\r\n                                    ))}\r\n                                </tbody >\r\n                            </table >\r\n                        </div >\r\n                        <div className=\"px-4 sm:px-6 py-4 border-t border-slate-100 flex justify-center sm:justify-end\">\r\n                            <Pagination\r\n                                current={currentPage}\r\n                                pageSize={pageSize}\r\n                                total={getFilteredApplicants().length}\r\n                                onChange={(page) => setCurrentPage(page)}\r\n                                showSizeChanger={false}\r\n                                responsive={true}\r\n                                size=\"small\"\r\n                                className=\"text-xs sm:text-sm\"\r\n                            />\r\n                        </div>\r\n                    </div >\r\n                )}\r\n            </div >\r\n\r\n            {/* Offer Generation Modal */}\r\n            {\r\n                showModal && selectedApplicant && (\r\n                    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n                        <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full p-6\">\r\n                            <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Generate Offer Letter</h2>\r\n\r\n                            <form onSubmit={(e) => { e.preventDefault(); handlePreview(); }} className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700\">Candidate Name</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        name=\"name\"\r\n                                        value={offerData.name}\r\n                                        onChange={handleOfferChange}\r\n                                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"\r\n                                    />\r\n                                    <p className=\"text-xs text-gray-500 mt-1\">Role: {selectedApplicant.requirementId?.jobTitle}</p>\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700\">Name (For 'Dear ...' section)</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        name=\"dearName\"\r\n                                        value={offerData.dearName}\r\n                                        onChange={handleOfferChange}\r\n                                        placeholder=\"e.g. First Name only\"\r\n                                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700\">Date Format</label>\r\n                                    <select\r\n                                        name=\"dateFormat\"\r\n                                        value={offerData.dateFormat}\r\n                                        onChange={handleOfferChange}\r\n                                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"\r\n                                    >\r\n                                        <option value=\"Do MMM. YYYY\">17th Jan. 2026 (Default)</option>\r\n                                        <option value=\"DD/MM/YYYY\">17/01/2026</option>\r\n                                        <option value=\"Do MMMM YYYY\">17th January 2026</option>\r\n                                        <option value=\"YYYY-MM-DD\">2026-01-17</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-4 gap-4\">\r\n                                    <div className=\"col-span-1\">\r\n                                        <label className=\"block text-sm font-medium text-gray-700\">Title</label>\r\n                                        <select\r\n                                            name=\"salutation\"\r\n                                            value={offerData.salutation}\r\n                                            onChange={handleOfferChange}\r\n                                            className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"\r\n                                        >\r\n                                            <option value=\"\">--</option>\r\n                                            <option value=\"Mr.\">Mr.</option>\r\n                                            <option value=\"Ms.\">Ms.</option>\r\n                                            <option value=\"Mrs.\">Mrs.</option>\r\n                                            <option value=\"Dr.\">Dr.</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div className=\"col-span-3\">\r\n                                        <label className=\"block text-sm font-medium text-gray-700\">Offer Template</label>\r\n                                        <select\r\n                                            name=\"templateId\"\r\n                                            value={offerData.templateId}\r\n                                            onChange={handleOfferChange}\r\n                                            className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"\r\n                                        >\r\n                                            <option value=\"\">-- Select Template --</option>\r\n                                            {templates.map(t => (\r\n                                                <option key={t._id} value={t._id}>{t.name}</option>\r\n                                            ))}\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700\">Reference Number</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        name=\"refNo\"\r\n                                        value={offerData.refNo || ''}\r\n                                        onChange={handleOfferChange}\r\n                                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"\r\n                                        placeholder=\"e.g. OFFER/2025/001\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"flex gap-4\">\r\n                                        <div className=\"w-1/2\">\r\n                                            <label className=\"block text-sm font-medium text-gray-700\">Joining Date *</label>\r\n                                            <DatePicker\r\n                                                disabledDate={(current) => current && current < dayjs().startOf('day')}\r\n                                                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 h-[42px]\"\r\n                                                format=\"DD-MM-YYYY\"\r\n                                                placeholder=\"DD-MM-YYYY\"\r\n                                                value={offerData.joiningDate ? dayjs(offerData.joiningDate) : null}\r\n                                                onChange={(date) => setOfferData(prev => ({ ...prev, joiningDate: date ? date.format('YYYY-MM-DD') : '' }))}\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"w-1/2\">\r\n                                            <label className=\"block text-sm font-medium text-gray-700\">Letter Issue Date</label>\r\n                                            <DatePicker\r\n                                                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 h-[42px]\"\r\n                                                format=\"DD-MM-YYYY\"\r\n                                                placeholder=\"DD-MM-YYYY\"\r\n                                                value={offerData.issueDate ? dayjs(offerData.issueDate) : null}\r\n                                                onChange={(date) => setOfferData(prev => ({ ...prev, issueDate: date ? date.format('YYYY-MM-DD') : '' }))}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"hidden\">\r\n                                    <label className=\"block text-sm font-medium text-gray-700\">Work Location</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        name=\"location\"\r\n                                        value={offerData.location}\r\n                                        onChange={handleOfferChange}\r\n                                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"\r\n                                        placeholder=\"e.g. New York, Remote\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"col-span-full\">\r\n                                    <label className=\"block text-sm font-medium text-gray-700\">Candidate Address</label>\r\n                                    <textarea\r\n                                        name=\"address\"\r\n                                        value={offerData.address}\r\n                                        onChange={handleOfferChange}\r\n                                        rows=\"3\"\r\n                                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"\r\n                                        placeholder=\"Full address with pin code...\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"flex justify-end space-x-3 mt-6\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setShowModal(false)}\r\n                                        className=\"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={handlePreview}\r\n                                        className=\"px-4 py-2 border border-blue-600 rounded-md text-sm font-medium text-blue-600 hover:bg-blue-50\"\r\n                                    >\r\n                                        Preview\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={(e) => submitOffer(e)}\r\n                                        disabled={generating}\r\n                                        className=\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50\"\r\n                                    >\r\n                                        {generating ? 'Generating...' : 'Generate & Download'}\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* Joining Letter Generation Modal */}\r\n            {\r\n                showJoiningModal && selectedApplicant && (\r\n                    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n                        <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full p-6\">\r\n                            <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Generate Joining Letter</h2>\r\n                            <div className=\"mb-4 text-sm text-gray-600 space-y-2\">\r\n                                <p><strong>Candidate:</strong> {selectedApplicant.name}</p>\r\n                                <p><strong>Joining Date:</strong> {selectedApplicant.joiningDate ? new Date(selectedApplicant.joiningDate).toLocaleDateString() : 'N/A'}</p>\r\n                                <p><strong>Location:</strong> {selectedApplicant.location || selectedApplicant.workLocation || 'N/A'}</p>\r\n                                <p className=\"text-xs text-orange-600 mt-2 bg-orange-50 p-2 rounded\">\r\n                                    Note: Joining Date and Location are pulled from the Offer Letter data.\r\n                                </p>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700\">Select Template</label>\r\n                                    <select\r\n                                        value={joiningTemplateId}\r\n                                        onChange={(e) => setJoiningTemplateId(e.target.value)}\r\n                                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2\"\r\n                                    >\r\n                                        <option value=\"\">-- Select Template --</option>\r\n                                        {joiningTemplates.map(t => (\r\n                                            <option key={t._id} value={t._id}>{t.name}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div className=\"flex justify-end space-x-3 mt-6\">\r\n                                    <button\r\n                                        onClick={() => setShowJoiningModal(false)}\r\n                                        className=\"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleJoiningPreview}\r\n                                        disabled={generating}\r\n                                        className=\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:opacity-50\"\r\n                                    >\r\n                                        {generating ? 'Loading...' : 'Preview'}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* Joining Letter Preview Modal */}\r\n            {\r\n                showJoiningPreview && selectedApplicant && (\r\n                    <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 overflow-y-auto\">\r\n                        <div className=\"min-h-screen py-8 px-4\">\r\n                            {/* Sticky Header with Buttons */}\r\n                            <div className=\"sticky top-0 z-10 bg-gradient-to-b from-black via-black to-transparent pb-6 mb-4\">\r\n                                <div className=\"w-full mx-auto flex justify-between items-center gap-3\">\r\n                                    <h2 className=\"text-xl font-bold text-white\">Joining Letter Preview</h2>\r\n                                    <div className=\"flex gap-3\">\r\n                                        <button\r\n                                            onClick={() => setShowJoiningPreview(false)}\r\n                                            className=\"px-4 py-2 bg-white text-slate-700 rounded-lg hover:bg-slate-100 shadow-lg font-medium transition\"\r\n                                        >\r\n                                            ‚úï Close Preview\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={handleJoiningGenerate}\r\n                                            disabled={generating}\r\n                                            className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-lg font-medium disabled:opacity-50 transition\"\r\n                                        >\r\n                                            {generating ? 'Generating...' : '‚úì Generate & Download'}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Scrollable Preview Content */}\r\n                            <div className=\"w-full mx-auto\">\r\n                                {joiningPreviewUrl ? (\r\n                                    <iframe\r\n                                        src={joiningPreviewUrl}\r\n                                        className=\"w-full h-[80vh] rounded-lg shadow-xl bg-white\"\r\n                                        title=\"Joining Letter PDF Preview\"\r\n                                    />\r\n                                ) : (\r\n                                    <div className=\"w-full h-[80vh] rounded-lg shadow-xl bg-white flex items-center justify-center\">\r\n                                        <p className=\"text-gray-500\">Loading preview...</p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Bottom Padding */}\r\n                            <div className=\"h-8\"></div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* Offer Letter Preview Modal (Unified for both Offer & Joining) */}\r\n            {\r\n                showPreview && selectedApplicant && (\r\n                    <div className=\"fixed inset-0 bg-black bg-opacity-75 z-50 overflow-y-auto\">\r\n                        <div className=\"min-h-screen py-8 px-4\">\r\n                            {/* Sticky Header with Buttons */}\r\n                            <div className=\"sticky top-0 z-10 bg-gradient-to-b from-black via-black to-transparent pb-6 mb-4\">\r\n                                <div className=\"w-full mx-auto flex justify-between items-center gap-3\">\r\n                                    <h2 className=\"text-xl font-bold text-white\">Offer Letter Preview</h2>\r\n                                    <div className=\"flex gap-3\">\r\n                                        <button\r\n                                            onClick={() => setShowPreview(false)}\r\n                                            className=\"px-4 py-2 bg-white text-slate-700 rounded-lg hover:bg-slate-100 shadow-lg font-medium transition\"\r\n                                        >\r\n                                            ‚úï Close Preview\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={(e) => submitOffer(e)}\r\n                                            disabled={generating}\r\n                                            className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-lg font-medium disabled:opacity-50 transition\"\r\n                                        >\r\n                                            {generating ? 'Downloading...' : '‚úì Download PDF'}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Scrollable Preview Content */}\r\n                            <div className=\"w-full mx-auto\">\r\n                                {offerData.isWordTemplate && previewPdfUrl ? (\r\n                                    <iframe\r\n                                        src={previewPdfUrl}\r\n                                        className=\"w-full h-[80vh] rounded-lg shadow-xl bg-white\"\r\n                                        title=\"PDF Preview\"\r\n                                    />\r\n                                ) : (\r\n                                    <OfferLetterPreview\r\n                                        applicant={selectedApplicant}\r\n                                        offerData={offerData}\r\n                                        companyInfo={companyInfo}\r\n                                    />\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Bottom Padding */}\r\n                            <div className=\"h-8\"></div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* Assign Salary Modal */}\r\n            {\r\n                showSalaryModal && selectedApplicant && (\r\n                    <AssignSalaryModal\r\n                        isOpen={showSalaryModal}\r\n                        onClose={() => {\r\n                            setShowSalaryModal(false);\r\n                            setSelectedApplicant(null);\r\n                        }}\r\n                        applicant={selectedApplicant}\r\n                        onSuccess={handleSalaryAssigned}\r\n                    />\r\n                )\r\n            }\r\n\r\n            {/* Salary Preview Modal */}\r\n            {\r\n                showSalaryPreview && selectedApplicant && (selectedApplicant.salarySnapshotId || selectedApplicant.salarySnapshot) && (() => {\r\n                    // Logic: Use populated object if available, else fallback to embedded snapshot. \r\n                    // If salarySnapshotId is a string (unpopulated ID), we MUST use local snapshot.\r\n                    const snapshot = (typeof selectedApplicant.salarySnapshotId === 'object' && selectedApplicant.salarySnapshotId !== null)\r\n                        ? selectedApplicant.salarySnapshotId\r\n                        : selectedApplicant.salarySnapshot;\r\n                    const earnings = snapshot.earnings || [];\r\n                    const deductions = snapshot.employeeDeductions || snapshot.deductions || [];\r\n                    const takeHome = snapshot.breakdown?.takeHome || snapshot.takeHome?.monthly || snapshot.takeHome || 0;\r\n                    const ctcYearly = snapshot.ctc?.yearly || snapshot.ctc || 0;\r\n                    const grossMonthly = snapshot.breakdown?.grossA || snapshot.grossA?.monthly || snapshot.grossA || 0;\r\n\r\n                    return (\r\n                        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n                            <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in fade-in zoom-in-95 duration-200\">\r\n                                {/* Header */}\r\n                                <div className=\"px-6 py-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center\">\r\n                                    <div>\r\n                                        <h3 className=\"text-lg font-bold text-slate-800\">Salary Structure</h3>\r\n                                        <p className=\"text-sm text-slate-500\">{selectedApplicant.name} ‚Ä¢ {selectedApplicant.requirementId?.jobTitle}</p>\r\n                                    </div>\r\n                                    <button onClick={() => setShowSalaryPreview(false)} className=\"p-2 hover:bg-slate-200 rounded-full transition text-slate-500\">\r\n                                        ‚úï\r\n                                    </button>\r\n                                </div>\r\n\r\n                                {/* Body - Scrollable */}\r\n                                <div className=\"p-6 overflow-y-auto space-y-6\">\r\n                                    {/* Grid */}\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                                        {/* Earnings */}\r\n                                        <div className=\"space-y-3\">\r\n                                            <h4 className=\"text-xs font-bold text-emerald-600 uppercase tracking-wider border-b border-emerald-100 pb-2\">Earnings (Monthly)</h4>\r\n                                            <div className=\"space-y-2\">\r\n                                                {earnings.map((e, i) => (\r\n                                                    <div key={i} className=\"flex justify-between text-sm group border-b border-dashed border-slate-100 pb-1 last:border-0\">\r\n                                                        <span className=\"text-slate-600 group-hover:text-slate-900\">{e.name}</span>\r\n                                                        <span className=\"font-medium text-slate-800\">‚Çπ{e.monthlyAmount?.toLocaleString()}</span>\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                            <div className=\"pt-2 border-t border-slate-200 flex justify-between font-bold text-slate-800 mt-2\">\r\n                                                <span>Gross Earnings</span>\r\n                                                <span>‚Çπ{grossMonthly.toLocaleString()}</span>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Deductions */}\r\n                                        <div className=\"space-y-3\">\r\n                                            <h4 className=\"text-xs font-bold text-rose-600 uppercase tracking-wider border-b border-rose-100 pb-2\">Deductions (Monthly)</h4>\r\n                                            <div className=\"space-y-2\">\r\n                                                {deductions.length > 0 ? (\r\n                                                    deductions.map((d, i) => (\r\n                                                        <div key={i} className=\"flex justify-between text-sm group border-b border-dashed border-slate-100 pb-1 last:border-0\">\r\n                                                            <span className=\"text-slate-600 group-hover:text-slate-900\">{d.name}</span>\r\n                                                            <span className=\"font-medium text-rose-600\">-‚Çπ{d.monthlyAmount?.toLocaleString()}</span>\r\n                                                        </div>\r\n                                                    ))\r\n                                                ) : (\r\n                                                    <p className=\"text-xs text-slate-400 italic\">No deductions</p>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Summary Card */}\r\n                                    <div className=\"bg-slate-900 text-white rounded-xl p-5 shadow-lg ring-1 ring-white/10\">\r\n                                        <div className=\"grid grid-cols-2 gap-4 text-center divide-x divide-slate-700/50\">\r\n                                            <div>\r\n                                                <div className=\"text-slate-400 text-[10px] uppercase tracking-widest mb-1\">Monthly Net Pay</div>\r\n                                                <div className=\"text-2xl font-bold text-emerald-400\">‚Çπ{takeHome.toLocaleString()}</div>\r\n                                            </div>\r\n                                            <div>\r\n                                                <div className=\"text-slate-400 text-[10px] uppercase tracking-widest mb-1\">Annual CTC</div>\r\n                                                <div className=\"text-xl font-bold text-white\">‚Çπ{ctcYearly.toLocaleString()}</div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Footer */}\r\n                                <div className=\"px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3\">\r\n                                    <button\r\n                                        onClick={() => { setShowSalaryPreview(false); openSalaryModal(selectedApplicant); }}\r\n                                        className=\"px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition\"\r\n                                    >\r\n                                        Edit Structure\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setShowSalaryPreview(false)}\r\n                                        className=\"px-6 py-2 text-sm font-medium bg-slate-900 text-white rounded-lg hover:bg-slate-800 transition shadow-lg\"\r\n                                    >\r\n                                        Close\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })()\r\n            }\r\n\r\n            {/* INTERVIEW MODAL */}\r\n            {\r\n                showInterviewModal && (\r\n                    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\r\n                        <div className=\"bg-white rounded-lg shadow-xl w-full max-w-md p-6 max-h-[90vh] overflow-y-auto\">\r\n                            <h2 className=\"text-xl font-bold text-slate-800 mb-4\">\r\n                                {isReschedule ? 'Reschedule Interview' : 'Schedule Interview'}\r\n                            </h2>\r\n\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-700\">Date</label>\r\n                                    <DatePicker\r\n                                        className=\"w-full mt-1 h-[42px]\"\r\n                                        format=\"YYYY-MM-DD\"\r\n                                        value={interviewData.date ? dayjs(interviewData.date) : null}\r\n                                        disabledDate={(current) => {\r\n                                            if (!current) return false;\r\n                                            const isSunday = current.day() === 0;\r\n                                            const dateStr = current.format('YYYY-MM-DD');\r\n                                            const isHoliday = companyHolidays.includes(dateStr);\r\n                                            return isSunday || isHoliday || current < dayjs().startOf('day');\r\n                                        }}\r\n                                        onChange={(date, dateString) => setInterviewData({ ...interviewData, date: dateString })}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700\">Time</label>\r\n                                        <TimePicker\r\n                                            className=\"w-full mt-1 h-[42px]\"\r\n                                            use12Hours\r\n                                            format=\"h:mm a\"\r\n                                            value={interviewData.time ? dayjs(interviewData.time, 'h:mm a') : null}\r\n                                            onChange={(time, timeString) => setInterviewData({ ...interviewData, time: timeString })}\r\n                                            minuteStep={5}\r\n                                        />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700\">Mode</label>\r\n                                        <select\r\n                                            value={interviewData.mode}\r\n                                            onChange={(e) => setInterviewData({ ...interviewData, mode: e.target.value })}\r\n                                            className=\"w-full mt-1 p-2 border rounded h-[42px]\"\r\n                                        >\r\n                                            <option value=\"Online\">Online</option>\r\n                                            <option value=\"Offline\">Offline</option>\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-700\">\r\n                                        {interviewData.mode === 'Online' ? 'Meeting Link' : 'Office/Location Address'}\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={interviewData.location}\r\n                                        onChange={(e) => setInterviewData({ ...interviewData, location: e.target.value })}\r\n                                        placeholder={interviewData.mode === 'Online' ? 'Zoom/Teams/Meet Link' : 'Enter work location address'}\r\n                                        className=\"w-full mt-1 p-2 border rounded\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-700\">Interviewer Name</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={interviewData.interviewerName}\r\n                                        onChange={(e) => setInterviewData({ ...interviewData, interviewerName: e.target.value })}\r\n                                        className=\"w-full mt-1 p-2 border rounded\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-700\">Notes (Optional)</label>\r\n                                    <textarea\r\n                                        value={interviewData.notes}\r\n                                        onChange={(e) => setInterviewData({ ...interviewData, notes: e.target.value })}\r\n                                        className=\"w-full mt-1 p-2 border rounded\"\r\n                                        rows=\"2\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"flex gap-2 justify-end mt-4\">\r\n                                    <button\r\n                                        onClick={() => setShowInterviewModal(false)}\r\n                                        className=\"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleInterviewSubmit}\r\n                                        disabled={loading}\r\n                                        className=\"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50\"\r\n                                    >\r\n                                        {loading ? 'Sending...' : (isReschedule ? 'Reschedule & Notify' : 'Schedule & Notify')}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* Custom Stage Modal */}\r\n            {\r\n                isCustomStageModalVisible && (\r\n                    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\r\n                        <div className=\"bg-white rounded-lg shadow-xl w-full max-w-sm p-6\">\r\n                            <h2 className=\"text-lg font-bold text-slate-800 mb-4\">Add Custom Stage</h2>\r\n                            <p className=\"text-sm text-slate-600 mb-4\">Enter the name for the new ad-hoc stage. This will be added for <b>{candidateForCustomStage?.name}</b>.</p>\r\n\r\n                            <input\r\n                                type=\"text\"\r\n                                value={customStageName}\r\n                                onChange={(e) => setCustomStageName(e.target.value)}\r\n                                placeholder=\"e.g. Manager Review 2\"\r\n                                className=\"w-full p-2 border border-slate-300 rounded mb-4\"\r\n                                autoFocus\r\n                            />\r\n\r\n                            <div className=\"flex gap-2 justify-end\">\r\n                                <button onClick={() => setIsCustomStageModalVisible(false)} className=\"px-3 py-2 text-sm text-slate-600 hover:bg-slate-100 rounded\">Cancel</button>\r\n                                <button onClick={handleAddCustomStage} className=\"px-3 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 font-medium\">Add & Move</button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* Workflow Edit Modal */}\r\n            {\r\n                showWorkflowEditModal && (\r\n                    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\r\n                        <div className=\"bg-white rounded-xl shadow-xl w-full max-w-md p-6\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h2 className=\"text-xl font-bold text-slate-800\">Edit Hiring Workflow</h2>\r\n                                <button onClick={() => setShowWorkflowEditModal(false)} className=\"text-slate-400 hover:text-slate-600\">\r\n                                    <X size={20} />\r\n                                </button>\r\n                            </div>\r\n\r\n                            <p className=\"text-sm text-slate-500 mb-4 bg-blue-50 p-3 rounded-lg border border-blue-100\">\r\n                                Customize the hiring process for <b>{selectedRequirement?.jobTitle}</b>.\r\n                                Adding steps here updates the job for all candidates.\r\n                            </p>\r\n\r\n                            <div className=\"space-y-3 mb-6 max-h-[300px] overflow-y-auto pr-2\">\r\n                                {editingWorkflow.map((stage, index) => (\r\n                                    <div\r\n                                        key={index}\r\n                                        className={`flex items-center gap-2 p-2 bg-slate-50 rounded border border-slate-200 group ${stage === 'Applied' || stage === 'Finalized' ? 'opacity-80' : 'cursor-move hover:border-blue-300'}`}\r\n                                        draggable={stage !== 'Applied' && stage !== 'Finalized'}\r\n                                        onDragStart={(e) => {\r\n                                            dragItem.current = index;\r\n                                            e.target.classList.add('opacity-50');\r\n                                        }}\r\n                                        onDragEnter={(e) => {\r\n                                            dragOverItem.current = index;\r\n                                        }}\r\n                                        onDragEnd={(e) => {\r\n                                            e.target.classList.remove('opacity-50');\r\n                                            handleSort();\r\n                                        }}\r\n                                        onDragOver={(e) => e.preventDefault()}\r\n                                    >\r\n                                        {/* Grip Handle for Draggable Items */}\r\n                                        {stage !== 'Applied' && stage !== 'Finalized' ? (\r\n                                            <div className=\"text-slate-400 cursor-grab active:cursor-grabbing\">\r\n                                                <GripVertical size={16} />\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className=\"w-4\"></div> // Spacer\r\n                                        )}\r\n\r\n                                        <div className=\"flex-1 text-sm font-medium text-slate-700\">\r\n                                            {index + 1}. {stage}\r\n                                        </div>\r\n                                        {/* Prevent removing critical stages if needed, or allow full flexibility */}\r\n                                        {stage !== 'Applied' && stage !== 'Finalized' && (\r\n                                            <button\r\n                                                onClick={() => handleStageRemove(index)}\r\n                                                className=\"text-slate-400 hover:text-red-500 p-1 opacity-0 group-hover:opacity-100 transition\"\r\n                                            >\r\n                                                <Trash2 size={16} />\r\n                                            </button>\r\n                                        )}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-2 mb-6\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={newStageName}\r\n                                    onChange={(e) => setNewStageName(e.target.value)}\r\n                                    placeholder=\"New Stage Name (e.g. Logic Test)\"\r\n                                    className=\"flex-1 p-2 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                    onKeyDown={(e) => e.key === 'Enter' && handleStageAdd()}\r\n                                />\r\n                                <button\r\n                                    onClick={handleStageAdd}\r\n                                    className=\"bg-blue-100 text-blue-600 p-2 rounded hover:bg-blue-200 transition\"\r\n                                >\r\n                                    <Plus size={20} />\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-3 justify-end pt-4 border-t border-slate-100\">\r\n                                <button\r\n                                    onClick={() => setShowWorkflowEditModal(false)}\r\n                                    className=\"px-4 py-2 text-slate-600 hover:bg-slate-50 rounded-lg text-sm font-medium\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    onClick={saveWorkflowChanges}\r\n                                    disabled={loading}\r\n                                    className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md text-sm font-medium disabled:opacity-50\"\r\n                                >\r\n                                    {loading ? 'Saving...' : 'Save Changes'}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n            {/* End of Workflow Edit Modal */}\r\n            {/* Candidate Details & Resume Modal */}\r\n            {\r\n                showCandidateModal && selectedApplicant && (\r\n                    <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center overflow-y-auto p-4 sm:p-6\">\r\n                        <div className=\"bg-white w-full w-full h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in-95 duration-200\">\r\n                            {/* Header */}\r\n                            <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-200 bg-slate-50\">\r\n                                <div>\r\n                                    <h2 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\r\n                                        {selectedApplicant.name}\r\n                                        <span className={`px-2 py-0.5 rounded-full text-xs font-semibold ${getStatusColor(selectedApplicant.status)}`}>\r\n                                            {selectedApplicant.status}\r\n                                        </span>\r\n                                    </h2>\r\n                                    <p className=\"text-sm text-slate-500\">Applied for <span className=\"font-medium text-slate-700\">{selectedApplicant.requirementId?.jobTitle}</span></p>\r\n                                </div>\r\n                                <div className=\"flex gap-3\">\r\n                                    <a\r\n                                        href={getResumeUrl(selectedApplicant.resume)}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noreferrer\"\r\n                                        className=\"px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium text-sm flex items-center gap-2\"\r\n                                    >\r\n                                        <Download size={16} /> Download Resume\r\n                                    </a>\r\n                                    <button\r\n                                        onClick={() => setShowCandidateModal(false)}\r\n                                        className=\"p-2 hover:bg-slate-200 rounded-full transition text-slate-500\"\r\n                                    >\r\n                                        <X size={24} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Content */}\r\n                            <div className=\"flex-1 flex flex-col lg:flex-row overflow-hidden\">\r\n                                {/* Sidebar: Candidate Details */}\r\n                                <div className=\"w-full lg:w-1/3 bg-white border-r border-slate-200 overflow-y-auto p-6 space-y-6\">\r\n                                    <section>\r\n                                        <h3 className=\"text-xs font-bold text-slate-400 uppercase tracking-wider mb-4\">Personal Information</h3>\r\n                                        <div className=\"space-y-4\">\r\n                                            <div className=\"flex items-start gap-3\">\r\n                                                <div className=\"mt-0.5 text-slate-400\"><FileText size={16} /></div>\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500\">Father's Name</p>\r\n                                                    <p className=\"text-sm font-medium text-slate-800\">{selectedApplicant.fatherName || '-'}</p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex items-start gap-3\">\r\n                                                <div className=\"mt-0.5 text-slate-400\">@</div>\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500\">Email Address</p>\r\n                                                    <p className=\"text-sm font-medium text-slate-800 break-all\">{selectedApplicant.email}</p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex items-start gap-3\">\r\n                                                <div className=\"mt-0.5 text-slate-400\">#</div>\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500\">Mobile Number</p>\r\n                                                    <p className=\"text-sm font-medium text-slate-800\">{selectedApplicant.mobile}</p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex items-start gap-3\">\r\n                                                <div className=\"mt-0.5 text-slate-400\">üìÖ</div>\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500\">Date of Birth</p>\r\n                                                    <p className=\"text-sm font-medium text-slate-800\">\r\n                                                        {selectedApplicant.dob ? dayjs(selectedApplicant.dob).format('DD MMM YYYY') : '-'}\r\n                                                    </p>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex items-start gap-3\">\r\n                                                <div className=\"mt-0.5 text-slate-400\">üìç</div>\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500\">Address</p>\r\n                                                    <p className=\"text-sm text-slate-700 leading-relaxed\">{selectedApplicant.address || '-'}</p>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </section>\r\n\r\n                                    <div className=\"border-t border-slate-100 my-2\"></div>\r\n\r\n                                    <section>\r\n                                        <h3 className=\"text-xs font-bold text-slate-400 uppercase tracking-wider mb-4\">Professional Details</h3>\r\n                                        <div className=\"space-y-4\">\r\n                                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500\">Experience</p>\r\n                                                    <p className=\"text-sm font-medium text-slate-800\">{selectedApplicant.experience || '0'} Years</p>\r\n                                                </div>\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500\">Notice Period</p>\r\n                                                    <p className=\"text-sm font-medium text-slate-800\">{selectedApplicant.noticePeriod ? 'Yes' : 'No'}</p>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div>\r\n                                                <p className=\"text-xs text-slate-500\">Current Company</p>\r\n                                                <p className=\"text-sm font-medium text-slate-800\">{selectedApplicant.currentCompany || '-'}</p>\r\n                                            </div>\r\n                                            <div>\r\n                                                <p className=\"text-xs text-slate-500\">Designation</p>\r\n                                                <p className=\"text-sm font-medium text-slate-800\">{selectedApplicant.currentDesignation || '-'}</p>\r\n                                            </div>\r\n\r\n                                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500\">Current CTC</p>\r\n                                                    <p className=\"text-sm font-medium text-slate-800\">{selectedApplicant.currentCTC || '-'}</p>\r\n                                                </div>\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500\">Expected CTC</p>\r\n                                                    <p className=\"text-sm font-medium text-emerald-600\">{selectedApplicant.expectedCTC || '-'}</p>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {selectedApplicant.linkedin && (\r\n                                                <div>\r\n                                                    <p className=\"text-xs text-slate-500 mb-1\">LinkedIn Profile</p>\r\n                                                    <a href={selectedApplicant.linkedin} target=\"_blank\" rel=\"noreferrer\" className=\"text-sm text-blue-600 hover:underline truncate block\">\r\n                                                        {selectedApplicant.linkedin}\r\n                                                    </a>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    </section>\r\n\r\n                                    {selectedApplicant.intro && (\r\n                                        <>\r\n                                            <div className=\"border-t border-slate-100 my-2\"></div>\r\n                                            <section>\r\n                                                <h3 className=\"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2\">Introduction / Notes</h3>\r\n                                                <p className=\"text-sm text-slate-600 italic leading-relaxed bg-slate-50 p-3 rounded\">\r\n                                                    \"{selectedApplicant.intro}\"\r\n                                                </p>\r\n                                            </section>\r\n                                        </>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Main Area: Resume Preview */}\r\n                                <div className=\"flex-1 bg-slate-100 flex items-center justify-center p-4\">\r\n                                    {selectedApplicant.resume ? (\r\n                                        selectedApplicant.resume.toLowerCase().endsWith('.pdf') ? (\r\n                                            <iframe\r\n                                                src={getResumeUrl(selectedApplicant.resume)}\r\n                                                className=\"w-full h-full rounded-lg shadow-input bg-white\"\r\n                                                title=\"Resume Preview\"\r\n                                            />\r\n                                        ) : (\r\n                                            <div className=\"text-center p-8 bg-white rounded-xl shadow-sm max-w-md\">\r\n                                                <FileText size={48} className=\"mx-auto text-slate-300 mb-4\" />\r\n                                                <p className=\"text-lg font-medium text-slate-800 mb-2\">Preview not available</p>\r\n                                                <p className=\"text-slate-500 mb-6\">This file type cannot be previewed directly in the browser.</p>\r\n                                                <a\r\n                                                    href={getResumeUrl(selectedApplicant.resume)}\r\n                                                    target=\"_blank\"\r\n                                                    rel=\"noreferrer\"\r\n                                                    className=\"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium\"\r\n                                                >\r\n                                                    <Download size={18} /> Download File\r\n                                                </a>\r\n                                            </div>\r\n                                        )\r\n                                    ) : (\r\n                                        <div className=\"text-center text-slate-400\">\r\n                                            <p>No resume uploaded</p>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n            {/* Premium Candidate Evaluation Drawer */}\r\n            {\r\n                showEvaluationDrawer && selectedApplicant && (\r\n                    <div className=\"fixed inset-0 z-[100] flex justify-end\">\r\n                        {/* Backdrop */}\r\n                        <div\r\n                            className=\"absolute inset-0 bg-slate-900/40 backdrop-blur-sm animate-in fade-in duration-300\"\r\n                            onClick={() => setShowEvaluationDrawer(false)}\r\n                        />\r\n\r\n                        {/* Drawer Content */}\r\n                        <div className=\"relative w-full max-w-2xl bg-white h-screen shadow-2xl flex flex-col animate-in slide-in-from-right duration-500 ease-out overflow-hidden\">\r\n                            {/* Header */}\r\n                            <div className=\"p-6 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0 z-10\">\r\n                                <div>\r\n                                    <h1 className=\"text-xl font-black text-slate-800 tracking-tight\">Candidate Evaluation</h1>\r\n                                    <p className=\"text-xs text-slate-400 mt-1 uppercase font-bold tracking-widest flex items-center gap-2\">\r\n                                        <span className=\"text-blue-600 font-black\">{selectedApplicant.name}</span>\r\n                                        <span className=\"opacity-20 italic\">|</span>\r\n                                        <span>{selectedApplicant.requirementId?.jobTitle}</span>\r\n                                    </p>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => {\r\n                                        setShowEvaluationDrawer(false);\r\n                                        setIsFinishingInterview(false);\r\n                                    }}\r\n                                    className=\"p-2 hover:bg-slate-50 rounded-full transition-colors\"\r\n                                >\r\n                                    <X size={24} className=\"text-slate-400\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Middle Area (Scrollable) */}\r\n                            <div className=\"flex-1 overflow-y-auto p-6 space-y-8 pb-32\">\r\n\r\n                                {/* Round Navigation Tabs */}\r\n                                <div className=\"flex gap-2 p-1 bg-slate-50 rounded-xl\">\r\n                                    {evaluationData.rounds.map((round, idx) => (\r\n                                        <button\r\n                                            key={round.id}\r\n                                            onClick={() => setEvalActiveRound(idx)}\r\n                                            className={`flex-1 py-2 px-3 rounded-lg text-xs font-black uppercase tracking-wider transition-all\r\n                                            ${evalActiveRound === idx\r\n                                                    ? 'bg-white text-blue-600 shadow-sm'\r\n                                                    : 'text-slate-400 hover:text-slate-600'}`}\r\n                                        >\r\n                                            {round.name}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                {/* Active Evaluation Criteria */}\r\n                                <div className=\"space-y-6\">\r\n                                    <h3 className=\"text-sm font-black text-slate-800 uppercase tracking-widest flex items-center gap-3\">\r\n                                        <span className=\"w-8 h-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center\">0{evalActiveRound + 1}</span>\r\n                                        {evaluationData.rounds[evalActiveRound].name}\r\n                                    </h3>\r\n\r\n                                    {evaluationData.rounds[evalActiveRound].categories.map((cat, catIdx) => (\r\n                                        <div key={catIdx} className=\"space-y-4\">\r\n                                            <h4 className=\"text-[11px] font-bold text-slate-400 uppercase tracking-widest\">{cat.name}</h4>\r\n                                            <div className=\"space-y-2\">\r\n                                                {cat.skills.map((skill, skillIdx) => (\r\n                                                    <div key={skillIdx} className=\"grid grid-cols-12 gap-4 items-center p-4 bg-slate-50/50 border border-slate-100/50 rounded-2xl group hover:bg-white hover:shadow-xl hover:shadow-slate-100 transition-all duration-300\">\r\n                                                        <div className=\"col-span-12 md:col-span-5\">\r\n                                                            <p className=\"text-xs font-black text-slate-700\">{skill.name}</p>\r\n                                                        </div>\r\n                                                        <div className=\"col-span-12 md:col-span-3 flex gap-2\">\r\n                                                            {[1, 2, 3, 4, 5].map(num => (\r\n                                                                <button\r\n                                                                    key={num}\r\n                                                                    onClick={() => {\r\n                                                                        const newData = { ...evaluationData };\r\n                                                                        newData.rounds[evalActiveRound].categories[catIdx].skills[skillIdx].rating = num;\r\n                                                                        setEvaluationData(newData);\r\n                                                                        const allRatings = evaluationData.rounds.flatMap(r => r.categories.flatMap(c => c.skills.map(s => s.rating))).filter(r => r > 0);\r\n                                                                        if (allRatings.length > 0) {\r\n                                                                            const avg = Math.round(allRatings.reduce((a, b) => a + b, 0) / allRatings.length);\r\n                                                                            setReviewRating(avg);\r\n                                                                        }\r\n                                                                    }}\r\n                                                                    className={`w-8 h-8 rounded-full text-[11px] font-black transition-all flex items-center justify-center\r\n                                                                    ${skill.rating === num\r\n                                                                            ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 scale-110'\r\n                                                                            : 'bg-white text-slate-400 border border-slate-200 hover:border-blue-400 font-bold'}`}\r\n                                                                >\r\n                                                                    {num}\r\n                                                                </button>\r\n                                                            ))}\r\n                                                        </div>\r\n                                                        <div className=\"col-span-12 md:col-span-4\">\r\n                                                            <input\r\n                                                                type=\"text\"\r\n                                                                placeholder=\"Short Note...\"\r\n                                                                value={skill.comment}\r\n                                                                onChange={(e) => {\r\n                                                                    const newData = { ...evaluationData };\r\n                                                                    newData.rounds[evalActiveRound].categories[catIdx].skills[skillIdx].comment = e.target.value;\r\n                                                                    setEvaluationData(newData);\r\n                                                                    // Sync with main feedback\r\n                                                                    setReviewFeedback(e.target.value);\r\n                                                                }}\r\n                                                                className=\"w-full text-[10px] p-2 bg-white border border-slate-100 rounded-lg outline-none focus:border-blue-500 transition-colors\"\r\n                                                            />\r\n                                                        </div>\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Footer - Bottom Action Bar */}\r\n                            <div className=\"absolute bottom-0 left-0 right-0 bg-white border-t border-slate-100 p-6 flex items-center justify-between shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.1)]\">\r\n                                <div className=\"flex items-center gap-6\">\r\n                                    <div>\r\n                                        <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-[2px] mb-1\">Total Score</p>\r\n                                        <div className=\"text-2xl font-black text-slate-800\">\r\n                                            {(evaluationData.rounds.flatMap(r => r.categories.flatMap(c => c.skills.map(s => s.rating))).filter(r => r > 0).reduce((a, b, _, arr) => a + b / arr.length, 0) || 0).toFixed(2)}\r\n                                            <span className=\"text-xs text-slate-300\"> / 5</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"w-px h-10 bg-slate-100\"></div>\r\n                                    <div>\r\n                                        <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-[2px] mb-1\">Decision</p>\r\n                                        <Select\r\n                                            className=\"w-40 premium-select\"\r\n                                            placeholder=\"Pick Step\"\r\n                                            value={selectedStatusForReview || null}\r\n                                            variant=\"borderless\"\r\n                                            style={{ background: '#f8fafc', borderRadius: '12px', padding: '0 8px', border: '1px solid #f1f5f9' }}\r\n                                            onChange={(val) => setSelectedStatusForReview(val)}\r\n                                        >\r\n                                            <Select.OptGroup label=\"Hiring Pipeline\">\r\n                                                {workflowTabs.filter(t => !['Applied', 'Finalized'].includes(t)).map(tab => (\r\n                                                    <Select.Option key={tab} value={tab}>{tab}</Select.Option>\r\n                                                ))}\r\n                                            </Select.OptGroup>\r\n                                            <Select.OptGroup label=\"Final Result\">\r\n                                                <Select.Option value=\"Selected\" className=\"text-emerald-600 font-bold\">Selected / Hire</Select.Option>\r\n                                                <Select.Option value=\"Rejected\" className=\"text-red-500 font-bold\">Reject</Select.Option>\r\n                                            </Select.OptGroup>\r\n                                        </Select>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <button\r\n                                    onClick={submitReviewAndStatus}\r\n                                    disabled={loading || !selectedStatusForReview}\r\n                                    className=\"px-8 py-3 bg-blue-600 text-white text-xs font-black uppercase tracking-widest rounded-2xl shadow-2xl shadow-blue-200 hover:bg-blue-700 transition-all active:scale-95 disabled:opacity-50 disabled:grayscale\"\r\n                                >\r\n                                    {loading ? 'Processing...' : 'Complete Evaluation'}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* Document Upload Modal */}\r\n            {\r\n                showDocumentModal && (\r\n                    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n                        <div className=\"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\r\n                            {/* Header */}\r\n                            <div className=\"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-gradient-to-r from-blue-50 to-indigo-50\">\r\n                                <div>\r\n                                    <h3 className=\"text-lg font-bold text-slate-800\">Upload Documents</h3>\r\n                                    <p className=\"text-xs text-slate-500 mt-1\">\r\n                                        {documentApplicant?.name} - {documentApplicant?.requirementId?.title}\r\n                                    </p>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => setShowDocumentModal(false)}\r\n                                    className=\"p-2 hover:bg-white rounded-lg transition-colors\"\r\n                                >\r\n                                    <XCircle size={20} className=\"text-slate-400\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Body */}\r\n                            <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\r\n                                {/* Add New Document */}\r\n                                <div className=\"bg-slate-50 rounded-xl p-4 space-y-4\">\r\n                                    <h4 className=\"text-sm font-bold text-slate-700 uppercase tracking-wider\">Add New Document</h4>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-bold text-slate-600 mb-2\">Document Name *</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={documentName}\r\n                                            onChange={(e) => setDocumentName(e.target.value)}\r\n                                            placeholder=\"e.g., Aadhar Card, PAN Card, Degree Certificate\"\r\n                                            className=\"w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-bold text-slate-600 mb-2\">Select File * (PDF, JPG, PNG - Max 5MB)</label>\r\n                                        <input\r\n                                            id=\"documentFileInput\"\r\n                                            type=\"file\"\r\n                                            accept=\".pdf,.jpg,.jpeg,.png\"\r\n                                            onChange={handleDocumentFileChange}\r\n                                            className=\"w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"\r\n                                        />\r\n                                        {documentFile && (\r\n                                            <p className=\"mt-2 text-xs text-slate-500\">\r\n                                                Selected: {documentFile.name} ({(documentFile.size / 1024).toFixed(1)} KB)\r\n                                            </p>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        onClick={addDocumentToList}\r\n                                        className=\"w-full py-2 bg-blue-600 text-white text-sm font-bold rounded-lg hover:bg-blue-700 transition-colors\"\r\n                                    >\r\n                                        + Add to List\r\n                                    </button>\r\n                                </div>\r\n\r\n                                {/* Uploaded Documents List */}\r\n                                {uploadedDocuments.length > 0 && (\r\n                                    <div>\r\n                                        <h4 className=\"text-sm font-bold text-slate-700 uppercase tracking-wider mb-3\">\r\n                                            Documents to Upload ({uploadedDocuments.length})\r\n                                        </h4>\r\n                                        <div className=\"space-y-2\">\r\n                                            {uploadedDocuments.map((doc, idx) => (\r\n                                                <div key={idx} className=\"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg\">\r\n                                                    <div className=\"flex-1\">\r\n                                                        <div className=\"text-sm font-bold text-slate-800\">{doc.name}</div>\r\n                                                        <div className=\"text-xs text-slate-500 mt-1\">\r\n                                                            {doc.fileName} ‚Ä¢ {(doc.fileSize / 1024).toFixed(1)} KB\r\n                                                            {doc.verified && <span className=\"ml-2 text-emerald-600\">‚úì Verified</span>}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    {!doc.verified && (\r\n                                                        <button\r\n                                                            onClick={() => removeDocumentFromList(idx)}\r\n                                                            className=\"ml-3 p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\r\n                                                        >\r\n                                                            <Trash2 size={16} />\r\n                                                        </button>\r\n                                                    )}\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Footer */}\r\n                            <div className=\"px-6 py-4 border-t border-slate-100 flex gap-3\">\r\n                                <button\r\n                                    onClick={() => setShowDocumentModal(false)}\r\n                                    className=\"flex-1 py-2 border border-slate-200 text-slate-600 font-bold rounded-lg hover:bg-slate-50 transition-colors\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    onClick={saveDocuments}\r\n                                    disabled={uploadedDocuments.length === 0}\r\n                                    className={`flex-1 py-2 font-bold rounded-lg transition-colors ${uploadedDocuments.length > 0\r\n                                        ? 'bg-emerald-600 text-white hover:bg-emerald-700'\r\n                                        : 'bg-slate-100 text-slate-400 cursor-not-allowed'\r\n                                        }`}\r\n                                >\r\n                                    Save Documents ({uploadedDocuments.length})\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n        </div >\r\n    );\r\n}\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\ApplicantsDocumentFunctions.jsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'setDocumentApplicant' is not defined.","line":14,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'setUploadedDocuments' is not defined.","line":15,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":15,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'setDocumentName' is not defined.","line":16,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'setDocumentFile' is not defined.","line":17,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":17,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'setShowDocumentModal' is not defined.","line":18,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":18,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":28,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":28,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":34,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":34,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'setDocumentFile' is not defined.","line":38,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":38,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'documentName' is not defined.","line":44,"column":10,"nodeType":"Identifier","messageId":"undef","endLine":44,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":45,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":45,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'documentFile' is not defined.","line":49,"column":10,"nodeType":"Identifier","messageId":"undef","endLine":49,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":50,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":50,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'documentName' is not defined.","line":55,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":55,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'documentFile' is not defined.","line":56,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":56,"endColumn":31},{"ruleId":"no-undef","severity":2,"message":"'documentFile' is not defined.","line":57,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":57,"endColumn":31},{"ruleId":"no-undef","severity":2,"message":"'documentFile' is not defined.","line":58,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":58,"endColumn":31},{"ruleId":"no-undef","severity":2,"message":"'documentFile' is not defined.","line":59,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":59,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'setUploadedDocuments' is not defined.","line":64,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":64,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'setDocumentName' is not defined.","line":65,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":65,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'setDocumentFile' is not defined.","line":66,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":66,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":72,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":72,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'setUploadedDocuments' is not defined.","line":77,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":77,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'uploadedDocuments' is not defined.","line":82,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":82,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":83,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":83,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'uploadedDocuments' is not defined.","line":90,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":90,"endColumn":26},{"ruleId":"no-unused-vars","severity":2,"message":"'res' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":97,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"res"},"fix":{"range":[2863,3099],"text":""},"desc":"Remove unused variable 'res'."}]},{"ruleId":"no-undef","severity":2,"message":"'api' is not defined.","line":97,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":97,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'documentApplicant' is not defined.","line":98,"column":41,"nodeType":"Identifier","messageId":"undef","endLine":98,"endColumn":58},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":105,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":105,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'setShowDocumentModal' is not defined.","line":106,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":106,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'loadApplicants' is not defined.","line":107,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":107,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":110,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":110,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'api' is not defined.","line":117,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":117,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":121,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":121,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'loadApplicants' is not defined.","line":122,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":122,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'message' is not defined.","line":125,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":125,"endColumn":16}],"suppressedMessages":[],"errorCount":36,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Document Upload Helper Functions for Applicants.jsx\r\n// Add these functions to your Applicants.jsx component\r\n\r\n// Helper function to check if all documents are verified\r\nconst areAllDocumentsVerified = (applicant) => {\r\n    if (!applicant.customDocuments || applicant.customDocuments.length === 0) {\r\n        return false; // No documents uploaded\r\n    }\r\n    return applicant.customDocuments.every(doc => doc.verified === true);\r\n};\r\n\r\n// Open document upload modal\r\nconst openDocumentModal = (applicant) => {\r\n    setDocumentApplicant(applicant);\r\n    setUploadedDocuments(applicant.customDocuments || []);\r\n    setDocumentName('');\r\n    setDocumentFile(null);\r\n    setShowDocumentModal(true);\r\n};\r\n\r\n// Handle document file selection\r\nconst handleDocumentFileChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n        // Validate file type (PDF, JPG, PNG)\r\n        const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];\r\n        if (!allowedTypes.includes(file.type)) {\r\n            message.error('Only PDF, JPG, and PNG files are allowed');\r\n            return;\r\n        }\r\n\r\n        // Validate file size (max 5MB)\r\n        if (file.size > 5 * 1024 * 1024) {\r\n            message.error('File size must be less than 5MB');\r\n            return;\r\n        }\r\n\r\n        setDocumentFile(file);\r\n    }\r\n};\r\n\r\n// Add document to list\r\nconst addDocumentToList = () => {\r\n    if (!documentName.trim()) {\r\n        message.error('Please enter document name');\r\n        return;\r\n    }\r\n\r\n    if (!documentFile) {\r\n        message.error('Please select a file');\r\n        return;\r\n    }\r\n\r\n    const newDoc = {\r\n        name: documentName.trim(),\r\n        fileName: documentFile.name,\r\n        fileSize: documentFile.size,\r\n        fileType: documentFile.type,\r\n        file: documentFile,\r\n        verified: false,\r\n        uploadedAt: new Date()\r\n    };\r\n\r\n    setUploadedDocuments(prev => [...prev, newDoc]);\r\n    setDocumentName('');\r\n    setDocumentFile(null);\r\n\r\n    // Reset file input\r\n    const fileInput = document.getElementById('documentFileInput');\r\n    if (fileInput) fileInput.value = '';\r\n\r\n    message.success('Document added to list');\r\n};\r\n\r\n// Remove document from list\r\nconst removeDocumentFromList = (index) => {\r\n    setUploadedDocuments(prev => prev.filter((_, idx) => idx !== index));\r\n};\r\n\r\n// Save all documents to backend\r\nconst saveDocuments = async () => {\r\n    if (uploadedDocuments.length === 0) {\r\n        message.error('Please add at least one document');\r\n        return;\r\n    }\r\n\r\n    try {\r\n        const formData = new FormData();\r\n\r\n        uploadedDocuments.forEach((doc, index) => {\r\n            if (doc.file) {\r\n                formData.append('documents', doc.file);\r\n                formData.append(`documentNames[${index}]`, doc.name);\r\n            }\r\n        });\r\n\r\n        const res = await api.post(\r\n            `/requirements/applicants/${documentApplicant._id}/documents`,\r\n            formData,\r\n            {\r\n                headers: { 'Content-Type': 'multipart/form-data' }\r\n            }\r\n        );\r\n\r\n        message.success('Documents uploaded successfully');\r\n        setShowDocumentModal(false);\r\n        loadApplicants(); // Refresh data\r\n    } catch (err) {\r\n        console.error('Document upload error:', err);\r\n        message.error(err.response?.data?.message || 'Failed to upload documents');\r\n    }\r\n};\r\n\r\n// Verify a specific document\r\nconst verifyDocument = async (applicantId, documentIndex) => {\r\n    try {\r\n        await api.patch(\r\n            `/requirements/applicants/${applicantId}/documents/${documentIndex}/verify`\r\n        );\r\n\r\n        message.success('Document verified');\r\n        loadApplicants(); // Refresh data\r\n    } catch (err) {\r\n        console.error('Document verification error:', err);\r\n        message.error('Failed to verify document');\r\n    }\r\n};\r\n\r\nexport {\r\n    areAllDocumentsVerified,\r\n    openDocumentModal,\r\n    handleDocumentFileChange,\r\n    addDocumentToList,\r\n    removeDocumentFromList,\r\n    saveDocuments,\r\n    verifyDocument\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\AttendanceAdmin.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token `}`. Did you mean `&rbrace;` or `{\"}\"}`?","line":524,"column":14}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Pagination } from 'antd';\r\nimport api from '../../utils/api';\r\nimport {\r\n    Search, Filter, Download,\r\n    Settings, ShieldAlert,\r\n    User, Clock, MapPin,\r\n    MoreVertical, Edit2, Lock, X, Eye, ChevronLeft, ChevronRight, Upload,\r\n    CheckCircle, XCircle, AlertTriangle, AlertCircle, LayoutDashboard, History\r\n} from 'lucide-react';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\nimport AttendanceSettings from './AttendanceSettings';\r\nimport AttendanceCalendar from '../../components/AttendanceCalendar';\r\nimport { DatePicker } from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport AttendanceHistory from './AttendanceHistory';\r\nimport * as XLSX from 'xlsx';\r\n\r\nexport default function AttendanceAdmin() {\r\n    const [view, setView] = useState('dashboard'); // dashboard, settings\r\n    const [attendance, setAttendance] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\r\n\r\n    // Register View for specific employee\r\n    const [viewingEmployee, setViewingEmployee] = useState(null);\r\n    const [employeeAttendance, setEmployeeAttendance] = useState([]);\r\n    const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());\r\n    const [currentYear, setCurrentYear] = useState(new Date().getFullYear());\r\n    const [holidays, setHolidays] = useState([]);\r\n    const [settings, setSettings] = useState({});\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const pageSize = 10;\r\n\r\n    // Edit Attendance Modal\r\n    const [editingAttendance, setEditingAttendance] = useState(null);\r\n    const [editForm, setEditForm] = useState({\r\n        status: 'present',\r\n        checkIn: '',\r\n        checkOut: '',\r\n        reason: ''\r\n    });\r\n    const [saving, setSaving] = useState(false);\r\n    const [uploading, setUploading] = useState(false);\r\n    const [uploadedData, setUploadedData] = useState(null);\r\n    const [showUploadPreview, setShowUploadPreview] = useState(false);\r\n    const fileInputRef = React.useRef(null);\r\n\r\n    useEffect(() => {\r\n        if (view === 'dashboard') {\r\n            fetchStats();\r\n        }\r\n    }, [view, date]);\r\n\r\n    const fetchStats = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const res = await api.get(`/attendance/all?date=${date}`);\r\n            setAttendance(res.data);\r\n        } catch (err) {\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (viewingEmployee) fetchEmployeeRegister();\r\n    }, [viewingEmployee, currentMonth, currentYear]);\r\n\r\n    const fetchEmployeeRegister = async () => {\r\n        try {\r\n            const [attRes, holidayRes, settingsRes] = await Promise.all([\r\n                api.get(`/attendance/my?employeeId=${viewingEmployee._id}&month=${currentMonth + 1}&year=${currentYear}`),\r\n                api.get('/holidays'),\r\n                api.get('/attendance/settings')\r\n            ]);\r\n            setEmployeeAttendance(attRes.data);\r\n            setHolidays(holidayRes.data || []);\r\n            setSettings(settingsRes.data || {});\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    const handleSaveEdit = async () => {\r\n        if (!editForm.reason.trim()) {\r\n            alert('Please provide a reason for the override');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setSaving(true);\r\n            const payload = {\r\n                employeeId: editingAttendance.employee._id || editingAttendance.employee,\r\n                date: editingAttendance.date,\r\n                status: editForm.status,\r\n                reason: editForm.reason\r\n            };\r\n\r\n            if (editForm.checkIn) {\r\n                payload.checkIn = new Date(editForm.checkIn).toISOString();\r\n            }\r\n            if (editForm.checkOut) {\r\n                payload.checkOut = new Date(editForm.checkOut).toISOString();\r\n            }\r\n\r\n            await api.post('/attendance/override', payload);\r\n            setEditingAttendance(null);\r\n            fetchStats(); // Refresh the attendance list\r\n            alert('Attendance updated successfully');\r\n        } catch (err) {\r\n            console.error('Failed to save attendance edit:', err);\r\n            alert(err.response?.data?.error || 'Failed to save attendance');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    // const handleFileUpload = async (e) => {\r\n    //     const file = e.target.files[0];\r\n    //     if (!file) return;\r\n\r\n    //     const formData = new FormData();\r\n    //     formData.append('file', file);\r\n\r\n    //     try {\r\n    //         setUploading(true);\r\n    //         const res = await api.post('/attendance/upload-excel', formData, {\r\n    //             headers: { 'Content-Type': 'multipart/form-data' }\r\n    //         });\r\n    //         alert(res.data.message);\r\n    //         fetchStats();\r\n    //     } catch (err) {\r\n    //         console.error('Upload failed:', err);\r\n    //         alert(err.response?.data?.error || 'Failed to upload attendance');\r\n    //     } finally {\r\n    //         setUploading(false);\r\n    //         if (fileInputRef.current) fileInputRef.current.value = '';\r\n    //     }\r\n    // };\r\n\r\n    const handleFileUpload = (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = (event) => {\r\n            try {\r\n                const data = new Uint8Array(event.target.result);\r\n                const workbook = XLSX.read(data, { type: 'array' });\r\n\r\n                const sheetName = workbook.SheetNames[0]; // first sheet\r\n                const worksheet = workbook.Sheets[sheetName];\r\n\r\n                const jsonData = XLSX.utils.sheet_to_json(worksheet);\r\n\r\n                if (!jsonData || jsonData.length === 0) {\r\n                    alert('Excel file is empty');\r\n                    return;\r\n                }\r\n\r\n                console.log('Total records:', jsonData.length);\r\n\r\n                setUploadedData({\r\n                    fileName: file.name,\r\n                    rowCount: jsonData.length,\r\n                    previewData: jsonData.slice(0, 10), // Show first 10 rows in preview only\r\n                    fullData: jsonData // Store all data for upload\r\n                });\r\n                setShowUploadPreview(true);\r\n            } catch (error) {\r\n                console.error('Error reading file:', error);\r\n                alert('Failed to read Excel file. Please check the file format.');\r\n            }\r\n        };\r\n\r\n        reader.onerror = () => {\r\n            alert('Failed to read the file');\r\n        };\r\n\r\n        reader.readAsArrayBuffer(file);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 pt-6 animate-in fade-in duration-500\">\r\n            {/* Header / Tabs */}\r\n            <div className=\"flex flex-col xl:flex-row xl:items-center justify-between gap-6\">\r\n                <div>\r\n                    <h1 className=\"text-4xl font-black text-slate-800 dark:text-white tracking-tighter uppercase\">Attendance Control</h1>\r\n                    <div className=\"flex flex-wrap gap-4 mt-4\">\r\n                        <TabButton active={view === 'dashboard'} onClick={() => setView('dashboard')} label=\"Live Dashboard\" />\r\n                        <TabButton active={view === 'settings'} onClick={() => setView('settings')} label=\"Policy Settings\" />\r\n                        <TabButton active={view === 'attendanceHistory'} onClick={() => setView('attendanceHistory')} label=\"Attendance History\" />\r\n                    </div>\r\n                </div>\r\n                {view === 'dashboard' && (\r\n                    <div className=\"flex flex-wrap items-center gap-3\">\r\n                        <DatePicker\r\n                            className=\"bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 p-3 rounded-2xl text-sm font-bold uppercase outline-none shadow-sm h-[46px] w-full sm:w-[180px]\"\r\n                            format=\"DD-MM-YYYY\"\r\n                            placeholder=\"DD-MM-YYYY\"\r\n                            allowClear={false}\r\n                            value={date ? dayjs(date) : null}\r\n                            onChange={(d) => setDate(d ? d.format('YYYY-MM-DD') : '')}\r\n                        />\r\n                        <button\r\n                            onClick={fetchStats}\r\n                            disabled={loading}\r\n                            className=\"bg-blue-600 text-white px-6 py-3 rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl shadow-blue-500/20 hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 flex-grow sm:flex-grow-0 justify-center\"\r\n                        >\r\n                            {loading ? (\r\n                                <>\r\n                                    <div className=\"h-4 w-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                                    Syncing...\r\n                                </>\r\n                            ) : (\r\n                                'Sync Logs'\r\n                            )}\r\n                        </button>\r\n\r\n                        <input\r\n                            type=\"file\"\r\n                            ref={fileInputRef}\r\n                            style={{ display: 'none' }}\r\n                            accept=\".xlsx, .xls\"\r\n                            onChange={handleFileUpload}\r\n                        />\r\n                        <button\r\n                            onClick={() => fileInputRef.current?.click()}\r\n                            disabled={uploading}\r\n                            className=\"bg-emerald-600 text-white px-6 py-3 rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl shadow-emerald-500/20 hover:bg-emerald-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 flex-grow sm:flex-grow-0 justify-center\"\r\n                        >\r\n                            <Upload size={16} />\r\n                            {uploading ? 'Uploading...' : 'Upload Excel'}\r\n                        </button>\r\n                    </div>\r\n                )}\r\n        <div className=\"space-y-6 sm:space-y-8 p-4 sm:p-6 animate-in fade-in duration-500\">\r\n            {/* Header / Tabs */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                <div>\r\n                    <h1 className=\"text-2xl sm:text-3xl font-bold text-slate-900 tracking-tight\">Attendance Dashboard</h1>\r\n                    <p className=\"text-slate-500 text-sm mt-1\">Monitor daily attendance, check-ins, and irregularities.</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3 self-start md:self-auto\">\r\n                    {view === 'dashboard' && (\r\n                        <>\r\n                            <DatePicker\r\n                                className=\"w-[160px] px-4 py-2 border border-slate-200 rounded-lg text-sm font-medium focus:border-blue-500 hover:border-blue-400 shadow-sm\"\r\n                                format=\"DD-MM-YYYY\"\r\n                                placeholder=\"Select Date\"\r\n                                allowClear={false}\r\n                                value={date ? dayjs(date) : null}\r\n                                onChange={(d) => setDate(d ? d.format('YYYY-MM-DD') : '')}\r\n                            />\r\n                            <button\r\n                                onClick={fetchStats}\r\n                                disabled={loading}\r\n                                className=\"p-2.5 bg-white border border-slate-200 text-slate-600 rounded-lg hover:bg-slate-50 hover:text-blue-600 transition shadow-sm\"\r\n                                title=\"Sync Logs\"\r\n                            >\r\n                                <div className={`${loading ? 'animate-spin' : ''}`}>\r\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\" /><path d=\"M3 3v5h5\" /><path d=\"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16\" /><path d=\"M16 16h5v5\" /></svg>\r\n                                </div>\r\n                            </button>\r\n                            <input\r\n                                type=\"file\"\r\n                                ref={fileInputRef}\r\n                                style={{ display: 'none' }}\r\n                                accept=\".xlsx, .xls\"\r\n                                onChange={handleFileUpload}\r\n                            />\r\n                            <button\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                disabled={uploading}\r\n                                className=\"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700 transition shadow-sm\"\r\n                            >\r\n                                <Upload size={16} />\r\n                                <span className=\"hidden sm:inline\">Upload Excel</span>\r\n                            </button>\r\n                        </>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex bg-slate-100/80 p-1.5 rounded-xl w-fit border border-slate-200/50 backdrop-blur-sm\">\r\n                <TabButton active={view === 'dashboard'} onClick={() => setView('dashboard')} label=\"Live Dashboard\" icon={<LayoutDashboard size={14} />} />\r\n                <TabButton active={view === 'attendanceHistory'} onClick={() => setView('attendanceHistory')} label=\"History\" icon={<History size={14} />} />\r\n                <TabButton active={view === 'settings'} onClick={() => setView('settings')} label=\"Settings\" icon={<Settings size={14} />} />\r\n            </div>\r\n\r\n            {view === 'dashboard' ? (\r\n                <div className=\"space-y-6\">\r\n                    {/* Summary Cards */}\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        <StatItem\r\n                            label=\"Active Count\"\r\n                            value={attendance.length}\r\n                            icon={<User size={22} className=\"text-blue-600\" />}\r\n                            gradient=\"from-blue-50 to-white\"\r\n                            border=\"border-blue-100\"\r\n                            textColor=\"text-blue-900\"\r\n                        />\r\n                        <StatItem\r\n                            label=\"Present\"\r\n                            value={attendance.filter(a => a.status === 'present').length}\r\n                            icon={<CheckCircle size={22} className=\"text-emerald-600\" />}\r\n                            gradient=\"from-emerald-50 to-white\"\r\n                            border=\"border-emerald-100\"\r\n                            textColor=\"text-emerald-900\"\r\n                        />\r\n                        <StatItem\r\n                            label=\"Absent\"\r\n                            value={attendance.filter(a => a.status === 'absent').length}\r\n                            icon={<XCircle size={22} className=\"text-rose-600\" />}\r\n                            gradient=\"from-rose-50 to-white\"\r\n                            border=\"border-rose-100\"\r\n                            textColor=\"text-rose-900\"\r\n                        />\r\n                        <StatItem\r\n                            label=\"Late Comers\"\r\n                            value={attendance.filter(a => a.isLate).length}\r\n                            icon={<Clock size={22} className=\"text-amber-600\" />}\r\n                            gradient=\"from-amber-50 to-white\"\r\n                            border=\"border-amber-100\"\r\n                            textColor=\"text-amber-900\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Table */}\r\n                    <div className=\"bg-white dark:bg-slate-900 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-xl overflow-hidden flex flex-col\">\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full text-left min-w-max\">\r\n                                <thead className=\"bg-slate-50/50 dark:bg-slate-950/50 border-b border-slate-100 dark:border-slate-800\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap\">Employee</th>\r\n                                        <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap\">Status</th>\r\n                                        <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap\">In/Out</th>\r\n                                        <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap\">Hours</th>\r\n                                        <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap\">Override</th>\r\n                                        <th className=\"px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right whitespace-nowrap\">Action</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-slate-50 dark:divide-slate-800\">\r\n                                    {attendance.slice((currentPage - 1) * pageSize, currentPage * pageSize).map((item) => (\r\n                                        <tr key={item._id} className=\"hover:bg-slate-50/50 dark:hover:bg-slate-800/30 transition-colors group\">\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <div className=\"h-10 w-10 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400 overflow-hidden shadow-inner font-black text-xs\">\r\n                                                        {item.employee?.firstName?.[0]}\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <div className=\"text-sm font-black text-slate-800 dark:text-white uppercase tracking-tighter\">{item.employee?.firstName} {item.employee?.lastName}</div>\r\n                                                        <div className=\"text-[10px] font-bold text-slate-400\">{item.employee?.employeeId}</div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <StatusChip status={item.status} />\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-xs font-bold text-slate-600 dark:text-slate-400\">\r\n                                                <div className=\"flex flex-col gap-1\">\r\n                                                    <div className=\"flex items-center gap-1.5\">\r\n                                                        <Clock size={12} className=\"text-emerald-500\" />\r\n                                                        {item.checkIn ? new Date(item.checkIn).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '--:--'}\r\n                                                    </div>\r\n                                                    <div className=\"flex items-center gap-1.5\">\r\n                                                        <Clock size={12} className=\"text-rose-500\" />\r\n                                                        {item.checkOut ? new Date(item.checkOut).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '--:--'}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <span className=\"text-sm font-black text-slate-800 dark:text-white tracking-widest\">\r\n                                                    {item.workingHours?.toFixed(1) || '0.0'} <span className=\"text-[10px] opacity-30\">HRS</span>\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                {item.isManualOverride ? (\r\n                                                    <div className=\"flex items-center gap-1.5 px-3 py-1 bg-amber-50 text-amber-600 rounded-lg border border-amber-100 w-fit\">\r\n                                                        <ShieldAlert size={12} />\r\n                                                        <span className=\"text-[9px] font-black uppercase\">Modified</span>\r\n                                                    </div>\r\n                                                ) : <span className=\"text-[10px] font-bold text-slate-300\">-</span>}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-right flex gap-1 justify-end\">\r\n                                                <button\r\n                                                    onClick={() => setViewingEmployee(item.employee)}\r\n                                                    className=\"p-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-slate-400 hover:text-blue-500 rounded-xl transition\"\r\n                                                    title=\"View Register\"\r\n                                                >\r\n                                                    <Eye size={16} />\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => {\r\n                                                        const dateStr = new Date(item.date).toISOString().split('T')[0];\r\n                                                        setEditingAttendance(item);\r\n                                                        setEditForm({\r\n                                                            status: item.status || 'present',\r\n                                                            checkIn: item.checkIn ? new Date(item.checkIn).toISOString().slice(0, 16) : '',\r\n                                                            checkOut: item.checkOut ? new Date(item.checkOut).toISOString().slice(0, 16) : '',\r\n                                                            reason: item.overrideReason || ''\r\n                                                        });\r\n                                                    }}\r\n                                                    className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl text-slate-400 group-hover:text-blue-500 transition-colors\"\r\n                                                    title=\"Edit Attendance\"\r\n                                                >\r\n                                                    <Edit2 size={16} />\r\n                                                </button>\r\n                                            </td>\r\n                    <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden\">\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"min-w-full text-left text-sm divide-y divide-slate-100\">\r\n                                <thead className=\"bg-slate-50/50\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Employee</th>\r\n                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Status</th>\r\n                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Check In / Out</th>\r\n                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Hours</th>\r\n                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider\">Note</th>\r\n                                        <th className=\"px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right\">Action</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-slate-100 bg-white\">\r\n                                    {attendance.length === 0 ? (\r\n                                        <tr>\r\n                                            <td colSpan=\"6\" className=\"px-6 py-8 text-center text-slate-500\">\r\n                                                No attendance records found for this date.\r\n                                            </td>\r\n                                        </tr>\r\n                                    ) : attendance.slice((currentPage - 1) * pageSize, currentPage * pageSize).map((item) => (\r\n                                        <tr key={item._id} className=\"hover:bg-slate-50 transition-colors group\">\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <div className=\"h-9 w-9 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 text-xs font-bold border border-slate-200\">\r\n                                                        {item.employee?.firstName?.[0]}\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <div className=\"font-semibold text-slate-900\">{item.employee?.firstName} {item.employee?.lastName}</div>\r\n                                                        <div className=\"text-xs text-slate-500 font-mono\">{item.employee?.employeeId}</div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                <StatusChip status={item.status} />\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                <div className=\"flex flex-col gap-1 text-xs\">\r\n                                                    <div className=\"flex items-center gap-2 text-emerald-700\">\r\n                                                        <span className=\"font-medium w-8\">IN</span>\r\n                                                        <span className=\"bg-emerald-50 px-1.5 py-0.5 rounded text-emerald-700 font-mono border border-emerald-100\">\r\n                                                            {item.checkIn ? new Date(item.checkIn).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '--:--'}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <div className=\"flex items-center gap-2 text-rose-700\">\r\n                                                        <span className=\"font-medium w-8\">OUT</span>\r\n                                                        <span className=\"bg-rose-50 px-1.5 py-0.5 rounded text-rose-700 font-mono border border-rose-100\">\r\n                                                            {item.checkOut ? new Date(item.checkOut).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '--:--'}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                <span className=\"font-mono text-slate-700 font-medium\">{item.workingHours?.toFixed(1) || '0.0'}</span> <span className=\"text-xs text-slate-400\">hrs</span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                {item.isManualOverride ? (\r\n                                                    <div className=\"flex items-center gap-1.5 text-amber-600\" title=\"Manually Modified\">\r\n                                                        <ShieldAlert size={14} />\r\n                                                        <span className=\"text-xs font-medium\">Modified</span>\r\n                                                    </div>\r\n                                                ) : <span className=\"text-slate-300\">-</span>}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-right\">\r\n                                                <div className=\"flex justify-end gap-1\">\r\n                                                    <button\r\n                                                        onClick={() => setViewingEmployee(item.employee)}\r\n                                                        className=\"p-1.5 hover:bg-blue-50 text-slate-400 hover:text-blue-600 rounded transition\"\r\n                                                        title=\"View Register\"\r\n                                                    >\r\n                                                        <Eye size={16} />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => {\r\n                                                            setEditingAttendance(item);\r\n                                                            setEditForm({\r\n                                                                status: item.status || 'present',\r\n                                                                checkIn: item.checkIn ? new Date(item.checkIn).toISOString().slice(0, 16) : '',\r\n                                                                checkOut: item.checkOut ? new Date(item.checkOut).toISOString().slice(0, 16) : '',\r\n                                                                reason: item.overrideReason || ''\r\n                                                            });\r\n                                                        }}\r\n                                                        className=\"p-1.5 hover:bg-slate-100 text-slate-400 hover:text-slate-700 rounded transition\"\r\n                                                        title=\"Edit Attendance\"\r\n                                                    >\r\n                                                        <Edit2 size={16} />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                        <div className=\"px-6 py-4 border-t border-slate-100 dark:border-slate-800 flex justify-end\">\r\n                        <div className=\"px-6 py-4 border-t border-slate-100 flex justify-end\">\r\n                            <Pagination\r\n                                current={currentPage}\r\n                                pageSize={pageSize}\r\n                                total={attendance.length}\r\n                                onChange={(page) => setCurrentPage(page)}\r\n                                showSizeChanger={false}\r\n                                size=\"small\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            ) : view === 'settings' ? (\r\n                <AttendanceSettings />\r\n            ) : (\r\n                <AttendanceHistory />\r\n            )}\r\n\r\n            {/* Employee Register Modal (Reuse the same logic) */}\r\n            {viewingEmployee && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"absolute inset-0 bg-slate-900/60 backdrop-blur-sm\" onClick={() => setViewingEmployee(null)}></div>\r\n                    <div className=\"relative w-full w-full max-h-[90vh] overflow-y-auto bg-slate-50 dark:bg-slate-950 rounded-[40px] shadow-2xl border border-white/20 p-8 animate-in zoom-in-95 duration-200\">\r\n                        <div className=\"flex justify-between items-center mb-8\">\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className=\"h-14 w-14 rounded-2xl bg-white dark:bg-slate-800 flex items-center justify-center text-slate-300 font-black text-xl shadow-lg\">\r\n                                    {viewingEmployee.firstName[0]}\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">\r\n                                        {viewingEmployee.firstName} {viewingEmployee.lastName}'s Register\r\n                                    </h3>\r\n                                    <p className=\"text-xs font-bold text-slate-400 uppercase tracking-widest\">{viewingEmployee.employeeId}</p>\r\n                                </div>\r\n                            </div>\r\n                            <button onClick={() => setViewingEmployee(null)} className=\"p-3 bg-white dark:bg-slate-800 rounded-2xl text-slate-400 hover:text-rose-500 shadow-lg transition\">\r\n                                <X size={24} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"flex items-center gap-4 bg-white dark:bg-slate-900 p-3 rounded-2xl w-fit border border-slate-100 dark:border-slate-800 shadow-sm\">\r\n                                <button onClick={() => setCurrentMonth(m => m === 0 ? 11 : m - 1)} className=\"p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition\"><ChevronLeft size={20} /></button>\r\n                                <span className=\"text-sm font-black uppercase tracking-widest min-w-[120px] text-center\">\r\n                                    {new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long', year: 'numeric' })}\r\n                                </span>\r\n                                <button onClick={() => setCurrentMonth(m => m === 11 ? 0 : m + 1)} className=\"p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition\"><ChevronRight size={20} /></button>\r\n                            </div>\r\n\r\n                            <AttendanceCalendar\r\n                                data={employeeAttendance}\r\n                                holidays={holidays}\r\n                                settings={settings}\r\n                                currentMonth={currentMonth}\r\n                                currentYear={currentYear}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Edit Attendance Modal */}\r\n            {editingAttendance && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"absolute inset-0 bg-slate-900/60 backdrop-blur-sm\" onClick={() => setEditingAttendance(null)}></div>\r\n                    <div className=\"relative w-full max-w-md bg-white dark:bg-slate-900 rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-800 p-8 animate-in zoom-in-95 duration-200\">\r\n                        <div className=\"flex justify-between items-center mb-6\">\r\n                            <div>\r\n                                <h3 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">\r\n                                    Edit Attendance\r\n                                </h3>\r\n                                <p className=\"text-xs font-bold text-slate-400 mt-1\">\r\n                                    {editingAttendance.employee?.firstName} {editingAttendance.employee?.lastName} - {formatDateDDMMYYYY(editingAttendance.date)}\r\n                                </p>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => setEditingAttendance(null)}\r\n                                className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl text-slate-400 hover:text-rose-500 transition\"\r\n                            >\r\n                                <X size={20} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">\r\n                                    Status *\r\n                                </label>\r\n                                <select\r\n                                    value={editForm.status}\r\n                                    onChange={(e) => setEditForm({ ...editForm, status: e.target.value })}\r\n                                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                                >\r\n                                    <option value=\"present\">Present</option>\r\n                                    <option value=\"absent\">Absent</option>\r\n                                    <option value=\"half_day\">Half Day</option>\r\n                                    <option value=\"leave\">Leave</option>\r\n                                    <option value=\"missed_punch\">Missed Punch</option>\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">\r\n                                    Check In Time\r\n                                </label>\r\n                                <input\r\n                                    type=\"datetime-local\"\r\n                                    value={editForm.checkIn}\r\n                                    onChange={(e) => setEditForm({ ...editForm, checkIn: e.target.value })}\r\n                                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">\r\n                                    Check Out Time\r\n                                </label>\r\n                                <input\r\n                                    type=\"datetime-local\"\r\n                                    value={editForm.checkOut}\r\n                                    onChange={(e) => setEditForm({ ...editForm, checkOut: e.target.value })}\r\n                                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">\r\n                                    Reason for Override *\r\n                                </label>\r\n                                <textarea\r\n                                    value={editForm.reason}\r\n                                    onChange={(e) => setEditForm({ ...editForm, reason: e.target.value })}\r\n                                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition resize-none\"\r\n                                    rows=\"3\"\r\n                                    placeholder=\"Enter reason for manual override...\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-3 mt-8\">\r\n                            <button\r\n                                onClick={() => setEditingAttendance(null)}\r\n                                disabled={saving}\r\n                                className=\"flex-1 px-6 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl text-sm font-black uppercase tracking-widest hover:bg-slate-200 dark:hover:bg-slate-700 transition disabled:opacity-50\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleSaveEdit}\r\n                                disabled={saving || !editForm.reason.trim()}\r\n                                className=\"flex-1 px-6 py-3 bg-blue-600 text-white rounded-xl text-sm font-black uppercase tracking-widest shadow-xl shadow-blue-500/20 hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                            >\r\n                                {saving ? (\r\n                                    <>\r\n                                        <div className=\"h-4 w-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                                        Saving...\r\n                                    </>\r\n                                ) : (\r\n                                    'Save Changes'\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Upload Preview Modal */}\r\n            {showUploadPreview && uploadedData && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"absolute inset-0 bg-slate-900/60 backdrop-blur-sm\" onClick={() => setShowUploadPreview(false)}></div>\r\n                    <div className=\"relative w-full max-w-4xl max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900 rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-800 p-8 animate-in zoom-in-95 duration-200\">\r\n                        <div className=\"flex justify-between items-center mb-6\">\r\n                            <div>\r\n                                <h3 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">\r\n                                    Upload Preview\r\n                                </h3>\r\n                                <p className=\"text-xs font-bold text-slate-400 mt-1\">\r\n                                    File: {uploadedData.fileName} ‚Ä¢ Total Records: {uploadedData.rowCount}\r\n                                </p>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => setShowUploadPreview(false)}\r\n                                className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl text-slate-400 hover:text-rose-500 transition\"\r\n                            >\r\n                                <X size={24} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        {uploadedData.previewData.length > 0 ? (\r\n                            <div className=\"overflow-x-auto mb-6\">\r\n                                <table className=\"w-full text-sm\">\r\n                                    <thead className=\"bg-slate-50 dark:bg-slate-950 border-b border-slate-200 dark:border-slate-800\">\r\n                                        <tr>\r\n                                            {Object.keys(uploadedData.previewData[0]).map((header, idx) => (\r\n                                                <th key={idx} className=\"px-4 py-3 text-left text-[10px] font-black text-slate-600 dark:text-slate-400 uppercase tracking-widest\">\r\n                                                    {header}\r\n                                                </th>\r\n                                            ))}\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800\">\r\n                                        {uploadedData.previewData.map((row, idx) => (\r\n                                            <tr key={idx} className=\"hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-colors\">\r\n                                                {Object.values(row).map((value, colIdx) => (\r\n                                                    <td key={colIdx} className=\"px-4 py-3 text-xs font-bold text-slate-700 dark:text-slate-300\">\r\n                                                        {String(value)}\r\n                                                    </td>\r\n                                                ))}\r\n                                            </tr>\r\n                                        ))}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"text-center py-8\">\r\n                                <p className=\"text-slate-500 dark:text-slate-400 font-bold\">No data to display</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {uploadedData.rowCount > 10 && (\r\n                            <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-2xl p-4 mb-6\">\r\n                                <p className=\"text-xs font-bold text-blue-700 dark:text-blue-400\">\r\n                                    Showing first 10 of {uploadedData.rowCount} records\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"flex gap-3\">\r\n                            <button\r\n                                onClick={() => setShowUploadPreview(false)}\r\n                                className=\"flex-1 px-6 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl text-sm font-black uppercase tracking-widest hover:bg-slate-200 dark:hover:bg-slate-700 transition\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={async () => {\r\n                                    try {\r\n                                        setUploading(true);\r\n                                        console.log('Uploading', uploadedData.fullData.length, 'records');\r\n                                        const res = await api.post('/attendance/bulk-upload', {\r\n                                            records: uploadedData.fullData\r\n                                        });\r\n                                        alert(`‚úÖ ${res.data.uploadedCount} records uploaded successfully${res.data.failedCount > 0 ? `\\n‚ö†Ô∏è ${res.data.failedCount} records failed` : ''}`);\r\n                                        setShowUploadPreview(false);\r\n                                        setUploadedData(null);\r\n                                        if (fileInputRef.current) fileInputRef.current.value = '';\r\n                                        fetchStats();\r\n                                    } catch (err) {\r\n                                        console.error('Upload failed:', err);\r\n                                        alert(err.response?.data?.message || err.response?.data?.error || 'Failed to upload attendance');\r\n                                    } finally {\r\n                                        setUploading(false);\r\n                                    }\r\n                                }}\r\n                                disabled={uploading}\r\n                                className=\"flex-1 px-6 py-3 bg-emerald-600 text-white rounded-xl text-sm font-black uppercase tracking-widest shadow-xl shadow-emerald-500/20 hover:bg-emerald-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                            >\r\n                                {uploading ? (\r\n                                    <>\r\n                                        <div className=\"h-4 w-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                                        Uploading...\r\n                                    </>\r\n                                ) : (\r\n                                    'Confirm Upload'\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction StatItem({ label, value, icon, gradient, border, textColor = \"text-slate-800\" }) {\r\n    return (\r\n        <div className={`relative p-5 rounded-2xl border ${border} bg-gradient-to-br ${gradient} shadow-sm group hover:shadow-md transition-all duration-300 overflow-hidden`}>\r\n            {/* Background Decoration */}\r\n            <div className=\"absolute -right-6 -top-6 opacity-5 group-hover:opacity-10 transition-opacity transform group-hover:scale-110 duration-500\">\r\n                {React.cloneElement(icon, { size: 80 })}\r\n            </div>\r\n\r\n            <div className=\"relative flex justify-between items-start\">\r\n                <div>\r\n                    <div className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5\">{label}</div>\r\n                    <div className={`text-3xl font-bold ${textColor} tracking-tight`}>{value}</div>\r\n                </div>\r\n                <div className={`p-2.5 rounded-xl bg-white/80 backdrop-blur-sm border ${border} shadow-sm`}>\r\n                    {icon}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction StatusChip({ status }) {\r\n    const config = {\r\n        present: 'text-emerald-700 bg-emerald-50 border-emerald-200 ring-emerald-200/50',\r\n        absent: 'text-rose-700 bg-rose-50 border-rose-200 ring-rose-200/50',\r\n        leave: 'text-blue-700 bg-blue-50 border-blue-200 ring-blue-200/50',\r\n        half_day: 'text-amber-700 bg-amber-50 border-amber-200 ring-amber-200/50',\r\n        missed_punch: 'text-orange-700 bg-orange-50 border-orange-200 ring-orange-200/50',\r\n        holiday: 'text-purple-700 bg-purple-50 border-purple-200 ring-purple-200/50',\r\n        weekly_off: 'text-slate-600 bg-slate-100 border-slate-200 ring-slate-200/50',\r\n    };\r\n    const style = config[status.toLowerCase()] || 'bg-slate-50 text-slate-500 border-slate-200';\r\n\r\n    return (\r\n        <span className={`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-semibold border ring-1 ring-inset ${style} capitalize shadow-sm`}>\r\n            {status.replace('_', ' ')}\r\n        </span>\r\n    );\r\n}\r\n\r\nfunction TabButton({ active, label, onClick, icon }) {\r\n    return (\r\n        <button\r\n            onClick={onClick}\r\n            className={`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-300\r\n                ${active\r\n                    ? 'bg-white text-indigo-600 shadow-sm ring-1 ring-indigo-100'\r\n                    : 'text-slate-500 hover:text-slate-700 hover:bg-white/50'}\r\n            `}\r\n        >\r\n            {icon && <span className={active ? 'text-indigo-500' : 'text-slate-400'}>{icon}</span>}\r\n            {label}\r\n        </button>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\AttendanceHistory.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'setSelectedMonth' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":12,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":41,"suggestions":[{"messageId":"removeVar","data":{"varName":"setSelectedMonth"},"fix":{"range":[475,493],"text":""},"desc":"Remove unused variable 'setSelectedMonth'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'attendance' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":17,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"attendance"},"fix":{"range":[795,805],"text":""},"desc":"Remove unused variable 'attendance'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'totalWeeklyOffs' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":52,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"totalWeeklyOffs"},"fix":{"range":[2797,2893],"text":""},"desc":"Remove unused variable 'totalWeeklyOffs'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'getAttendanceColor' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":65,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":65,"endColumn":27,"suggestions":[{"messageId":"removeVar","data":{"varName":"getAttendanceColor"},"fix":{"range":[3515,3837],"text":""},"desc":"Remove unused variable 'getAttendanceColor'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'handleRegisterFace' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":199,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":199,"endColumn":27,"suggestions":[{"messageId":"removeVar","data":{"varName":"handleRegisterFace"},"fix":{"range":[8142,8274],"text":""},"desc":"Remove unused variable 'handleRegisterFace'."}]},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":490,"column":28,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":490,"endColumn":42,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[17737,17766],"text":"Object.prototype.hasOwnProperty.call(faceStatusMap, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'faceStatusMap'. Either include it or remove the dependency array.","line":495,"column":6,"nodeType":"ArrayExpression","endLine":495,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [faceStatusMap, newAttendance]","fix":{"range":[17852,17867],"text":"[faceStatusMap, newAttendance]"}}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Calendar, Clock, TrendingUp, Users, Download, Filter, Search,\r\n  ChevronLeft, ChevronRight, UserCheck, AlertCircle, MapPin,\r\n  MoreVertical, Edit2, FileText, BarChart3, PieChart,\r\n  Camera, CheckCircle, XCircle, Trash2, RefreshCw, Loader2, Upload\r\n} from 'lucide-react';\r\nimport * as XLSX from 'xlsx';\r\nimport api from '../../utils/api';\r\n\r\nexport default function AttendanceHistory() {\r\n  const [selectedMonth, setSelectedMonth] = useState('January 2026');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedDepartment, setSelectedDepartment] = useState('All Departments');\r\n  const [selectedStatus, setSelectedStatus] = useState('All Status');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [attendance, setAttendance] = useState([]);\r\n  const [newAttendance, setNewAttendance] = useState({});\r\n  const [faceStatusMap, setFaceStatusMap] = useState({});\r\n  const [loadingFaceStatus, setLoadingFaceStatus] = useState({});\r\n  const [deletingFaceId, setDeletingFaceId] = useState(null);\r\n  const [showFaceRegistrationModal, setShowFaceRegistrationModal] = useState(false);\r\n  const [selectedEmployeeForFace, setSelectedEmployeeForFace] = useState(null);\r\n  const [registeringFaceId, setRegisteringFaceId] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [exporting, setExporting] = useState(false);\r\n  const [showReportModal, setShowReportModal] = useState(false);\r\n  const [selectedEmployeeForDetails, setSelectedEmployeeForDetails] = useState(null);\r\n  const [showUploadModal, setShowUploadModal] = useState(false);\r\n  const [uploadedFile, setUploadedFile] = useState(null);\r\n  const [uploadPreview, setUploadPreview] = useState([]);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [uploadErrors, setUploadErrors] = useState([]);\r\n  const pageSize = 10;\r\n\r\n  const calculateStats = () => {\r\n    if (Object.keys(newAttendance).length === 0) {\r\n      return [\r\n        { label: 'Total Employees', value: '0', icon: Users, color: 'blue', bgColor: 'bg-blue-500' },\r\n        { label: 'Avg Attendance', value: '0%', icon: TrendingUp, color: 'green', bgColor: 'bg-green-500' },\r\n        { label: 'Total Working Hours', value: '0h', icon: Clock, color: 'cyan', bgColor: 'bg-cyan-500' },\r\n        // { label: 'Total Weekly Offs', value: '0', icon: Calendar, color: 'purple', bgColor: 'bg-purple-500' },\r\n      ];\r\n    }\r\n\r\n    const employees = Object.values(newAttendance);\r\n    const totalEmployees = employees.length;\r\n    const avgAttendance = Math.round(\r\n      employees.reduce((sum, emp) => sum + (emp.attendanceRate || 0), 0) / employees.length\r\n    );\r\n    const totalWorkingHours = employees.reduce((sum, emp) => sum + (emp.workingHours || 0), 0);\r\n    const totalWeeklyOffs = employees.reduce((sum, emp) => sum + (emp.weeklyOffDays?.size || 0), 0);\r\n\r\n    return [\r\n      { label: 'Total Employees', value: totalEmployees.toString(), icon: Users, color: 'blue', bgColor: 'bg-blue-500' },\r\n      { label: 'Avg Attendance', value: `${avgAttendance}%`, icon: TrendingUp, color: 'green', bgColor: 'bg-green-500' },\r\n      { label: 'Total Working Hours', value: `${totalWorkingHours.toFixed(1)}h`, icon: Clock, color: 'cyan', bgColor: 'bg-cyan-500' },\r\n      // { label: 'Total Weekly Offs', value: totalWeeklyOffs.toString(), icon: Calendar, color: 'purple', bgColor: 'bg-purple-500' },\r\n    ];\r\n  };\r\n\r\n  const stats = calculateStats();\r\n  const departmentStats = [];\r\n\r\n  const getAttendanceColor = (rate) => {\r\n    if (rate >= 95) return 'text-green-600 bg-green-50 border-green-200';\r\n    if (rate >= 85) return 'text-blue-600 bg-blue-50 border-blue-200';\r\n    if (rate >= 75) return 'text-orange-600 bg-orange-50 border-orange-200';\r\n    return 'text-red-600 bg-red-50 border-red-200';\r\n  };\r\n\r\n  // Export to Excel functionality\r\n  const handleExportReport = async () => {\r\n    try {\r\n      setExporting(true);\r\n      console.log(newAttendance);\r\n      // Prepare data for export\r\n      const exportData = Object.values(newAttendance).map((emp) => ({\r\n        'Employee Name': emp.name,\r\n        'Employee ID': emp.employeeId,\r\n        'Role': emp.role,\r\n        'Present Days': emp.presentDays.size,\r\n        'Absent Days': emp.absentDays.size,\r\n        'Leave Days': emp.leaveDays.size,\r\n        'Holiday Days': emp.holidayDays.size,\r\n        // 'Weekly Offs': emp.weeklyOffDays.size,\r\n        'Half Day': emp.halfDayDays.size,\r\n        'Total Working Hours': emp.workingHours.toFixed(2),\r\n        'Attendance Rate (%)': emp.attendanceRate,\r\n        'Late Arrivals': emp.lateArrivals,\r\n        'Total Days': emp.days.size\r\n      }));\r\n\r\n      if (exportData.length === 0) {\r\n        alert('No attendance data to export');\r\n        setExporting(false);\r\n        return;\r\n      }\r\n\r\n      // Create workbook and worksheet\r\n      const ws = XLSX.utils.json_to_sheet(exportData);\r\n      const wb = XLSX.utils.book_new();\r\n      XLSX.utils.book_append_sheet(wb, ws, 'Attendance Report');\r\n\r\n      // Add summary sheet\r\n      const summaryData = [\r\n        ['Attendance Report Summary'],\r\n        ['Report Generated Date', new Date().toLocaleDateString('en-IN')],\r\n        ['Report Month', selectedMonth],\r\n        ['Total Employees', Object.keys(newAttendance).length],\r\n        ['Average Attendance Rate', stats[1].value],\r\n        ['Total Working Hours', stats[2].value],\r\n        // ['Total Weekly Offs', stats[3].value]\r\n      ];\r\n\r\n      const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);\r\n      XLSX.utils.book_append_sheet(wb, wsSummary, 'Summary');\r\n\r\n      // Generate filename with date\r\n      const fileName = `Attendance_Report_${selectedMonth.replace(/\\\\s+/g, '_')}_${new Date().getTime()}.xlsx`;\r\n\r\n      // Download file\r\n      XLSX.writeFile(wb, fileName);\r\n\r\n      console.log('‚úÖ Report exported successfully');\r\n      alert('Report exported successfully!');\r\n    } catch (error) {\r\n      console.error('‚ùå Error exporting report:', error);\r\n      alert('Error exporting report. Please try again.');\r\n    } finally {\r\n      setExporting(false);\r\n    }\r\n  };\r\n\r\n  const getEmployeeAttendance = async () => {\r\n    try {\r\n      const res = await api.get('/attendance/all');\r\n      console.log('Attendance API Response:', res.data);\r\n      return res.data;\r\n    } catch (error) {\r\n      console.log('Error fetching attendance data:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // Fetch employee face registration status\r\n  const checkFaceRegistration = async (employeeId) => {\r\n    try {\r\n      setLoadingFaceStatus(prev => ({ ...prev, [employeeId]: true }));\r\n      const res = await api.get(`/attendance/face/status?employeeId=${employeeId}`);\r\n      setFaceStatusMap(prev => ({\r\n        ...prev,\r\n        [employeeId]: res.data.isRegistered\r\n      }));\r\n      return res.data.isRegistered;\r\n    } catch (err) {\r\n      console.error('Error checking face status:', err);\r\n      setFaceStatusMap(prev => ({\r\n        ...prev,\r\n        [employeeId]: false\r\n      }));\r\n      return false;\r\n    } finally {\r\n      setLoadingFaceStatus(prev => ({ ...prev, [employeeId]: false }));\r\n    }\r\n  };\r\n\r\n  // Delete face registration for an employee\r\n  const handleDeleteFace = async (employeeId) => {\r\n    if (!window.confirm('Are you sure you want to delete this employee\\'s face registration?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setDeletingFaceId(employeeId);\r\n      const res = await api.delete(`/attendance/face/delete?employeeId=${employeeId}`);\r\n      \r\n      if (res.data.success) {\r\n        setFaceStatusMap(prev => ({\r\n          ...prev,\r\n          [employeeId]: false\r\n        }));\r\n        alert('Face registration deleted successfully');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error deleting face:', err);\r\n      alert(err.response?.data?.message || 'Failed to delete face registration');\r\n    } finally {\r\n      setDeletingFaceId(null);\r\n    }\r\n  };\r\n\r\n  // Refresh face registration status\r\n  const handleRefreshFaceStatus = async (employeeId) => {\r\n    await checkFaceRegistration(employeeId);\r\n  };\r\n\r\n  // Handle face registration button click\r\n  const handleRegisterFace = (employee) => {\r\n    setSelectedEmployeeForFace(employee);\r\n    setShowFaceRegistrationModal(true);\r\n  };\r\n\r\n  // Handle closing the face registration modal\r\n  const closeFaceRegistrationModal = () => {\r\n    setShowFaceRegistrationModal(false);\r\n    setSelectedEmployeeForFace(null);\r\n  };\r\n\r\n  // Submit face registration\r\n  const handleSubmitFaceRegistration = async () => {\r\n    if (!selectedEmployeeForFace) return;\r\n\r\n    try {\r\n      setRegisteringFaceId(selectedEmployeeForFace._id);\r\n      const res = await api.post(`/attendance/face/register`, {\r\n        employeeId: selectedEmployeeForFace._id,\r\n        status: 'pending'\r\n      });\r\n      \r\n      if (res.data.success) {\r\n        alert('Face registration initiated. Please ask the employee to complete registration.');\r\n        closeFaceRegistrationModal();\r\n        await checkFaceRegistration(selectedEmployeeForFace._id);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error initiating face registration:', err);\r\n      alert(err.response?.data?.message || 'Failed to initiate face registration');\r\n    } finally {\r\n      setRegisteringFaceId(null);\r\n    }\r\n  };\r\n\r\n  // Handle viewing employee report\r\n  const handleViewReport = (empId) => {\r\n    const employee = newAttendance[empId];\r\n    if (employee) {\r\n      setSelectedEmployeeForDetails(employee);\r\n      setShowReportModal(true);\r\n    }\r\n  };\r\n\r\n  // Close report modal\r\n  const closeReportModal = () => {\r\n    setShowReportModal(false);\r\n    setSelectedEmployeeForDetails(null);\r\n  };\r\n\r\n  // Handle file upload\r\n  const handleFileUpload = (event) => {\r\n    const file = event.target.files?.[0];\r\n    \r\n    if (!file) {\r\n      setUploadErrors(['Please select a file to upload']);\r\n      setUploadedFile(null);\r\n      return;\r\n    }\r\n\r\n    // Validate file type\r\n    const validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel', 'text/csv'];\r\n    const validExtensions = /\\.(xlsx|xls|csv)$/i;\r\n    \r\n    if (!validExtensions.test(file.name) && !validTypes.includes(file.type)) {\r\n      setUploadErrors(['Invalid file format. Please upload Excel (.xlsx, .xls) or CSV (.csv) file']);\r\n      setUploadedFile(null);\r\n      return;\r\n    }\r\n\r\n    setUploadedFile(file);\r\n    setUploadErrors([]);\r\n\r\n    // Read and preview file\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      try {\r\n        const data = new Uint8Array(e.target.result);\r\n        const workbook = XLSX.read(data, { type: 'array' });\r\n        \r\n        if (!workbook.SheetNames || workbook.SheetNames.length === 0) {\r\n          setUploadErrors(['File is empty or corrupted. Please check your Excel file']);\r\n          return;\r\n        }\r\n\r\n        const sheetName = workbook.SheetNames[0];\r\n        const worksheet = workbook.Sheets[sheetName];\r\n        const jsonData = XLSX.utils.sheet_to_json(worksheet);\r\n\r\n        // Validate data\r\n        if (jsonData.length === 0) {\r\n          setUploadErrors(['File is empty. Please check your Excel file']);\r\n          return;\r\n        }\r\n\r\n        // Check required columns (more flexible - check for partial matches)\r\n        const fileColumns = Object.keys(jsonData[0]);\r\n        const requiredColumns = ['Employee ID', 'Date', 'Status', 'Check In', 'Check Out'];\r\n        const missingColumns = requiredColumns.filter(col => \r\n          !fileColumns.some(fc => fc.toLowerCase().includes(col.toLowerCase()))\r\n        );\r\n\r\n        if (missingColumns.length > 0) {\r\n          setUploadErrors([\r\n            'Missing required columns:',\r\n            ...missingColumns.map(col => `‚Ä¢ ${col}`)\r\n          ]);\r\n          setUploadedFile(null);\r\n          return;\r\n        }\r\n\r\n        // Show preview (first 5 rows)\r\n        setUploadPreview(jsonData.slice(0, 5));\r\n        setUploadErrors([]);\r\n      } catch (error) {\r\n        console.error('File read error:', error);\r\n        setUploadErrors([`Error reading file: ${error.message}`]);\r\n        setUploadedFile(null);\r\n      }\r\n    };\r\n\r\n    reader.onerror = () => {\r\n      setUploadErrors(['Error reading file. Please try again.']);\r\n      setUploadedFile(null);\r\n    };\r\n\r\n    reader.readAsArrayBuffer(file);\r\n  };\r\n\r\n  // Submit upload\r\n  const handleSubmitUpload = async () => {\r\n    if (!uploadedFile) {\r\n      setUploadErrors(['Please select a file first']);\r\n      return;\r\n    }\r\n\r\n    if (uploadErrors.length > 0) {\r\n      alert('Please fix the errors in your file before uploading');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setUploading(true);\r\n      const reader = new FileReader();\r\n\r\n      reader.onload = async (e) => {\r\n        try {\r\n          const data = new Uint8Array(e.target.result);\r\n          const workbook = XLSX.read(data, { type: 'array' });\r\n          const sheetName = workbook.SheetNames[0];\r\n          const worksheet = workbook.Sheets[sheetName];\r\n          const jsonData = XLSX.utils.sheet_to_json(worksheet);\r\n\r\n          // Validate data before sending\r\n          if (jsonData.length === 0) {\r\n            setUploadErrors(['File is empty']);\r\n            setUploading(false);\r\n            return;\r\n          }\r\n\r\n          // Send to backend\r\n          const response = await api.post('/attendance/bulk-upload', {\r\n            records: jsonData\r\n          });\r\n\r\n          if (response.data.success) {\r\n            alert(`‚úÖ Successfully uploaded ${response.data.uploadedCount} attendance records`);\r\n            if (response.data.errors?.length > 0) {\r\n              alert(`‚ö†Ô∏è ${response.data.errors.length} records failed:\\n${response.data.errors.slice(0, 5).join('\\n')}`);\r\n            }\r\n            \r\n            // Refresh attendance data\r\n            const newData = await getEmployeeAttendance();\r\n            processAttendanceData(newData);\r\n            \r\n            // Close modal and reset\r\n            setShowUploadModal(false);\r\n            setUploadedFile(null);\r\n            setUploadPreview([]);\r\n            setUploadErrors([]);\r\n          } else {\r\n            setUploadErrors([response.data.message || 'Upload failed']);\r\n          }\r\n        } catch (error) {\r\n          console.error('Upload error:', error);\r\n          setUploadErrors([error.response?.data?.message || error.message || 'Error uploading file']);\r\n        } finally {\r\n          setUploading(false);\r\n        }\r\n      };\r\n\r\n      reader.onerror = () => {\r\n        setUploadErrors(['Error reading file']);\r\n        setUploading(false);\r\n      };\r\n\r\n      reader.readAsArrayBuffer(uploadedFile);\r\n    } catch (error) {\r\n      setUploadErrors([error.message]);\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  // Close upload modal\r\n  const closeUploadModal = () => {\r\n    setShowUploadModal(false);\r\n    setUploadedFile(null);\r\n    setUploadPreview([]);\r\n    setUploadErrors([]);\r\n  };\r\n\r\n  // Process attendance data\r\n  const processAttendanceData = (data) => {\r\n    const result = data.reduce((acc, item) => {\r\n      const empId = item.employee._id;\r\n      const empName = `${item.employee.firstName} ${item.employee.lastName}`;\r\n      const empRole = item.employee.role;\r\n      const day = item.date.split('T')[0];\r\n      const status = item.status;\r\n      const employeeId = item.employee.employeeId;\r\n\r\n      if (!acc[empId]) {\r\n        acc[empId] = {\r\n          _id: empId,\r\n          empId: item.employee.empId || empId,\r\n          name: empName,\r\n          role: empRole,\r\n          employeeId: employeeId,\r\n          avatar: item.employee.firstName?.charAt(0).toUpperCase() || 'E',\r\n          days: new Set(),\r\n          presentDays: new Set(),\r\n          absentDays: new Set(),\r\n          leaveDays: new Set(),\r\n          holidayDays: new Set(),\r\n          weeklyOffDays: new Set(),\r\n          halfDayDays: new Set(),\r\n          missedPunchDays: new Set(),\r\n          lateArrivals: 0,\r\n          leaves: 0,\r\n          workingHours: 0,\r\n          attendanceRate: 0\r\n        };\r\n      }\r\n\r\n      acc[empId].days.add(day);\r\n\r\n      if (item.checkIn && item.checkOut) {\r\n        const checkInTime = new Date(item.checkIn);\r\n        const checkOutTime = new Date(item.checkOut);\r\n        const hoursWorked = (checkOutTime - checkInTime) / (1000 * 60 * 60);\r\n        if (hoursWorked > 0) {\r\n          acc[empId].workingHours += parseFloat(hoursWorked.toFixed(2));\r\n        }\r\n      }\r\n\r\n      if (status === 'present') {\r\n        acc[empId].presentDays.add(day);\r\n      } else if (status === 'absent') {\r\n        acc[empId].absentDays.add(day);\r\n      } else if (status === 'leave') {\r\n        acc[empId].leaveDays.add(day);\r\n      } else if (status === 'holiday') {\r\n        acc[empId].holidayDays.add(day);\r\n      } else if (status === 'weekly_off') {\r\n        acc[empId].weeklyOffDays.add(day);\r\n      } else if (status === 'half_day') {\r\n        acc[empId].halfDayDays.add(day);\r\n      } else if (status === 'missed_punch') {\r\n        acc[empId].missedPunchDays.add(day);\r\n      }\r\n\r\n      return acc;\r\n    }, {});\r\n\r\n    // Calculate attendance rates\r\n    Object.keys(result).forEach(empId => {\r\n      const employee = result[empId];\r\n      const totalDays = employee.days.size;\r\n      const presentDays = employee.presentDays.size + employee.halfDayDays.size * 0.5;\r\n      employee.attendanceRate = totalDays > 0 ? Math.round((presentDays / totalDays) * 100) : 0;\r\n    });\r\n\r\n    setNewAttendance(result);\r\n    setAttendance(data);\r\n    setLoading(false);\r\n  };\r\n\r\n  // Load face status for all employees when attendance data is loaded\r\n  useEffect(() => {\r\n    if (Object.keys(newAttendance).length > 0) {\r\n      Object.keys(newAttendance).forEach(empId => {\r\n        if (!faceStatusMap.hasOwnProperty(empId)) {\r\n          checkFaceRegistration(empId);\r\n        }\r\n      });\r\n    }\r\n  }, [newAttendance]);\r\n\r\n  useEffect(() => {\r\n    const fetchAttendance = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const data = await getEmployeeAttendance();\r\n        \r\n        // Process attendance data: Group by employee with status counts\r\n        const result = data.reduce((acc, item) => {\r\n          const empId = item.employee._id;\r\n          const empName = `${item.employee.firstName} ${item.employee.lastName}`;\r\n          const empRole = item.employee.role;\r\n          const day = item.date.split('T')[0];\r\n          const status = item.status; // Includes 'weekly_off' from backend\r\n          const employeeId = item.employee.employeeId\r\n\r\n          if (!acc[empId]) {\r\n            acc[empId] = {\r\n              _id: empId,\r\n              empId: item.employee.empId || empId,\r\n              name: empName,\r\n              role: empRole,\r\n              employeeId: employeeId,\r\n              avatar: item.employee.firstName?.charAt(0).toUpperCase() || 'E',\r\n              days: new Set(),\r\n              presentDays: new Set(),\r\n              absentDays: new Set(),\r\n              leaveDays: new Set(),\r\n              holidayDays: new Set(),\r\n              weeklyOffDays: new Set(),\r\n              halfDayDays: new Set(),\r\n              missedPunchDays: new Set(),\r\n              lateArrivals: 0,\r\n              leaves: 0,\r\n              workingHours: 0,\r\n              attendanceRate: 0\r\n            };\r\n          }\r\n\r\n          acc[empId].days.add(day);\r\n          \r\n          // Calculate working hours from punch data\r\n          if (item.checkIn && item.checkOut) {\r\n            const checkInTime = new Date(item.checkIn);\r\n            const checkOutTime = new Date(item.checkOut);\r\n            const hoursWorked = (checkOutTime - checkInTime) / (1000 * 60 * 60); // Convert ms to hours\r\n            if (hoursWorked > 0) {\r\n              acc[empId].workingHours += parseFloat(hoursWorked.toFixed(2));\r\n            }\r\n          }\r\n          \r\n          // Track status by category\r\n          if (status === 'present') {\r\n            acc[empId].presentDays.add(day);\r\n          } else if (status === 'absent') {\r\n            acc[empId].absentDays.add(day);\r\n          } else if (status === 'leave') {\r\n            acc[empId].leaveDays.add(day);\r\n          } else if (status === 'holiday') {\r\n            acc[empId].holidayDays.add(day);\r\n          } else if (status === 'weekly_off') {\r\n            acc[empId].weeklyOffDays.add(day);\r\n          } else if (status === 'half_day') {\r\n            acc[empId].halfDayDays.add(day);\r\n          } else if (status === 'missed_punch') {\r\n            acc[empId].missedPunchDays.add(day);\r\n          }\r\n\r\n          // Calculate attendance rate (present / working days, excluding weekly off and holidays)\r\n          const workingDays = acc[empId].days.size - acc[empId].weeklyOffDays.size - acc[empId].holidayDays.size;\r\n          acc[empId].attendanceRate = workingDays > 0 \r\n            ? Math.round((acc[empId].presentDays.size / workingDays) * 100)\r\n            : 0;\r\n\r\n          return acc;\r\n        }, {});\r\n\r\n        console.log('Processed Attendance Data:', result);\r\n        setNewAttendance(result);\r\n        setAttendance(data);\r\n      } catch (err) {\r\n        console.error('Error fetching attendance:', err);\r\n        setAttendance([]);\r\n        setNewAttendance({});\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchAttendance();\r\n  }, []);\r\n\r\n  // Helper function to get status category based on attendance rate\r\n  const getStatusCategory = (rate) => {\r\n    if (rate >= 95) return 'Excellent (95%+)';\r\n    if (rate >= 85) return 'Good (85%+)';\r\n    if (rate >= 75) return 'Average (75%+)';\r\n    return 'Poor (<75%)';\r\n  };\r\n\r\n  // Filter employees based on search term, department, and status\r\n  const filteredEmployees = Object.keys(newAttendance).filter((empId) => {\r\n    const employee = newAttendance[empId];\r\n    const searchLower = searchTerm.toLowerCase();\r\n    \r\n    // Search filter\r\n    const matchesSearch = \r\n      employee.name.toLowerCase().includes(searchLower) ||\r\n      employee.empId.toLowerCase().includes(searchLower) ||\r\n      employee.role.toLowerCase().includes(searchLower);\r\n    \r\n    // Department filter\r\n    const matchesDepartment = \r\n      selectedDepartment === 'All Departments' || \r\n      employee.role === selectedDepartment;\r\n    \r\n    // Status filter\r\n    let matchesStatus = true;\r\n    if (selectedStatus !== 'All Status') {\r\n      const employeeStatus = getStatusCategory(employee.attendanceRate);\r\n      matchesStatus = employeeStatus === selectedStatus;\r\n    }\r\n    \r\n    return matchesSearch && matchesDepartment && matchesStatus;\r\n  });\r\n\r\n  const totalPages = Math.ceil(filteredEmployees.length / pageSize);\r\n  const paginatedEmployees = filteredEmployees\r\n    .slice((currentPage - 1) * pageSize, currentPage * pageSize);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center p-4\">\r\n        <div className=\"text-center\">\r\n          <Loader2 className=\"w-12 h-12 text-blue-600 animate-spin mx-auto mb-4\" />\r\n          <p className=\"text-slate-600 dark:text-slate-400 text-lg font-bold\">Loading attendance data...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Stats Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n        {stats.map((stat, index) => {\r\n          const Icon = stat.icon;\r\n          return (\r\n            <div key={index} className=\"bg-white dark:bg-slate-900 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-800 p-6 hover:shadow-2xl transition-all hover:-translate-y-1\">\r\n              <div className=\"flex items-start justify-between mb-4\">\r\n                <div className={`p-3 rounded-2xl ${stat.bgColor} shadow-lg`}>\r\n                  <Icon className=\"w-6 h-6 text-white\" />\r\n                </div>\r\n              </div>\r\n              <p className=\"text-slate-600 dark:text-slate-400 text-xs font-black uppercase tracking-widest mb-2\">{stat.label}</p>\r\n              <span className=\"text-4xl font-black text-slate-800 dark:text-white tracking-tighter\">{stat.value}</span>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Department Overview */}\r\n      <div className=\"bg-white dark:bg-slate-900 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-800 p-6\">\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"p-2.5 bg-blue-100 dark:bg-blue-900/30 rounded-xl\">\r\n              <PieChart className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\r\n            </div>\r\n            <h2 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">Department Overview</h2>\r\n          </div>\r\n          <button className=\"px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl text-xs font-black uppercase tracking-widest hover:bg-slate-200 dark:hover:bg-slate-700 transition flex items-center gap-2\">\r\n            <BarChart3 className=\"w-4 h-4\" />\r\n            View Analytics\r\n          </button>\r\n        </div>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\r\n          {departmentStats.length === 0 ? (\r\n            <p className=\"text-slate-500 dark:text-slate-400 text-sm\">No department data available</p>\r\n          ) : (\r\n            departmentStats.map((dept, index) => (\r\n              <div key={index} className=\"bg-slate-50 dark:bg-slate-950 border border-slate-100 dark:border-slate-800 rounded-2xl p-4 hover:shadow-lg transition-all\">\r\n                <p className=\"text-xs font-black text-slate-600 dark:text-slate-400 uppercase tracking-widest mb-3\">{dept.department}</p>\r\n                <div className=\"flex items-end justify-between mb-3\">\r\n                  <span className=\"text-3xl font-black text-slate-800 dark:text-white tracking-tighter\">{dept.present}</span>\r\n                  <span className=\"text-sm font-bold text-slate-400\">/ {dept.total}</span>\r\n                </div>\r\n                <div className=\"w-full bg-slate-200 dark:bg-slate-800 rounded-full h-2 mb-3\">\r\n                  <div\r\n                    className=\"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all\"\r\n                    style={{ width: dept.rate }}\r\n                  ></div>\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <p className=\"text-[10px] font-black text-slate-500 uppercase\">{dept.rate} Present</p>\r\n                  <p className=\"text-[10px] font-black text-blue-600 dark:text-blue-400\">{dept.avgHours} avg</p>\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filters Section */}\r\n      <div className=\"bg-white dark:bg-slate-900 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-800 p-6\">\r\n        <div className=\"flex flex-col lg:flex-row gap-4 items-center justify-between\">\r\n          <div className=\"flex flex-col sm:flex-row items-center gap-3 w-full lg:w-auto\">\r\n            <div className=\"relative w-full sm:w-80\">\r\n              <Search className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5\" />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Search employee name or ID...\"\r\n                value={searchTerm}\r\n                onChange={(e) => {\r\n                  setSearchTerm(e.target.value);\r\n                  setCurrentPage(1); // Reset to first page when searching\r\n                }}\r\n                className=\"w-full pl-12 pr-4 py-3 bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-2xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n              />\r\n            </div>\r\n            <select\r\n              value={selectedDepartment}\r\n              onChange={(e) => {\r\n                setSelectedDepartment(e.target.value);\r\n                setCurrentPage(1); // Reset to first page when filtering\r\n              }}\r\n              className=\"w-full sm:w-48 px-4 py-3 bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-2xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n            >\r\n              <option>All Departments</option>\r\n              <option>Engineering</option>\r\n              <option>Sales</option>\r\n              <option>Marketing</option>\r\n              <option>Finance</option>\r\n              <option>HR</option>\r\n              <option>Design</option>\r\n            </select>\r\n            <select\r\n              value={selectedStatus}\r\n              onChange={(e) => {\r\n                setSelectedStatus(e.target.value);\r\n                setCurrentPage(1); // Reset to first page when filtering\r\n              }}\r\n              className=\"w-full sm:w-40 px-4 py-3 bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-2xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n            >\r\n              <option>All Status</option>\r\n              <option>Excellent (95%+)</option>\r\n              <option>Good (85%+)</option>\r\n              <option>Average (75%+)</option>\r\n              <option>Poor (&lt;75%)</option>\r\n            </select>\r\n          </div>\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"flex items-center gap-2 bg-slate-100 dark:bg-slate-800 rounded-2xl px-3 py-2\">\r\n              <button \r\n                onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\r\n                disabled={currentPage === 1}\r\n                className=\"p-1.5 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-xl transition disabled:opacity-50\"\r\n              >\r\n                <ChevronLeft className=\"w-5 h-5 text-slate-600 dark:text-slate-400\" />\r\n              </button>\r\n              <span className=\"font-black text-slate-700 dark:text-slate-300 px-2 text-xs uppercase tracking-widest\">{selectedMonth}</span>\r\n              <button \r\n                onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\r\n                disabled={currentPage === totalPages}\r\n                className=\"p-1.5 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-xl transition disabled:opacity-50\"\r\n              >\r\n                <ChevronRight className=\"w-5 h-5 text-slate-600 dark:text-slate-400\" />\r\n              </button>\r\n            </div>\r\n            <button \r\n              onClick={handleExportReport}\r\n              disabled={exporting || Object.keys(newAttendance).length === 0}\r\n              className=\"flex items-center gap-2 px-5 py-3 bg-emerald-600 text-white rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl shadow-emerald-500/20 hover:bg-emerald-700 transition disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {exporting ? (\r\n                <>\r\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                  Exporting...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Download className=\"w-5 h-5\" />\r\n                  Export Report\r\n                </>\r\n              )}\r\n            </button>\r\n            {/* <button \r\n              onClick={() => setShowUploadModal(true)}\r\n              className=\"flex items-center gap-2 px-5 py-3 bg-blue-600 text-white rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl shadow-blue-500/20 hover:bg-blue-700 transition\"\r\n            >\r\n              <Upload className=\"w-5 h-5\" />\r\n              Upload Excel\r\n            </button> */}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Attendance History Table */}\r\n      <div className=\"bg-white dark:bg-slate-900 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-800 overflow-hidden\">\r\n        <div className=\"px-6 py-5 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-950/50\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h2 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">Monthly Attendance History</h2>\r\n              <p className=\"text-xs font-bold text-slate-500 dark:text-slate-400 mt-1 uppercase tracking-widest\">January 2026 - Complete Records</p>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"text-xs font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest\">\r\n                Showing {filteredEmployees.length === 0 ? 0 : (currentPage - 1) * pageSize + 1}-{Math.min(currentPage * pageSize, filteredEmployees.length)} of {filteredEmployees.length}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full\">\r\n            <thead className=\"bg-slate-50/50 dark:bg-slate-950/50 border-b border-slate-100 dark:border-slate-800\">\r\n              <tr>\r\n                <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Employee</th>\r\n                <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Present Days</th>\r\n                <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Absent</th>\r\n                {/* <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Leaves</th> */}\r\n                {/* <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Weekly Offs</th> */}\r\n                <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Late Arrivals</th>\r\n                <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Total Hours</th>\r\n                {/* <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Attendance</th> */}\r\n                <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Face Registration</th>\r\n                <th className=\"px-6 py-4 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Actions</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-slate-50 dark:divide-slate-800\">\r\n              {paginatedEmployees.map((empId) => {\r\n                const employee = newAttendance[empId];\r\n                console.log(employee);\r\n                return (\r\n                  <tr key={empId} className=\"hover:bg-slate-50/50 dark:hover:bg-slate-800/30 transition-colors group\">\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-11 h-11 rounded-2xl bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-black text-sm shadow-lg\">\r\n                          {employee.avatar}\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-sm font-black text-slate-800 dark:text-white uppercase tracking-tighter\">{employee.name}</p>\r\n                          <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest\">{employee.employeeId}</p>\r\n                        </div>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"text-2xl font-black text-green-600 dark:text-green-400 tracking-tighter\">{employee.presentDays.size}</span>\r\n                        <span className=\"text-xs font-bold text-slate-400\">days</span>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <span className=\"text-lg font-black text-red-600 dark:text-red-400 tracking-tighter\">{employee.absentDays.size}</span>\r\n                    </td>\r\n                    {/* <td className=\"px-6 py-4\">\r\n                      <span className=\"text-lg font-black text-blue-600 dark:text-blue-400 tracking-tighter\">{employee.leaveDays.size}</span>\r\n                    </td> */}\r\n                    {/* <td className=\"px-6 py-4\">\r\n                      <span className=\"text-lg font-black text-purple-600 dark:text-purple-400 tracking-tighter\">{employee.weeklyOffDays.size}</span>\r\n                    </td> */}\r\n                    <td className=\"px-6 py-4\">\r\n                      <span className=\"text-lg font-black text-orange-600 dark:text-orange-400 tracking-tighter\">{employee.lateArrivals}</span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <span className=\"text-lg font-black text-slate-800 dark:text-white tracking-tighter\">\r\n                        {employee.workingHours}\r\n                        <span className=\"text-[10px] text-slate-400 ml-1\">hrs</span>\r\n                      </span>\r\n                    </td>\r\n                    {/* <td className=\"px-6 py-4\">\r\n                      <span className={`inline-flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-black border ${getAttendanceColor(employee.attendanceRate)}`}>\r\n                        <TrendingUp size={12} />\r\n                        {employee.attendanceRate}%\r\n                      </span>\r\n                    </td> */}\r\n                    <td className=\"px-6 py-4\">\r\n                      {loadingFaceStatus[empId] ? (\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Loader2 size={14} className=\"animate-spin text-blue-600\" />\r\n                          <span className=\"text-xs font-bold text-slate-500\">Checking...</span>\r\n                        </div>\r\n                      ) : faceStatusMap[empId] ? (\r\n                        <div className=\"flex items-center gap-2 px-3 py-2 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-xl w-fit\">\r\n                          <CheckCircle size={14} className=\"text-emerald-600 dark:text-emerald-400\" />\r\n                          <span className=\"text-xs font-bold text-emerald-700 dark:text-emerald-300\">Registered</span>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"flex items-center gap-2 px-3 py-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl w-fit\">\r\n                          <XCircle size={14} className=\"text-red-600 dark:text-red-400\" />\r\n                          <span className=\"text-xs font-bold text-red-700 dark:text-red-300\">Not Registered</span>\r\n                        </div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <button\r\n                          onClick={() => handleViewReport(empId)}\r\n                          className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl text-slate-400 group-hover:text-blue-600 transition\"\r\n                          title=\"View Report\"\r\n                        >\r\n                          <FileText size={16} />\r\n                        </button>\r\n                        {faceStatusMap[empId] && (\r\n                          <button\r\n                            onClick={() => handleDeleteFace(empId)}\r\n                            disabled={deletingFaceId === empId}\r\n                            className=\"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-400 hover:text-red-600 disabled:opacity-50 rounded-xl transition\"\r\n                            title=\"Delete Face Registration\"\r\n                          >\r\n                            {deletingFaceId === empId ? (\r\n                              <Loader2 size={16} className=\"animate-spin\" />\r\n                            ) : (\r\n                              <Trash2 size={16} />\r\n                            )}\r\n                          </button>\r\n                        )}\r\n                        {faceStatusMap[empId] && (\r\n                          <button\r\n                            onClick={() => handleRefreshFaceStatus(empId)}\r\n                            className=\"p-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-slate-400 hover:text-blue-600 rounded-xl transition\"\r\n                            title=\"Refresh Face Status\"\r\n                          >\r\n                            <RefreshCw size={16} />\r\n                          </button>\r\n                        )}\r\n                        {/* {!faceStatusMap[empId] && !loadingFaceStatus[empId] && (\r\n                          <button\r\n                            onClick={() => handleRegisterFace(employee)}\r\n                            disabled={registeringFaceId === empId}\r\n                            className=\"p-2 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 text-slate-400 hover:text-emerald-600 disabled:opacity-50 rounded-xl transition\"\r\n                            title=\"Register Face\"\r\n                          >\r\n                            {registeringFaceId === empId ? (\r\n                              <Loader2 size={16} className=\"animate-spin\" />\r\n                            ) : (\r\n                              <Camera size={16} />\r\n                            )}\r\n                          </button>\r\n                        )} */}\r\n                        <button\r\n                          className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl text-slate-400 group-hover:text-slate-600 transition\"\r\n                          title=\"More Options\"\r\n                        >\r\n                          <MoreVertical size={16} />\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n              {paginatedEmployees.length === 0 && (\r\n                <tr>\r\n                  <td colSpan=\"10\" className=\"px-6 py-12 text-center\">\r\n                    <div className=\"flex flex-col items-center gap-3\">\r\n                      <AlertCircle className=\"w-12 h-12 text-slate-300\" />\r\n                      <p className=\"text-slate-500 dark:text-slate-400 font-bold text-lg\">\r\n                        {Object.keys(newAttendance).length === 0 ? 'No attendance records found' : 'No matching employees found'}\r\n                      </p>\r\n                      <p className=\"text-slate-400 dark:text-slate-500 text-sm\">\r\n                        {Object.keys(newAttendance).length === 0 \r\n                          ? 'There are no employee attendance records to display' \r\n                          : `No employees match your search \"${searchTerm}\"`}\r\n                      </p>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* Pagination */}\r\n        <div className=\"px-6 py-4 border-t border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-950/50 flex items-center justify-between\">\r\n          <p className=\"text-xs font-bold text-slate-600 dark:text-slate-400 uppercase tracking-widest\">\r\n            Page {currentPage} of {Math.max(1, totalPages)}\r\n          </p>\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\r\n              disabled={currentPage === 1}\r\n              className=\"px-4 py-2 border border-slate-200 dark:border-slate-700 rounded-xl text-xs font-black text-slate-700 dark:text-slate-300 hover:bg-white dark:hover:bg-slate-800 transition disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-widest\"\r\n            >\r\n              Previous\r\n            </button>\r\n\r\n            <button\r\n              onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\r\n              disabled={currentPage === totalPages}\r\n              className=\"px-4 py-2 border border-slate-200 dark:border-slate-700 rounded-xl text-xs font-black text-slate-700 dark:text-slate-300 hover:bg-white dark:hover:bg-slate-800 transition disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-widest\"\r\n            >\r\n              Next\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Face Registration Modal */}\r\n      {showFaceRegistrationModal && selectedEmployeeForFace && (\r\n        <div className=\"fixed inset-0 bg-black/50 dark:bg-black/70 z-50 flex items-center justify-center p-4\">\r\n          <div className=\"bg-white dark:bg-slate-900 rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-800 max-w-md w-full p-8 space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"space-y-2\">\r\n              <h2 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">\r\n                Face Registration\r\n              </h2>\r\n              <p className=\"text-sm text-slate-600 dark:text-slate-400\">\r\n                Register face for <span className=\"font-bold text-slate-800 dark:text-white\">{selectedEmployeeForFace.name}</span>\r\n              </p>\r\n            </div>\r\n\r\n            {/* Employee Info */}\r\n            <div className=\"bg-slate-50 dark:bg-slate-950 rounded-2xl p-4 space-y-3\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-black text-sm shadow-lg\">\r\n                  {selectedEmployeeForFace.avatar}\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm font-black text-slate-800 dark:text-white uppercase tracking-tighter\">\r\n                    {selectedEmployeeForFace.name}\r\n                  </p>\r\n                  <p className=\"text-xs text-slate-500 dark:text-slate-400 uppercase tracking-widest\">\r\n                    {selectedEmployeeForFace.empId} ‚Ä¢ {selectedEmployeeForFace.role}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Message */}\r\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-2xl p-4\">\r\n              <p className=\"text-sm text-blue-700 dark:text-blue-300 font-bold\">\r\n                <span className=\"block font-black mb-1\">üì∏ Registration Process</span>\r\n                Click \"Start Registration\" to initiate the face registration process. The employee will need to use their camera to capture face data.\r\n              </p>\r\n            </div>\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"flex gap-3 pt-4\">\r\n              <button\r\n                onClick={closeFaceRegistrationModal}\r\n                className=\"flex-1 px-4 py-3 border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-slate-50 dark:hover:bg-slate-700 transition\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleSubmitFaceRegistration}\r\n                disabled={registeringFaceId === selectedEmployeeForFace._id}\r\n                className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-emerald-600 text-white rounded-2xl font-black text-sm uppercase tracking-widest shadow-lg shadow-emerald-500/20 hover:bg-emerald-700 disabled:opacity-50 transition\"\r\n              >\r\n                {registeringFaceId === selectedEmployeeForFace._id ? (\r\n                  <>\r\n                    <Loader2 size={16} className=\"animate-spin\" />\r\n                    Processing...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Camera size={16} />\r\n                    Start Registration\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Report Modal */}\r\n      {showReportModal && selectedEmployeeForDetails && (\r\n        <div className=\"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n            {/* Header */}\r\n            <div className=\"sticky top-0 bg-gradient-to-r from-emerald-600 to-emerald-700 dark:from-emerald-800 dark:to-emerald-900 p-6 border-b border-emerald-500\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"w-12 h-12 rounded-full bg-emerald-500 text-white flex items-center justify-center font-black text-lg\">\r\n                    {selectedEmployeeForDetails.avatar}\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-lg font-black text-white\">\r\n                      Attendance Report - {selectedEmployeeForDetails.name}\r\n                    </p>\r\n                    <p className=\"text-sm text-emerald-100\">\r\n                      {selectedEmployeeForDetails.employeeId} ‚Ä¢ {selectedEmployeeForDetails.role}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  onClick={closeReportModal}\r\n                  className=\"text-white hover:bg-white/20 p-2 rounded-xl transition\"\r\n                >\r\n                  ‚úï\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"p-6 space-y-6\">\r\n              {/* Key Metrics */}\r\n              <div>\r\n                <h3 className=\"text-sm font-black text-slate-700 dark:text-slate-300 uppercase tracking-widest mb-4\">\r\n                  üìä Key Metrics\r\n                </h3>\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex justify-between items-center p-4 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div>\r\n                      <p className=\"text-xs font-bold text-slate-600 dark:text-slate-400 uppercase tracking-widest mb-1\">Attendance Rate</p>\r\n                      <p className=\"text-2xl font-black text-slate-900 dark:text-white\">{selectedEmployeeForDetails.attendanceRate}%</p>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      {selectedEmployeeForDetails.attendanceRate >= 95 && <span className=\"inline-block px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full text-xs font-black\">Excellent</span>}\r\n                      {selectedEmployeeForDetails.attendanceRate >= 85 && selectedEmployeeForDetails.attendanceRate < 95 && <span className=\"inline-block px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-xs font-black\">Good</span>}\r\n                      {selectedEmployeeForDetails.attendanceRate >= 75 && selectedEmployeeForDetails.attendanceRate < 85 && <span className=\"inline-block px-3 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-full text-xs font-black\">Average</span>}\r\n                      {selectedEmployeeForDetails.attendanceRate < 75 && <span className=\"inline-block px-3 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-full text-xs font-black\">Poor</span>}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Breakdown */}\r\n              <div>\r\n                <h3 className=\"text-sm font-black text-slate-700 dark:text-slate-300 uppercase tracking-widest mb-4\">\r\n                  üìã Attendance Breakdown\r\n                </h3>\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-xl p-4\">\r\n                    <p className=\"text-xs font-bold text-green-700 dark:text-green-300 uppercase tracking-widest mb-2\">Present</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <p className=\"text-3xl font-black text-green-600 dark:text-green-400\">{selectedEmployeeForDetails.presentDays.size}</p>\r\n                      <p className=\"text-xs text-green-600 dark:text-green-400 font-bold\">days</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-xl p-4\">\r\n                    <p className=\"text-xs font-bold text-red-700 dark:text-red-300 uppercase tracking-widest mb-2\">Absent</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <p className=\"text-3xl font-black text-red-600 dark:text-red-400\">{selectedEmployeeForDetails.absentDays.size}</p>\r\n                      <p className=\"text-xs text-red-600 dark:text-red-400 font-bold\">days</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-700 rounded-xl p-4\">\r\n                    <p className=\"text-xs font-bold text-orange-700 dark:text-orange-300 uppercase tracking-widest mb-2\">Leave</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <p className=\"text-3xl font-black text-orange-600 dark:text-orange-400\">{selectedEmployeeForDetails.leaveDays.size}</p>\r\n                      <p className=\"text-xs text-orange-600 dark:text-orange-400 font-bold\">days</p>\r\n                    </div>\r\n                  </div>\r\n                  {/* <div className=\"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-700 rounded-xl p-4\">\r\n                    <p className=\"text-xs font-bold text-purple-700 dark:text-purple-300 uppercase tracking-widest mb-2\">Weekly Offs</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <p className=\"text-3xl font-black text-purple-600 dark:text-purple-400\">{selectedEmployeeForDetails.weeklyOffDays.size}</p>\r\n                      <p className=\"text-xs text-purple-600 dark:text-purple-400 font-bold\">days</p>\r\n                    </div>\r\n                  </div> */}\r\n                  <div className=\"bg-cyan-50 dark:bg-cyan-900/20 border border-cyan-200 dark:border-cyan-700 rounded-xl p-4\">\r\n                    <p className=\"text-xs font-bold text-cyan-700 dark:text-cyan-300 uppercase tracking-widest mb-2\">Holiday</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <p className=\"text-3xl font-black text-cyan-600 dark:text-cyan-400\">{selectedEmployeeForDetails.holidayDays.size}</p>\r\n                      <p className=\"text-xs text-cyan-600 dark:text-cyan-400 font-bold\">days</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-700 rounded-xl p-4\">\r\n                    <p className=\"text-xs font-bold text-indigo-700 dark:text-indigo-300 uppercase tracking-widest mb-2\">Half Day</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <p className=\"text-3xl font-black text-indigo-600 dark:text-indigo-400\">{selectedEmployeeForDetails.halfDayDays.size}</p>\r\n                      <p className=\"text-xs text-indigo-600 dark:text-indigo-400 font-bold\">days</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Working Hours */}\r\n              <div>\r\n                <h3 className=\"text-sm font-black text-slate-700 dark:text-slate-300 uppercase tracking-widest mb-4\">\r\n                  ‚è±Ô∏è Working Hours\r\n                </h3>\r\n                <div className=\"bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 border border-blue-200 dark:border-blue-700 rounded-xl p-6\">\r\n                  <p className=\"text-xs font-bold text-slate-600 dark:text-slate-400 uppercase tracking-widest mb-2\">Total Hours Worked</p>\r\n                  <p className=\"text-4xl font-black text-blue-600 dark:text-blue-400\">{selectedEmployeeForDetails.workingHours.toFixed(2)} <span className=\"text-xl\">hrs</span></p>\r\n                  <p className=\"text-xs text-slate-600 dark:text-slate-400 mt-2 font-bold\">Average per day: {(selectedEmployeeForDetails.workingHours / Math.max(selectedEmployeeForDetails.presentDays.size, 1)).toFixed(2)} hrs</p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Summary */}\r\n              <div>\r\n                <h3 className=\"text-sm font-black text-slate-700 dark:text-slate-300 uppercase tracking-widest mb-4\">\r\n                  ‚úÖ Summary\r\n                </h3>\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-2xl p-4\">\r\n                  <p className=\"text-sm text-blue-700 dark:text-blue-300 font-bold leading-relaxed\">\r\n                    <strong>{selectedEmployeeForDetails.name}</strong> has worked <strong>{selectedEmployeeForDetails.presentDays.size}</strong> days with an attendance rate of <strong>{selectedEmployeeForDetails.attendanceRate}%</strong>. \r\n                    Total working hours recorded: <strong>{selectedEmployeeForDetails.workingHours.toFixed(2)} hours</strong>. \r\n                    Absences: <strong>{selectedEmployeeForDetails.absentDays.size} days</strong>, Leave: <strong>{selectedEmployeeForDetails.leaveDays.size} days</strong>.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"border-t border-slate-200 dark:border-slate-700 p-6 bg-slate-50 dark:bg-slate-800\">\r\n              <button\r\n                onClick={closeReportModal}\r\n                className=\"w-full px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-black text-sm uppercase tracking-widest transition\"\r\n              >\r\n                Close\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Upload Excel Modal */}\r\n      {showUploadModal && (\r\n        <div className=\"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n            {/* Header */}\r\n            <div className=\"sticky top-0 bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-800 dark:to-blue-900 p-6 border-b border-blue-500\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"p-2 bg-blue-500 rounded-lg\">\r\n                    <Upload className=\"w-6 h-6 text-white\" />\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"text-lg font-black text-white uppercase tracking-tighter\">Upload Attendance Records</h3>\r\n                    <p className=\"text-xs text-blue-100 mt-1 font-bold\">Import attendance data from Excel file</p>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  onClick={closeUploadModal}\r\n                  className=\"text-white hover:bg-white/20 p-2 rounded-xl transition\"\r\n                >\r\n                  ‚úï\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"p-6 space-y-6\">\r\n              {/* File Upload Section */}\r\n              <div>\r\n                {!uploadedFile ? (\r\n                  <div>\r\n                    <input\r\n                      type=\"file\"\r\n                      accept=\".xlsx,.xls,.csv\"\r\n                      onChange={handleFileUpload}\r\n                      className=\"hidden\"\r\n                      id=\"file-upload\"\r\n                    />\r\n                    <label htmlFor=\"file-upload\" className=\"block cursor-pointer\">\r\n                      <div className=\"border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl p-8 text-center hover:border-blue-500 transition cursor-pointer group\">\r\n                        <div className=\"flex justify-center mb-4\">\r\n                          <Upload className=\"w-12 h-12 text-slate-400 group-hover:text-blue-500 transition\" />\r\n                        </div>\r\n                        <p className=\"text-sm font-black text-slate-700 dark:text-slate-300 mb-2 uppercase tracking-widest\">\r\n                          Click to upload or drag and drop\r\n                        </p>\r\n                        <p className=\"text-xs text-slate-500 dark:text-slate-400 font-bold\">\r\n                          Supports: Excel (.xlsx, .xls) and CSV files\r\n                        </p>\r\n                      </div>\r\n                    </label>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-xl p-4 flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"p-2 bg-blue-100 dark:bg-blue-800 rounded-lg\">\r\n                        <FileText className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-bold text-slate-800 dark:text-white text-sm\">{uploadedFile.name}</p>\r\n                        <p className=\"text-xs text-slate-600 dark:text-slate-400 font-bold\">{(uploadedFile.size / 1024).toFixed(2)} KB</p>\r\n                      </div>\r\n                    </div>\r\n                    <button\r\n                      onClick={() => {\r\n                        setUploadedFile(null);\r\n                        setUploadPreview([]);\r\n                        setUploadErrors([]);\r\n                      }}\r\n                      className=\"p-2 hover:bg-blue-200 dark:hover:bg-blue-800 rounded-lg transition text-slate-600 dark:text-slate-400\"\r\n                    >\r\n                      ‚úï\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Error Messages */}\r\n              {uploadErrors.length > 0 && (\r\n                <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-xl p-4\">\r\n                  <p className=\"text-xs font-black text-red-700 dark:text-red-300 uppercase tracking-widest mb-2\">‚ùå Errors</p>\r\n                  <div className=\"text-sm text-red-700 dark:text-red-300 font-bold space-y-1\">\r\n                    {uploadErrors.map((error, idx) => (\r\n                      <p key={idx}>{error}</p>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Preview Section */}\r\n              {uploadPreview.length > 0 && (\r\n                <div>\r\n                  <h4 className=\"text-sm font-black text-slate-700 dark:text-slate-300 uppercase tracking-widest mb-3\">\r\n                    üìã Preview (First 5 Records)\r\n                  </h4>\r\n                  <div className=\"overflow-x-auto border border-slate-200 dark:border-slate-700 rounded-xl\">\r\n                    <table className=\"w-full text-sm\">\r\n                      <thead className=\"bg-slate-100 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700\">\r\n                        <tr>\r\n                          {Object.keys(uploadPreview[0] || {}).map((header) => (\r\n                            <th key={header} className=\"px-4 py-3 text-left font-black text-slate-700 dark:text-slate-300 text-xs uppercase tracking-widest whitespace-nowrap\">\r\n                              {header}\r\n                            </th>\r\n                          ))}\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {uploadPreview.map((row, rowIdx) => (\r\n                          <tr key={rowIdx} className=\"border-b border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800\">\r\n                            {Object.values(row).map((value, cellIdx) => (\r\n                              <td key={cellIdx} className=\"px-4 py-3 text-slate-600 dark:text-slate-400 font-bold\">\r\n                                {String(value).substring(0, 30)}\r\n                              </td>\r\n                            ))}\r\n                          </tr>\r\n                        ))}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Info Box */}\r\n              <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4\">\r\n                <p className=\"text-xs text-blue-700 dark:text-blue-300 font-bold leading-relaxed\">\r\n                  <span className=\"block font-black mb-2\">üìù Required Columns:</span>\r\n                  Your Excel file must have these columns: <strong>Employee ID</strong>, <strong>Date</strong>, <strong>Status</strong>, <strong>Check In</strong>, <strong>Check Out</strong>\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"border-t border-slate-200 dark:border-slate-700 p-6 bg-slate-50 dark:bg-slate-800 flex gap-3\">\r\n              <button\r\n                onClick={closeUploadModal}\r\n                className=\"flex-1 px-4 py-3 border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-xl font-black text-sm uppercase tracking-widest hover:bg-slate-50 dark:hover:bg-slate-700 transition\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleSubmitUpload}\r\n                disabled={!uploadedFile || uploading || uploadErrors.length > 0}\r\n                className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-black text-sm uppercase tracking-widest transition disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                {uploading ? (\r\n                  <>\r\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                    Uploading...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Upload className=\"w-4 h-4\" />\r\n                    Upload Records\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\AttendanceSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":55,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { notification } from 'antd';\r\nimport api from '../../utils/api';\r\nimport { Save, Clock, Calendar, ToggleLeft, ToggleRight, ShieldCheck, MapPin, Globe, Lock, Plus, X } from 'lucide-react';\r\n\r\nexport default function AttendanceSettings() {\r\n    const [settings, setSettings] = useState({\r\n        shiftStartTime: \"09:00\",\r\n        shiftEndTime: \"18:00\",\r\n        graceTimeMinutes: 15,\r\n        lateMarkThresholdMinutes: 30,\r\n        halfDayThresholdHours: 4,\r\n        fullDayThresholdHours: 7,\r\n        weeklyOffDays: [0],\r\n        sandwichLeave: false,\r\n        autoAbsent: true,\r\n        attendanceLockDay: 25,\r\n        // Punch Policy\r\n        punchMode: 'single',\r\n        maxPunchesPerDay: 10,\r\n        maxPunchAction: 'block',\r\n        breakTrackingEnabled: false,\r\n        overtimeAllowed: false,\r\n        overtimeAfterShiftHours: true,\r\n        overtimeToPayroll: false,\r\n        geoFencingEnabled: false,\r\n        officeLatitude: null,\r\n        officeLongitude: null,\r\n        allowedRadiusMeters: 100,\r\n        ipRestrictionEnabled: false,\r\n        allowedIPs: [],\r\n        allowedIPRanges: [],\r\n        locationRestrictionMode: 'none'\r\n    });\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchSettings();\r\n    }, []);\r\n\r\n    const fetchSettings = async () => {\r\n        try {\r\n            const res = await api.get('/attendance/settings');\r\n            if (res.data) setSettings(res.data);\r\n        } catch (err) {\r\n            console.error(\"Failed to load settings\", err);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        try {\r\n            setSaving(true);\r\n            await api.put('/attendance/settings', settings);\r\n            notification.success({ message: 'Success', description: \"Settings saved successfully!\", placement: 'topRight' });\r\n        } catch (err) {\r\n            notification.error({ message: 'Error', description: \"Failed to save settings\", placement: 'topRight' });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 animate-in slide-in-from-bottom-5 duration-500\">\r\n            {/* Shift Configuration */}\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-100 dark:border-slate-800 shadow-xl overflow-hidden relative\">\r\n                <div className=\"absolute top-0 right-0 h-32 w-32 bg-slate-50 dark:bg-slate-800/50 rounded-bl-full -mr-16 -mt-16 opacity-20\"></div>\r\n\r\n                <h3 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter flex items-center gap-3 mb-8\">\r\n                    <Clock className=\"text-blue-500\" />\r\n                    Shift & Grace Time\r\n                </h3>\r\n\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <InputGroup label=\"Shift Start\" type=\"time\" value={settings.shiftStartTime} onChange={(e) => setSettings({ ...settings, shiftStartTime: e.target.value })} />\r\n                        <InputGroup label=\"Shift End\" type=\"time\" value={settings.shiftEndTime} onChange={(e) => setSettings({ ...settings, shiftEndTime: e.target.value })} />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <InputGroup label=\"Grace Minutes\" type=\"number\" value={settings.graceTimeMinutes} onChange={(e) => setSettings({ ...settings, graceTimeMinutes: parseInt(e.target.value) })} />\r\n                        <InputGroup label=\"Late Threshold\" type=\"number\" value={settings.lateMarkThresholdMinutes} onChange={(e) => setSettings({ ...settings, lateMarkThresholdMinutes: parseInt(e.target.value) })} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Threshold Configuration */}\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-100 dark:border-slate-800 shadow-xl overflow-hidden relative\">\r\n                <h3 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter flex items-center gap-3 mb-8\">\r\n                    <ShieldCheck className=\"text-emerald-500\" />\r\n                    Presence Thresholds\r\n                </h3>\r\n\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <InputGroup label=\"HD Threshold (Hrs)\" type=\"number\" value={settings.halfDayThresholdHours} onChange={(e) => setSettings({ ...settings, halfDayThresholdHours: parseInt(e.target.value) })} />\r\n                        <InputGroup label=\"P Threshold (Hrs)\" type=\"number\" value={settings.fullDayThresholdHours} onChange={(e) => setSettings({ ...settings, fullDayThresholdHours: parseInt(e.target.value) })} />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <InputGroup label=\"Monthly Lock Day\" type=\"number\" value={settings.attendanceLockDay} onChange={(e) => setSettings({ ...settings, attendanceLockDay: parseInt(e.target.value) })} />\r\n                        <div>\r\n                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 block px-1\">Leave Cycle Start</label>\r\n                            <select\r\n                                className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-xl p-3 text-sm focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all dark:text-white\"\r\n                                value={settings.leaveCycleStartMonth || 0}\r\n                                onChange={(e) => setSettings({ ...settings, leaveCycleStartMonth: parseInt(e.target.value) })}\r\n                            >\r\n                                {[\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"].map((month, idx) => (\r\n                                    <option key={month} value={idx}>{month}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Punch Mode Configuration */}\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-100 dark:border-slate-800 shadow-xl col-span-1 md:col-span-2\">\r\n                <h3 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter flex items-center gap-3 mb-8\">\r\n                    <Lock className=\"text-purple-500\" />\r\n                    Punch Mode Configuration\r\n                </h3>\r\n\r\n                <div className=\"space-y-6\">\r\n                    <div>\r\n                        <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">Punch Mode</label>\r\n                        <select\r\n                            value={settings.punchMode}\r\n                            onChange={(e) => setSettings({ ...settings, punchMode: e.target.value })}\r\n                            className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                        >\r\n                            <option value=\"single\">Single Punch Mode (1 IN, 1 OUT per day)</option>\r\n                            <option value=\"multiple\">Multiple Punch Mode (Multiple IN/OUT for breaks)</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    {settings.punchMode === 'multiple' && (\r\n                        <>\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <InputGroup\r\n                                    label=\"Max Punches Per Day\"\r\n                                    type=\"number\"\r\n                                    value={settings.maxPunchesPerDay}\r\n                                    onChange={(e) => setSettings({ ...settings, maxPunchesPerDay: parseInt(e.target.value) })}\r\n                                />\r\n                                <div>\r\n                                    <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">Action on Limit</label>\r\n                                    <select\r\n                                        value={settings.maxPunchAction}\r\n                                        onChange={(e) => setSettings({ ...settings, maxPunchAction: e.target.value })}\r\n                                        className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                                    >\r\n                                        <option value=\"block\">Block Further Punches</option>\r\n                                        <option value=\"warn\">Show Warning (Allow)</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n\r\n                    <ToggleItem\r\n                        label=\"Break Tracking\"\r\n                        description=\"Deduct break time from working hours calculation\"\r\n                        active={settings.breakTrackingEnabled}\r\n                        onClick={() => setSettings({ ...settings, breakTrackingEnabled: !settings.breakTrackingEnabled })}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Overtime Configuration */}\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-100 dark:border-slate-800 shadow-xl col-span-1 md:col-span-2\">\r\n                <h3 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter flex items-center gap-3 mb-8\">\r\n                    <Clock className=\"text-orange-500\" />\r\n                    Overtime Configuration\r\n                </h3>\r\n\r\n                <div className=\"space-y-6\">\r\n                    <ToggleItem\r\n                        label=\"Overtime Allowed\"\r\n                        description=\"Enable overtime tracking and calculation\"\r\n                        active={settings.overtimeAllowed}\r\n                        onClick={() => setSettings({ ...settings, overtimeAllowed: !settings.overtimeAllowed })}\r\n                    />\r\n\r\n                    {settings.overtimeAllowed && (\r\n                        <>\r\n                            <ToggleItem\r\n                                label=\"Overtime After Shift Hours Only\"\r\n                                description=\"Only count overtime after scheduled shift hours\"\r\n                                active={settings.overtimeAfterShiftHours}\r\n                                onClick={() => setSettings({ ...settings, overtimeAfterShiftHours: !settings.overtimeAfterShiftHours })}\r\n                            />\r\n                            <ToggleItem\r\n                                label=\"Send Overtime to Payroll\"\r\n                                description=\"Export overtime hours to payroll system\"\r\n                                active={settings.overtimeToPayroll}\r\n                                onClick={() => setSettings({ ...settings, overtimeToPayroll: !settings.overtimeToPayroll })}\r\n                            />\r\n                        </>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Location Restrictions */}\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-100 dark:border-slate-800 shadow-xl col-span-1 md:col-span-2\">\r\n                <h3 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter flex items-center gap-3 mb-8\">\r\n                    <MapPin className=\"text-red-500\" />\r\n                    Location Restrictions\r\n                </h3>\r\n\r\n                <div className=\"space-y-6\">\r\n                    <div>\r\n                        <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">Restriction Mode</label>\r\n                        <select\r\n                            value={settings.locationRestrictionMode}\r\n                            onChange={(e) => {\r\n                                const mode = e.target.value;\r\n                                setSettings({\r\n                                    ...settings,\r\n                                    locationRestrictionMode: mode,\r\n                                    geoFencingEnabled: mode === 'geo' || mode === 'both',\r\n                                    ipRestrictionEnabled: mode === 'ip' || mode === 'both'\r\n                                });\r\n                            }}\r\n                            className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                        >\r\n                            <option value=\"none\">No Restriction (WFH / Field Employees)</option>\r\n                            <option value=\"geo\">Geo-fencing Only</option>\r\n                            <option value=\"ip\">IP Restriction Only</option>\r\n                            <option value=\"both\">Both Geo-fencing and IP</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    {(settings.locationRestrictionMode === 'geo' || settings.locationRestrictionMode === 'both') && (\r\n                        <div className=\"bg-slate-50 dark:bg-slate-950 rounded-xl p-4 space-y-4\">\r\n                            <div className=\"text-sm font-black text-slate-600 dark:text-slate-400 uppercase tracking-widest\">Geo-fencing Settings</div>\r\n                            <div className=\"grid grid-cols-3 gap-4\">\r\n                                <InputGroup\r\n                                    label=\"Office Latitude\"\r\n                                    type=\"number\"\r\n                                    step=\"any\"\r\n                                    value={settings.officeLatitude || ''}\r\n                                    onChange={(e) => setSettings({ ...settings, officeLatitude: parseFloat(e.target.value) })}\r\n                                />\r\n                                <InputGroup\r\n                                    label=\"Office Longitude\"\r\n                                    type=\"number\"\r\n                                    step=\"any\"\r\n                                    value={settings.officeLongitude || ''}\r\n                                    onChange={(e) => setSettings({ ...settings, officeLongitude: parseFloat(e.target.value) })}\r\n                                />\r\n                                <InputGroup\r\n                                    label=\"Allowed Radius (meters)\"\r\n                                    type=\"number\"\r\n                                    value={settings.allowedRadiusMeters}\r\n                                    onChange={(e) => setSettings({ ...settings, allowedRadiusMeters: parseInt(e.target.value) })}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {(settings.locationRestrictionMode === 'ip' || settings.locationRestrictionMode === 'both') && (\r\n                        <div className=\"bg-slate-50 dark:bg-slate-950 rounded-xl p-4 space-y-4\">\r\n                            <div className=\"text-sm font-black text-slate-600 dark:text-slate-400 uppercase tracking-widest mb-2\">IP Restriction Settings</div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">Allowed IP Addresses</label>\r\n                                <div className=\"space-y-2\">\r\n                                    {(settings.allowedIPs || []).map((ip, idx) => (\r\n                                        <div key={idx} className=\"flex items-center gap-2\">\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={ip}\r\n                                                onChange={(e) => {\r\n                                                    const newIPs = [...(settings.allowedIPs || [])];\r\n                                                    newIPs[idx] = e.target.value;\r\n                                                    setSettings({ ...settings, allowedIPs: newIPs });\r\n                                                }}\r\n                                                className=\"flex-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 p-2 rounded-lg text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                                                placeholder=\"192.168.1.1\"\r\n                                            />\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    const newIPs = (settings.allowedIPs || []).filter((_, i) => i !== idx);\r\n                                                    setSettings({ ...settings, allowedIPs: newIPs });\r\n                                                }}\r\n                                                className=\"p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-950/20 rounded-lg transition\"\r\n                                            >\r\n                                                <X size={16} />\r\n                                            </button>\r\n                                        </div>\r\n                                    ))}\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            setSettings({ ...settings, allowedIPs: [...(settings.allowedIPs || []), ''] });\r\n                                        }}\r\n                                        className=\"flex items-center gap-2 px-4 py-2 bg-blue-50 dark:bg-blue-950/20 text-blue-600 dark:text-blue-400 rounded-lg text-xs font-black uppercase hover:bg-blue-100 dark:hover:bg-blue-950/30 transition\"\r\n                                    >\r\n                                        <Plus size={14} />\r\n                                        Add IP Address\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">Allowed IP Ranges (CIDR format)</label>\r\n                                <div className=\"space-y-2\">\r\n                                    {(settings.allowedIPRanges || []).map((range, idx) => (\r\n                                        <div key={idx} className=\"flex items-center gap-2\">\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={range}\r\n                                                onChange={(e) => {\r\n                                                    const newRanges = [...(settings.allowedIPRanges || [])];\r\n                                                    newRanges[idx] = e.target.value;\r\n                                                    setSettings({ ...settings, allowedIPRanges: newRanges });\r\n                                                }}\r\n                                                className=\"flex-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 p-2 rounded-lg text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                                                placeholder=\"192.168.1.0/24\"\r\n                                            />\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    const newRanges = (settings.allowedIPRanges || []).filter((_, i) => i !== idx);\r\n                                                    setSettings({ ...settings, allowedIPRanges: newRanges });\r\n                                                }}\r\n                                                className=\"p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-950/20 rounded-lg transition\"\r\n                                            >\r\n                                                <X size={16} />\r\n                                            </button>\r\n                                        </div>\r\n                                    ))}\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            setSettings({ ...settings, allowedIPRanges: [...(settings.allowedIPRanges || []), ''] });\r\n                                        }}\r\n                                        className=\"flex items-center gap-2 px-4 py-2 bg-blue-50 dark:bg-blue-950/20 text-blue-600 dark:text-blue-400 rounded-lg text-xs font-black uppercase hover:bg-blue-100 dark:hover:bg-blue-950/30 transition\"\r\n                                    >\r\n                                        <Plus size={14} />\r\n                                        Add IP Range\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Policy Toggles */}\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-100 dark:border-slate-800 shadow-xl col-span-1 md:col-span-2\">\r\n                <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-8\">\r\n                    <div className=\"flex gap-12\">\r\n                        <ToggleItem\r\n                            label=\"Sandwich Leave Rules\"\r\n                            description=\"Apply leave to weekends between absences\"\r\n                            active={settings.sandwichLeave}\r\n                            onClick={() => setSettings({ ...settings, sandwichLeave: !settings.sandwichLeave })}\r\n                        />\r\n                        <ToggleItem\r\n                            label=\"Auto-Mark Absent\"\r\n                            description=\"Mark absent if no punch log exists\"\r\n                            active={settings.autoAbsent}\r\n                            onClick={() => setSettings({ ...settings, autoAbsent: !settings.autoAbsent })}\r\n                        />\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={handleSave}\r\n                        disabled={saving}\r\n                        className=\"bg-slate-800 text-white px-10 py-4 rounded-2xl font-black uppercase text-xs tracking-widest shadow-2xl shadow-slate-500/20 hover:bg-slate-900 hover:-translate-y-1 transition disabled:opacity-50 disabled:translate-y-0\"\r\n                    >\r\n                        {saving ? 'Saving...' : 'Save Configuration'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction InputGroup({ label, ...props }) {\r\n    return (\r\n        <div className=\"space-y-2\">\r\n            <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest block\">{label}</label>\r\n            <input {...props} className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition\" />\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ToggleItem({ label, description, active, onClick }) {\r\n    return (\r\n        <div className=\"flex items-center gap-4 cursor-pointer group\" onClick={onClick}>\r\n            <div className={`transition-colors duration-300 ${active ? 'text-blue-500' : 'text-slate-300'}`}>\r\n                {active ? <ToggleRight size={48} /> : <ToggleLeft size={48} />}\r\n            </div>\r\n            <div>\r\n                <div className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">{label}</div>\r\n                <div className=\"text-xs font-bold text-slate-600 dark:text-slate-400\">{description}</div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\CalendarManagement.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token Upload","line":12,"column":5}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Pagination, DatePicker, Modal } from 'antd';\r\nimport { showToast, showConfirmToast } from '../../utils/uiNotifications';\r\nimport dayjs from 'dayjs';\r\nimport api from '../../utils/api';\r\nimport AttendanceCalendar from '../../components/AttendanceCalendar';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\nimport {\r\n    Upload, Plus, ChevronLeft, ChevronRight,\r\n    Coffee, Edit2, Trash2, X, AlertCircle,\r\n    FileSpreadsheet, AlertTriangle, CheckCircle, Save\r\n    Upload, Plus, AlertCircle, ChevronLeft, ChevronRight,\r\n    FileSpreadsheet, Coffee, Edit2, Trash2, X, Save,\r\n    AlertTriangle, CheckCircle, Calendar as CalendarIcon, Clock\r\n} from 'lucide-react';\r\n\r\nexport default function CalendarManagement() {\r\n    const [view, setView] = useState('calendar'); // 'calendar' or 'list'\r\n    const [currentYear, setCurrentYear] = useState(new Date().getFullYear());\r\n    const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());\r\n    const [holidays, setHolidays] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showHolidayModal, setShowHolidayModal] = useState(false);\r\n    const [editingHoliday, setEditingHoliday] = useState(null);\r\n    const [holidayForm, setHolidayForm] = useState({ name: '', date: '', type: 'Public', description: '' });\r\n    const [settings, setSettings] = useState({});\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const pageSize = 10;\r\n    const [calendarData, setCalendarData] = useState(null);\r\n\r\n    // Bulk Upload State\r\n    const [showBulkUploadModal, setShowBulkUploadModal] = useState(false);\r\n    const [uploadFile, setUploadFile] = useState(null);\r\n    const [uploadPreview, setUploadPreview] = useState(null);\r\n    const [uploadErrors, setUploadErrors] = useState([]);\r\n    const [uploading, setUploading] = useState(false);\r\n    const [uploadSummary, setUploadSummary] = useState(null);\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, [currentYear, currentMonth]);\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const [holidaysRes, settingsRes, calendarRes] = await Promise.all([\r\n                api.get(`/holidays?year=${currentYear}`),\r\n                api.get('/attendance/settings'),\r\n                api.get(`/attendance/calendar?year=${currentYear}&month=${currentMonth + 1}`)\r\n            ]);\r\n            setHolidays(holidaysRes.data || []);\r\n            setSettings(settingsRes.data || {});\r\n            setCalendarData(calendarRes.data);\r\n        } catch (err) {\r\n            console.error('Failed to fetch calendar data:', err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleAddHoliday = () => {\r\n        setEditingHoliday(null);\r\n        setHolidayForm({ name: '', date: '', type: 'Public', description: '' });\r\n        setShowHolidayModal(true);\r\n    };\r\n\r\n    const handleEditHoliday = (holiday) => {\r\n        setEditingHoliday(holiday);\r\n        const dateStr = new Date(holiday.date).toISOString().split('T')[0];\r\n        setHolidayForm({\r\n            name: holiday.name,\r\n            date: dateStr,\r\n            type: holiday.type || 'Public',\r\n            description: holiday.description || ''\r\n        });\r\n        setShowHolidayModal(true);\r\n    };\r\n\r\n    const handleSaveHoliday = async () => {\r\n        try {\r\n            if (!holidayForm.name || !holidayForm.date) {\r\n                showToast('error', 'Error', 'Please fill in holiday name and date');\r\n                return;\r\n            }\r\n\r\n            if (editingHoliday) {\r\n                await api.put(`/holidays/${editingHoliday._id}`, holidayForm);\r\n            } else {\r\n                await api.post('/holidays', holidayForm);\r\n            }\r\n\r\n            setShowHolidayModal(false);\r\n            showToast('success', 'Success', 'Holiday saved successfully');\r\n            fetchData();\r\n        } catch (err) {\r\n            console.error('Failed to save holiday:', err);\r\n            showToast('error', 'Error', err.response?.data?.error || 'Failed to save holiday');\r\n        }\r\n    };\r\n\r\n    const handleDeleteHoliday = async (id) => {\r\n        showConfirmToast({\r\n            title: 'Delete Holiday',\r\n            description: 'Are you sure you want to delete this holiday? This action cannot be undone.',\r\n            okText: 'Delete',\r\n            cancelText: 'Cancel',\r\n            danger: true,\r\n            onConfirm: async () => {\r\n                try {\r\n                    await api.delete(`/holidays/${id}`);\r\n                    showToast('success', 'Success', 'Holiday deleted successfully');\r\n                    fetchData();\r\n                } catch (err) {\r\n                    console.error('Failed to delete holiday:', err);\r\n                    showToast('error', 'Error', err.response?.data?.error || 'Failed to delete holiday');\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleFileSelect = (e) => {\r\n        const file = e.target.files[0];\r\n        if (file) {\r\n            setUploadFile(file);\r\n            setUploadPreview(null);\r\n            setUploadSummary(null);\r\n        }\r\n    };\r\n\r\n    const handlePreviewUpload = async () => {\r\n        if (!uploadFile) return;\r\n\r\n        try {\r\n            setUploading(true);\r\n            const formData = new FormData();\r\n            formData.append('file', uploadFile);\r\n\r\n            const res = await api.post('/holidays/bulk/preview', formData, {\r\n                headers: {\r\n                    'Content-Type': 'multipart/form-data'\r\n                }\r\n            });\r\n\r\n            setUploadPreview(res.data.preview);\r\n            setUploadErrors(res.data.errors || []);\r\n            setUploadSummary(res.data.summary);\r\n        } catch (err) {\r\n            console.error('Failed to preview upload:', err);\r\n            showToast('error', 'Error', err.response?.data?.error || 'Failed to process file');\r\n            setUploadFile(null);\r\n        } finally {\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    const handleConfirmUpload = async () => {\r\n        if (!uploadPreview || uploadSummary?.new === 0) return;\r\n\r\n        try {\r\n            setUploading(true);\r\n            const res = await api.post('/holidays/bulk/confirm', {\r\n                holidays: uploadPreview,\r\n                skipDuplicates: true\r\n            });\r\n\r\n            showToast('success', 'Success', `Successfully uploaded ${res.data.summary.saved} holidays!`);\r\n            setShowBulkUploadModal(false);\r\n            setUploadFile(null);\r\n            setUploadPreview(null);\r\n            setUploadErrors([]);\r\n            setUploadSummary(null);\r\n            fetchData(); // Refresh the holiday list\r\n        } catch (err) {\r\n            console.error('Failed to confirm upload:', err);\r\n            showToast('error', 'Error', err.response?.data?.error || 'Failed to save holidays');\r\n        } finally {\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    const navigateMonth = (direction) => {\r\n        if (direction === 'prev') {\r\n            if (currentMonth === 0) {\r\n                setCurrentMonth(11);\r\n                setCurrentYear(currentYear - 1);\r\n            } else {\r\n                setCurrentMonth(currentMonth - 1);\r\n            }\r\n        } else {\r\n            if (currentMonth === 11) {\r\n                setCurrentMonth(0);\r\n                setCurrentYear(currentYear + 1);\r\n            } else {\r\n                setCurrentMonth(currentMonth + 1);\r\n            }\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <div className=\"text-slate-400 font-bold uppercase tracking-widest\">Loading Calendar...</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-8 p-6 md:p-8 animate-in fade-in duration-500\">\r\n            {/* Header & Stats */}\r\n            <div className=\"space-y-6\">\r\n                <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                    <div>\r\n                        <h1 className=\"text-2xl sm:text-3xl font-bold text-slate-900 tracking-tight\">\r\n                            Calendar Management\r\n                        </h1>\r\n                        <p className=\"text-sm text-slate-500 mt-1\">\r\n                            Manage organization working days and holidays.\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <button\r\n                            onClick={() => setShowBulkUploadModal(true)}\r\n                            className=\"px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition flex items-center gap-2 shadow-sm\"\r\n                        >\r\n                            <Upload size={16} />\r\n                            <span className=\"hidden sm:inline\">Bulk Upload</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={handleAddHoliday}\r\n                            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition flex items-center gap-2 shadow-md shadow-blue-500/20\"\r\n                        >\r\n                            <Plus size={16} />\r\n                            Add Holiday\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Stats Cards */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div className=\"relative overflow-hidden bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg shadow-blue-500/20\">\r\n                        <div className=\"relative z-10\">\r\n                            <div className=\"text-blue-100 text-xs font-semibold uppercase tracking-wider mb-1\">Total Holidays</div>\r\n                            <div className=\"text-3xl font-bold\">{holidays.length}</div>\r\n                            <div className=\"mt-2 text-blue-100 text-xs flex items-center gap-1\">\r\n                                <CalendarIcon size={12} />\r\n                                <span>In {currentYear}</span>\r\n                            </div>\r\n                        </div>\r\n                        <CalendarIcon className=\"absolute right-[-20px] bottom-[-20px] text-white opacity-10\" size={120} />\r\n                    </div>\r\n\r\n                    <div className=\"relative overflow-hidden bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-6 text-white shadow-lg shadow-emerald-500/20\">\r\n                        <div className=\"relative z-10\">\r\n                            <div className=\"text-emerald-100 text-xs font-semibold uppercase tracking-wider mb-1\">Next Holiday</div>\r\n                            <div className=\"text-xl font-bold truncate\">\r\n                                {holidays.find(h => new Date(h.date) >= new Date())?.name || 'No upcoming holidays'}\r\n                            </div>\r\n                            <div className=\"mt-2 text-emerald-100 text-xs flex items-center gap-1\">\r\n                                <Clock size={12} />\r\n                                <span>\r\n                                    {holidays.find(h => new Date(h.date) >= new Date())\r\n                                        ? formatDateDDMMYYYY(holidays.find(h => new Date(h.date) >= new Date()).date)\r\n                                        : 'Relax!'}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                        <Coffee className=\"absolute right-[-10px] bottom-[-20px] text-white opacity-10\" size={100} />\r\n                    </div>\r\n\r\n                    <div className=\"relative overflow-hidden bg-white border border-slate-200 rounded-2xl p-6 shadow-sm\">\r\n                        <div className=\"flex items-center justify-between h-full\">\r\n                            <div>\r\n                                <div className=\"text-slate-500 text-xs font-semibold uppercase tracking-wider mb-1\">View Mode</div>\r\n                                <div className=\"flex bg-slate-100 p-1 rounded-lg mt-2 w-fit\">\r\n                                    <button\r\n                                        onClick={() => setView('calendar')}\r\n                                        className={`px-3 py-1.5 rounded-md text-xs font-semibold transition-all ${view === 'calendar' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}\r\n                                    >\r\n                                        Calendar\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setView('list')}\r\n                                        className={`px-3 py-1.5 rounded-md text-xs font-semibold transition-all ${view === 'list' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}\r\n                                    >\r\n                                        List\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex flex-col items-end gap-2\">\r\n                                <span className=\"text-xs font-semibold text-slate-400 uppercase tracking-widest\">Year</span>\r\n                                <select\r\n                                    value={currentYear}\r\n                                    onChange={(e) => setCurrentYear(parseInt(e.target.value))}\r\n                                    className=\"px-3 py-1 bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                >\r\n                                    {Array.from({ length: 5 }, (_, i) => {\r\n                                        const year = new Date().getFullYear() - 1 + i;\r\n                                        return (\r\n                                            <option key={year} value={year}>\r\n                                                {year}\r\n                                            </option>\r\n                                        );\r\n                                    })}\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Info Banner */}\r\n            <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start gap-3\">\r\n                <AlertCircle className=\"text-amber-600 mt-0.5 flex-shrink-0\" size={18} />\r\n                <div className=\"text-sm text-amber-800\">\r\n                    <span className=\"font-semibold block mb-0.5\">HR-Only Access</span>\r\n                    Only HR/Company Admin can modify the calendar. Employees have read-only access.\r\n                </div>\r\n            </div>\r\n\r\n            {view === 'calendar' ? (\r\n                <div className=\"space-y-6\">\r\n                    {/* Month Navigation */}\r\n                    <div className=\"flex items-center justify-between bg-white px-4 py-3 rounded-xl border border-slate-200 shadow-sm\">\r\n                        <button\r\n                            onClick={() => navigateMonth('prev')}\r\n                            className=\"p-2 hover:bg-slate-100 rounded-lg transition text-slate-500 hover:text-slate-800\"\r\n                        >\r\n                            <ChevronLeft size={20} />\r\n                        </button>\r\n                        <div className=\"text-lg font-bold text-slate-900\">\r\n                            {new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long', year: 'numeric' })}\r\n                        </div>\r\n                        <button\r\n                            onClick={() => navigateMonth('next')}\r\n                            className=\"p-2 hover:bg-slate-100 rounded-lg transition text-slate-500 hover:text-slate-800\"\r\n                        >\r\n                            <ChevronRight size={20} />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Calendar Display */}\r\n                    {calendarData && (\r\n                        <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden p-6\">\r\n                            <AttendanceCalendar\r\n                                data={[]}\r\n                                holidays={calendarData.holidays || []}\r\n                                settings={calendarData.settings || {}}\r\n                                currentMonth={currentMonth}\r\n                                currentYear={currentYear}\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Calendar Legend */}\r\n                    <div className=\"bg-white rounded-xl p-4 border border-slate-200 shadow-sm\">\r\n                        <div className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3\">Legend</div>\r\n                        <div className=\"flex flex-wrap gap-3\">\r\n                            <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-amber-50 text-amber-700 border border-amber-100\">\r\n                                Holiday\r\n                            </span>\r\n                            <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200\">\r\n                                Weekly Off\r\n                            </span>\r\n                            <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-100\">\r\n                                Present\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden\">\r\n                    <div className=\"px-6 py-4 border-b border-slate-200 bg-slate-50\">\r\n                        <h3 className=\"text-sm font-semibold text-slate-700\">\r\n                            Holidays ({currentYear})\r\n                        </h3>\r\n                    </div>\r\n                    <div className=\"overflow-x-auto\">\r\n                        <table className=\"w-full text-left text-sm\">\r\n                            <thead>\r\n                                <tr className=\"bg-slate-50 border-b border-slate-200\">\r\n                                    <th className=\"px-6 py-3 font-semibold text-slate-700\">Date</th>\r\n                                    <th className=\"px-6 py-3 font-semibold text-slate-700\">Holiday Name</th>\r\n                                    <th className=\"px-6 py-3 font-semibold text-slate-700\">Type</th>\r\n                                    <th className=\"px-6 py-3 font-semibold text-slate-700\">Description</th>\r\n                                    <th className=\"px-6 py-3 font-semibold text-slate-700 text-right\">Actions</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-slate-100\">\r\n                                {holidays.length === 0 ? (\r\n                                    <tr>\r\n                                        <td colSpan=\"5\" className=\"px-6 py-12 text-center text-slate-400\">\r\n                                            No holidays defined for {currentYear}\r\n                                        </td>\r\n                                    </tr>\r\n                                ) : (\r\n                                    holidays.slice((currentPage - 1) * pageSize, currentPage * pageSize).map((holiday) => {\r\n                                        const holidayDate = new Date(holiday.date);\r\n                                        const holidayYear = holidayDate.getFullYear();\r\n                                        return (\r\n                                            <tr key={holiday._id} className=\"hover:bg-slate-50 transition-colors\">\r\n                                                <td className=\"px-6 py-4\">\r\n                                                    <div>\r\n                                                        <div className=\"font-medium text-slate-900\">\r\n                                                            {formatDateDDMMYYYY(holiday.date)}\r\n                                                        </div>\r\n                                                        <div className=\"text-xs text-slate-500\">\r\n                                                            {new Date(holiday.date).toLocaleDateString('en-US', { weekday: 'long' })}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4\">\r\n                                                    <div className=\"font-medium text-slate-900\">{holiday.name}</div>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4\">\r\n                                                    <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium \r\n                                                        ${holiday.type === 'Public' ? 'bg-purple-50 text-purple-700 border border-purple-100' :\r\n                                                            holiday.type === 'Optional' ? 'bg-blue-50 text-blue-700 border border-blue-100' :\r\n                                                                'bg-slate-100 text-slate-600 border border-slate-200'}`}>\r\n                                                        {holiday.type || 'Public'}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 text-slate-500 max-w-xs truncate\">\r\n                                                    {holiday.description || '-'}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 text-right\">\r\n                                                    <div className=\"flex gap-2 justify-end\">\r\n                                                        <button\r\n                                                            onClick={() => handleEditHoliday(holiday)}\r\n                                                            className=\"p-1.5 hover:bg-blue-50 text-slate-400 hover:text-blue-600 rounded transition\"\r\n                                                            title=\"Edit\"\r\n                                                        >\r\n                                                            <Edit2 size={16} />\r\n                                                        </button>\r\n                                                        <button\r\n                                                            onClick={() => handleDeleteHoliday(holiday._id)}\r\n                                                            className=\"p-1.5 hover:bg-red-50 text-slate-400 hover:text-red-600 rounded transition\"\r\n                                                            title=\"Delete\"\r\n                                                        >\r\n                                                            <Trash2 size={16} />\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </td>\r\n                                            </tr>\r\n                                        );\r\n                                    })\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                    {holidays.length > pageSize && (\r\n                        <div className=\"px-6 py-4 border-t border-slate-200 bg-slate-50 flex justify-end\">\r\n                            <Pagination\r\n                                current={currentPage}\r\n                                pageSize={pageSize}\r\n                                total={holidays.length}\r\n                                onChange={(page) => setCurrentPage(page)}\r\n                                showSizeChanger={false}\r\n                                hideOnSinglePage\r\n                                size=\"small\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Holiday Modal */}\r\n            {showHolidayModal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"absolute inset-0 bg-slate-900/60 backdrop-blur-sm\" onClick={() => setShowHolidayModal(false)}></div>\r\n                    <div className=\"relative w-full max-w-md bg-white dark:bg-slate-900 rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-800 p-8 animate-in zoom-in-95 duration-200\">\r\n                        <div className=\"flex justify-between items-center mb-6\">\r\n                            <h3 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">\r\n                                {editingHoliday ? 'Edit Holiday' : 'Add Holiday'}\r\n                            </h3>\r\n                            <button\r\n                                onClick={() => setShowHolidayModal(false)}\r\n                                className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl text-slate-400 hover:text-rose-500 transition\"\r\n                            >\r\n                                <X size={20} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">\r\n                                    Holiday Name *\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={holidayForm.name}\r\n                                    onChange={(e) => setHolidayForm({ ...holidayForm, name: e.target.value })}\r\n                                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                                    placeholder=\"e.g., Diwali, Christmas\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">\r\n                                    Date *\r\n                                </label>\r\n                                <DatePicker\r\n                                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition h-[46px]\"\r\n                                    format=\"DD-MM-YYYY\"\r\n                                    placeholder=\"DD-MM-YYYY\"\r\n                                    value={holidayForm.date ? dayjs(holidayForm.date) : null}\r\n                                    onChange={(date) => setHolidayForm({ ...holidayForm, date: date ? date.format('YYYY-MM-DD') : '' })}\r\n                                />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">\r\n                                    Type\r\n                                </label>\r\n                                <select\r\n                                    value={holidayForm.type}\r\n                                    onChange={(e) => setHolidayForm({ ...holidayForm, type: e.target.value })}\r\n                                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition\"\r\n                                >\r\n                                    <option value=\"Public\">Public Holiday</option>\r\n                                    <option value=\"Optional\">Optional Holiday</option>\r\n                                    <option value=\"Company\">Company Holiday</option>\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">\r\n                                    Description\r\n                                </label>\r\n                                <textarea\r\n                                    value={holidayForm.description}\r\n                                    onChange={(e) => setHolidayForm({ ...holidayForm, description: e.target.value })}\r\n                                    className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 p-3 rounded-xl text-sm font-bold outline-none focus:border-blue-500 transition resize-none\"\r\n                                    rows=\"3\"\r\n                                    placeholder=\"Optional description\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-3 mt-8\">\r\n                            <button\r\n                                onClick={() => setShowHolidayModal(false)}\r\n                                className=\"flex-1 px-6 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl text-sm font-black uppercase tracking-widest hover:bg-slate-200 dark:hover:bg-slate-700 transition\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleSaveHoliday}\r\n                                className=\"flex-1 px-6 py-3 bg-blue-600 text-white rounded-xl text-sm font-black uppercase tracking-widest shadow-xl shadow-blue-500/20 hover:bg-blue-700 transition flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Save size={16} />\r\n                                {editingHoliday ? 'Update' : 'Save'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Bulk Upload Modal */}\r\n            {showBulkUploadModal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"absolute inset-0 bg-slate-900/60 backdrop-blur-sm\" onClick={() => {\r\n                        setShowBulkUploadModal(false);\r\n                        setUploadFile(null);\r\n                        setUploadPreview(null);\r\n                        setUploadErrors([]);\r\n                        setUploadSummary(null);\r\n                    }}></div>\r\n                    <div className=\"relative w-full w-full max-h-[90vh] overflow-y-auto bg-white dark:bg-slate-900 rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-800 p-8 animate-in zoom-in-95 duration-200\">\r\n                        <div className=\"flex justify-between items-center mb-6\">\r\n                            <div>\r\n                                <h3 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tighter flex items-center gap-3\">\r\n                                    <FileSpreadsheet className=\"text-emerald-500\" size={24} />\r\n                                    Bulk Holiday Upload\r\n                                </h3>\r\n                                <p className=\"text-xs font-bold text-slate-400 mt-2\">\r\n                                    Upload Excel file (.xlsx, .xls) with columns: Name, Date, Type (optional), Description (optional)\r\n                                </p>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => {\r\n                                    setShowBulkUploadModal(false);\r\n                                    setUploadFile(null);\r\n                                    setUploadPreview(null);\r\n                                    setUploadErrors([]);\r\n                                    setUploadSummary(null);\r\n                                }}\r\n                                className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl text-slate-400 hover:text-rose-500 transition\"\r\n                            >\r\n                                <X size={20} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        {!uploadPreview ? (\r\n                            <div className=\"space-y-6\">\r\n                                <div className=\"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-2xl p-12 text-center hover:border-emerald-500 transition-colors\">\r\n                                    <input\r\n                                        type=\"file\"\r\n                                        id=\"bulk-upload-file\"\r\n                                        accept=\".xlsx,.xls,.csv\"\r\n                                        onChange={handleFileSelect}\r\n                                        className=\"hidden\"\r\n                                    />\r\n                                    <label htmlFor=\"bulk-upload-file\" className=\"cursor-pointer\">\r\n                                        <Upload size={48} className=\"mx-auto text-slate-400 mb-4\" />\r\n                                        <div className=\"text-lg font-black text-slate-600 dark:text-slate-300 mb-2\">\r\n                                            Click to upload or drag and drop\r\n                                        </div>\r\n                                        <div className=\"text-sm font-bold text-slate-400\">\r\n                                            Excel files (.xlsx, .xls) up to 5MB\r\n                                        </div>\r\n                                        {uploadFile && (\r\n                                            <div className=\"mt-4 text-sm font-bold text-emerald-600\">\r\n                                                Selected: {uploadFile.name}\r\n                                            </div>\r\n                                        )}\r\n                                    </label>\r\n                                </div>\r\n\r\n                                {uploadFile && (\r\n                                    <button\r\n                                        onClick={handlePreviewUpload}\r\n                                        disabled={uploading}\r\n                                        className=\"w-full px-6 py-4 bg-emerald-600 text-white rounded-2xl text-sm font-black uppercase tracking-widest shadow-xl shadow-emerald-500/20 hover:bg-emerald-700 transition disabled:opacity-50 flex items-center justify-center gap-2\"\r\n                                    >\r\n                                        {uploading ? (\r\n                                            <>\r\n                                                <div className=\"h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                                                Processing...\r\n                                            </>\r\n                                        ) : (\r\n                                            <>\r\n                                                <FileSpreadsheet size={20} />\r\n                                                Preview Upload\r\n                                            </>\r\n                                        )}\r\n                                    </button>\r\n                                )}\r\n\r\n                                <div className=\"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-2xl p-4\">\r\n                                    <div className=\"text-sm font-black text-blue-800 dark:text-blue-200 mb-2\">File Format:</div>\r\n                                    <div className=\"text-xs font-bold text-blue-700 dark:text-blue-300 space-y-1\">\r\n                                        <div>Row 1: Header (will be skipped)</div>\r\n                                        <div>Columns: Name | Date | Type (optional) | Description (optional)</div>\r\n                                        <div>Example: \"Diwali\" | \"01-11-2024\" | \"Festival\" | \"Hindu festival\"</div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-6\">\r\n                                {/* Summary */}\r\n                                {uploadSummary && (\r\n                                    <div className=\"grid grid-cols-3 gap-4\">\r\n                                        <div className=\"bg-emerald-50 dark:bg-emerald-950/20 border border-emerald-200 dark:border-emerald-900 rounded-xl p-4\">\r\n                                            <div className=\"text-xs font-black text-emerald-600 dark:text-emerald-400 uppercase tracking-widest mb-1\">New</div>\r\n                                            <div className=\"text-2xl font-black text-emerald-700 dark:text-emerald-300\">{uploadSummary.new}</div>\r\n                                        </div>\r\n                                        <div className=\"bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-900 rounded-xl p-4\">\r\n                                            <div className=\"text-xs font-black text-amber-600 dark:text-amber-400 uppercase tracking-widest mb-1\">Duplicates</div>\r\n                                            <div className=\"text-2xl font-black text-amber-700 dark:text-amber-300\">{uploadSummary.duplicates}</div>\r\n                                        </div>\r\n                                        <div className=\"bg-rose-50 dark:bg-rose-950/20 border border-rose-200 dark:border-rose-900 rounded-xl p-4\">\r\n                                            <div className=\"text-xs font-black text-rose-600 dark:text-rose-400 uppercase tracking-widest mb-1\">Errors</div>\r\n                                            <div className=\"text-2xl font-black text-rose-700 dark:text-rose-300\">{uploadSummary.errors}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Preview Table */}\r\n                                <div className=\"bg-slate-50 dark:bg-slate-950 rounded-2xl border border-slate-200 dark:border-slate-800 overflow-hidden\">\r\n                                    <div className=\"overflow-x-auto max-h-96\">\r\n                                        <table className=\"w-full text-left\">\r\n                                            <thead className=\"bg-slate-100 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 sticky top-0\">\r\n                                                <tr>\r\n                                                    <th className=\"px-4 py-3 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Status</th>\r\n                                                    <th className=\"px-4 py-3 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Name</th>\r\n                                                    <th className=\"px-4 py-3 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Date</th>\r\n                                                    <th className=\"px-4 py-3 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Type</th>\r\n                                                    <th className=\"px-4 py-3 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Description</th>\r\n                                                </tr>\r\n                                            </thead>\r\n                                            <tbody className=\"divide-y divide-slate-200 dark:divide-slate-800\">\r\n                                                {uploadPreview.map((holiday, idx) => (\r\n                                                    <tr key={idx} className={`${holiday.isDuplicate ? 'bg-amber-50/50 dark:bg-amber-950/20' : ''}`}>\r\n                                                        <td className=\"px-4 py-3\">\r\n                                                            {holiday.isDuplicate ? (\r\n                                                                <div className=\"flex items-center gap-2 text-amber-600\">\r\n                                                                    <AlertTriangle size={14} />\r\n                                                                    <span className=\"text-[10px] font-black\">Duplicate</span>\r\n                                                                </div>\r\n                                                            ) : (\r\n                                                                <div className=\"flex items-center gap-2 text-emerald-600\">\r\n                                                                    <CheckCircle size={14} />\r\n                                                                    <span className=\"text-[10px] font-black\">New</span>\r\n                                                                </div>\r\n                                                            )}\r\n                                                        </td>\r\n                                                        <td className=\"px-4 py-3 text-sm font-bold text-slate-800 dark:text-white\">{holiday.name}</td>\r\n                                                        <td className=\"px-4 py-3 text-xs font-bold text-slate-600 dark:text-slate-400\">\r\n                                                            {new Date(holiday.date).toLocaleDateString('en-US', {\r\n                                                                year: 'numeric', month: 'short', day: 'numeric'\r\n                                                            })}\r\n                                                        </td>\r\n                                                        <td className=\"px-4 py-3\">\r\n                                                            <span className=\"px-2 py-1 bg-blue-50 dark:bg-blue-950/30 text-blue-600 dark:text-blue-400 rounded text-xs font-black uppercase\">\r\n                                                                {holiday.type || 'Public'}\r\n                                                            </span>\r\n                                                        </td>\r\n                                                        <td className=\"px-4 py-3 text-xs font-bold text-slate-500 dark:text-slate-400\">\r\n                                                            {holiday.description || '‚Äî'}\r\n                                                        </td>\r\n                                                    </tr>\r\n                                                ))}\r\n                                            </tbody>\r\n                                        </table>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Errors */}\r\n                                {uploadErrors && uploadErrors.length > 0 && (\r\n                                    <div className=\"bg-rose-50 dark:bg-rose-950/20 border border-rose-200 dark:border-rose-900 rounded-2xl p-4\">\r\n                                        <div className=\"text-sm font-black text-rose-800 dark:text-rose-200 mb-2\">Errors:</div>\r\n                                        <div className=\"space-y-1\">\r\n                                            {uploadErrors.map((err, idx) => (\r\n                                                <div key={idx} className=\"text-xs font-bold text-rose-700 dark:text-rose-300\">\r\n                                                    Row {err.row}: {err.error}\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Action Buttons */}\r\n                                <div className=\"flex gap-3\">\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            setUploadPreview(null);\r\n                                            setUploadFile(null);\r\n                                            setUploadSummary(null);\r\n                                        }}\r\n                                        className=\"flex-1 px-6 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl text-sm font-black uppercase tracking-widest hover:bg-slate-200 dark:hover:bg-slate-700 transition\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleConfirmUpload}\r\n                                        disabled={uploading || !uploadPreview || uploadSummary?.new === 0}\r\n                                        className=\"flex-1 px-6 py-3 bg-emerald-600 text-white rounded-xl text-sm font-black uppercase tracking-widest shadow-xl shadow-emerald-500/20 hover:bg-emerald-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                                    >\r\n                                        {uploading ? (\r\n                                            <>\r\n                                                <div className=\"h-4 w-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                                                Saving...\r\n                                            </>\r\n                                        ) : (\r\n                                            <>\r\n                                                <Save size={16} />\r\n                                                Confirm & Save ({uploadSummary?.new || 0} holidays)\r\n                                            </>\r\n                                        )}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\CandidateStatusTracker\\CandidateTimeline.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":59,"column":8,"nodeType":"ArrayExpression","endLine":59,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadData]","fix":{"range":[1928,1932],"text":"[id, loadData]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'getStatusIcon' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":73,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"getStatusIcon"},"fix":{"range":[2298,2914],"text":""},"desc":"Remove unused variable 'getStatusIcon'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport api from '../../../utils/api';\r\nimport {\r\n    ArrowLeft, Clock, User, MessageSquare, Calendar,\r\n    CheckCircle, PlusCircle, XCircle, PlayCircle,\r\n    MapPin, Phone, Mail, Award\r\n} from 'lucide-react';\r\nimport dayjs from 'dayjs';\r\n\r\nexport default function CandidateTimeline() {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const [candidate, setCandidate] = useState(null);\r\n    const [timeline, setTimeline] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Modal State for Status Update\r\n    const [showUpdateModal, setShowUpdateModal] = useState(false);\r\n    const [formData, setFormData] = useState({\r\n        status: '',\r\n        stage: 'HR',\r\n        remarks: '',\r\n        actionBy: 'HR Manager'\r\n    });\r\n\r\n    const loadData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // Fetch candidate directly by ID\r\n            const cRes = await api.get(`tracker/candidates/${id}`);\r\n            const found = cRes.data;\r\n            setCandidate(found);\r\n\r\n            // Get timeline\r\n            const tRes = await api.get(`tracker/candidates/${id}/timeline`);\r\n            setTimeline(tRes.data || []);\r\n\r\n            if (found) {\r\n                setFormData(prev => ({\r\n                    ...prev,\r\n                    status: found.currentStatus || '',\r\n                    stage: found.currentStage || 'HR'\r\n                }));\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n            // Don't alert if candidate is not found, handled by UI\r\n            if (err.response?.status !== 404) {\r\n                alert('Failed to load candidate data');\r\n            }\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [id]);\r\n\r\n    const handleUpdateStatus = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            await api.post(`tracker/candidates/${id}/status`, formData);\r\n            setShowUpdateModal(false);\r\n            loadData();\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert('Failed to update status');\r\n        }\r\n    };\r\n\r\n    const getStatusIcon = (status) => {\r\n        switch (status) {\r\n            case 'Applied': return <PlusCircle size={20} className=\"text-blue-500\" />;\r\n            case 'Shortlisted': return <Award size={20} className=\"text-yellow-500\" />;\r\n            case 'Interview Scheduled': return <PlayCircle size={20} className=\"text-purple-500\" />;\r\n            case 'Selected': return <CheckCircle size={20} className=\"text-emerald-500\" />;\r\n            case 'Rejected': return <XCircle size={20} className=\"text-rose-500\" />;\r\n            default: return <Clock size={20} className=\"text-slate-400\" />;\r\n        }\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className=\"flex items-center justify-center min-h-screen bg-slate-50\">\r\n            <div className=\"flex flex-col items-center gap-4\">\r\n                <div className=\"w-12 h-12 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin\"></div>\r\n                <p className=\"text-slate-500 font-medium animate-pulse\">Building Timeline...</p>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    if (!candidate) return (\r\n        <div className=\"p-12 text-center\">\r\n            <div className=\"text-slate-400 mb-4 font-bold text-xl uppercase\">404 - Not Found</div>\r\n            <button onClick={() => navigate('/hr/candidate-status')} className=\"text-blue-600 hover:underline\">Return to list</button>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50/50 pb-20\">\r\n            {/* Top Banner */}\r\n            <div className=\"bg-white border-b border-slate-200 sticky top-0 z-20\">\r\n                <div className=\"w-full mx-auto px-6 py-4 flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <button\r\n                            onClick={() => navigate('/hr/candidate-status')}\r\n                            className=\"p-2 hover:bg-slate-100 rounded-full transition text-slate-500\"\r\n                        >\r\n                            <ArrowLeft size={20} />\r\n                        </button>\r\n                        <div>\r\n                            <h2 className=\"text-xl font-bold text-slate-900\">{candidate.name}</h2>\r\n                            <p className=\"text-xs text-slate-500 font-medium uppercase tracking-wider\">{candidate.requirementTitle}</p>\r\n                        </div>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => setShowUpdateModal(true)}\r\n                        className=\"px-5 py-2.5 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition shadow-lg shadow-indigo-100 font-bold text-sm\"\r\n                    >\r\n                        Update Progress\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"w-full mx-auto px-6 mt-8 grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n\r\n                {/* Left: Candidate Info Card */}\r\n                <div className=\"lg:col-span-1 space-y-6\">\r\n                    <div className=\"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm overflow-hidden relative\">\r\n                        <div className=\"absolute top-0 right-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-8 -mt-8 opacity-50\"></div>\r\n\r\n                        <div className=\"w-20 h-20 rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center text-white text-3xl font-black mb-6 shadow-lg shadow-blue-200\">\r\n                            {candidate.name.charAt(0)}\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4 relative\">\r\n                            <div className=\"flex items-center gap-3 text-slate-600\">\r\n                                <Mail size={18} className=\"text-blue-500\" />\r\n                                <span className=\"text-sm font-medium truncate\">{candidate.email}</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-3 text-slate-600\">\r\n                                <Phone size={18} className=\"text-emerald-500\" />\r\n                                <span className=\"text-sm font-medium\">{candidate.phone}</span>\r\n                            </div>\r\n                            <div className=\"pt-6 border-t border-slate-100\">\r\n                                <div className=\"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3\">Current Status</div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"w-3 h-3 rounded-full bg-blue-500 animate-pulse\"></span>\r\n                                    <span className=\"font-bold text-slate-800\">{candidate.currentStatus}</span>\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3\">Target Role</div>\r\n                                <div className=\"flex items-center gap-2 font-medium text-slate-700\">\r\n                                    <MapPin size={16} className=\"text-slate-400\" />\r\n                                    {candidate.requirementTitle}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right: Vertical Timeline View */}\r\n                <div className=\"lg:col-span-2\">\r\n                    <div className=\"bg-white rounded-2xl border border-slate-200 p-8 shadow-sm\">\r\n                        <h3 className=\"text-lg font-bold text-slate-900 mb-8 flex items-center gap-2\">\r\n                            <Clock size={20} className=\"text-blue-500\" />\r\n                            Execution Timeline\r\n                        </h3>\r\n\r\n                        {timeline.length === 0 ? (\r\n                            <div className=\"py-20 text-center text-slate-400 italic bg-slate-50 rounded-xl border-2 border-dashed border-slate-100\">\r\n                                No timeline logs yet.\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"relative ml-4\">\r\n                                {/* Vertical Line */}\r\n                                <div className=\"absolute left-0 top-0 w-0.5 h-full bg-slate-100 -ml-[1px]\"></div>\r\n\r\n                                <div className=\"space-y-12\">\r\n                                    {(() => {\r\n                                        // Group logs by stage\r\n                                        const grouped = timeline.reduce((acc, log) => {\r\n                                            let stageKey = log.stage || 'Others';\r\n\r\n                                            // Fix for \"Shortlisted\" often mapping to Application/Other in old data\r\n                                            if (log.status === 'Shortlisted') stageKey = 'Interview';\r\n\r\n                                            // Normalize stage key for grouping\r\n                                            if (stageKey.toUpperCase().includes('INTERVIEW')) stageKey = 'Interview';\r\n                                            else if (stageKey.toUpperCase().includes('FINAL') || stageKey.toUpperCase().includes('SELECTED') || stageKey.toUpperCase().includes('OFFER') || stageKey.toUpperCase().includes('HIRED') || stageKey.toUpperCase().includes('REJECTED')) stageKey = 'Final';\r\n                                            else if (stageKey.toUpperCase().includes('APPLICATION') || stageKey.toUpperCase().includes('APPLIED')) stageKey = 'Application';\r\n\r\n                                            if (!acc[stageKey]) acc[stageKey] = [];\r\n                                            acc[stageKey].push(log);\r\n                                            return acc;\r\n                                        }, {});\r\n\r\n                                        // Define stage order explicitly\r\n                                        const stageOrder = ['Final', 'Interview', 'Application'];\r\n                                        const sortedStageKeys = Object.keys(grouped).sort((a, b) => {\r\n                                            const idxA = stageOrder.indexOf(a);\r\n                                            const idxB = stageOrder.indexOf(b);\r\n                                            // Keep unknown stages at the top/bottom depending on preference, logic below keeps newer unknown first\r\n                                            if (idxA === -1 && idxB === -1) return 0;\r\n                                            if (idxA === -1) return -1;\r\n                                            if (idxB === -1) return 1;\r\n                                            return idxA - idxB;\r\n                                        });\r\n\r\n                                        return sortedStageKeys.map((stageName, groupIndex) => {\r\n                                            const groupLogs = grouped[stageName];\r\n                                            // Sort logs within group by date desc\r\n                                            groupLogs.sort((a, b) => new Date(b.actionDate) - new Date(a.actionDate));\r\n\r\n                                            return (\r\n                                                <div key={stageName} className=\"relative pl-10\">\r\n                                                    {/* Stage Icon */}\r\n                                                    <div className=\"absolute left-0 top-0 -ml-[21px] p-2 bg-white rounded-full border-2 border-slate-100 shadow-sm z-10 transition-transform hover:scale-110\">\r\n                                                        {stageName === 'Interview' ? <MessageSquare size={20} className=\"text-purple-500\" /> :\r\n                                                            stageName === 'Final' ? <CheckCircle size={20} className=\"text-emerald-500\" /> :\r\n                                                                stageName === 'Application' ? <PlusCircle size={20} className=\"text-blue-500\" /> :\r\n                                                                    <Clock size={20} className=\"text-slate-400\" />\r\n                                                        }\r\n                                                    </div>\r\n\r\n                                                    <div className=\"bg-slate-50/50 hover:bg-slate-50 rounded-2xl p-5 border border-slate-100 transition duration-300\">\r\n                                                        {/* Stage Header */}\r\n                                                        <div className=\"flex items-center justify-between mb-6 border-b border-slate-200/60 pb-3\">\r\n                                                            <h4 className=\"text-sm font-black text-slate-800 uppercase tracking-widest flex items-center gap-2\">\r\n                                                                {stageName === 'Application' ? 'APPLICATION RECEIVED' :\r\n                                                                    stageName === 'Interview' ? 'INTERVIEW PROCESS' :\r\n                                                                        stageName === 'Final' ? 'FINAL DECISION' : stageName}\r\n                                                            </h4>\r\n                                                            <span className=\"text-[10px] font-bold text-slate-400 bg-white px-2 py-1 rounded border border-slate-100 uppercase\">\r\n                                                                {groupLogs.length} Update{groupLogs.length !== 1 ? 's' : ''}\r\n                                                            </span>\r\n                                                        </div>\r\n\r\n                                                        {/* Logs List */}\r\n                                                        <div className=\"space-y-6\">\r\n                                                            {groupLogs.map((log) => (\r\n                                                                <div key={log._id} className=\"relative pl-4 border-l-2 border-slate-200/60 transition hover:border-blue-300\">\r\n                                                                    <div className=\"absolute left-0 top-1.5 -ml-[5px] w-2 h-2 rounded-full bg-slate-300 ring-2 ring-white\"></div>\r\n\r\n                                                                    <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-1 mb-2\">\r\n                                                                        {(() => {\r\n                                                                            const s = log.status || '';\r\n                                                                            let colorClass = 'text-slate-600';\r\n                                                                            if (s === 'Shortlisted') colorClass = 'text-amber-600';\r\n                                                                            else if (s === 'Interview Scheduled') colorClass = 'text-purple-600';\r\n                                                                            else if (s === 'Selected') colorClass = 'text-emerald-600';\r\n                                                                            else if (s === 'Rejected') colorClass = 'text-rose-600';\r\n                                                                            else if (s === 'Applied') colorClass = 'text-blue-600';\r\n\r\n                                                                            return (\r\n                                                                                <span className={`text-xs font-bold ${colorClass}`}>\r\n                                                                                    {s}\r\n                                                                                </span>\r\n                                                                            );\r\n                                                                        })()}\r\n                                                                        <span className=\"text-[10px] font-medium text-slate-400 flex items-center gap-1\">\r\n                                                                            <Calendar size={10} />\r\n                                                                            {dayjs(log.actionDate).format('MMM DD, hh:mm A')}\r\n                                                                        </span>\r\n                                                                    </div>\r\n\r\n                                                                    <p className=\"text-xs text-slate-500 leading-relaxed italic bg-white p-2 rounded-lg border border-slate-100\">\r\n                                                                        \"{log.remarks || 'No remarks provided.'}\"\r\n                                                                    </p>\r\n                                                                    <div className=\"mt-1 text-[10px] font-semibold text-slate-400 pl-1\">\r\n                                                                        Action by <span className=\"text-slate-600\">{log.actionBy}</span>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            ))}\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    {/* Animated connector for the latest stage */}\r\n                                                    {groupIndex === 0 && <div className=\"absolute -left-[1px] top-0 w-0.5 h-10 bg-gradient-to-b from-blue-500 to-transparent\"></div>}\r\n                                                </div>\r\n                                            );\r\n                                        });\r\n                                    })()}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Update Status Modal */}\r\n            {showUpdateModal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in transition-all\">\r\n                    <div className=\"bg-white rounded-3xl w-full max-w-md shadow-2xl overflow-hidden animate-in zoom-in duration-300\">\r\n                        <div className=\"bg-gradient-to-r from-indigo-600 to-blue-600 p-6 flex justify-between items-center\">\r\n                            <h3 className=\"text-white font-bold text-lg\">Update Candidate Progress</h3>\r\n                            <button\r\n                                onClick={() => setShowUpdateModal(false)}\r\n                                className=\"text-white/80 hover:text-white transition\"\r\n                            >\r\n                                <ArrowLeft className=\"rotate-90\" size={24} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <form onSubmit={handleUpdateStatus} className=\"p-6 space-y-5\">\r\n                            <div>\r\n                                <label className=\"block text-xs font-black text-slate-400 uppercase tracking-widest mb-2\">Target Status</label>\r\n                                <select\r\n                                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition font-medium text-slate-700\"\r\n                                    value={formData.status}\r\n                                    onChange={(e) => setFormData({ ...formData, status: e.target.value })}\r\n                                    required\r\n                                >\r\n                                    <option value=\"Applied\">Applied</option>\r\n                                    <option value=\"Shortlisted\">Shortlisted</option>\r\n                                    <option value=\"Interview Scheduled\">Interview Scheduled</option>\r\n                                    <option value=\"Selected\">Selected</option>\r\n                                    <option value=\"Rejected\">Rejected</option>\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-xs font-black text-slate-400 uppercase tracking-widest mb-2\">Process Stage</label>\r\n                                <div className=\"grid grid-cols-3 gap-3\">\r\n                                    {['HR', 'Technical', 'Final'].map(s => (\r\n                                        <button\r\n                                            key={s}\r\n                                            type=\"button\"\r\n                                            onClick={() => setFormData({ ...formData, stage: s })}\r\n                                            className={`py-2 text-xs font-bold rounded-lg border transition ${formData.stage === s\r\n                                                ? 'bg-indigo-50 border-indigo-200 text-indigo-600'\r\n                                                : 'bg-white border-slate-100 text-slate-500 hover:border-slate-200'\r\n                                                }`}\r\n                                        >\r\n                                            {s}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-xs font-black text-slate-400 uppercase tracking-widest mb-2\">HR Remarks</label>\r\n                                <textarea\r\n                                    className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition font-medium text-slate-700 min-h-[100px]\"\r\n                                    placeholder=\"Describe the candidate's performance or action notes...\"\r\n                                    value={formData.remarks}\r\n                                    onChange={(e) => setFormData({ ...formData, remarks: e.target.value })}\r\n                                    required\r\n                                ></textarea>\r\n                            </div>\r\n\r\n                            <div className=\"pt-4 flex gap-3\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setShowUpdateModal(false)}\r\n                                    className=\"flex-1 px-4 py-3 text-slate-500 font-bold hover:bg-slate-50 rounded-xl transition border border-transparent\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    className=\"flex-1 px-4 py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition shadow-lg shadow-indigo-100\"\r\n                                >\r\n                                    Confirm Update\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\CandidateStatusTracker\\index.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token `}`. Did you mean `&rbrace;` or `{\"}\"}`?","line":277,"column":1}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api from '../../../utils/api';\r\nimport { Eye, Clock, User, Briefcase, Calendar, CheckCircle, XCircle, ChevronRight, RefreshCw, Database, Search, Filter } from 'lucide-react';\r\nimport dayjs from 'dayjs';\r\n\r\nexport default function CandidateStatusTracker() {\r\n    const navigate = useNavigate();\r\n    const [candidates, setCandidates] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    const loadCandidates = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await api.get('hr/candidate-status');\r\n            setCandidates(res.data || []);\r\n        } catch (err) {\r\n            console.error('[CANDIDATE_LOAD_ERR]', err);\r\n            // alert('Failed to load candidates');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const seedSampleData = async () => {\r\n        if (!confirm('This will seed sample candidates. Continue?')) return;\r\n        setLoading(true);\r\n        try {\r\n            await api.post('tracker/seed');\r\n            await loadCandidates();\r\n        } catch (err) {\r\n            console.error('[SEED_ERR]', err);\r\n            alert('Failed to seed sample data');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadCandidates();\r\n    }, []);\r\n\r\n    const getStatusBadge = (status) => {\r\n        const config = {\r\n            'Applied': { color: 'text-blue-600', bg: 'bg-blue-50', border: 'border-blue-100', icon: Clock },\r\n            'Shortlisted': { color: 'text-amber-600', bg: 'bg-amber-50', border: 'border-amber-100', icon: CheckCircle },\r\n            'Interview Scheduled': { color: 'text-purple-600', bg: 'bg-purple-50', border: 'border-purple-100', icon: Calendar },\r\n            'Selected': { color: 'text-emerald-600', bg: 'bg-emerald-50', border: 'border-emerald-100', icon: CheckCircle },\r\n            'Rejected': { color: 'text-rose-600', bg: 'bg-rose-50', border: 'border-rose-100', icon: XCircle },\r\n        };\r\n        const style = config[status] || { color: 'text-slate-600', bg: 'bg-slate-50', border: 'border-slate-100', icon: Clock };\r\n        const Icon = style.icon;\r\n\r\n        return (\r\n            <span className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[11px] font-bold uppercase tracking-wider border ${style.bg} ${style.color} ${style.border}`}>\r\n                <Icon size={12} strokeWidth={2.5} />\r\n                {status}\r\n            </span>\r\n        );\r\n    };\r\n\r\n    const getStageBadge = (stage) => {\r\n        // Map raw stages to display labels\r\n        let label = stage;\r\n        let styleKey = 'Default';\r\n\r\n        if (stage === 'Applied' || stage === 'New') {\r\n            label = 'APPLICATION STAGE';\r\n            styleKey = 'Application';\r\n        } else if (stage === 'Shortlisted' || stage === 'Interview Scheduled' || stage === 'HR' || stage === 'Technical') {\r\n            label = 'INTERVIEW STAGE';\r\n            styleKey = 'Interview';\r\n        } else if (stage === 'Selected' || stage === 'Offer Sent' || stage === 'Hired') {\r\n            label = 'FINAL STAGE';\r\n            styleKey = 'Final';\r\n        } else if (stage === 'Rejected') {\r\n            label = 'CLOSED';\r\n            styleKey = 'Closed';\r\n        }\r\n\r\n        const styles = {\r\n            'Application': 'text-blue-600 bg-blue-50 ring-blue-100',\r\n            'Interview': 'text-orange-600 bg-orange-50 ring-orange-100',\r\n            'Final': 'text-purple-600 bg-purple-50 ring-purple-100',\r\n            'Closed': 'text-slate-500 bg-slate-50 ring-slate-200',\r\n            'Default': 'text-slate-600 bg-slate-50 ring-slate-100'\r\n        };\r\n\r\n        return (\r\n            <span className={`px-3 py-1.5 rounded-md text-[10px] font-black uppercase tracking-widest ring-1 ring-inset whitespace-nowrap ${styles[styleKey]}`}>\r\n                {label}\r\n            </span>\r\n        );\r\n    };\r\n\r\n    const filteredCandidates = candidates.filter(c =>\r\n        c.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        c.requirementTitle.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className=\"p-6 space-y-6 w-full mx-auto\">\r\n        <div className=\"p-8 space-y-8 max-w-7xl mx-auto min-h-screen\">\r\n            {/* Header Section */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black text-slate-800 tracking-tight\">Candidate Status Tracker</h1>\r\n                    <p className=\"text-slate-500 mt-2 flex items-center gap-2 text-sm font-medium\">\r\n                        <span className=\"w-2 h-2 rounded-full bg-emerald-500 animate-pulse\"></span>\r\n                        Real-time applicant progression monitoring\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button\r\n                        onClick={seedSampleData}\r\n                        className=\"flex items-center gap-2 px-5 py-2.5 bg-white border border-slate-200 text-slate-600 rounded-xl hover:bg-slate-50 hover:border-slate-300 transition-all shadow-sm font-semibold text-sm\"\r\n                    >\r\n                        <Database size={18} className=\"text-slate-400\" />\r\n                        Seed Data\r\n                    </button>\r\n                    <button\r\n                        onClick={loadCandidates}\r\n                        className=\"flex items-center gap-2 px-5 py-2.5 bg-slate-900 text-white rounded-xl hover:bg-slate-800 transition-all shadow-lg hover:shadow-slate-200 font-semibold text-sm active:scale-95\"\r\n                    >\r\n                        <RefreshCw size={18} className={loading ? 'animate-spin' : ''} />\r\n                        Refresh List\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats Cards */}\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5\">\r\n                {[\r\n                    { label: 'Total Tracked', count: candidates.length, color: 'blue', icon: User, gradient: 'from-blue-500 to-indigo-600' },\r\n                    { label: 'In Interview', count: candidates.filter(c => c.currentStatus === 'Interview Scheduled').length, color: 'purple', icon: Calendar, gradient: 'from-purple-500 to-fuchsia-600' },\r\n                    { label: 'Selected Candidates', count: candidates.filter(c => c.currentStatus === 'Selected').length, color: 'emerald', icon: CheckCircle, gradient: 'from-emerald-500 to-teal-600' },\r\n                    { label: 'Rejected', count: candidates.filter(c => c.currentStatus === 'Rejected').length, color: 'rose', icon: XCircle, gradient: 'from-rose-500 to-pink-600' },\r\n                ].map((stat, i) => (\r\n                    <div key={i} className=\"relative overflow-hidden bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all group\">\r\n                        <div className={`absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity`}>\r\n                            <stat.icon size={64} className={`text-${stat.color}-600`} />\r\n                        </div>\r\n                        <div className=\"relative z-10\">\r\n                            <div className=\"text-[11px] font-bold text-slate-400 uppercase tracking-widest mb-2\">{stat.label}</div>\r\n                            <div className=\"flex items-end gap-2\">\r\n                                <div className={`text-4xl font-black text-slate-800`}>{stat.count}</div>\r\n                                {stat.count > 0 && <span className={`text-xs font-bold text-${stat.color}-600 mb-1`}>+{(stat.count / (candidates.length || 1) * 100).toFixed(0)}%</span>}\r\n                            </div>\r\n                        </div>\r\n                        <div className={`absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r ${stat.gradient}`}></div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Main Content Area */}\r\n            <div className=\"bg-white rounded-3xl border border-slate-200/60 shadow-xl shadow-slate-200/40 overflow-hidden\">\r\n                {/* Toolbar */}\r\n                <div className=\"p-5 border-b border-slate-100 bg-white flex flex-col md:flex-row gap-4 justify-between items-center sticky top-0 z-10\">\r\n                    <div className=\"relative w-full md:w-96 group\">\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search by candidate or job role...\"\r\n                            className=\"w-full pl-11 pr-4 py-3 rounded-xl border border-slate-200 bg-slate-50/50 focus:bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all text-sm font-medium group-hover:border-slate-300\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                        />\r\n                        <Search size={18} className=\"absolute left-4 top-3.5 text-slate-400 group-hover:text-blue-500 transition-colors\" />\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"px-3 py-1 rounded-lg bg-slate-50 text-xs font-semibold text-slate-500 border border-slate-100\">\r\n                            Total Records: <span className=\"text-slate-900\">{filteredCandidates.length}</span>\r\n                        </div>\r\n                        <button className=\"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors\">\r\n                            <Filter size={18} />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Table */}\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left border-collapse\">\r\n                        <thead>\r\n                            <tr className=\"bg-slate-50/80 border-b border-slate-100\">\r\n                                <th className=\"px-8 py-4 text-[11px] font-black text-slate-400 uppercase tracking-widest first:rounded-tl-2xl\">Candidate</th>\r\n                                <th className=\"px-6 py-4 text-[11px] font-black text-slate-400 uppercase tracking-widest\">Role Applied</th>\r\n                                <th className=\"px-6 py-4 text-[11px] font-black text-slate-400 uppercase tracking-widest\">Status</th>\r\n                                <th className=\"px-6 py-4 text-[11px] font-black text-slate-400 uppercase tracking-widest\">Stage</th>\r\n                                <th className=\"px-6 py-4 text-[11px] font-black text-slate-400 uppercase tracking-widest\">Applied On</th>\r\n                                <th className=\"px-6 py-4 text-[11px] font-black text-slate-400 uppercase tracking-widest text-center last:rounded-tr-2xl\">Timeline</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-100\">\r\n                            {loading && candidates.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan=\"6\" className=\"px-6 py-20 text-center\">\r\n                                        <div className=\"flex flex-col items-center gap-3\">\r\n                                            <div className=\"w-10 h-10 border-4 border-slate-100 border-t-blue-500 rounded-full animate-spin\"></div>\r\n                                            <p className=\"text-slate-400 font-medium text-sm\">Loading tracker data...</p>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ) : filteredCandidates.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan=\"6\" className=\"px-6 py-20 text-center\">\r\n                                        <div className=\"flex flex-col items-center gap-2\">\r\n                                            <div className=\"bg-slate-50 p-4 rounded-full mb-2\">\r\n                                                <User size={32} className=\"text-slate-300\" />\r\n                                            </div>\r\n                                            <p className=\"text-slate-800 font-bold\">No candidates found</p>\r\n                                            <p className=\"text-slate-500 text-sm\">Try adjusting your search filters.</p>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ) : (\r\n                                filteredCandidates.map((candidate, idx) => (\r\n                                    <tr key={candidate._id} className=\"group hover:bg-slate-50/80 transition-colors duration-200\">\r\n                                        <td className=\"px-8 py-5\">\r\n                                            <div className=\"flex items-center gap-4\">\r\n                                                <div className={`w-10 h-10 shrink-0 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-lg shadow-blue-100 ring-2 ring-white bg-gradient-to-br ${idx % 3 === 0 ? 'from-blue-500 to-indigo-600' :\r\n                                                    idx % 3 === 1 ? 'from-violet-500 to-purple-600' : 'from-emerald-500 to-teal-600'\r\n                                                    }`}>\r\n                                                    {candidate.name.charAt(0)}\r\n                                                </div>\r\n                                                <div className=\"min-w-0\">\r\n                                                    <div className=\"font-bold text-slate-800 text-sm group-hover:text-blue-600 transition-colors truncate max-w-[180px]\" title={candidate.name}>\r\n                                                        {candidate.name}\r\n                                                    </div>\r\n                                                    <div className=\"text-xs text-slate-500 mt-0.5 font-medium opacity-80 truncate max-w-[180px]\" title={candidate.email}>\r\n                                                        {candidate.email}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-5\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <div className=\"p-1.5 rounded-lg bg-slate-100 text-slate-500\">\r\n                                                    <Briefcase size={14} />\r\n                                                </div>\r\n                                                <span className=\"text-sm font-semibold text-slate-700\">{candidate.requirementTitle}</span>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-5\">\r\n                                            {getStatusBadge(candidate.currentStatus)}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-5\">\r\n                                            {getStageBadge(candidate.currentStage)}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-5\">\r\n                                            <div className=\"flex items-center gap-2 text-xs font-semibold text-slate-500 bg-slate-50 px-2 py-1 rounded w-fit\">\r\n                                                <Calendar size={12} />\r\n                                                {dayjs(candidate.createdAt).format('MMM DD, YYYY')}\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-5 text-center\">\r\n                                            <button\r\n                                                onClick={() => navigate(`/hr/candidate-status/${candidate._id}`)}\r\n                                                className=\"group/btn relative inline-flex items-center justify-center p-2 rounded-full text-slate-400 hover:text-blue-600 hover:bg-blue-50 transition-all active:scale-95\"\r\n                                            >\r\n                                                <span className=\"sr-only\">View Details</span>\r\n                                                <Eye size={20} className=\"group-hover/btn:scale-110 transition-transform\" />\r\n                                                <span className=\"absolute right-full mr-2 px-2 py-1 bg-slate-900 text-white text-[10px] font-bold rounded opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap pointer-events-none\">\r\n                                                    View Details\r\n                                                </span>\r\n                                            </button>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\CeoOrg.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\CreateRequirement.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Dashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\DepartmentHierarchy.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Departments.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\EmployeeForm.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'formatDateDDMMYYYY' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"formatDateDDMMYYYY"},"fix":{"range":[242,301],"text":""},"desc":"Remove unused variable 'formatDateDDMMYYYY'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'selectedTemplateDetails'. Either include it or remove the dependency array.","line":80,"column":6,"nodeType":"ArrayExpression","endLine":80,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [salaryTemplateId, selectedTemplateDetails]","fix":{"range":[5142,5160],"text":"[salaryTemplateId, selectedTemplateDetails]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPolicies'. Either include it or remove the dependency array.","line":211,"column":6,"nodeType":"ArrayExpression","endLine":211,"endColumn":78,"suggestions":[{"desc":"Update the dependencies array to be: [loadDepartments, loadManagers, loadEmployeeCodePreview, step, employee, loadPolicies]","fix":{"range":[10418,10490],"text":"[loadDepartments, loadManagers, loadEmployeeCodePreview, step, employee, loadPolicies]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';\r\nimport api from '../../utils/api';\r\nimport { notification, DatePicker } from 'antd';\r\nimport { IndianRupee } from 'lucide-react';\r\nimport dayjs from 'dayjs';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\n\r\nconst BACKEND_URL = import.meta.env.VITE_BACKEND_URL || 'https://hrms.gitakshmi.com';\r\nconst NATIONALITIES = ['Indian', 'American', 'British', 'Canadian', 'Australian', 'Other'];\r\n\r\nexport default function EmployeeForm({ employee, onClose, viewOnly = false }) {\r\n  const [step, setStep] = useState((employee?.status === 'Draft' ? employee?.lastStep : 1) || 1);\r\n\r\n  const [firstName, setFirstName] = useState(employee?.firstName || '');\r\n  const [middleName, setMiddleName] = useState(employee?.middleName || '');\r\n  const [lastName, setLastName] = useState(employee?.lastName || '');\r\n  const [gender, setGender] = useState(employee?.gender || '');\r\n  const [dob, setDob] = useState(employee?.dob ? new Date(employee.dob).toISOString().slice(0, 10) : '');\r\n  const [contactNo, setContactNo] = useState(employee?.contactNo || '');\r\n  const [email, setEmail] = useState(employee?.email || '');\r\n  const [password, setPassword] = useState('');\r\n  const [profilePic, setProfilePic] = useState(null);\r\n  const [profilePreview, setProfilePreview] = useState(employee?.profilePic || null);\r\n  const [maritalStatus, setMaritalStatus] = useState(employee?.maritalStatus || '');\r\n  const [bloodGroup, setBloodGroup] = useState(employee?.bloodGroup || '');\r\n  const [nationality, setNationality] = useState(employee?.nationality || '');\r\n  const [fatherName, setFatherName] = useState(employee?.fatherName || '');\r\n  const [motherName, setMotherName] = useState(employee?.motherName || '');\r\n  const [emergencyContactName, setEmergencyContactName] = useState(employee?.emergencyContactName || '');\r\n  const [emergencyContactNumber, setEmergencyContactNumber] = useState(employee?.emergencyContactNumber || '');\r\n\r\n  const [tempAddress, setTempAddress] = useState(employee?.tempAddress || { line1: '', line2: '', city: '', state: '', pinCode: '', country: '' });\r\n  const [permAddress, setPermAddress] = useState(employee?.permAddress || { line1: '', line2: '', city: '', state: '', pinCode: '', country: '' });\r\n  const [sameAsTemp, setSameAsTemp] = useState(false);\r\n\r\n  const [experience, setExperience] = useState(employee?.experience?.length ? employee.experience.map(e => ({\r\n    ...e,\r\n    payslips: e.payslips || (e.payslipUrl ? [e.payslipUrl] : [])\r\n  })) : []);\r\n  const [jobType, setJobType] = useState(employee?.jobType || 'Full-Time');\r\n\r\n  const [bankName, setBankName] = useState(employee?.bankDetails?.bankName || '');\r\n  const [accountNumber, setAccountNumber] = useState(employee?.bankDetails?.accountNumber || '');\r\n  const [ifsc, setIfsc] = useState(employee?.bankDetails?.ifsc || '');\r\n  const [branchName, setBranchName] = useState(employee?.bankDetails?.branchName || '');\r\n  const [bankLocation, setBankLocation] = useState(employee?.bankDetails?.location || '');\r\n  const [currentBankProof, setCurrentBankProof] = useState(employee?.bankDetails?.bankProofUrl || null);\r\n\r\n  const [role, setRole] = useState(employee?.role || 'Employee');\r\n  const [department, setDepartment] = useState(employee?.department || '');\r\n  const [departmentId, setDepartmentId] = useState(employee?.departmentId?._id || employee?.departmentId || '');\r\n  const [manager, setManager] = useState(employee?.manager?._id || employee?.manager || '');\r\n  const [joiningDate, setJoiningDate] = useState(employee?.joiningDate ? new Date(employee.joiningDate).toISOString().split('T')[0] : '');\r\n  const [departments, setDepartments] = useState([]);\r\n  const [managers, setManagers] = useState([]);\r\n  const [_departmentHead, _setDepartmentHead] = useState(employee?.departmentHead || false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [errors, setErrors] = useState({});\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [pincodeLoading, setPincodeLoading] = useState(false);\r\n  const [ifscLoading, setIfscLoading] = useState(false);\r\n\r\n  // Payroll / Compensation State (Step 8)\r\n  const [salaryTemplateId, setSalaryTemplateId] = useState(employee?.salaryTemplateId?._id || employee?.salaryTemplateId || '');\r\n  const [salaryEffectiveDate, setSalaryEffectiveDate] = useState(dayjs().format('YYYY-MM-DD'));\r\n  const [salaryStatus, setSalaryStatus] = useState('Active');\r\n  const [salaryTemplates, setSalaryTemplates] = useState([]);\r\n  const [selectedTemplateDetails, setSelectedTemplateDetails] = useState(null);\r\n\r\n  const loadSalaryTemplates = useCallback(async () => {\r\n    try {\r\n      const res = await api.get('/payroll/salary-templates');\r\n      setSalaryTemplates(res.data?.data || []);\r\n      // Pre-select if existing\r\n      if (salaryTemplateId && !selectedTemplateDetails) {\r\n        const found = (res.data?.data || []).find(t => t._id === salaryTemplateId);\r\n        if (found) setSelectedTemplateDetails(found);\r\n      }\r\n    } catch (err) { console.error(\"Failed to load salary templates\", err); }\r\n  }, [salaryTemplateId]);\r\n\r\n  useEffect(() => {\r\n    if (step === 8) loadSalaryTemplates();\r\n  }, [step, loadSalaryTemplates]);\r\n\r\n  const handleTemplateChange = (e) => {\r\n    const tid = e.target.value;\r\n    setSalaryTemplateId(tid);\r\n    const found = salaryTemplates.find(t => t._id === tid);\r\n    setSelectedTemplateDetails(found || null);\r\n  };\r\n\r\n  const saveSalaryAssignment = async () => {\r\n    if (!salaryTemplateId) { notification.error({ message: 'Validation Error', description: \"Please select a Salary Template\", placement: 'topRight' }); return; }\r\n    if (!employee?._id) { notification.error({ message: 'Validation Error', description: \"Please save employee draft first\", placement: 'topRight' }); return; }\r\n\r\n    setSaving(true);\r\n    try {\r\n      await api.post(`/hr/employees/${employee._id}/salary-assignment`, {\r\n        salaryTemplateId,\r\n        effectiveFrom: salaryEffectiveDate,\r\n        status: salaryStatus\r\n      });\r\n      notification.success({ message: 'Success', description: \"Salary assigned successfully!\", placement: 'topRight' });\r\n    } catch (err) {\r\n      console.error(err);\r\n      notification.error({ message: 'Error', description: err.response?.data?.message || \"Failed to assign salary\", placement: 'topRight' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  // Leave Policy\r\n  const [leavePolicy, setLeavePolicy] = useState(employee?.leavePolicy || '');\r\n  const [policies, setPolicies] = useState([]);\r\n\r\n  const loadPolicies = useCallback(async () => {\r\n    try {\r\n      const res = await api.get('/hr/leave-policies');\r\n      setPolicies(res.data || []);\r\n    } catch (err) { console.error(\"Failed to load policies\", err); }\r\n  }, []);\r\n\r\n\r\n  // Education State\r\n  const [eduType, setEduType] = useState(employee?.education?.type || 'Diploma');\r\n  const [class10Marksheet, setClass10Marksheet] = useState(employee?.education?.class10Marksheet || null);\r\n  const [class12Marksheet, setClass12Marksheet] = useState(employee?.education?.class12Marksheet || null);\r\n  const [diplomaCertificate, setDiplomaCertificate] = useState(employee?.education?.diplomaCertificate || null);\r\n  const [bachelorDegree, setBachelorDegree] = useState(employee?.education?.bachelorDegree || null);\r\n  const [masterDegree, setMasterDegree] = useState(employee?.education?.masterDegree || null);\r\n\r\n  // Alternative: Last 3 Sem Marksheets\r\n  const [lastSem1, setLastSem1] = useState(employee?.education?.lastSem1Marksheet || null);\r\n  const [lastSem2, setLastSem2] = useState(employee?.education?.lastSem2Marksheet || null);\r\n  const [lastSem3, setLastSem3] = useState(employee?.education?.lastSem3Marksheet || null);\r\n\r\n  // Step 6: Identity Documents\r\n  // Step 6: Identity Documents\r\n  const [aadharFront, setAadharFront] = useState(employee?.documents?.aadharFront || null);\r\n  const [aadharBack, setAadharBack] = useState(employee?.documents?.aadharBack || null);\r\n  const [panCard, setPanCard] = useState(employee?.documents?.panCard || null);\r\n\r\n  const bankProofRef = useRef(null);\r\n  const c10Ref = useRef(null);\r\n  const c12Ref = useRef(null);\r\n  const diplomaRef = useRef(null);\r\n  const bachelorRef = useRef(null);\r\n  const masterRef = useRef(null);\r\n  const ls1Ref = useRef(null);\r\n  const ls2Ref = useRef(null);\r\n  const ls3Ref = useRef(null);\r\n  const aadharFrontRef = useRef(null);\r\n  const aadharBackRef = useRef(null);\r\n  const panRef = useRef(null);\r\n  const profilePicRef = useRef(null);\r\n  const ignoreAutoFill = useRef(false);\r\n\r\n\r\n  // Fetch departments for dropdown\r\n  const loadDepartments = useCallback(async () => {\r\n    try {\r\n      const res = await api.get('/hr/departments');\r\n      const deptList = Array.isArray(res.data) ? res.data : [];\r\n      setDepartments(deptList);\r\n    } catch (err) {\r\n      console.error('Failed to load departments', err);\r\n      setDepartments([]);\r\n    }\r\n  }, []);\r\n\r\n  // Fetch employees for manager dropdown\r\n  const loadManagers = useCallback(async () => {\r\n    try {\r\n      const res = await api.get('/hr/employees');\r\n      const empList = Array.isArray(res.data?.data) ? res.data.data : (Array.isArray(res.data) ? res.data : []);\r\n      setManagers(empList.filter(e => !employee || e._id !== employee._id)); // Exclude self\r\n    } catch (err) {\r\n      console.error('Failed to load managers', err);\r\n      setManagers([]);\r\n    }\r\n  }, [employee]);\r\n\r\n  // Step 7: Fetch Employee Code Preview\r\n  const loadEmployeeCodePreview = useCallback(async () => {\r\n    if (step !== 7) return;\r\n    try {\r\n      const payload = {\r\n        firstName: firstName,\r\n        lastName: lastName,\r\n        department: department || 'GEN'\r\n      };\r\n      console.log('Fetching preview with:', payload);\r\n      const res = await api.post('/hr/employees/preview', payload);\r\n      if (res.data && res.data.preview) {\r\n        setEmployeeCode(res.data.preview);\r\n      } else {\r\n        setEmployeeCode('Error: No ID returned');\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load employee code preview', err);\r\n      setEmployeeCode('Error: Failed to generate');\r\n    }\r\n  }, [step, firstName, lastName, department]);\r\n\r\n  useEffect(() => {\r\n    loadDepartments();\r\n    loadManagers();\r\n    loadPolicies();\r\n    if (step === 7 && !employee) loadEmployeeCodePreview();\r\n  }, [loadDepartments, loadManagers, loadEmployeeCodePreview, step, employee]);\r\n\r\n  const [employeeCode, setEmployeeCode] = useState('');\r\n\r\n  const phoneRe = /^\\d{10,15}$/;\r\n  const pinRe = useMemo(() => /^\\d{5,10}$/, []);\r\n  const ifscRe = useMemo(() => /^[A-Z]{4}0[0-9A-Z]{6}$/, []);\r\n\r\n  const handlePincodeLookup = useCallback(async (pin, target = 'temp') => {\r\n    try {\r\n      if (!pin || !pinRe.test(pin)) return;\r\n      setPincodeLoading(true);\r\n      const key = 'pincode_cache';\r\n      let cache = {};\r\n      try { cache = JSON.parse(sessionStorage.getItem(key) || '{}') || {}; } catch { cache = {}; }\r\n      const isOnline = typeof navigator !== 'undefined' ? navigator.onLine : true;\r\n      if (!isOnline) {\r\n        const c = cache[pin];\r\n        if (c) {\r\n          if (target === 'temp') setTempAddress(p => {\r\n            const next = { ...p, city: c.city || p.city, state: c.stateVal || p.state, country: c.countryVal || p.country };\r\n            return (next.city === p.city && next.state === p.state && next.country === p.country) ? p : next;\r\n          });\r\n          else setPermAddress(p => {\r\n            const next = { ...p, city: c.city || p.city, state: c.stateVal || p.state, country: c.countryVal || p.country };\r\n            return (next.city === p.city && next.state === p.state && next.country === p.country) ? p : next;\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      const res = await fetch(`https://api.postalpincode.in/pincode/${encodeURIComponent(pin)}`);\r\n      let city = '', stateVal = '', countryVal = '';\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        const entry = Array.isArray(data) ? data[0] : null;\r\n        const po = entry && Array.isArray(entry.PostOffice) ? entry.PostOffice[0] : null;\r\n        city = (po && (po.District || po.Name)) || '';\r\n        stateVal = (po && po.State) || '';\r\n        countryVal = (po && po.Country) || '';\r\n      }\r\n      if (city || stateVal || countryVal) {\r\n        if (ignoreAutoFill.current) return; // Prevent overwriting city if triggered by city lookup\r\n\r\n        const v = { city, stateVal, countryVal, ts: Date.now() };\r\n        cache[pin] = v;\r\n        try { sessionStorage.setItem(key, JSON.stringify(cache)); } catch { /* ignore sessionStorage errors */ }\r\n        if (target === 'temp') setTempAddress(p => {\r\n          const next = { ...p, city: city || p.city, state: stateVal || p.state, country: countryVal || p.country };\r\n          return (next.city === p.city && next.state === p.state && next.country === p.country) ? p : next;\r\n        });\r\n        else setPermAddress(p => {\r\n          const next = { ...p, city: city || p.city, state: stateVal || p.state, country: countryVal || p.country };\r\n          return (next.city === p.city && next.state === p.state && next.country === p.country) ? p : next;\r\n        });\r\n      }\r\n    } finally {\r\n      setPincodeLoading(false);\r\n    }\r\n  }, [pinRe]);\r\n\r\n  const handleIfscLookup = useCallback(async (code) => {\r\n    try {\r\n      if (!code || !ifscRe.test(code)) return;\r\n      setIfscLoading(true);\r\n      const key = 'ifsc_cache';\r\n      let cache = {};\r\n      try { cache = JSON.parse(sessionStorage.getItem(key) || '{}') || {}; } catch { cache = {}; }\r\n      const isOnline = typeof navigator !== 'undefined' ? navigator.onLine : true;\r\n      if (!isOnline) {\r\n        const c = cache[code];\r\n        if (c) {\r\n          setBankName(prev => c.BANK || prev);\r\n          setBranchName(prev => c.BRANCH || prev);\r\n        }\r\n        return;\r\n      }\r\n      const res = await fetch(`https://ifsc.razorpay.com/${encodeURIComponent(code)}`);\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setBankName(prev => data.BANK || prev);\r\n        setBranchName(prev => data.BRANCH || prev);\r\n        setBankLocation(prev => data.CITY || data.DISTRICT || prev); // Auto-populate location\r\n        const v = { ...data, ts: Date.now() };\r\n        cache[code] = v;\r\n        try { sessionStorage.setItem(key, JSON.stringify(cache)); } catch { /* ignore sessionStorage errors */ }\r\n      }\r\n    } finally {\r\n      setIfscLoading(false);\r\n    }\r\n  }, [ifscRe]);\r\n\r\n  const handleCityLookup = useCallback(async (city, target = 'temp') => {\r\n    try {\r\n      if (!city || city.length < 3) { setPincodeLoading(false); return; }\r\n\r\n      const isOnline = typeof navigator !== 'undefined' ? navigator.onLine : true;\r\n      if (!isOnline) { setPincodeLoading(false); return; }\r\n\r\n      const res = await fetch(`https://api.postalpincode.in/postoffice/${encodeURIComponent(city)}`);\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        const entry = Array.isArray(data) ? data[0] : null;\r\n        if (entry && entry.Status === 'Success' && Array.isArray(entry.PostOffice) && entry.PostOffice.length > 0) {\r\n          const list = entry.PostOffice;\r\n          const inputCity = city.trim().toLowerCase();\r\n\r\n          // Priority 1: Exact Match on District\r\n          let po = list.find(item => item.District && item.District.toLowerCase() === inputCity);\r\n\r\n          // Priority 2: Exact Match on Region\r\n          if (!po) po = list.find(item => item.Region && item.Region.toLowerCase() === inputCity);\r\n\r\n          // Priority 3: Fuzzy Match on Name (Starts with input + space, or exact)\r\n          // e.g. Input \"Dhari\" matches \"Dhari S.O\"\r\n          if (!po) {\r\n            const nameRegex = new RegExp(`^${inputCity}( |$|\\\\.)`, 'i');\r\n            const nameMatches = list.filter(item => item.Name && nameRegex.test(item.Name));\r\n\r\n            if (nameMatches.length > 0) {\r\n              // Sort by State (A-Z) -> Gujarat comes before Uttarakhand\r\n              nameMatches.sort((a, b) => (a.State || '').localeCompare(b.State || ''));\r\n              po = nameMatches[0];\r\n            }\r\n          }\r\n\r\n          // Fallback: Just take the first one if we can't find a direct match\r\n          if (!po) po = list[0];\r\n\r\n          const stateVal = po.State || '';\r\n          const countryVal = po.Country || 'India';\r\n          const pinVal = po.Pincode || '';\r\n\r\n          if (target === 'temp') {\r\n            ignoreAutoFill.current = true;\r\n            setTempAddress(p => ({ ...p, state: stateVal || p.state, country: countryVal || p.country, pinCode: pinVal }));\r\n            setTimeout(() => { ignoreAutoFill.current = false; }, 2000);\r\n          } else {\r\n            ignoreAutoFill.current = true;\r\n            setPermAddress(p => ({ ...p, state: stateVal || p.state, country: countryVal || p.country, pinCode: pinVal }));\r\n            setTimeout(() => { ignoreAutoFill.current = false; }, 2000);\r\n          }\r\n        } else {\r\n          // Fallback to Global Search (Nominatim)\r\n          throw new Error(\"No Indian match found\");\r\n        }\r\n\r\n      } else {\r\n        throw new Error(\"Indian API Failed\");\r\n      }\r\n    } catch (e) {\r\n      console.log(\"Indian API missed, trying global...\", e);\r\n\r\n      // Clear stale data immediately to prevent wrong info persistence\r\n      if (target === 'temp') setTempAddress(p => ({ ...p, state: '', country: '', pinCode: '' }));\r\n      else setPermAddress(p => ({ ...p, state: '', country: '', pinCode: '' }));\r\n\r\n      try {\r\n        const globalRes = await fetch(`https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(city)}&format=json&addressdetails=1&limit=1`, {\r\n          headers: { 'Accept-Language': 'en' } // Prefer English results\r\n        });\r\n        if (globalRes.ok) {\r\n          const gData = await globalRes.json();\r\n          const gEntry = Array.isArray(gData) ? gData[0] : null;\r\n          if (gEntry && gEntry.address) {\r\n            const stateVal = gEntry.address.state || gEntry.address.county || '';\r\n            const countryVal = gEntry.address.country || '';\r\n            const pinVal = gEntry.address.postcode || '';\r\n\r\n            if (target === 'temp') {\r\n              ignoreAutoFill.current = true;\r\n              setTempAddress(p => ({ ...p, state: stateVal || p.state, country: countryVal || p.country, pinCode: pinVal }));\r\n              setTimeout(() => { ignoreAutoFill.current = false; }, 2000);\r\n            } else {\r\n              ignoreAutoFill.current = true;\r\n              setPermAddress(p => ({ ...p, state: stateVal || p.state, country: countryVal || p.country, pinCode: pinVal }));\r\n              setTimeout(() => { ignoreAutoFill.current = false; }, 2000);\r\n            }\r\n          }\r\n        }\r\n      } catch (err2) {\r\n        console.error(\"Global lookup failed\", err2);\r\n      }\r\n    } finally {\r\n      setPincodeLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Debounced Effect for City Lookup - Temp Address\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      if (tempAddress.city && tempAddress.city.length > 2) handleCityLookup(tempAddress.city, 'temp');\r\n    }, 800);\r\n    return () => clearTimeout(timer);\r\n  }, [tempAddress.city, handleCityLookup]);\r\n\r\n  // Debounced Effect for City Lookup - Perm Address\r\n  useEffect(() => {\r\n    if (sameAsTemp) return;\r\n    const timer = setTimeout(() => {\r\n      if (permAddress.city && permAddress.city.length > 2) handleCityLookup(permAddress.city, 'perm');\r\n    }, 800);\r\n    return () => clearTimeout(timer);\r\n  }, [permAddress.city, sameAsTemp, handleCityLookup]);\r\n\r\n  // ... (renderFilePreview and validateStep unchanged)\r\n\r\n  // ...\r\n\r\n  // Helper to render file preview\r\n  const renderFilePreview = (fileOrUrl, altText) => {\r\n    if (!fileOrUrl) return null;\r\n    const isFile = fileOrUrl instanceof File;\r\n    const isPdf = isFile ? (fileOrUrl.type === 'application/pdf') : fileOrUrl.toLowerCase().endsWith('.pdf');\r\n\r\n    if (isPdf) {\r\n      return <div className=\"text-red-500 font-bold text-xs p-2 text-center border rounded bg-slate-50\">PDF Document</div>;\r\n    }\r\n\r\n    let src = '';\r\n    if (isFile) {\r\n      src = URL.createObjectURL(fileOrUrl);\r\n    } else {\r\n      if (fileOrUrl.startsWith('http')) {\r\n        src = fileOrUrl;\r\n      } else {\r\n        // Normalize URL: remove /api from end if present (for static files), remove trailing slash\r\n        const backendUrl = BACKEND_URL || '';\r\n        const baseUrl = backendUrl.replace(/\\/api\\/?$/, '').replace(/\\/$/, '');\r\n        const cleanPath = (fileOrUrl || '').replace(/\\\\/g, '/');\r\n        const path = cleanPath.startsWith('/') ? cleanPath : `/${cleanPath}`;\r\n        src = `${baseUrl}${path}`;\r\n      }\r\n    }\r\n\r\n    return <img src={src} alt={altText} className=\"w-full h-full object-contain\" />;\r\n  };\r\n\r\n  const validateStep = (stepNum) => {\r\n    const e = {};\r\n    if (stepNum === 1) {\r\n      if (!firstName || firstName.length < 3 || !/^[A-Za-z]+$/.test(firstName)) e.firstName = 'First name required (min 3 chars, letters only)';\r\n      if (!middleName || middleName.length < 3) e.middleName = 'Middle name is required (min 3 chars)';\r\n      if (!lastName || lastName.length < 3) e.lastName = 'Last name is required (min 3 chars)';\r\n      if (!gender) e.gender = 'Gender is required';\r\n      // Department and Manager are optional now\r\n      if (!joiningDate) e.joiningDate = 'Joining Date is required';\r\n      if (!dob) e.dob = 'Date of birth required';\r\n      else {\r\n        const birth = new Date(dob); const age = Math.floor((Date.now() - birth.getTime()) / (1000 * 60 * 60 * 24 * 365.25));\r\n        if (age < 18) e.dob = 'Employee must be at least 18 years old';\r\n      }\r\n      if (!contactNo || !phoneRe.test(contactNo)) e.contactNo = 'Phone must be 10-15 digits';\r\n      // Email and Password validation removed\r\n\r\n      if (!maritalStatus) e.maritalStatus = 'Marital Status is required';\r\n\r\n      const validBloodGroups = ['A+', 'A-', 'B+', 'B-', 'O+', 'O-', 'AB+', 'AB-'];\r\n      if (!bloodGroup) e.bloodGroup = 'Blood Group is required';\r\n      else if (!validBloodGroups.includes(bloodGroup.toUpperCase())) e.bloodGroup = 'Invalid Blood Group (Allowed: A+, A-, B+, B-, O+, O-, AB+, AB-)';\r\n\r\n      if (!nationality) e.nationality = 'Nationality is required';\r\n\r\n      // Father/Mother remain optional, but validate if entered\r\n      if (fatherName && fatherName.length < 3) e.fatherName = 'Father name must be at least 3 chars';\r\n      if (motherName && motherName.length < 3) e.motherName = 'Mother name must be at least 3 chars';\r\n\r\n      if (!emergencyContactName || emergencyContactName.length < 3) e.emergencyContactName = 'Emergency contact name required (min 3 chars)';\r\n      if (!emergencyContactNumber || !phoneRe.test(emergencyContactNumber)) e.emergencyContactNumber = 'Emergency contact number invalid';\r\n    }\r\n\r\n    if (stepNum === 2) {\r\n      if (!tempAddress.line1) e.tempLine1 = 'Temporary address line1 required';\r\n      if (!tempAddress.city) e.tempCity = 'Temporary city required';\r\n      if (!tempAddress.state) e.tempState = 'Temporary state required';\r\n      if (!tempAddress.pinCode || !pinRe.test(tempAddress.pinCode)) e.tempPin = 'Temporary pin code invalid';\r\n      if (!tempAddress.country) e.tempCountry = 'Temporary country required';\r\n      if (!sameAsTemp) {\r\n        if (!permAddress.line1) e.permLine1 = 'Permanent address line1 required';\r\n        if (!permAddress.city) e.permCity = 'Permanent city required';\r\n        if (!permAddress.state) e.permState = 'Permanent state required';\r\n        if (!permAddress.pinCode || !pinRe.test(permAddress.pinCode)) e.permPin = 'Permanent pin code invalid';\r\n        if (!permAddress.country) e.permCountry = 'Permanent country required';\r\n      }\r\n    }\r\n\r\n    if (stepNum === 3) {\r\n      experience.forEach((exp, idx) => {\r\n        if (exp.from && exp.to) {\r\n          const f = new Date(exp.from); const t = new Date(exp.to);\r\n          if (f > t) e[`exp_${idx}`] = 'From date must be before To date';\r\n        }\r\n        // Mandatory fields check\r\n        if (!exp.companyName) e[`exp_${idx}`] = 'Company Name is required';\r\n        if (!exp.reportingPersonName) e[`exp_${idx}`] = 'Reporting Person Name is required';\r\n        if (!exp.reportingPersonEmail) e[`exp_${idx}`] = 'Reporting Person Email is required';\r\n        if (!exp.payslips || exp.payslips.filter(Boolean).length !== 3) e[`exp_${idx}`] = 'Exactly 3 payslips are required';\r\n      });\r\n    }\r\n\r\n    if (stepNum === 4) {\r\n      if (!employee) {\r\n        if (!bankName) e.bankName = 'Bank name required';\r\n        if (!accountNumber || !/^[0-9]{9,18}$/.test(accountNumber)) e.accountNumber = 'Account Number must be 9-18 digits';\r\n        if (!ifsc || !ifscRe.test(ifsc)) e.ifsc = 'IFSC invalid';\r\n        if (!branchName) e.branchName = 'Branch name required';\r\n        // Bank Proof Mandatory Validation\r\n        if (!currentBankProof) e.bankProof = 'Bank Proof (Cheque/Passbook Photo) is required';\r\n      }\r\n    }\r\n\r\n    if (stepNum === 5) {\r\n      if (!eduType) { e.eduType = 'Education Type is required'; return false; }\r\n\r\n      // Common Rule: 10th Marksheet is always required\r\n      if (!class10Marksheet) e.class10 = '10th Marksheet is required';\r\n\r\n      if (eduType === 'Diploma') {\r\n        // Diploma: Require Diploma Certificate OR (Last 3 Sem Marksheets)\r\n        const hasDegree = !!diplomaCertificate;\r\n        const hasAlt = lastSem1 && lastSem2 && lastSem3;\r\n        if (!hasDegree && !hasAlt) {\r\n          e.diploma = 'Diploma Certificate OR Last 3 Sem Marksheets required';\r\n        }\r\n      } else if (eduType === 'Bachelor') {\r\n        if (!class12Marksheet) e.class12 = '12th Marksheet is required';\r\n        // Bachelor: Require Bachelor Degree OR (Last 3 Sem Marksheets)\r\n        const hasDegree = !!bachelorDegree;\r\n        const hasAlt = lastSem1 && lastSem2 && lastSem3;\r\n        if (!hasDegree && !hasAlt) {\r\n          e.bachelor = 'Bachelor Degree OR Last 3 Sem Marksheets required';\r\n        }\r\n      }\r\n    }\r\n\r\n    if (stepNum === 6) {\r\n      // Identity Documents validation\r\n      if (!aadharFront && !employee?.documents?.aadharFront) e.aadharFront = 'Aadhar Front is required';\r\n      if (!aadharBack && !employee?.documents?.aadharBack) e.aadharBack = 'Aadhar Back is required';\r\n      if (!panCard && !employee?.documents?.panCard) e.panCard = 'PAN Card is required';\r\n    }\r\n\r\n    if (stepNum === 7) {\r\n      // Step 7: Account Credentials\r\n      // Employee Code is read-only\r\n      if (!email || !/\\S+@\\S+\\.\\S+/.test(email)) e.email = 'Valid Email is required';\r\n\r\n      // Password is now mandatory for both New/Draft AND Edit modes\r\n      if (!password && !employee?._id) { // Only mandatory if new? Actually old code said \"password || employee ? .. : valid\"\r\n        // Re-reading logic: new employee needs password. Edit doesn't unless changing.\r\n        if (password && password.length < 6) e.password = 'Password min 6 chars';\r\n        if (!employee && !password) e.password = 'Password is required';\r\n      }\r\n    }\r\n\r\n    if (stepNum === 8) {\r\n      if (!salaryTemplateId) e.salaryTemplate = \"Salary Template is required\";\r\n      if (!salaryEffectiveDate) e.effectiveDate = \"Effective Date is required\";\r\n      if (joiningDate && salaryEffectiveDate < joiningDate) e.effectiveDate = \"Cannot be before Joining Date\";\r\n    }\r\n\r\n    setErrors(e);\r\n    return Object.keys(e).length === 0;\r\n  };\r\n\r\n  const handleNext = () => {\r\n    if (validateStep(step)) setStep(step + 1);\r\n  };\r\n\r\n\r\n  const handlePrev = () => {\r\n    setStep(step - 1);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (sameAsTemp) setPermAddress({ ...tempAddress });\r\n  }, [sameAsTemp, tempAddress]);\r\n\r\n  useEffect(() => {\r\n    const t = setTimeout(() => {\r\n      const pin = tempAddress.pinCode;\r\n      if (pin && pinRe.test(pin)) handlePincodeLookup(pin, 'temp');\r\n    }, 500);\r\n    return () => clearTimeout(t);\r\n  }, [tempAddress.pinCode, handlePincodeLookup, pinRe]);\r\n\r\n  useEffect(() => {\r\n    const t = setTimeout(() => {\r\n      const pin = permAddress.pinCode;\r\n      if (pin && pinRe.test(pin) && !sameAsTemp) handlePincodeLookup(pin, 'perm');\r\n    }, 500);\r\n    return () => clearTimeout(t);\r\n  }, [permAddress.pinCode, sameAsTemp, handlePincodeLookup, pinRe]);\r\n\r\n  useEffect(() => {\r\n    const t = setTimeout(() => {\r\n      if (ifsc && ifscRe.test(ifsc)) handleIfscLookup(ifsc);\r\n    }, 500);\r\n    return () => clearTimeout(t);\r\n  }, [ifsc, handleIfscLookup, ifscRe]);\r\n\r\n  async function submit(e) {\r\n    e.preventDefault();\r\n    if (!validateStep(7)) return;\r\n    setSaving(true);\r\n    try {\r\n      // Upload Current Bank Proof if changed\r\n      let currentBankProofUrl = employee?.bankDetails?.bankProofUrl;\r\n      if (currentBankProof && currentBankProof instanceof File) {\r\n        try {\r\n          const fd = new FormData();\r\n          fd.append('file', currentBankProof);\r\n          const up = await api.post('/uploads/doc', fd);\r\n          if (up?.data?.success) currentBankProofUrl = up.data.url;\r\n        } catch (e) { console.warn('Bank proof upload failed', e) }\r\n      } else if (currentBankProof) {\r\n        currentBankProofUrl = currentBankProof; // string\r\n      } else {\r\n        currentBankProofUrl = ''; // removed\r\n      }\r\n      /* Profile Pic removed\r\n      let profilePicUrl = employee?.profilePic || undefined;\r\n      if (profilePic && profilePic instanceof File) { ... } \r\n      */\r\n\r\n      // Process experience file uploads\r\n      let processedExperience = [];\r\n      if (experience && experience.length > 0) {\r\n        processedExperience = await Promise.all(experience.map(async (exp) => {\r\n          let pSlips = [];\r\n          if (exp.payslips && exp.payslips.length > 0) {\r\n            for (const item of exp.payslips) {\r\n              if (item instanceof File) {\r\n                const fd = new FormData();\r\n                fd.append('file', item);\r\n                try {\r\n                  const up = await api.post('/uploads/doc', fd);\r\n                  if (up?.data?.success) pSlips.push(up.data.url);\r\n                } catch (e) { console.warn('Payslip upload failed', e); }\r\n              } else if (typeof item === 'string') { pSlips.push(item); }\r\n            }\r\n          }\r\n          return { ...exp, payslips: pSlips };\r\n        }));\r\n      }\r\n\r\n      // Education File Uploads\r\n      let c10Url = employee?.education?.class10Marksheet;\r\n      let c12Url = employee?.education?.class12Marksheet;\r\n      let diplomaUrl = employee?.education?.diplomaCertificate;\r\n      let bachelorUrl = employee?.education?.bachelorDegree;\r\n      let masterUrl = employee?.education?.masterDegree;\r\n      let ls1Url = employee?.education?.lastSem1Marksheet;\r\n      let ls2Url = employee?.education?.lastSem2Marksheet;\r\n      let ls3Url = employee?.education?.lastSem3Marksheet;\r\n\r\n      const uploadFile = async (file) => {\r\n        if (!file || !(file instanceof File)) return null;\r\n        const fd = new FormData();\r\n        fd.append('file', file);\r\n        try {\r\n          const res = await api.post('/uploads/doc', fd);\r\n          return res?.data?.success ? res.data.url : null;\r\n        } catch (e) {\r\n          console.warn('File upload failed', e);\r\n          return null;\r\n        }\r\n      };\r\n\r\n      if (class10Marksheet instanceof File) { c10Url = await uploadFile(class10Marksheet) || c10Url; }\r\n      if (class12Marksheet instanceof File) { c12Url = await uploadFile(class12Marksheet) || c12Url; }\r\n      if (diplomaCertificate instanceof File) { diplomaUrl = await uploadFile(diplomaCertificate) || diplomaUrl; }\r\n      if (bachelorDegree instanceof File) { bachelorUrl = await uploadFile(bachelorDegree) || bachelorUrl; }\r\n      if (masterDegree instanceof File) { masterUrl = await uploadFile(masterDegree) || masterUrl; }\r\n\r\n      if (lastSem1 instanceof File) { ls1Url = await uploadFile(lastSem1) || ls1Url; }\r\n      if (lastSem2 instanceof File) { ls2Url = await uploadFile(lastSem2) || ls2Url; }\r\n      if (lastSem3 instanceof File) { ls3Url = await uploadFile(lastSem3) || ls3Url; }\r\n\r\n      // Step 6 Documents\r\n\r\n      // Step 6 Documents\r\n      let aadharFrontUrl = employee?.documents?.aadharFront;\r\n      let aadharBackUrl = employee?.documents?.aadharBack;\r\n      let panUrl = employee?.documents?.panCard;\r\n      let profilePicUrl = employee?.profilePic; // Existing URL\r\n\r\n      if (profilePic instanceof File) { profilePicUrl = await uploadFile(profilePic) || profilePicUrl; }\r\n      if (aadharFront instanceof File) { aadharFrontUrl = await uploadFile(aadharFront) || aadharFrontUrl; }\r\n      if (aadharBack instanceof File) { aadharBackUrl = await uploadFile(aadharBack) || aadharBackUrl; }\r\n      if (panCard instanceof File) { panUrl = await uploadFile(panCard) || panUrl; }\r\n\r\n      const payload = {\r\n        firstName, middleName, lastName, gender, dob: dob || undefined,\r\n        contactNo, email, password: password || undefined,\r\n        maritalStatus, bloodGroup, nationality, fatherName, motherName,\r\n        emergencyContactName, emergencyContactNumber,\r\n        tempAddress, permAddress: sameAsTemp ? tempAddress : permAddress,\r\n        experience: processedExperience,\r\n        jobType,\r\n        bankDetails: { bankName, accountNumber, ifsc, branchName, location: bankLocation, bankProofUrl: currentBankProofUrl },\r\n        education: {\r\n          type: eduType,\r\n          class10Marksheet: c10Url,\r\n          class12Marksheet: c12Url,\r\n          diplomaCertificate: diplomaUrl,\r\n          bachelorDegree: bachelorUrl,\r\n          masterDegree: masterUrl,\r\n          lastSem1Marksheet: ls1Url,\r\n          lastSem2Marksheet: ls2Url,\r\n          lastSem3Marksheet: ls3Url\r\n        },\r\n        documents: {\r\n          aadharFront: aadharFrontUrl,\r\n          aadharBack: aadharBackUrl,\r\n          panCard: panUrl\r\n        },\r\n        role,\r\n        department: department || (departments.find(d => d._id === departmentId)?.name || ''),\r\n        departmentId: departmentId || undefined,\r\n        manager: manager || undefined,\r\n        joiningDate: joiningDate || new Date().toISOString(),\r\n        departmentHead: _departmentHead,\r\n        profilePic: profilePicUrl,\r\n        status: 'Active',\r\n        lastStep: 7,\r\n        leavePolicy: leavePolicy || undefined,\r\n      };\r\n\r\n      let empResult;\r\n      if (employee) {\r\n        empResult = await api.put(`/hr/employees/${employee._id}`, payload);\r\n      } else {\r\n        empResult = await api.post('/hr/employees', payload);\r\n      }\r\n\r\n      // If employee is marked as \"Dep Head\", update the department's head field\r\n      if (role === 'Dep Head' && department) {\r\n        const empId = empResult?.data?.data?._id || empResult?.data?._id || employee?._id;\r\n        if (empId) {\r\n          await api.put(`/hr/departments/${department}`, { head: empId })\r\n            .catch(err => console.error('Failed to update department head', err?.response?.data?.message || err.message));\r\n        }\r\n      }\r\n\r\n      onClose();\r\n    } catch (err) {\r\n      console.error('Employee save error:', err);\r\n      const errorMsg = err?.response?.data?.message || err?.response?.data?.error || err?.message || 'Failed to save employee';\r\n      notification.error({ message: 'Error', description: errorMsg, placement: 'topRight' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  async function saveDraft(e) {\r\n    if (e) e.preventDefault();\r\n    setSaving(true);\r\n    try {\r\n      const uploadFile = async (file) => {\r\n        if (!file || !(file instanceof File)) return null;\r\n        const fd = new FormData();\r\n        fd.append('file', file);\r\n        try {\r\n          const res = await api.post('/uploads/doc', fd);\r\n          return res?.data?.success ? res.data.url : null;\r\n        } catch (e) { console.warn('File upload failed', e); return null; }\r\n      };\r\n\r\n      // Bank Proof\r\n      let currentBankProofUrl = employee?.bankDetails?.bankProofUrl;\r\n      if (currentBankProof && currentBankProof instanceof File) {\r\n        currentBankProofUrl = await uploadFile(currentBankProof) || currentBankProofUrl;\r\n      } else if (currentBankProof) { currentBankProofUrl = currentBankProof; }\r\n      else { currentBankProofUrl = ''; }\r\n\r\n      // Profile Pic\r\n      let profilePicUrl = employee?.profilePic;\r\n      if (profilePic && profilePic instanceof File) {\r\n        profilePicUrl = await uploadFile(profilePic) || profilePicUrl;\r\n      } else if (profilePic) { profilePicUrl = profilePic; }\r\n\r\n      // Payslips\r\n      let processedExperience = [];\r\n      if (experience && experience.length > 0) {\r\n        processedExperience = await Promise.all(experience.map(async (exp) => {\r\n          let pSlips = [];\r\n          if (exp.payslips && exp.payslips.length > 0) {\r\n            for (const item of exp.payslips) {\r\n              if (item instanceof File) {\r\n                const u = await uploadFile(item);\r\n                if (u) pSlips.push(u);\r\n              } else if (typeof item === 'string') { pSlips.push(item); }\r\n            }\r\n          }\r\n          return { ...exp, payslips: pSlips };\r\n        }));\r\n      }\r\n\r\n      // Education\r\n      let c10Url = employee?.education?.class10Marksheet;\r\n      let c12Url = employee?.education?.class12Marksheet;\r\n      let diplomaUrl = employee?.education?.diplomaCertificate;\r\n      let bachelorUrl = employee?.education?.bachelorDegree;\r\n      let masterUrl = employee?.education?.masterDegree;\r\n      let ls1Url = employee?.education?.lastSem1Marksheet;\r\n      let ls2Url = employee?.education?.lastSem2Marksheet;\r\n      let ls3Url = employee?.education?.lastSem3Marksheet;\r\n\r\n      if (class10Marksheet instanceof File) { c10Url = await uploadFile(class10Marksheet) || c10Url; }\r\n      if (class12Marksheet instanceof File) { c12Url = await uploadFile(class12Marksheet) || c12Url; }\r\n      if (diplomaCertificate instanceof File) { diplomaUrl = await uploadFile(diplomaCertificate) || diplomaUrl; }\r\n      if (bachelorDegree instanceof File) { bachelorUrl = await uploadFile(bachelorDegree) || bachelorUrl; }\r\n      if (masterDegree instanceof File) { masterUrl = await uploadFile(masterDegree) || masterUrl; }\r\n\r\n      if (lastSem1 instanceof File) { ls1Url = await uploadFile(lastSem1) || ls1Url; }\r\n      if (lastSem2 instanceof File) { ls2Url = await uploadFile(lastSem2) || ls2Url; }\r\n      if (lastSem3 instanceof File) { ls3Url = await uploadFile(lastSem3) || ls3Url; }\r\n\r\n      let aadharFrontUrl = employee?.documents?.aadharFront;\r\n      let aadharBackUrl = employee?.documents?.aadharBack;\r\n      let panUrl = employee?.documents?.panCard;\r\n      if (aadharFront instanceof File) { aadharFrontUrl = await uploadFile(aadharFront) || aadharFrontUrl; }\r\n      if (aadharBack instanceof File) { aadharBackUrl = await uploadFile(aadharBack) || aadharBackUrl; }\r\n      if (panCard instanceof File) { panUrl = await uploadFile(panCard) || panUrl; }\r\n\r\n      const payload = {\r\n        firstName, middleName, lastName,\r\n        gender: gender || undefined,\r\n        dob: dob || undefined,\r\n        contactNo, email,\r\n        password: password || undefined,\r\n        maritalStatus: maritalStatus || undefined,\r\n        bloodGroup,\r\n        nationality: nationality || undefined,\r\n        fatherName, motherName,\r\n        emergencyContactName, emergencyContactNumber,\r\n        tempAddress, permAddress: sameAsTemp ? tempAddress : permAddress,\r\n        experience: processedExperience,\r\n        jobType: jobType || undefined,\r\n        bankDetails: { bankName, accountNumber, ifsc, branchName, location: bankLocation, bankProofUrl: currentBankProofUrl },\r\n        education: {\r\n          type: eduType,\r\n          class10Marksheet: c10Url,\r\n          class12Marksheet: c12Url,\r\n          diplomaCertificate: diplomaUrl,\r\n          bachelorDegree: bachelorUrl,\r\n          masterDegree: masterUrl,\r\n          lastSem1Marksheet: ls1Url,\r\n          lastSem2Marksheet: ls2Url,\r\n          lastSem3Marksheet: ls3Url\r\n        },\r\n        documents: {\r\n          aadharFront: aadharFrontUrl,\r\n          aadharBack: aadharBackUrl,\r\n          panCard: panUrl\r\n        },\r\n        role, department: department || undefined, departmentId: departmentId || undefined,\r\n        manager: manager || undefined, joiningDate: joiningDate || undefined,\r\n        profilePic: profilePicUrl,\r\n        status: 'Draft',\r\n        lastStep: step,\r\n        leavePolicy: leavePolicy || undefined, // Add Leave Policy\r\n      };\r\n\r\n      if (employee?._id) {\r\n        await api.put(`/hr/employees/${employee._id}`, payload);\r\n      } else {\r\n        await api.post('/hr/employees', payload);\r\n        // If new employee created, we might want to set it so future saves are updates?\r\n        // But for now just alert.\r\n      }\r\n      notification.success({ message: 'Success', description: 'Draft saved successfully!', placement: 'topRight' });\r\n      // onClose(); // Removed as requested: User wants to stay on form\r\n    } catch (err) {\r\n      console.error(\"Failed to save draft\", err);\r\n      notification.error({ message: 'Error', description: \"Failed to save draft: \" + (err.response?.data?.message || err.message), placement: 'topRight' });\r\n    } finally { setSaving(false); }\r\n  }\r\n\r\n  const stepTitles = ['General Details', 'Address', 'Experience', 'Bank & Job', 'Education Details', 'Identity Documents', 'Account Credentials', 'Payroll / Compensation'];\r\n\r\n  return (\r\n    <div>\r\n      <form onSubmit={submit} className=\"bg-white p-6 rounded-lg border border-slate-200 shadow-sm w-full\">\r\n        {/* Step Indicator */}\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h3 className=\"font-bold text-lg\">{employee ? 'Edit' : 'Add'} Employee - Step {step} of {stepTitles.length}</h3>\r\n          <div className=\"text-xs text-slate-500\">{stepTitles[step - 1]}</div>\r\n        </div>\r\n\r\n        {/* Draft Badge */}\r\n        {employee?.status === 'Draft' && (\r\n          <div className=\"mb-4 bg-amber-50 text-amber-800 text-sm px-3 py-2 rounded border border-amber-200\">\r\n            This is a <strong>Draft</strong>. You are currently on Step {step}.\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 1: General Details */}\r\n        {step === 1 && (\r\n          <div className=\"space-y-6\">\r\n\r\n            {/* Profile Picture Upload */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200 flex flex-col md:flex-row items-center gap-6\">\r\n              <div className=\"relative group\">\r\n                <div className=\"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-md bg-slate-200 flex items-center justify-center\">\r\n                  {profilePreview ? (\r\n                    <img src={profilePreview instanceof File ? URL.createObjectURL(profilePreview) : `${BACKEND_URL}${profilePreview}`} alt=\"Profile\" className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <svg className=\"w-12 h-12 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" /></svg>\r\n                  )}\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => profilePicRef.current?.click()}\r\n                  className=\"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full shadow hover:bg-blue-700 transition\"\r\n                  title=\"Upload Photo\"\r\n                >\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\" /></svg>\r\n                </button>\r\n                <input\r\n                  ref={profilePicRef}\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  className=\"hidden\"\r\n                  onChange={(e) => {\r\n                    const file = e.target.files[0];\r\n                    if (file) {\r\n                      setProfilePic(file);\r\n                      setProfilePreview(file);\r\n                    }\r\n                  }}\r\n                />\r\n              </div>\r\n              <div className=\"flex-1 text-center md:text-left\">\r\n                <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-1\">Profile Photo</h4>\r\n                <p className=\"text-xs text-slate-500 mb-2\">Upload a professional photo. Max 2MB. (Optional)</p>\r\n                {profilePic && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => { setProfilePic(null); setProfilePreview(null); if (profilePicRef.current) profilePicRef.current.value = ''; }}\r\n                    className=\"text-xs text-red-500 hover:text-red-700 border border-red-200 bg-red-50 px-3 py-1 rounded-full transition\"\r\n                  >\r\n                    Remove Photo\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section: Identity Details */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Identity Details</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">First Name <span className=\"text-red-500\">*</span></label>\r\n                  <input required value={firstName} onChange={e => { const v = e.target.value; setFirstName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.firstName ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"John\" />\r\n                  {errors.firstName && <div className=\"text-xs text-red-600 mt-1\">{errors.firstName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Middle Name</label>\r\n                  <input value={middleName} onChange={e => { const v = e.target.value; setMiddleName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.middleName ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"D.\" />\r\n                  {errors.middleName && <div className=\"text-xs text-red-600 mt-1\">{errors.middleName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Last Name <span className=\"text-red-500\">*</span></label>\r\n                  <input required value={lastName} onChange={e => { const v = e.target.value; setLastName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.lastName ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"Doe\" />\r\n                  {errors.lastName && <div className=\"text-xs text-red-600 mt-1\">{errors.lastName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Gender</label>\r\n                  <select\r\n                    value={gender}\r\n                    onChange={e => setGender(e.target.value)}\r\n                    className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.gender ? 'border-red-500' : 'border-slate-300'}`}\r\n                  >\r\n                    <option value=\"\">Select Gender</option>\r\n                    <option value=\"Male\">Male</option>\r\n                    <option value=\"Female\">Female</option>\r\n                    <option value=\"Other\">Other</option>\r\n                  </select>\r\n                  {errors.gender && <div className=\"text-xs text-red-600 mt-1\">{errors.gender}</div>}\r\n                </div>\r\n                <div>\r\n                  <DatePicker\r\n                    className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none h-[40px] ${errors.dob ? 'border-red-500' : 'border-slate-300'}`}\r\n                    format=\"DD-MM-YYYY\"\r\n                    placeholder=\"DD-MM-YYYY\"\r\n                    allowClear={false}\r\n                    value={dob ? dayjs(dob) : null}\r\n                    onChange={(date) => setDob(date ? date.format('YYYY-MM-DD') : '')}\r\n                  />\r\n                  {errors.dob && <div className=\"text-xs text-red-600 mt-1\">{errors.dob}</div>}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section: Official Information */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Official Information</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Department <span className=\"text-red-500\">*</span></label>\r\n                  <select\r\n                    value={departmentId}\r\n                    onChange={e => {\r\n                      const selectedDept = departments.find(d => d._id === e.target.value);\r\n                      setDepartmentId(e.target.value);\r\n                      setDepartment(selectedDept?.name || '');\r\n                    }}\r\n                    className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.department ? 'border-red-500' : 'border-slate-300'}`}\r\n                    required\r\n                  >\r\n                    <option value=\"\">-- Select Department --</option>\r\n                    {departments.map((d) => (\r\n                      <option key={d._id || d} value={d._id || d}>{typeof d === 'string' ? d : d.name}</option>\r\n                    ))}\r\n                  </select>\r\n                  {errors.department && <div className=\"text-xs text-red-600 mt-1\">{errors.department}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Manager (Optional)</label>\r\n                  <select\r\n                    value={manager}\r\n                    onChange={e => setManager(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">-- No Manager (Top Level) --</option>\r\n                    {managers\r\n                      .filter(m => !departmentId || m.departmentId === departmentId || m.department === department)\r\n                      .map((m) => (\r\n                        <option key={m._id} value={m._id}>\r\n                          {[m.firstName, m.lastName].filter(Boolean).join(' ')} ({m.employeeId}) - {m.role || 'Employee'}\r\n                        </option>\r\n                      ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Leave Policy</label>\r\n                  <select\r\n                    value={leavePolicy}\r\n                    onChange={e => setLeavePolicy(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">-- Select Leave Policy --</option>\r\n                    {policies.map(p => (\r\n                      <option key={p._id} value={p._id}>{p.name}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <DatePicker\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300 h-[40px]\"\r\n                    format=\"DD-MM-YYYY\"\r\n                    placeholder=\"DD-MM-YYYY\"\r\n                    allowClear={false}\r\n                    value={joiningDate ? dayjs(joiningDate) : null}\r\n                    onChange={(date) => setJoiningDate(date ? date.format('YYYY-MM-DD') : '')}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Designation / Role</label>\r\n                  <select\r\n                    value={role}\r\n                    onChange={e => setRole(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option>Employee</option>\r\n                    <option>Manager</option>\r\n                    <option>Dep Head</option>\r\n                    <option>HR</option>\r\n                    <option>Admin</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Job Type</label>\r\n                  <select\r\n                    value={jobType}\r\n                    onChange={e => setJobType(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option>Full-Time</option>\r\n                    <option>Part-Time</option>\r\n                    <option>Internship</option>\r\n                    <option>Contract</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section: Personal & Family */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Personal & Family</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Marital Status</label>\r\n                  <select value={maritalStatus} onChange={e => setMaritalStatus(e.target.value)} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\">\r\n                    <option value=\"\">Select</option>\r\n                    <option>Single</option>\r\n                    <option>Married</option>\r\n                    <option>Divorced</option>\r\n                    <option>Widowed</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Blood Group</label>\r\n                  <select\r\n                    value={bloodGroup}\r\n                    onChange={e => setBloodGroup(e.target.value)}\r\n                    className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.bloodGroup ? 'border-red-500' : 'border-slate-300'}`}\r\n                  >\r\n                    <option value=\"\">Select</option>\r\n                    <option value=\"A+\">A+</option>\r\n                    <option value=\"A-\">A-</option>\r\n                    <option value=\"B+\">B+</option>\r\n                    <option value=\"B-\">B-</option>\r\n                    <option value=\"O+\">O+</option>\r\n                    <option value=\"O-\">O-</option>\r\n                    <option value=\"AB+\">AB+</option>\r\n                    <option value=\"AB-\">AB-</option>\r\n                  </select>\r\n                  {errors.bloodGroup && <div className=\"text-xs text-red-600 mt-1\">{errors.bloodGroup}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Nationality</label>\r\n                  <select\r\n                    value={nationality}\r\n                    onChange={e => setNationality(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">Select Country</option>\r\n                    {NATIONALITIES.map((nat) => (\r\n                      <option key={nat} value={nat}>{nat}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Father's Name</label>\r\n                  <input value={fatherName} onChange={e => { const v = e.target.value; setFatherName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.fatherName ? 'border-red-500' : 'border-slate-300'}`} />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Mother's Name</label>\r\n                  <input value={motherName} onChange={e => { const v = e.target.value; setMotherName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.motherName ? 'border-red-500' : 'border-slate-300'}`} />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section: Contact */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Contact Information</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Phone Number</label>\r\n                  <input value={contactNo} onChange={e => setContactNo(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.contactNo ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  {errors.contactNo && <div className=\"text-xs text-red-600 mt-1\">{errors.contactNo}</div>}\r\n                </div>\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <div>\r\n                    <label className=\"text-sm font-semibold text-slate-700\">Emergency Contact Name</label>\r\n                    <input value={emergencyContactName} onChange={e => { const v = e.target.value; setEmergencyContactName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.emergencyContactName ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-sm font-semibold text-slate-700\">Emergency Contact #</label>\r\n                    <input value={emergencyContactNumber} onChange={e => setEmergencyContactNumber(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.emergencyContactNumber ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 2: Address */}\r\n        {step === 2 && (\r\n          <div className=\"space-y-6\">\r\n            {/* Temporary Address Section */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <div className=\"flex items-center justify-between mb-4 border-b border-slate-200 pb-2\">\r\n                <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide\">Temporary Address</h4>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Address Line 1 <span className=\"text-red-500\">*</span></label>\r\n                  <input value={tempAddress.line1} onChange={e => setTempAddress(p => ({ ...p, line1: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempLine1 ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"Street, Sector, Area\" />\r\n                  {errors.tempLine1 && <div className=\"text-xs text-red-600 mt-1\">{errors.tempLine1}</div>}\r\n                </div>\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Address Line 2 (Optional)</label>\r\n                  <input value={tempAddress.line2} onChange={e => setTempAddress(p => ({ ...p, line2: e.target.value }))} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" placeholder=\"Landmark, Building Name\" />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">City <span className=\"text-red-500\">*</span></label>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      value={tempAddress.city}\r\n                      onChange={e => {\r\n                        setTempAddress(p => ({ ...p, city: e.target.value }));\r\n                        setPincodeLoading(true);\r\n                      }}\r\n                      className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempCity ? 'border-red-500' : 'border-slate-300'}`}\r\n                      placeholder=\"Start typing...\"\r\n                    />\r\n                    {pincodeLoading && tempAddress.city.length > 2 && <div className=\"absolute right-2 top-2 text-xs text-blue-500 animate-pulse\">Searching...</div>}\r\n                  </div>\r\n                  {errors.tempCity && <div className=\"text-xs text-red-600 mt-1\">{errors.tempCity}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">State</label>\r\n                  <input value={tempAddress.state} onChange={e => setTempAddress(p => ({ ...p, state: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempState ? 'border-red-500' : 'border-slate-300'}`} disabled />\r\n                  {errors.tempState && <div className=\"text-xs text-red-600 mt-1\">{errors.tempState}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Pin/Zip Code <span className=\"text-red-500\">*</span></label>\r\n                  <input value={tempAddress.pinCode} onChange={e => setTempAddress(p => ({ ...p, pinCode: e.target.value }))} onBlur={() => handlePincodeLookup(tempAddress.pinCode, 'temp')} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempPin ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  {errors.tempPin && <div className=\"text-xs text-red-600 mt-1\">{errors.tempPin}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Country</label>\r\n                  <input value={tempAddress.country} onChange={e => setTempAddress(p => ({ ...p, country: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempCountry ? 'border-red-500' : 'border-slate-300'}`} disabled />\r\n                  {errors.tempCountry && <div className=\"text-xs text-red-600 mt-1\">{errors.tempCountry}</div>}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Same As Temp Checkbox */}\r\n            <div className=\"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-100\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={sameAsTemp}\r\n                onChange={e => {\r\n                  const checked = e.target.checked;\r\n                  setSameAsTemp(checked);\r\n                  if (!checked) {\r\n                    setPermAddress({ line1: '', line2: '', city: '', state: '', pinCode: '', country: '' });\r\n                  }\r\n                }}\r\n                id=\"sameTemp\"\r\n                className=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\"\r\n              />\r\n              <label htmlFor=\"sameTemp\" className=\"text-sm font-medium text-blue-800 cursor-pointer\">Permanent Address is same as Temporary Address</label>\r\n            </div>\r\n\r\n            {/* Permanent Address Section */}\r\n            <div className={`bg-slate-50 p-4 rounded-lg border border-slate-200 transition-opacity ${sameAsTemp ? 'opacity-50 pointer-events-none' : ''}`}>\r\n              <div className=\"flex items-center justify-between mb-4 border-b border-slate-200 pb-2\">\r\n                <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide\">Permanent Address</h4>\r\n              </div>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Address Line 1 <span className=\"text-red-500\">*</span></label>\r\n                  <input value={permAddress.line1} onChange={e => setPermAddress(p => ({ ...p, line1: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permLine1 ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permLine1 && <div className=\"text-xs text-red-600 mt-1\">{errors.permLine1}</div>}\r\n                </div>\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Address Line 2 (Optional)</label>\r\n                  <input value={permAddress.line2} onChange={e => setPermAddress(p => ({ ...p, line2: e.target.value }))} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" disabled={sameAsTemp} />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">City <span className=\"text-red-500\">*</span></label>\r\n                  <input value={permAddress.city} onChange={e => setPermAddress(p => ({ ...p, city: e.target.value }))} onBlur={() => handleCityLookup(permAddress.city, 'perm')} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permCity ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permCity && <div className=\"text-xs text-red-600 mt-1\">{errors.permCity}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">State</label>\r\n                  <input value={permAddress.state} onChange={e => setPermAddress(p => ({ ...p, state: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permState ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permState && <div className=\"text-xs text-red-600 mt-1\">{errors.permState}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Pin/Zip Code <span className=\"text-red-500\">*</span></label>\r\n                  <input value={permAddress.pinCode} onChange={e => setPermAddress(p => ({ ...p, pinCode: e.target.value }))} onBlur={() => handlePincodeLookup(permAddress.pinCode, 'perm')} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permPin ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permPin && <div className=\"text-xs text-red-600 mt-1\">{errors.permPin}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Country</label>\r\n                  <input value={permAddress.country} onChange={e => setPermAddress(p => ({ ...p, country: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permCountry ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permCountry && <div className=\"text-xs text-red-600 mt-1\">{errors.permCountry}</div>}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 3: Experience */}\r\n        {step === 3 && (\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h4 className=\"text-lg font-bold text-slate-800\">Work Experience</h4>\r\n            </div>\r\n            {experience.map((exp, idx) => (\r\n              <div key={idx} className=\"bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative group hover:shadow-md transition\">\r\n                {/* Remove Button */}\r\n                {experience.length > 1 && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      const copy = [...experience];\r\n                      copy.splice(idx, 1);\r\n                      setExperience(copy);\r\n                    }}\r\n                    className=\"absolute top-4 right-4 text-slate-300 hover:text-red-500 transition\"\r\n                    title=\"Remove Entry\"\r\n                  >\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                      <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </button>\r\n                )}\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\r\n                  {/* Left Col: Company Info */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-3 border-b border-slate-100 pb-1 text-blue-600\">Company Details</h5>\r\n                    <div className=\"space-y-3\">\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Company Name <span className=\"text-red-500\">*</span></label>\r\n                        <input placeholder=\"Ex. Tech Solutions Inc.\" value={exp.companyName} onChange={e => { const v = e.target.value; const copy = [...experience]; copy[idx].companyName = v ? v.charAt(0).toUpperCase() + v.slice(1) : v; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                      <div className=\"grid grid-cols-2 gap-3\">\r\n                        <div>\r\n                          <label className=\"text-sm font-semibold text-slate-700\">From Date</label>\r\n                          <DatePicker\r\n                            className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300 h-[40px]\"\r\n                            format=\"DD-MM-YYYY\"\r\n                            placeholder=\"DD-MM-YYYY\"\r\n                            value={exp.from ? dayjs(exp.from) : null}\r\n                            onChange={(date) => { const copy = [...experience]; copy[idx].from = date ? date.format('YYYY-MM-DD') : ''; setExperience(copy); }}\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"text-sm font-semibold text-slate-700\">To Date</label>\r\n                          <DatePicker\r\n                            className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300 h-[40px]\"\r\n                            format=\"DD-MM-YYYY\"\r\n                            placeholder=\"DD-MM-YYYY\"\r\n                            value={exp.to ? dayjs(exp.to) : null}\r\n                            onChange={(date) => { const copy = [...experience]; copy[idx].to = date ? date.format('YYYY-MM-DD') : ''; setExperience(copy); }}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Last Salary</label>\r\n                        <input placeholder=\"Ex. 50000\" type=\"number\" value={exp.lastDrawnSalary} onChange={e => { const copy = [...experience]; copy[idx].lastDrawnSalary = e.target.value; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Right Col: Manager Info */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-3 border-b border-slate-100 pb-1 text-green-600\">Reporting Manager</h5>\r\n                    <div className=\"space-y-3\">\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Manager Name <span className=\"text-red-500\">*</span></label>\r\n                        <input placeholder=\"Full Name\" value={exp.reportingPersonName || ''} onChange={e => { const v = e.target.value; const copy = [...experience]; copy[idx].reportingPersonName = v ? v.charAt(0).toUpperCase() + v.slice(1) : v; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Manager Email <span className=\"text-red-500\">*</span></label>\r\n                        <input placeholder=\"email@company.com\" value={exp.reportingPersonEmail || ''} onChange={e => { const copy = [...experience]; copy[idx].reportingPersonEmail = e.target.value; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Manager Phone</label>\r\n                        <input placeholder=\"Optional\" value={exp.reportingPersonPhone || ''} onChange={e => { const copy = [...experience]; copy[idx].reportingPersonPhone = e.target.value; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Verification Documents */}\r\n                <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n                  <h5 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-3 border-b border-slate-200 pb-1 text-indigo-600\">Verification Documents</h5>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    {/* Payslips */}\r\n                    <div>\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Payslips (Last 3 Months) <span className=\"text-red-500\">*</span></label>\r\n                      <div className=\"flex gap-2\">\r\n                        {[0, 1, 2].map((i) => (\r\n                          <div key={i} className=\"flex-1\">\r\n                            <label className=\"block bg-white border border-dashed border-slate-300 rounded p-2 text-center cursor-pointer hover:border-blue-400 transition\" title={`Upload Month ${i + 1}`}>\r\n                              <div className=\"text-xs font-semibold text-slate-500 mb-1\">Mo. {i + 1}</div>\r\n                              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 mx-auto text-slate-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" /></svg>\r\n                            </label>\r\n                            <input\r\n                              type=\"file\"\r\n                              className=\"hidden\"\r\n                              onChange={(e) => {\r\n                                const file = e.target.files[0];\r\n                                const copy = [...experience];\r\n                                if (!copy[idx].payslips) copy[idx].payslips = [];\r\n                                copy[idx].payslips[i] = file;\r\n                                setExperience(copy);\r\n                              }}\r\n                            />\r\n                            {exp.payslips && exp.payslips[i] && <div className=\"text-[10px] text-green-600 text-center mt-1 truncate\">{exp.payslips[i].name}</div>}\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Chequebook */}\r\n                    <div>\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Bank Proof (Cheque/Passbook) <span className=\"text-red-500\">*</span></label>\r\n                      <label className=\"block bg-white border border-dashed border-slate-300 rounded p-2 text-center cursor-pointer hover:border-blue-400 transition h-[74px] flex flex-col justify-center items-center\">\r\n                        <div className=\"text-xs font-semibold text-slate-500 mb-1\">{exp.chequebook ? 'File Selected' : 'Upload File'}</div>\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 mx-auto text-slate-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" /></svg>\r\n                      </label>\r\n                      <input\r\n                        type=\"file\"\r\n                        className=\"hidden\"\r\n                        onChange={(e) => {\r\n                          const file = e.target.files[0];\r\n                          const copy = [...experience];\r\n                          copy[idx].chequebook = file;\r\n                          setExperience(copy);\r\n                        }}\r\n                      />\r\n                      {exp.chequebook && <div className=\"text-[10px] text-green-600 text-center mt-1 truncate\">{exp.chequebook.name}</div>}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n              </div>\r\n            ))}\r\n\r\n\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setExperience([...experience, { companyName: '', from: '', to: '', lastDrawnSalary: '', reportingPersonName: '', reportingPersonEmail: '', reportingPersonContact: '', payslips: [] }])}\r\n              className=\"w-full py-3 border-2 border-dashed border-blue-200 rounded-lg text-blue-600 hover:bg-blue-50 font-semibold transition flex items-center justify-center gap-2 hover:border-blue-300\"\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" /></svg>\r\n              Add Another Experience\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 4: Bank & Job */}\r\n        {/* Step 4: Bank & Job */}\r\n        {step === 4 && (\r\n          <div className=\"space-y-6\">\r\n            {/* Bank Details */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Bank Details</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Bank Name</label>\r\n                  <input value={bankName} onChange={e => setBankName(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.bankName ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"HDFC, SBI, etc.\" />\r\n                  {errors.bankName && <div className=\"text-xs text-red-600 mt-1\">{errors.bankName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Account Number</label>\r\n                  <input value={accountNumber} onChange={e => setAccountNumber(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.accountNumber ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"Account No\" />\r\n                  {errors.accountNumber && <div className=\"text-xs text-red-600 mt-1\">{errors.accountNumber}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">IFSC Code</label>\r\n                  <div className=\"relative\">\r\n                    <input value={ifsc} onChange={e => setIfsc(e.target.value.toUpperCase())} onBlur={() => handleIfscLookup(ifsc)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.ifsc ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"SBIN000....\" />\r\n                    {ifscLoading && <div className=\"absolute right-3 top-2.5 text-xs text-blue-500 animate-pulse\">Checking...</div>}\r\n                  </div>\r\n                  {errors.ifsc && <div className=\"text-xs text-red-600 mt-1\">{errors.ifsc}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Branch Name</label>\r\n                  <input value={branchName} onChange={e => setBranchName(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.branchName ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  {errors.branchName && <div className=\"text-xs text-red-600 mt-1\">{errors.branchName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Bank Location</label>\r\n                  <input value={bankLocation} onChange={e => setBankLocation(e.target.value)} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" placeholder=\"City/District\" />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Bank Proof Upload */}\r\n              <div className=\"mt-4 pt-4 border-t border-slate-200\">\r\n                <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Upload Cheque / Passbook <span className=\"text-red-500\">*</span></label>\r\n                <label className=\"flex flex-col items-center justify-center w-full h-32 border-2 border-slate-300 border-dashed rounded-lg cursor-pointer bg-white hover:bg-slate-50 transition border-slate-400\">\r\n                  <div className=\"flex flex-col items-center justify-center pt-5 pb-6\">\r\n                    <svg className=\"w-8 h-8 mb-3 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"></path></svg>\r\n                    <p className=\"mb-2 text-sm text-slate-500\"><span className=\"font-semibold\">Click to upload</span> or drag and drop</p>\r\n                    <p className=\"text-xs text-slate-500\">SVG, PNG, JPG or PDF (MAX. 2MB)</p>\r\n                  </div>\r\n                  <input ref={bankProofRef} type=\"file\" className=\"hidden\" accept=\"image/*,application/pdf\" onChange={e => setCurrentBankProof(e.target.files[0])} />\r\n                </label>\r\n                {currentBankProof && (\r\n                  <div className=\"mt-2 flex items-center justify-between bg-blue-50 px-3 py-2 rounded border border-blue-100\">\r\n                    <div className=\"flex items-center space-x-2 overflow-hidden\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-blue-500 flex-shrink-0\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" /></svg>\r\n                      {currentBankProof instanceof File ? <span className=\"text-sm text-blue-700 truncate\">{currentBankProof.name}</span> : <a href={`${BACKEND_URL}${currentBankProof}`} target=\"_blank\" rel=\"noreferrer\" className=\"text-sm text-blue-600 underline truncate\">View Uploaded File</a>}\r\n                    </div>\r\n                    <button type=\"button\" onClick={() => { setCurrentBankProof(null); if (bankProofRef.current) bankProofRef.current.value = ''; }} className=\"text-red-500 hover:text-red-700 p-1\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" /></svg>\r\n                    </button>\r\n                  </div>\r\n                )}\r\n                {errors.bankProof && <div className=\"text-xs text-red-600 mt-1\">{errors.bankProof}</div>}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Job Details */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Employment Details</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Job Type</label>\r\n                  <select value={jobType} onChange={e => setJobType(e.target.value)} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\">\r\n                    <option>Full-Time</option>\r\n                    <option>Part-Time</option>\r\n                    <option>Internship</option>\r\n                    <option>Contract</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Role / Access Level</label>\r\n                  <select value={role} onChange={e => setRole(e.target.value)} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\">\r\n                    <option value=\"Employee\">Employee</option>\r\n                    <option value=\"Dep Head\">Dep Head</option>\r\n                    <option value=\"Manager\">Manager</option>\r\n                    <option value=\"HR\">HR</option>\r\n                    <option value=\"Admin\">Admin</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Department</label>\r\n                  <select\r\n                    value={departmentId}\r\n                    onChange={e => {\r\n                      const selectedDept = departments.find(d => d._id === e.target.value);\r\n                      setDepartmentId(e.target.value);\r\n                      setDepartment(selectedDept?.name || '');\r\n                    }}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">-- Select Department --</option>\r\n                    {departments.map(dept => (\r\n                      <option key={dept._id} value={dept._id}>{dept.name}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Reporting Manager</label>\r\n                  <select\r\n                    value={manager}\r\n                    onChange={e => setManager(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">-- No Manager (Top Level) --</option>\r\n                    {managers\r\n                      .filter(m => !departmentId || m.departmentId === departmentId || m.department === department)\r\n                      .map((m) => (\r\n                        <option key={m._id} value={m._id}>\r\n                          {[m.firstName, m.lastName].filter(Boolean).join(' ')} ({m.employeeId})\r\n                        </option>\r\n                      ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <DatePicker\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300 h-[40px]\"\r\n                    format=\"DD-MM-YYYY\"\r\n                    placeholder=\"DD-MM-YYYY\"\r\n                    allowClear={false}\r\n                    value={joiningDate ? dayjs(joiningDate) : null}\r\n                    onChange={(date) => setJoiningDate(date ? date.format('YYYY-MM-DD') : '')}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 5: Education Details */}\r\n        {step === 5 && (\r\n          <div className=\"space-y-6\">\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Academic Information</h4>\r\n\r\n              <div className=\"mb-6\">\r\n                <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Education Track <span className=\"text-red-500\">*</span></label>\r\n                <div className=\"flex space-x-4\">\r\n                  {['Diploma', 'Bachelor'].map((type) => (\r\n                    <label key={type} className={`cursor-pointer px-4 py-2 rounded-lg border flex items-center space-x-2 transition ${eduType === type ? 'bg-blue-50 border-blue-500 text-blue-700' : 'bg-white border-slate-300 text-slate-600 hover:bg-slate-50'}`}>\r\n                      <input type=\"radio\" name=\"eduType\" value={type} checked={eduType === type} onChange={e => setEduType(e.target.value)} className=\"w-4 h-4 text-blue-600 focus:ring-blue-500\" />\r\n                      <span className=\"font-medium\">{type}</span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                {/* 10th Standard (Always Required) */}\r\n                <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                  <label className=\"text-sm font-semibold text-slate-700 block mb-2\">10th Standard Marksheet <span className=\"text-red-500\">*</span></label>\r\n                  <input ref={c10Ref} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setClass10Marksheet(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                  {class10Marksheet && (\r\n                    <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                      {class10Marksheet instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{class10Marksheet.name}</span> : <a href={`${BACKEND_URL}${class10Marksheet}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                      <button type=\"button\" onClick={() => { setClass10Marksheet(null); if (c10Ref.current) c10Ref.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                    </div>\r\n                  )}\r\n                  {errors.class10 && <div className=\"text-xs text-red-600 mt-1\">{errors.class10}</div>}\r\n                </div>\r\n\r\n                {/* Conditional Fields */}\r\n                {eduType === 'Diploma' ? (\r\n                  <>\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Diploma Certificate <span className=\"text-red-500\">*</span></label>\r\n                      <input ref={diplomaRef} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setDiplomaCertificate(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {diplomaCertificate && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {diplomaCertificate instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{diplomaCertificate.name}</span> : <a href={`${BACKEND_URL}${diplomaCertificate}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setDiplomaCertificate(null); if (diplomaRef.current) diplomaRef.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                      {errors.diploma && <div className=\"text-xs text-red-600 mt-1\">{errors.diploma}</div>}\r\n                      <p className=\"text-[10px] text-slate-400 mt-1 italic\">If certificate not available, upload combined marksheets below.</p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Optional Degree</label>\r\n                      <input ref={bachelorRef} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setBachelorDegree(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {bachelorDegree && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {bachelorDegree instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{bachelorDegree.name}</span> : <a href={`${BACKEND_URL}${bachelorDegree}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setBachelorDegree(null); if (bachelorRef.current) bachelorRef.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">12th Standard Marksheet <span className=\"text-red-500\">*</span></label>\r\n                      <input ref={c12Ref} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setClass12Marksheet(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {class12Marksheet && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {class12Marksheet instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{class12Marksheet.name}</span> : <a href={`${BACKEND_URL}${class12Marksheet}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setClass12Marksheet(null); if (c12Ref.current) c12Ref.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                      {errors.class12 && <div className=\"text-xs text-red-600 mt-1\">{errors.class12}</div>}\r\n                    </div>\r\n\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Bachelor Degree {eduType === 'Bachelor' && <span className=\"text-red-500\">*</span>}</label>\r\n                      <input ref={bachelorRef} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setBachelorDegree(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {bachelorDegree && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {bachelorDegree instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{bachelorDegree.name}</span> : <a href={`${BACKEND_URL}${bachelorDegree}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setBachelorDegree(null); if (bachelorRef.current) bachelorRef.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                      {errors.bachelor && <div className=\"text-xs text-red-600 mt-1\">{errors.bachelor}</div>}\r\n                    </div>\r\n\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Master Degree (Optional)</label>\r\n                      <input ref={masterRef} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setMasterDegree(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {masterDegree && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {masterDegree instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{masterDegree.name}</span> : <a href={`${BACKEND_URL}${masterDegree}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setMasterDegree(null); if (masterRef.current) masterRef.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n\r\n              {/* Alternative */}\r\n              <div className=\"mt-6 pt-4 border-t border-slate-100\">\r\n                <h5 className=\"text-xs font-bold text-slate-500 uppercase tracking-wide mb-3\">Alternative: Last 3 Semester Marksheets</h5>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                  {[ls1Ref, ls2Ref, ls3Ref].map((ref, i) => {\r\n                    const stateVal = i === 0 ? lastSem1 : i === 1 ? lastSem2 : lastSem3;\r\n                    const setter = i === 0 ? setLastSem1 : i === 1 ? setLastSem2 : setLastSem3;\r\n                    return (\r\n                      <div key={i} className=\"bg-white p-2 rounded border border-slate-200\">\r\n                        <label className=\"text-[10px] font-semibold text-slate-400 block mb-1\">Sem {i + 1} Marksheet</label>\r\n                        <input ref={ref} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setter(e.target.files[0])} className=\"block w-full text-[10px] text-slate-500 file:mr-1 file:py-0.5 file:px-2 file:rounded-full file:border-0 file:text-[10px] file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200\" />\r\n                        {stateVal && (\r\n                          <div className=\"mt-1 flex items-center justify-between\">\r\n                            {stateVal instanceof File ? <span className=\"text-[10px] text-slate-600 truncate max-w-[80px]\">{stateVal.name}</span> : <a href={`${BACKEND_URL}${stateVal}`} target=\"_blank\" className=\"text-[10px] text-blue-500 underline\">View</a>}\r\n                            <button type=\"button\" onClick={() => { setter(null); if (ref.current) ref.current.value = ''; }} className=\"text-red-400 font-bold ml-1 text-[10px]\">√ó</button>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )\r\n                  })}\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 6: Documents & Identity */}\r\n        {/* Step 6: Documents & Identity */}\r\n        {step === 6 && (\r\n          <div className=\"space-y-6\">\r\n            {/* Section 1: Education Documents Preview (Read-Only) */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Uploaded Education Documents</h4>\r\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                {[\r\n                  { label: '10th Marksheet', file: class10Marksheet },\r\n                  { label: '12th Marksheet', file: class12Marksheet, show: eduType !== 'Diploma' },\r\n                  { label: 'Diploma Cert', file: diplomaCertificate, show: eduType === 'Diploma' },\r\n                  { label: 'Bachelor Degree', file: bachelorDegree },\r\n                  { label: 'Master Degree', file: masterDegree },\r\n                  { label: 'Last Sem 1', file: lastSem1 },\r\n                  { label: 'Last Sem 2', file: lastSem2 },\r\n                  { label: 'Last Sem 3', file: lastSem3 },\r\n                ].map((item, idx) => {\r\n                  if (item.show === false || !item.file) return null;\r\n                  return (\r\n                    <div key={idx} className=\"bg-white border rounded p-3 flex flex-col items-center shadow-sm\">\r\n                      <div className=\"w-full h-24 bg-slate-100 mb-2 rounded overflow-hidden flex items-center justify-center border border-slate-200\">\r\n                        {renderFilePreview(item.file, item.label)}\r\n                      </div>\r\n                      <span className=\"text-xs font-semibold text-center text-slate-700 block truncate w-full\" title={item.label}>{item.label}</span>\r\n                    </div>\r\n                  );\r\n                })}\r\n                {/* Empty State if no docs */}\r\n                {![class10Marksheet, class12Marksheet, diplomaCertificate, bachelorDegree, masterDegree, lastSem1, lastSem2, lastSem3].some(f => f) && (\r\n                  <div className=\"col-span-full text-center text-sm text-slate-500 py-4 italic\">No education documents uploaded in Step 5.</div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section 2: Personal Identity (Aadhar/Pan) */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Identity Verification</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                {/* Aadhar Front */}\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Aadhar Front <span className=\"text-red-500\">*</span></label>\r\n                  <div className=\"bg-white p-3 rounded border border-slate-200 flex flex-col gap-3\">\r\n                    {aadharFront ? (\r\n                      <div className=\"relative group\">\r\n                        <div className=\"w-full h-32 bg-slate-100 rounded overflow-hidden border flex items-center justify-center\">\r\n                          {renderFilePreview(aadharFront, 'Aadhar Front')}\r\n                        </div>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => { setAadharFront(null); if (aadharFrontRef.current) aadharFrontRef.current.value = ''; }}\r\n                          className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600 opacity-0 group-hover:opacity-100 transition\"\r\n                        >\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\"></path></svg>\r\n                        </button>\r\n                      </div>\r\n                    ) : (\r\n                      <label className=\"flex flex-col items-center justify-center h-32 border-2 border-dashed border-slate-300 rounded cursor-pointer hover:bg-slate-50 transition\">\r\n                        <div className=\"text-center\">\r\n                          <svg className=\"mx-auto h-8 w-8 text-slate-400\" stroke=\"currentColor\" fill=\"none\" viewBox=\"0 0 48 48\"><path d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" /></svg>\r\n                          <p className=\"mt-1 text-xs text-slate-500\">Upload Front</p>\r\n                        </div>\r\n                        <input ref={aadharFrontRef} type=\"file\" className=\"hidden\" accept=\"image/*,application/pdf\" onChange={e => setAadharFront(e.target.files[0])} />\r\n                      </label>\r\n                    )}\r\n                    {errors.aadharFront && <div className=\"text-xs text-red-600\">{errors.aadharFront}</div>}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Aadhar Back */}\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Aadhar Back <span className=\"text-red-500\">*</span></label>\r\n                  <div className=\"bg-white p-3 rounded border border-slate-200 flex flex-col gap-3\">\r\n                    {aadharBack ? (\r\n                      <div className=\"relative group\">\r\n                        <div className=\"w-full h-32 bg-slate-100 rounded overflow-hidden border flex items-center justify-center\">\r\n                          {renderFilePreview(aadharBack, 'Aadhar Back')}\r\n                        </div>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => { setAadharBack(null); if (aadharBackRef.current) aadharBackRef.current.value = ''; }}\r\n                          className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600 opacity-0 group-hover:opacity-100 transition\"\r\n                        >\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\"></path></svg>\r\n                        </button>\r\n                      </div>\r\n                    ) : (\r\n                      <label className=\"flex flex-col items-center justify-center h-32 border-2 border-dashed border-slate-300 rounded cursor-pointer hover:bg-slate-50 transition\">\r\n                        <div className=\"text-center\">\r\n                          <svg className=\"mx-auto h-8 w-8 text-slate-400\" stroke=\"currentColor\" fill=\"none\" viewBox=\"0 0 48 48\"><path d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" /></svg>\r\n                          <p className=\"mt-1 text-xs text-slate-500\">Upload Back</p>\r\n                        </div>\r\n                        <input ref={aadharBackRef} type=\"file\" className=\"hidden\" accept=\"image/*,application/pdf\" onChange={e => setAadharBack(e.target.files[0])} />\r\n                      </label>\r\n                    )}\r\n                    {errors.aadharBack && <div className=\"text-xs text-red-600\">{errors.aadharBack}</div>}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* PAN Card */}\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700 block mb-2\">PAN Card <span className=\"text-red-500\">*</span></label>\r\n                  <div className=\"bg-white p-3 rounded border border-slate-200 flex flex-col gap-3\">\r\n                    {panCard ? (\r\n                      <div className=\"relative group\">\r\n                        <div className=\"w-full h-32 bg-slate-100 rounded overflow-hidden border flex items-center justify-center\">\r\n                          {renderFilePreview(panCard, 'PAN Card')}\r\n                        </div>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => { setPanCard(null); if (panRef.current) panRef.current.value = ''; }}\r\n                          className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600 opacity-0 group-hover:opacity-100 transition\"\r\n                        >\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\"></path></svg>\r\n                        </button>\r\n                      </div>\r\n                    ) : (\r\n                      <label className=\"flex flex-col items-center justify-center h-32 border-2 border-dashed border-slate-300 rounded cursor-pointer hover:bg-slate-50 transition\">\r\n                        <div className=\"text-center\">\r\n                          <svg className=\"mx-auto h-8 w-8 text-slate-400\" stroke=\"currentColor\" fill=\"none\" viewBox=\"0 0 48 48\"><path d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" /></svg>\r\n                          <p className=\"mt-1 text-xs text-slate-500\">Upload PAN</p>\r\n                        </div>\r\n                        <input ref={panRef} type=\"file\" className=\"hidden\" accept=\"image/*,application/pdf\" onChange={e => setPanCard(e.target.files[0])} />\r\n                      </label>\r\n                    )}\r\n                    {errors.panCard && <div className=\"text-xs text-red-600\">{errors.panCard}</div>}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 7: Account Credentials */}\r\n        {step === 7 && (\r\n          <div className=\"bg-slate-50 p-6 rounded-lg border border-slate-200 shadow-sm\">\r\n            <h3 className=\"text-lg font-bold text-slate-800 border-b border-slate-200 pb-3 mb-6 flex items-center gap-2\">\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\" /></svg>\r\n              Account Credentials\r\n            </h3>\r\n\r\n            <div className=\"bg-white p-4 rounded-lg flex items-center justify-between border border-blue-100 shadow-sm\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"bg-blue-50 p-2 rounded-full\">\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2\" /></svg>\r\n                </div>\r\n                <div>\r\n                  <span className=\"text-xs text-blue-600 font-bold uppercase tracking-wider block mb-1\">Employee ID</span>\r\n                  <span className=\"text-2xl font-bold text-slate-800 tracking-tight\">{employeeCode || (employee?.employeeId ? employee.employeeId : 'Generating...')}</span>\r\n                </div>\r\n                {(!employeeCode && !employee?.employeeId) || employeeCode.startsWith('Error') ? (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => { setEmployeeCode('Generating...'); loadEmployeeCodePreview(); }}\r\n                    className=\"text-xs bg-white border border-blue-200 text-blue-600 px-3 py-1.5 rounded hover:bg-blue-50 font-medium transition\"\r\n                  >\r\n                    Retry\r\n                  </button>\r\n                ) : null}\r\n              </div>\r\n              <div className=\"text-xs text-slate-500 max-w-xs text-right hidden sm:block leading-relaxed bg-slate-100 p-2 rounded border border-slate-200\">\r\n                <span className=\"font-semibold text-slate-700\">Auto-Generated:</span> Based on company prefix, department code, and sequence number.\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-2 gap-6 mt-6\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-slate-700 mb-2\">Login Email <span className=\"text-red-500\">*</span></label>\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                    <svg className=\"h-5 w-5 text-slate-400\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\r\n                      <path d=\"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z\" />\r\n                      <path d=\"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z\" />\r\n                    </svg>\r\n                  </div>\r\n                  <input\r\n                    type=\"email\"\r\n                    value={email}\r\n                    onChange={e => setEmail(e.target.value)}\r\n                    className={`w-full pl-10 p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none ${errors.email ? 'border-red-500 bg-red-50' : 'border-slate-300 bg-white'}`}\r\n                    placeholder=\"employee@company.com\"\r\n                    disabled={viewOnly && step !== 7}\r\n                  />\r\n                </div>\r\n                {errors.email && <p className=\"text-red-600 text-xs mt-1 font-medium\">{errors.email}</p>}\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-slate-700 mb-2\">Login Password <span className=\"text-red-500\">*</span></label>\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                    <svg className=\"h-5 w-5 text-slate-400\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\r\n                      <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </div>\r\n                  <input\r\n                    type={showPassword ? \"text\" : \"password\"}\r\n                    value={password}\r\n                    onChange={e => setPassword(e.target.value)}\r\n                    className={`w-full pl-10 p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none ${errors.password ? 'border-red-500 bg-red-50' : 'border-slate-300 bg-white'}`}\r\n                    placeholder=\"Create strong password\"\r\n                    disabled={viewOnly && step !== 7}\r\n                  />\r\n                  <button type=\"button\" onClick={() => setShowPassword(!showPassword)} className=\"absolute right-3 top-2.5 text-slate-400 hover:text-slate-600 transition\">\r\n                    {showPassword ? (\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21\" /></svg>\r\n                    ) : (\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg>\r\n                    )}\r\n                  </button>\r\n                </div>\r\n                {errors.password && <p className=\"text-red-600 text-xs mt-1 font-medium\">{errors.password}</p>}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        {/* Step 8: Payroll / Compensation */}\r\n        {step === 8 && (\r\n          <div className=\"bg-slate-50 p-6 rounded-lg border border-slate-200 shadow-sm space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center border-b border-slate-200 pb-3\">\r\n              <h3 className=\"text-lg font-bold text-slate-800 flex items-center gap-2\">\r\n                <IndianRupee className=\"w-5 h-5 text-emerald-600\" />\r\n                Payroll / Compensation\r\n              </h3>\r\n              <span className=\"px-3 py-1 bg-emerald-100 text-emerald-800 rounded-full text-xs font-semibold\">\r\n                {salaryStatus}\r\n              </span>\r\n            </div>\r\n\r\n            {/* Form Fields */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\r\n                  Salary Template <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <select\r\n                  className={`w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white ${errors.salaryTemplate ? 'border-red-500' : 'border-slate-300'}`}\r\n                  value={salaryTemplateId}\r\n                  onChange={handleTemplateChange}\r\n                >\r\n                  <option value=\"\">-- Select Template --</option>\r\n                  {salaryTemplates.map(t => (\r\n                    <option key={t._id} value={t._id}>{t.name} (CTC: {t.annualCTC})</option>\r\n                  ))}\r\n                </select>\r\n                {errors.salaryTemplate && <p className=\"text-red-600 text-xs mt-1\">{errors.salaryTemplate}</p>}\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\r\n                  Effective From <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  className={`w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white ${errors.effectiveDate ? 'border-red-500' : 'border-slate-300'}`}\r\n                  value={salaryEffectiveDate}\r\n                  onChange={e => setSalaryEffectiveDate(e.target.value)}\r\n                />\r\n                {errors.effectiveDate && <p className=\"text-red-600 text-xs mt-1\">{errors.effectiveDate}</p>}\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-slate-700 mb-2\">Pay Frequency</label>\r\n                <input type=\"text\" value=\"Monthly\" disabled className=\"w-full p-2.5 border border-slate-200 bg-slate-100 text-slate-500 rounded-lg cursor-not-allowed\" />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-slate-700 mb-2\">Status</label>\r\n                <div className=\"flex items-center gap-4\">\r\n                  <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                    <input type=\"radio\" name=\"salaryStatus\" value=\"Active\" checked={salaryStatus === 'Active'} onChange={e => setSalaryStatus(e.target.value)} />\r\n                    <span className=\"text-sm\">Active</span>\r\n                  </label>\r\n                  <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                    <input type=\"radio\" name=\"salaryStatus\" value=\"Inactive\" checked={salaryStatus === 'Inactive'} onChange={e => setSalaryStatus(e.target.value)} />\r\n                    <span className=\"text-sm\">Inactive</span>\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Preview Section */}\r\n            {selectedTemplateDetails && (\r\n              <div className=\"bg-white p-4 rounded border border-slate-200 mt-4\">\r\n                <h4 className=\"text-sm font-bold text-slate-700 uppercase tracking-wide mb-3 border-b pb-2\">Compensation Preview</h4>\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\r\n                  <div className=\"bg-slate-50 p-2 rounded\">\r\n                    <div className=\"text-xs text-slate-500\">Annual CTC</div>\r\n                    <div className=\"font-bold text-slate-800\">‚Çπ{selectedTemplateDetails.annualCTC?.toLocaleString()}</div>\r\n                  </div>\r\n                  <div className=\"bg-slate-50 p-2 rounded\">\r\n                    <div className=\"text-xs text-slate-500\">Monthly Gross</div>\r\n                    <div className=\"font-bold text-slate-800\">‚Çπ{selectedTemplateDetails.monthlyGross?.toLocaleString()}</div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <h5 className=\"text-xs font-bold text-green-700 mb-2\">Earnings</h5>\r\n                    <ul className=\"text-xs space-y-1\">\r\n                      {selectedTemplateDetails.earnings.map((e, i) => (\r\n                        <li key={i} className=\"flex justify-between\">\r\n                          <span>{e.salaryComponentId?.name || 'Component'}</span>\r\n                          <span className=\"font-mono\">‚Çπ{e.monthlyAmount?.toLocaleString()}</span>\r\n                        </li>\r\n                      ))}\r\n                    </ul>\r\n                  </div>\r\n                  <div>\r\n                    <h5 className=\"text-xs font-bold text-red-700 mb-2\">Deductions</h5>\r\n                    <ul className=\"text-xs space-y-1\">\r\n                      {selectedTemplateDetails.deductions.map((d, i) => (\r\n                        <li key={i} className=\"flex justify-between\">\r\n                          <span>{d.salaryComponentId?.name || 'Component'}</span>\r\n                          <span className=\"font-mono\">‚Çπ{d.monthlyAmount?.toLocaleString()}</span>\r\n                        </li>\r\n                      ))}\r\n                    </ul>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex justify-end pt-4\">\r\n              {!viewOnly && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={saveSalaryAssignment}\r\n                  className=\"px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 flex items-center gap-2 text-sm font-medium\"\r\n                  disabled={saving}\r\n                >\r\n                  {saving ? 'Saving...' : 'Save Assignment'}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Navigation Buttons */}\r\n        <div className=\"flex justify-between gap-2 mt-6 pt-4 border-t border-slate-200\">\r\n          <button type=\"button\" onClick={() => step > 1 ? handlePrev() : onClose()} className=\"px-5 py-2.5 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition shadow-sm\">{step > 1 ? 'Previous' : (viewOnly ? 'Close' : 'Cancel')}</button>\r\n\r\n          <div className=\"flex gap-3\">\r\n\r\n            {(!viewOnly) && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={(e) => saveDraft(e)}\r\n                className=\"px-5 py-2.5 bg-amber-50 text-amber-700 border border-amber-200 rounded-lg hover:bg-amber-100 font-medium transition shadow-sm\"\r\n                disabled={saving}\r\n              >\r\n                Save as Draft\r\n              </button>\r\n            )}\r\n\r\n            {step < 8 ? (\r\n              <button\r\n                type=\"button\"\r\n                onClick={(e) => { e.preventDefault(); handleNext(); }}\r\n                className=\"px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium shadow-md hover:shadow-lg transition flex items-center gap-2\"\r\n              >\r\n                Next\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" /></svg>\r\n              </button>\r\n            ) : (\r\n              (!viewOnly) ? (\r\n                <button\r\n                  onClick={(e) => submit(e)}\r\n                  disabled={saving}\r\n                  className=\"px-6 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium shadow-md hover:shadow-lg transition flex items-center gap-2\"\r\n                >\r\n                  {saving ? 'Saving...' : 'Finish & Close'}\r\n                  {!saving && <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" /></svg>}\r\n                </button>\r\n              ) : (\r\n                <button type=\"button\" onClick={onClose} className=\"px-5 py-2.5 bg-slate-800 text-white rounded-lg hover:bg-slate-900 font-medium shadow-sm\">Close</button>\r\n              )\r\n            )}\r\n          </div>\r\n        </div>\r\n      </form>\r\n\r\n      {/* View Only Overlay style for inputs */}\r\n      {viewOnly && (\r\n        <style>{`\r\n          .employee-form input, .employee-form select, .employee-form textarea {\r\n             pointer-events: none;\r\n             background-color: #f8fafc;\r\n             color: #475569;\r\n          }\r\n          .employee-form input[type=\"file\"] {\r\n             display: none;\r\n          }\r\n           /* Keep buttons clickable */\r\n           .employee-form button { pointer-events: auto; }\r\n           .employee-form a { pointer-events: auto; }\r\n        `}</style>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Helper components for EmployeeProfileView\r\nconst InfoItem = ({ label, value }) => (\r\n  <div className=\"mb-4\">\r\n    <span className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1\">{label}</span>\r\n    <span className=\"text-sm font-medium text-slate-900 break-words\">{value || '-'}</span>\r\n  </div>\r\n);\r\n\r\nconst SectionTitle = ({ title, icon }) => (\r\n  <h3 className=\"text-lg font-bold text-slate-800 border-b border-slate-200 pb-3 mb-4 flex items-center gap-2\">\r\n    {icon} {title}\r\n  </h3>\r\n);\r\n\r\nconst FileLink = ({ url, label }) => {\r\n  if (!url) return <span className=\"text-slate-400 text-sm italic py-1 block\">Not uploaded</span>;\r\n  return (\r\n    <a href={`${BACKEND_URL}${url}`} target=\"_blank\" rel=\"noreferrer\" className=\"flex items-center gap-3 text-blue-600 hover:text-blue-800 bg-blue-50 px-3 py-2 rounded-lg transition border border-blue-100 hover:border-blue-200 mb-2\">\r\n      <div className=\"bg-white p-1 rounded text-blue-500\">\r\n        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" /></svg>\r\n      </div>\r\n      <span className=\"text-sm font-medium truncate flex-1\">{label || 'View Document'}</span>\r\n      <svg className=\"w-4 h-4 opacity-50\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\" /></svg>\r\n    </a>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\EmployeeProfile.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Employees.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'formatDateDDMMYYYY' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"formatDateDDMMYYYY"},"fix":{"range":[119,178],"text":""},"desc":"Remove unused variable 'formatDateDDMMYYYY'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPolicies'. Either include it or remove the dependency array.","line":759,"column":6,"nodeType":"ArrayExpression","endLine":759,"endColumn":78,"suggestions":[{"desc":"Update the dependencies array to be: [loadDepartments, loadManagers, loadEmployeeCodePreview, step, employee, loadPolicies]","fix":{"range":[43617,43689],"text":"[loadDepartments, loadManagers, loadEmployeeCodePreview, step, employee, loadPolicies]"}}]},{"ruleId":"no-undef","severity":2,"message":"'notification' is not defined.","line":1301,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":1301,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'notification' is not defined.","line":1427,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":1427,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'notification' is not defined.","line":1431,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":1431,"endColumn":19}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback, useMemo, useRef } from 'react';\r\nimport api from '../../utils/api';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\nimport { DatePicker, Pagination } from 'antd';\r\nimport { showToast, showConfirmToast } from '../../utils/uiNotifications';\r\nimport dayjs from 'dayjs';\r\n\r\nconst BACKEND_URL = import.meta.env.VITE_BACKEND_URL || 'https://hrms.gitakshmi.com';\r\n\r\nconst DEPARTMENTS = [\"HR\", \"Tech\", \"Accounts\", \"Admin\"];\r\n\r\nconst NATIONALITIES = [\r\n  \"Afghan\", \"Albanian\", \"Algerian\", \"American\", \"Andorran\", \"Angolan\", \"Antiguans\", \"Argentinean\", \"Armenian\", \"Australian\", \"Austrian\", \"Azerbaijani\", \"Bahamian\", \"Bahraini\", \"Bangladeshi\", \"Barbadian\", \"Barbudans\", \"Batswana\", \"Belarusian\", \"Belgian\", \"Belizean\", \"Beninese\", \"Bhutanese\", \"Bolivian\", \"Bosnian\", \"Brazilian\", \"British\", \"Bruneian\", \"Bulgarian\", \"Burkinabe\", \"Burmese\", \"Burundian\", \"Cambodian\", \"Cameroonian\", \"Canadian\", \"Cape Verdean\", \"Central African\", \"Chadian\", \"Chilean\", \"Chinese\", \"Colombian\", \"Comoran\", \"Congolese\", \"Costa Rican\", \"Croatian\", \"Cuban\", \"Cypriot\", \"Czech\", \"Danish\", \"Djibouti\", \"Dominican\", \"Dutch\", \"East Timorese\", \"Ecuadorean\", \"Egyptian\", \"Emirian\", \"Equatorial Guinean\", \"Eritrean\", \"Estonian\", \"Ethiopian\", \"Fijian\", \"Filipino\", \"Finnish\", \"French\", \"Gabonese\", \"Gambian\", \"Georgian\", \"German\", \"Ghanaian\", \"Greek\", \"Grenadian\", \"Guatemalan\", \"Guinea-Bissauan\", \"Guinean\", \"Guyanese\", \"Haitian\", \"Herzegovinian\", \"Honduran\", \"Hungarian\", \"I-Kiribati\", \"Icelander\", \"Indian\", \"Indonesian\", \"Iranian\", \"Iraqi\", \"Irish\", \"Israeli\", \"Italian\", \"Ivorian\", \"Jamaican\", \"Japanese\", \"Jordanian\", \"Kazakhstani\", \"Kenyan\", \"Kittian and Nevisian\", \"Kuwaiti\", \"Kyrgyz\", \"Laotian\", \"Latvian\", \"Lebanese\", \"Liberian\", \"Libyan\", \"Liechtensteiner\", \"Lithuanian\", \"Luxembourger\", \"Macedonian\", \"Malagasy\", \"Malawian\", \"Malaysian\", \"Maldivan\", \"Malian\", \"Maltese\", \"Marshallese\", \"Mauritanian\", \"Mauritian\", \"Mexican\", \"Micronesian\", \"Moldovan\", \"Monacan\", \"Mongolian\", \"Moroccan\", \"Mosotho\", \"Motswana\", \"Mozambican\", \"Namibian\", \"Nauruan\", \"Nepalese\", \"New Zealander\", \"Ni-Vanuatu\", \"Nicaraguan\", \"Nigerian\", \"Nigerien\", \"North Korean\", \"Northern Irish\", \"Norwegian\", \"Omani\", \"Pakistani\", \"Palauan\", \"Panamanian\", \"Papua New Guinean\", \"Paraguayan\", \"Peruvian\", \"Polish\", \"Portuguese\", \"Qatari\", \"Romanian\", \"Russian\", \"Rwandan\", \"Saint Lucian\", \"Salvadoran\", \"Samoan\", \"San Marinese\", \"Sao Tomean\", \"Saudi\", \"Scottish\", \"Senegalese\", \"Serbian\", \"Seychellois\", \"Sierra Leonean\", \"Singaporean\", \"Slovakian\", \"Slovenian\", \"Solomon Islander\", \"Somali\", \"South African\", \"South Korean\", \"Spanish\", \"Sri Lankan\", \"Sudanese\", \"Surinamer\", \"Swazi\", \"Swedish\", \"Swiss\", \"Syrian\", \"Taiwanese\", \"Tajik\", \"Tanzanian\", \"Thai\", \"Togolese\", \"Tongan\", \"Trinidadian or Tobagonian\", \"Tunisian\", \"Turkish\", \"Tuvaluan\", \"Ugandan\", \"Ukrainian\", \"Uruguayan\", \"Uzbekistani\", \"Venezuelan\", \"Vietnamese\", \"Welsh\", \"Yemenite\", \"Zambian\", \"Zimbabwean\"\r\n];\r\n\r\nimport ApplyLeaveForm from '../../components/ApplyLeaveForm';\r\nimport SalaryAssignmentModal from '../../components/Payroll/SalaryAssignmentModal';\r\nimport EmployeeProfileView from '../../components/EmployeeProfileView';\r\nimport { Calendar as CalendarIcon, User, Search, Filter, Plus, FileText, Edit2, Trash2, Eye, IndianRupee } from 'lucide-react';\r\n\r\nexport default function Employees() {\r\n  const [employees, setEmployees] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [openForm, setOpenForm] = useState(false);\r\n  const [editing, setEditing] = useState(null);\r\n  const [viewing, setViewing] = useState(null);\r\n  const [applyingLeave, setApplyingLeave] = useState(null);\r\n  const [assigningSalary, setAssigningSalary] = useState(null); // New state //\r\n  const [selectedDepartment, setSelectedDepartment] = useState('');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [showDrafts, setShowDrafts] = useState(false);\r\n  const [drafts, setDrafts] = useState([]);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const pageSize = 10;\r\n\r\n  // Joining Letter State\r\n  const [showJoiningModal, setShowJoiningModal] = useState(false);\r\n  const [selectedEmpForJoining, setSelectedEmpForJoining] = useState(null);\r\n  const [joiningTemplateId, setJoiningTemplateId] = useState('');\r\n  const [joiningTemplates, setJoiningTemplates] = useState([]);\r\n  const [generatingJoining, setGeneratingJoining] = useState(false);\r\n  const [joiningPreviewUrl, setJoiningPreviewUrl] = useState(null);\r\n  const [showJoiningPreview, setShowJoiningPreview] = useState(false);\r\n\r\n  async function loadDrafts() {\r\n    try {\r\n      const res = await api.get('/hr/employees?status=Draft');\r\n      setDrafts(res.data?.data || res.data || []);\r\n    } catch (err) { console.error('Failed to load drafts', err); }\r\n  }\r\n\r\n  async function load() {\r\n    setLoading(true);\r\n    try {\r\n      const url = '/hr/employees'; // Removed department filter param\r\n      const res = await api.get(url);\r\n      const data = res.data?.data || res.data || [];\r\n      setEmployees(data);\r\n    } catch (err) {\r\n      console.error(err);\r\n      showToast('error', 'Error', 'Failed to load employees');\r\n    } finally { setLoading(false); }\r\n  }\r\n\r\n  useEffect(() => {\r\n    load();\r\n    async function fetchJoiningTemplates() {\r\n      try {\r\n        const res = await api.get('/letters/templates?type=joining');\r\n        setJoiningTemplates(res.data || []);\r\n      } catch (err) { console.error(\"Failed to load joining templates\", err); }\r\n    }\r\n    fetchJoiningTemplates();\r\n  }, []); // Removed selectedDepartment dependency\r\n\r\n  // Helper to derive a readable display name from various possible fields\r\n  function getDisplayName(emp) {\r\n    if (!emp) return '';\r\n    const parts = [];\r\n    if (emp.firstName) parts.push(emp.firstName);\r\n    if (emp.middleName) parts.push(emp.middleName.charAt(0).toUpperCase() + '.');\r\n    if (emp.lastName) parts.push(emp.lastName);\r\n    if (parts.length) return parts.join(' ');\r\n    if (emp.name) return emp.name;\r\n    if (emp.fullName) return emp.fullName;\r\n    if (emp.displayName) return emp.displayName;\r\n    // fallback to email or id\r\n    return emp.email || emp.employeeId || '';\r\n  }\r\n\r\n  function openNew() { setEditing(null); setViewing(null); setOpenForm(true); }\r\n  function openEdit(e) { setEditing(e); setViewing(null); setOpenForm(true); }\r\n  function openView(e) { setEditing(e); setViewing(true); setOpenForm(true); }\r\n\r\n  function remove(id) {\r\n    showConfirmToast({\r\n      title: 'Confirm Deletion',\r\n      description: 'Are you sure you want to delete this employee? This action cannot be undone.',\r\n      okText: 'OK',\r\n      cancelText: 'Cancel',\r\n      danger: true,\r\n      onConfirm: async () => {\r\n        try {\r\n          await api.delete(`/hr/employees/${id}`);\r\n          load();\r\n          showToast('success', 'Success', 'Employee deleted successfully');\r\n        } catch (err) {\r\n          console.error(err);\r\n          showToast('error', 'Error', 'Delete failed');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  const openJoiningModal = (emp) => {\r\n    setSelectedEmpForJoining(emp);\r\n    setJoiningTemplateId('');\r\n    setShowJoiningModal(true);\r\n    setJoiningPreviewUrl(null);\r\n    setShowJoiningPreview(false);\r\n  };\r\n\r\n  const handleJoiningPreview = async () => {\r\n    if (!joiningTemplateId) { alert('Please select a Joining Letter Template'); return; }\r\n    setGeneratingJoining(true);\r\n    try {\r\n      const res = await api.post('/letters/preview-joining', {\r\n        employeeId: selectedEmpForJoining._id,\r\n        templateId: joiningTemplateId\r\n      });\r\n      if (res.data.previewUrl) {\r\n        const url = `${BACKEND_URL}${res.data.previewUrl}`;\r\n        setJoiningPreviewUrl(url);\r\n        setShowJoiningPreview(true);\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Failed to preview joining letter: ' + (err.response?.data?.message || err.message));\r\n    } finally { setGeneratingJoining(false); }\r\n  };\r\n\r\n  const handleJoiningGenerate = async () => {\r\n    if (!joiningTemplateId) { alert('Please select a Joining Letter Template'); return; }\r\n    setGeneratingJoining(true);\r\n    try {\r\n      const res = await api.post('/letters/generate-joining', {\r\n        employeeId: selectedEmpForJoining._id,\r\n        templateId: joiningTemplateId\r\n      });\r\n      if (res.data.downloadUrl) {\r\n        const url = `${BACKEND_URL}${res.data.downloadUrl}`;\r\n        window.open(url, '_blank');\r\n        setShowJoiningModal(false);\r\n        alert('Joining Letter generated successfully!');\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Failed to generate joining letter: ' + (err.response?.data?.message || err.message));\r\n    } finally { setGeneratingJoining(false); }\r\n  };\r\n\r\n  if (openForm) {\r\n    if (viewing) {\r\n      return (\r\n        <div className=\"space-y-6\">\r\n          <div className=\"flex items-center gap-4 hidden-print\">\r\n            <button onClick={() => setOpenForm(false)} className=\"p-2 hover:bg-slate-100 rounded-full transition\" title=\"Back\">\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 text-slate-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n              </svg>\r\n            </button>\r\n            <h1 className=\"text-3xl font-bold text-slate-900\">Employee Profile</h1>\r\n          </div>\r\n          <EmployeeProfileView employee={editing} />\r\n        </div>\r\n      );\r\n    }\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <button onClick={() => setOpenForm(false)} className=\"p-2 hover:bg-slate-100 rounded-full transition\" title=\"Back\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 text-slate-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n          </button>\r\n          <h1 className=\"text-3xl font-bold text-slate-900\">{editing ? 'Edit Employee' : 'Add New Employee'}</h1>\r\n        </div>\r\n        <EmployeeForm\r\n          employee={editing}\r\n          viewOnly={false}\r\n          onClose={() => { setOpenForm(false); load(); }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4 sm:space-y-6\">\r\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-0\">\r\n        <h1 className=\"text-2xl sm:text-3xl font-bold text-slate-900\">Employees</h1>\r\n        <div className=\"flex flex-col sm:flex-row gap-2 w-full sm:w-auto\">\r\n          <button\r\n            onClick={() => { setShowDrafts(!showDrafts); if (!showDrafts) loadDrafts(); }}\r\n            className={`px-4 py-2 rounded-lg transition shadow-md border text-sm sm:text-base w-full sm:w-auto ${showDrafts ? 'bg-slate-200 text-slate-800 border-slate-300' : 'bg-white text-slate-700 border-slate-300 hover:bg-slate-50'}`}\r\n          >\r\n            {showDrafts ? 'Hide Drafts' : 'Drafts'}\r\n          </button>\r\n          <button onClick={openNew} className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md text-sm sm:text-base w-full sm:w-auto\">+ Add Employee</button>\r\n        </div>\r\n      </div>\r\n\r\n      {showDrafts && (\r\n        <div className=\"bg-amber-50 rounded-lg border border-amber-200 shadow-sm p-4 mb-6\">\r\n          <h3 className=\"text-lg font-semibold text-amber-900 mb-3 flex items-center gap-2\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" />\r\n            </svg>\r\n            Draft Applications\r\n          </h3>\r\n          {drafts.length === 0 ? (\r\n            <div className=\"text-amber-700 text-sm\">No drafts found.</div>\r\n          ) : (\r\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              {drafts.map(d => (\r\n                <div key={d._id} onClick={() => { setEditing(d); setViewing(null); setOpenForm(true); setShowDrafts(false); }} className=\"bg-white p-3 rounded border border-amber-200 cursor-pointer hover:shadow-md transition group\">\r\n                  <div className=\"flex justify-between items-start\">\r\n                    <div>\r\n                      <div className=\"font-semibold text-slate-800 group-hover:text-blue-600\">\r\n                        {d.firstName ? `${d.firstName} ${d.lastName || ''}` : 'Untitled Draft'}\r\n                      </div>\r\n                      <div className=\"text-xs text-slate-500 mt-1\">\r\n                        {d.email || 'No email'} ‚Ä¢ Step {d.lastStep || 1}\r\n                      </div>\r\n                    </div>\r\n                    <span className=\"text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full\">Draft</span>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden\">\r\n        <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 px-4 py-3 border-b border-slate-200\">\r\n          <select\r\n            value={selectedDepartment}\r\n            onChange={(e) => setSelectedDepartment(e.target.value)}\r\n            className=\"px-3 py-2 border border-slate-300 rounded-lg text-sm bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none w-full sm:w-auto\"\r\n          >\r\n            <option value=\"\">All Departments</option>\r\n            {DEPARTMENTS.map((d) => (\r\n              <option key={d} value={d}>{d}</option>\r\n            ))}\r\n          </select>\r\n          <div className=\"relative flex-1 max-w-md\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Search employees...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"w-full pl-9 pr-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none\"\r\n            />\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-slate-400 absolute left-2.5 top-2.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n            </svg>\r\n          </div>\r\n        </div>\r\n        {loading ? (\r\n          <div className=\"p-8 text-center text-slate-500\">Loading employees...</div>\r\n        ) : employees.length === 0 ? (\r\n          <div className=\"p-8 text-center text-slate-500\">No employees yet. Add one to get started!</div>\r\n        ) : (\r\n          (() => {\r\n            const filteredEmployees = employees.filter(emp => {\r\n              if (selectedDepartment && emp.department !== selectedDepartment) return false;\r\n              if (!searchTerm) return true;\r\n              const term = searchTerm.toLowerCase();\r\n              const name = getDisplayName(emp).toLowerCase();\r\n              const email = (emp.email || '').toLowerCase();\r\n              const empId = (emp.employeeId || '').toLowerCase();\r\n              return name.includes(term) || email.includes(term) || empId.includes(term);\r\n            });\r\n            const paginatedEmployees = filteredEmployees.slice((currentPage - 1) * pageSize, currentPage * pageSize);\r\n\r\n            return (\r\n              <>\r\n                {/* Desktop/Tablet Table View */}\r\n                <div className=\"table-responsive mobile-card-hide\">\r\n                  <div className=\"inline-block min-w-full align-middle\">\r\n                    <table className=\"min-w-full text-left text-sm\">\r\n                      <thead className=\"bg-slate-50 border-b border-slate-200\">\r\n                        <tr>\r\n                          <th className=\"px-4 py-3 text-left font-semibold text-slate-700 whitespace-nowrap\">Name</th>\r\n                          <th className=\"px-4 py-3 text-left font-semibold text-slate-700 hidden md:table-cell whitespace-nowrap\">Emp ID</th>\r\n                          <th className=\"px-4 py-3 text-left font-semibold text-slate-700 hidden lg:table-cell whitespace-nowrap\">Email</th>\r\n                          <th className=\"px-4 py-3 text-left font-semibold text-slate-700 hidden xl:table-cell whitespace-nowrap\">Phone</th>\r\n                          <th className=\"px-4 py-3 text-left font-semibold text-slate-700 whitespace-nowrap\">Role</th>\r\n                          <th className=\"px-4 py-3 text-left font-semibold text-slate-700 hidden md:table-cell whitespace-nowrap\">Department</th>\r\n                          <th className=\"px-4 py-3 text-left font-semibold text-slate-700 hidden lg:table-cell whitespace-nowrap\">Manager</th>\r\n                          <th className=\"px-4 py-3 text-right font-semibold text-slate-700 whitespace-nowrap\">Actions</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"divide-y divide-slate-200 bg-white\">\r\n                        {paginatedEmployees.map(emp => (\r\n                          <tr key={emp._id} className=\"hover:bg-slate-50 transition\">\r\n                            <td className=\"px-4 py-3 font-medium text-slate-900 whitespace-nowrap\">\r\n                              <div className=\"flex items-center gap-2 sm:gap-3\">\r\n                                {emp.profilePic ? (\r\n                                  <img src={`${BACKEND_URL}${emp.profilePic}`} alt=\"\" className=\"w-8 h-8 rounded-full object-cover border border-slate-200 flex-shrink-0\" />\r\n                                ) : (\r\n                                  <div className=\"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-xs font-bold text-slate-500 border border-slate-200 flex-shrink-0\">\r\n                                    {emp.firstName?.[0]}{emp.lastName?.[0]}\r\n                                  </div>\r\n                                )}\r\n                                <div className=\"min-w-0 flex-1\">\r\n                                  <div className=\"truncate\">{getDisplayName(emp)}</div>\r\n                                  <div className=\"text-xs text-slate-500 md:hidden\">{emp.employeeId || '-'}</div>\r\n                                  <div className=\"text-xs text-slate-500 lg:hidden md:block hidden\">{emp.email}</div>\r\n                                </div>\r\n                              </div>\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-slate-600 hidden md:table-cell whitespace-nowrap\">{emp.employeeId || '-'}</td>\r\n                            <td className=\"px-4 py-3 text-slate-600 hidden lg:table-cell whitespace-nowrap\">{emp.email}</td>\r\n                            <td className=\"px-4 py-3 text-slate-600 hidden xl:table-cell whitespace-nowrap\">{emp.contactNo || emp.phone || '-'}</td>\r\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\r\n                              <span className=\"inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800\">\r\n                                {emp.role || '-'}\r\n                              </span>\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-slate-600 hidden md:table-cell whitespace-nowrap\">{emp.department || '-'}</td>\r\n                            <td className=\"px-4 py-3 text-slate-600 hidden lg:table-cell whitespace-nowrap\">\r\n                              {(() => {\r\n                                if (!emp.manager) return '-';\r\n                                if (typeof emp.manager === 'string') {\r\n                                  const m = employees.find(e => String(e._id) === String(emp.manager));\r\n                                  return m ? getDisplayName(m) : emp.manager;\r\n                                }\r\n                                if (emp.manager && typeof emp.manager === 'object') {\r\n                                  return getDisplayName(emp.manager) || (emp.manager._id ? String(emp.manager._id) : '-');\r\n                                }\r\n                                return '-';\r\n                              })()}\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-right whitespace-nowrap\">\r\n                              <div className=\"flex items-center justify-end gap-1 sm:gap-2\">\r\n                                <button onClick={() => openView(emp)} className=\"p-1.5 rounded hover:bg-slate-100 transition\" title=\"View Details\">\r\n                                  <Eye className=\"h-4 w-4 sm:h-5 sm:w-5 text-slate-600\" />\r\n                                </button>\r\n                                <button onClick={() => setApplyingLeave(emp)} className=\"p-1.5 rounded hover:bg-emerald-50 transition\" title=\"Apply Leave\" aria-label=\"Apply leave for employee\">\r\n                                  <CalendarIcon className=\"h-4 w-4 sm:h-5 sm:w-5 text-emerald-600\" />\r\n                                </button>\r\n                                <button onClick={() => setAssigningSalary(emp)} className=\"p-1.5 rounded hover:bg-purple-50 transition\" title=\"Assign Salary Structure\" aria-label=\"Assign Salary\">\r\n                                  <IndianRupee className=\"h-4 w-4 sm:h-5 sm:w-5 text-purple-600\" />\r\n                                </button>\r\n                                <button\r\n                                  onClick={() => openJoiningModal(emp)}\r\n                                  disabled={!emp.salaryLocked}\r\n                                  className={`p-1.5 rounded transition ${!emp.salaryLocked ? 'opacity-40 cursor-not-allowed grayscale' : 'hover:bg-amber-50'}`}\r\n                                  title={emp.salaryLocked ? \"Joining Letter\" : \"Lock salary in Salary Assignment first\"}\r\n                                  aria-label=\"Joining Letter\"\r\n                                >\r\n                                  <FileText className={`h-4 w-4 sm:h-5 sm:w-5 ${emp.salaryLocked ? 'text-amber-600' : 'text-slate-400'}`} />\r\n                                </button>\r\n                                <button onClick={() => openEdit(emp)} className=\"p-1.5 rounded hover:bg-blue-50 transition\" title=\"Edit\" aria-label=\"Edit employee\">\r\n                                  <Edit2 className=\"h-4 w-4 sm:h-5 sm:w-5 text-blue-600\" />\r\n                                </button>\r\n                                <button onClick={() => remove(emp._id)} className=\"p-1.5 rounded hover:bg-red-50 text-red-600 transition\" title=\"Delete\" aria-label=\"Delete employee\">\r\n                                  <Trash2 className=\"h-4 w-4 sm:h-5 sm:w-5\" />\r\n                                </button>\r\n                              </div>\r\n                            </td>\r\n                          </tr>\r\n                        ))}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Mobile Card View (<= 480px) */}\r\n                <div className=\"mobile-card-show bg-slate-50/50 divide-y divide-slate-200\">\r\n                  {paginatedEmployees.map(emp => (\r\n                    <div key={emp._id} className=\"p-4 bg-white space-y-4\">\r\n                      <div className=\"flex justify-between items-start\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          {emp.profilePic ? (\r\n                            <img src={`${BACKEND_URL}${emp.profilePic}`} alt=\"\" className=\"w-10 h-10 rounded-full object-cover border border-slate-200\" />\r\n                          ) : (\r\n                            <div className=\"h-10 w-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold text-sm border border-slate-200\">\r\n                              {emp.firstName?.[0]}{emp.lastName?.[0]}\r\n                            </div>\r\n                          )}\r\n                          <div>\r\n                            <div className=\"font-bold text-slate-900\">{getDisplayName(emp)}</div>\r\n                            <div className=\"text-[10px] text-slate-400 uppercase font-bold tracking-wider\">{emp.employeeId || 'NO ID'}</div>\r\n                          </div>\r\n                          <span className=\"px-2.5 py-1 text-[10px] font-bold rounded-full bg-blue-50 text-blue-700 border border-blue-100\">\r\n                            {emp.role || 'Employee'}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-4 py-3 border-y border-slate-50\">\r\n                        <div>\r\n                          <div className=\"text-[10px] text-slate-400 uppercase font-bold mb-1\">Department</div>\r\n                          <div className=\"text-xs font-semibold text-slate-700\">{emp.department || '-'}</div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                          <div className=\"text-[10px] text-slate-400 uppercase font-bold mb-1\">Phone</div>\r\n                          <div className=\"text-xs font-semibold text-slate-700\">{emp.contactNo || emp.phone || '-'}</div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex gap-2 pt-1 overflow-x-auto no-scrollbar pb-1\">\r\n                        <button onClick={() => openView(emp)} className=\"flex-1 py-2 bg-slate-50 text-slate-700 border border-slate-200 rounded-lg text-[10px] font-bold flex items-center justify-center gap-1.5 min-w-[80px]\">\r\n                          <Eye size={14} /> VIEW\r\n                        </button>\r\n                        <button onClick={() => setApplyingLeave(emp)} className=\"flex-1 py-2 bg-emerald-50 text-emerald-700 border border-emerald-100 rounded-lg text-[10px] font-bold flex items-center justify-center gap-1.5 min-w-[80px]\">\r\n                          <CalendarIcon size={14} /> LEAVE\r\n                        </button>\r\n                        <button onClick={() => setAssigningSalary(emp)} className=\"flex-1 py-2 bg-purple-50 text-purple-700 border border-purple-100 rounded-lg text-[10px] font-bold flex items-center justify-center gap-1.5 min-w-[80px]\">\r\n                          <IndianRupee size={14} /> SALARY\r\n                        </button>\r\n                        <button\r\n                          onClick={() => openJoiningModal(emp)}\r\n                          disabled={!emp.salaryLocked}\r\n                          className={`flex-1 py-2 border rounded-lg text-[10px] font-bold flex items-center justify-center gap-1.5 min-w-[80px] transition ${!emp.salaryLocked ? 'bg-slate-50 text-slate-400 border-slate-100 cursor-not-allowed opacity-50 grayscale' : 'bg-amber-50 text-amber-700 border-amber-100'}`}\r\n                        >\r\n                          <FileText size={14} /> JOINING\r\n                        </button>\r\n                        <button onClick={() => openEdit(emp)} className=\"flex-1 py-2 bg-blue-50 text-blue-700 border border-blue-100 rounded-lg text-[10px] font-bold flex items-center justify-center gap-1.5 min-w-[80px]\">\r\n                          <Edit2 size={14} /> EDIT\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n\r\n                <div className=\"px-4 sm:px-6 py-4 border-t border-slate-200 flex justify-center sm:justify-end bg-white\">\r\n                  <Pagination\r\n                    current={currentPage}\r\n                    pageSize={pageSize}\r\n                    total={filteredEmployees.length}\r\n                    onChange={(page) => setCurrentPage(page)}\r\n                    showSizeChanger={false}\r\n                    responsive={true}\r\n                    size=\"small\"\r\n                    className=\"text-xs sm:text-sm\"\r\n                  />\r\n                </div>\r\n              </>\r\n            );\r\n          })()\r\n        )}\r\n      </div >\r\n\r\n      {\r\n        applyingLeave && (\r\n          <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-300\">\r\n            <div className=\"w-full w-full max-h-[90vh] overflow-y-auto no-scrollbar rounded-3xl shadow-2xl animate-in zoom-in-95 duration-300\">\r\n              <ApplyLeaveForm\r\n                isHR={true}\r\n                targetEmployeeId={applyingLeave._id}\r\n                balances={[]}\r\n                onSuccess={() => {\r\n                  setApplyingLeave(null);\r\n                  load();\r\n                }}\r\n                onCancelEdit={() => setApplyingLeave(null)}\r\n                onClose={() => setApplyingLeave(null)}\r\n              />\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n\r\n      {/* Joining Letter Modal */}\r\n      {\r\n        showJoiningModal && (\r\n          <div className=\"fixed inset-0 z-[110] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]\">\r\n              <div className=\"px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-slate-50\">\r\n                <h2 className=\"text-xl font-bold text-slate-900\">Joining Letter - {getDisplayName(selectedEmpForJoining)}</h2>\r\n                <button onClick={() => setShowJoiningModal(false)} className=\"text-slate-400 hover:text-slate-600 transition\">\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" /></svg>\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"p-6 space-y-4 overflow-y-auto no-scrollbar\">\r\n                {!showJoiningPreview ? (\r\n                  <>\r\n                    <p className=\"text-sm text-slate-600\">Select a Joining Letter template to generate the document for this employee.</p>\r\n                    <div>\r\n                      <label className=\"block text-sm font-semibold text-slate-700 mb-1\">Select Template</label>\r\n                      <select\r\n                        className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                        value={joiningTemplateId}\r\n                        onChange={(e) => setJoiningTemplateId(e.target.value)}\r\n                      >\r\n                        <option value=\"\">Choose a template...</option>\r\n                        {joiningTemplates.map(t => (\r\n                          <option key={t._id} value={t._id}>{t.name}</option>\r\n                        ))}\r\n                      </select>\r\n                      {joiningTemplates.length === 0 && (\r\n                        <p className=\"mt-2 text-xs text-amber-600 bg-amber-50 p-2 rounded border border-amber-100 italic\">\r\n                          No joining letter templates found. Please upload one in <b>Letter Templates</b> section first.\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <div className=\"w-full h-[500px] border border-slate-200 rounded-lg overflow-hidden bg-slate-100 flex flex-col\">\r\n                    {joiningPreviewUrl ? (\r\n                      <iframe src={joiningPreviewUrl} title=\"Joining Letter Preview\" className=\"w-full flex-1\" />\r\n                    ) : (\r\n                      <div className=\"flex-1 flex items-center justify-center text-slate-500 italic\">Generating Preview...</div>\r\n                    )}\r\n                    <div className=\"p-3 bg-white border-t border-slate-200 flex justify-between gap-2\">\r\n                      <button\r\n                        onClick={() => setShowJoiningPreview(false)}\r\n                        className=\"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition text-sm font-medium\"\r\n                      >\r\n                        Back to Selection\r\n                      </button>\r\n                      <button\r\n                        onClick={handleJoiningGenerate}\r\n                        disabled={generatingJoining}\r\n                        className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md disabled:opacity-50 text-sm font-medium\"\r\n                      >\r\n                        {generatingJoining ? 'Downloading...' : 'Download Final PDF'}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {!showJoiningPreview && (\r\n                <div className=\"px-6 py-4 border-t border-slate-200 flex justify-end gap-3 bg-slate-50\">\r\n                  <button\r\n                    onClick={() => setShowJoiningModal(false)}\r\n                    className=\"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition text-sm font-medium\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    onClick={handleJoiningPreview}\r\n                    disabled={!joiningTemplateId || generatingJoining}\r\n                    className=\"px-4 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-900 transition shadow-md disabled:opacity-50 text-sm font-medium\"\r\n                  >\r\n                    {generatingJoining ? 'Generating...' : 'Preview Letter'}\r\n                  </button>\r\n                  <button\r\n                    onClick={handleJoiningGenerate}\r\n                    disabled={!joiningTemplateId || generatingJoining}\r\n                    className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md disabled:opacity-50 text-sm font-medium\"\r\n                  >\r\n                    {generatingJoining ? 'Processing...' : 'Generate & Download'}\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n\r\n      {/* Salary Assignment Modal */}\r\n      {\r\n        assigningSalary && (\r\n          <SalaryAssignmentModal\r\n            employee={assigningSalary}\r\n            onClose={() => setAssigningSalary(null)}\r\n            onSuccess={() => {\r\n              showToast('success', 'Success', \"Salary structure assigned successfully!\");\r\n              load();\r\n            }}\r\n          />\r\n        )\r\n      }\r\n\r\n      <div className=\"bg-white rounded-lg border border-slate-200 shadow-sm p-4 sm:p-6\">\r\n        <h3 className=\"text-base sm:text-lg font-semibold text-slate-900 mb-3\">Employees by Department</h3>\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4\">\r\n          {DEPARTMENTS.map((dept) => (\r\n            <div key={dept} className=\"border border-slate-200 rounded-lg p-3\">\r\n              <div className=\"font-semibold text-slate-800 mb-2\">{dept}</div>\r\n              <div className=\"space-y-1 text-sm text-slate-600\">\r\n                {employees.filter(e => e.department === dept).map(e => (\r\n                  <div key={e._id} className=\"flex justify-between\">\r\n                    <span>{[e.firstName, e.lastName].filter(Boolean).join(' ') || e.email}</span>\r\n                    <span className=\"text-xs text-slate-500\">{e.role || '-'}</span>\r\n                  </div>\r\n                ))}\r\n                {employees.filter(e => e.department === dept).length === 0 && (\r\n                  <div className=\"text-xs text-slate-400\">No employees</div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div >\r\n  );\r\n}\r\n\r\n\r\n\r\nfunction EmployeeForm({ employee, onClose, viewOnly = false }) {\r\n  const [step, setStep] = useState((employee?.status === 'Draft' ? employee?.lastStep : 1) || 1);\r\n\r\n  const [firstName, setFirstName] = useState(employee?.firstName || '');\r\n  const [middleName, setMiddleName] = useState(employee?.middleName || '');\r\n  const [lastName, setLastName] = useState(employee?.lastName || '');\r\n  const [gender, setGender] = useState(employee?.gender || '');\r\n  const [dob, setDob] = useState(employee?.dob ? new Date(employee.dob).toISOString().slice(0, 10) : '');\r\n  const [contactNo, setContactNo] = useState(employee?.contactNo || '');\r\n  const [email, setEmail] = useState(employee?.email || '');\r\n  const [password, setPassword] = useState('');\r\n  const [profilePic, setProfilePic] = useState(null);\r\n  const [profilePreview, setProfilePreview] = useState(employee?.profilePic || null);\r\n  const [maritalStatus, setMaritalStatus] = useState(employee?.maritalStatus || '');\r\n  const [bloodGroup, setBloodGroup] = useState(employee?.bloodGroup || '');\r\n  const [nationality, setNationality] = useState(employee?.nationality || '');\r\n  const [fatherName, setFatherName] = useState(employee?.fatherName || '');\r\n  const [motherName, setMotherName] = useState(employee?.motherName || '');\r\n  const [emergencyContactName, setEmergencyContactName] = useState(employee?.emergencyContactName || '');\r\n  const [emergencyContactNumber, setEmergencyContactNumber] = useState(employee?.emergencyContactNumber || '');\r\n\r\n  const [tempAddress, setTempAddress] = useState(employee?.tempAddress || { line1: '', line2: '', city: '', state: '', pinCode: '', country: '' });\r\n  const [permAddress, setPermAddress] = useState(employee?.permAddress || { line1: '', line2: '', city: '', state: '', pinCode: '', country: '' });\r\n  const [sameAsTemp, setSameAsTemp] = useState(false);\r\n\r\n  const [experience, setExperience] = useState(employee?.experience?.length ? employee.experience.map(e => ({\r\n    ...e,\r\n    payslips: e.payslips || (e.payslipUrl ? [e.payslipUrl] : [])\r\n  })) : []);\r\n  const [jobType, setJobType] = useState(employee?.jobType || 'Full-Time');\r\n\r\n  const [bankName, setBankName] = useState(employee?.bankDetails?.bankName || '');\r\n  const [accountNumber, setAccountNumber] = useState(employee?.bankDetails?.accountNumber || '');\r\n  const [ifsc, setIfsc] = useState(employee?.bankDetails?.ifsc || '');\r\n  const [branchName, setBranchName] = useState(employee?.bankDetails?.branchName || '');\r\n  const [bankLocation, setBankLocation] = useState(employee?.bankDetails?.location || '');\r\n  const [currentBankProof, setCurrentBankProof] = useState(employee?.bankDetails?.bankProofUrl || null);\r\n\r\n  const [role, setRole] = useState(employee?.role || 'Employee');\r\n  const [department, setDepartment] = useState(employee?.department || '');\r\n  const [departmentId, setDepartmentId] = useState(employee?.departmentId?._id || employee?.departmentId || '');\r\n  const [manager, setManager] = useState(employee?.manager?._id || employee?.manager || '');\r\n  const [joiningDate, setJoiningDate] = useState(employee?.joiningDate ? new Date(employee.joiningDate).toISOString().split('T')[0] : '');\r\n  const [departments, setDepartments] = useState([]);\r\n  const [managers, setManagers] = useState([]);\r\n  const [_departmentHead, _setDepartmentHead] = useState(employee?.departmentHead || false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [errors, setErrors] = useState({});\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [pincodeLoading, setPincodeLoading] = useState(false);\r\n  const [ifscLoading, setIfscLoading] = useState(false);\r\n\r\n  // Leave Policy\r\n  const [leavePolicy, setLeavePolicy] = useState(employee?.leavePolicy || '');\r\n  const [policies, setPolicies] = useState([]);\r\n\r\n  const loadPolicies = useCallback(async () => {\r\n    try {\r\n      const res = await api.get('/hr/leave-policies');\r\n      setPolicies(res.data || []);\r\n    } catch (err) { console.error(\"Failed to load policies\", err); }\r\n  }, []);\r\n\r\n\r\n  // Education State\r\n  const [eduType, setEduType] = useState(employee?.education?.type || 'Diploma');\r\n  const [class10Marksheet, setClass10Marksheet] = useState(employee?.education?.class10Marksheet || null);\r\n  const [class12Marksheet, setClass12Marksheet] = useState(employee?.education?.class12Marksheet || null);\r\n  const [diplomaCertificate, setDiplomaCertificate] = useState(employee?.education?.diplomaCertificate || null);\r\n  const [bachelorDegree, setBachelorDegree] = useState(employee?.education?.bachelorDegree || null);\r\n  const [masterDegree, setMasterDegree] = useState(employee?.education?.masterDegree || null);\r\n\r\n  // Alternative: Last 3 Sem Marksheets\r\n  const [lastSem1, setLastSem1] = useState(employee?.education?.lastSem1Marksheet || null);\r\n  const [lastSem2, setLastSem2] = useState(employee?.education?.lastSem2Marksheet || null);\r\n  const [lastSem3, setLastSem3] = useState(employee?.education?.lastSem3Marksheet || null);\r\n\r\n  // Step 6: Identity Documents\r\n  // Step 6: Identity Documents\r\n  const [aadharFront, setAadharFront] = useState(employee?.documents?.aadharFront || null);\r\n  const [aadharBack, setAadharBack] = useState(employee?.documents?.aadharBack || null);\r\n  const [panCard, setPanCard] = useState(employee?.documents?.panCard || null);\r\n\r\n  const bankProofRef = useRef(null);\r\n  const c10Ref = useRef(null);\r\n  const c12Ref = useRef(null);\r\n  const diplomaRef = useRef(null);\r\n  const bachelorRef = useRef(null);\r\n  const masterRef = useRef(null);\r\n  const ls1Ref = useRef(null);\r\n  const ls2Ref = useRef(null);\r\n  const ls3Ref = useRef(null);\r\n  const aadharFrontRef = useRef(null);\r\n  const aadharBackRef = useRef(null);\r\n  const panRef = useRef(null);\r\n  const profilePicRef = useRef(null);\r\n  const ignoreAutoFill = useRef(false);\r\n\r\n\r\n  // Fetch departments for dropdown\r\n  const loadDepartments = useCallback(async () => {\r\n    try {\r\n      const res = await api.get('/hr/departments');\r\n      const deptList = Array.isArray(res.data) ? res.data : [];\r\n      setDepartments(deptList);\r\n    } catch (err) {\r\n      console.error('Failed to load departments', err);\r\n      setDepartments([]);\r\n    }\r\n  }, []);\r\n\r\n  // Fetch employees for manager dropdown\r\n  const loadManagers = useCallback(async () => {\r\n    try {\r\n      const res = await api.get('/hr/employees');\r\n      const empList = Array.isArray(res.data?.data) ? res.data.data : (Array.isArray(res.data) ? res.data : []);\r\n      setManagers(empList.filter(e => !employee || e._id !== employee._id)); // Exclude self\r\n    } catch (err) {\r\n      console.error('Failed to load managers', err);\r\n      setManagers([]);\r\n    }\r\n  }, [employee]);\r\n\r\n  // Step 7: Fetch Employee Code Preview\r\n  const loadEmployeeCodePreview = useCallback(async () => {\r\n    if (step !== 7) return;\r\n    try {\r\n      const payload = {\r\n        firstName: firstName,\r\n        lastName: lastName,\r\n        department: department || 'GEN'\r\n      };\r\n      console.log('Fetching preview with:', payload);\r\n      const res = await api.post('/hr/employees/preview', payload);\r\n      if (res.data && res.data.preview) {\r\n        setEmployeeCode(res.data.preview);\r\n      } else {\r\n        setEmployeeCode('Error: No ID returned');\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load employee code preview', err);\r\n      setEmployeeCode('Error: Failed to generate');\r\n    }\r\n  }, [step, firstName, lastName, department]);\r\n\r\n  useEffect(() => {\r\n    loadDepartments();\r\n    loadManagers();\r\n    loadPolicies();\r\n    // Allow preview if creating new OR editing a Draft\r\n    if (step === 7 && (!employee || employee.status === 'Draft')) loadEmployeeCodePreview();\r\n  }, [loadDepartments, loadManagers, loadEmployeeCodePreview, step, employee]);\r\n\r\n  const [employeeCode, setEmployeeCode] = useState('');\r\n\r\n  const phoneRe = /^\\d{10, 15}$/;\r\n  const pinRe = useMemo(() => /^\\d{5, 10}$/, []);\r\n  const ifscRe = useMemo(() => /^[A-Z]{4}0[0-9A-Z]{6}$/, []);\r\n\r\n  const handlePincodeLookup = useCallback(async (pin, target = 'temp') => {\r\n    try {\r\n      if (!pin || !pinRe.test(pin)) return;\r\n      setPincodeLoading(true);\r\n      const key = 'pincode_cache';\r\n      let cache = {};\r\n      try { cache = JSON.parse(sessionStorage.getItem(key) || '{}') || {}; } catch { cache = {}; }\r\n      const isOnline = typeof navigator !== 'undefined' ? navigator.onLine : true;\r\n      if (!isOnline) {\r\n        const c = cache[pin];\r\n        if (c) {\r\n          if (target === 'temp') setTempAddress(p => {\r\n            const next = { ...p, city: c.city || p.city, state: c.stateVal || p.state, country: c.countryVal || p.country };\r\n            return (next.city === p.city && next.state === p.state && next.country === p.country) ? p : next;\r\n          });\r\n          else setPermAddress(p => {\r\n            const next = { ...p, city: c.city || p.city, state: c.stateVal || p.state, country: c.countryVal || p.country };\r\n            return (next.city === p.city && next.state === p.state && next.country === p.country) ? p : next;\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      const res = await fetch(`https://api.postalpincode.in/pincode/${encodeURIComponent(pin)}`);\r\n      let city = '', stateVal = '', countryVal = '';\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        const entry = Array.isArray(data) ? data[0] : null;\r\n        const po = entry && Array.isArray(entry.PostOffice) ? entry.PostOffice[0] : null;\r\n        city = (po && (po.District || po.Name)) || '';\r\n        stateVal = (po && po.State) || '';\r\n        countryVal = (po && po.Country) || '';\r\n      }\r\n      if (city || stateVal || countryVal) {\r\n        if (ignoreAutoFill.current) return; // Prevent overwriting city if triggered by city lookup\r\n\r\n        const v = { city, stateVal, countryVal, ts: Date.now() };\r\n        cache[pin] = v;\r\n        try { sessionStorage.setItem(key, JSON.stringify(cache)); } catch { /* ignore sessionStorage errors */ }\r\n        if (target === 'temp') setTempAddress(p => {\r\n          const next = { ...p, city: city || p.city, state: stateVal || p.state, country: countryVal || p.country };\r\n          return (next.city === p.city && next.state === p.state && next.country === p.country) ? p : next;\r\n        });\r\n        else setPermAddress(p => {\r\n          const next = { ...p, city: city || p.city, state: stateVal || p.state, country: countryVal || p.country };\r\n          return (next.city === p.city && next.state === p.state && next.country === p.country) ? p : next;\r\n        });\r\n      }\r\n    } finally {\r\n      setPincodeLoading(false);\r\n    }\r\n  }, [pinRe]);\r\n\r\n  const handleIfscLookup = useCallback(async (code) => {\r\n    try {\r\n      if (!code || !ifscRe.test(code)) return;\r\n      setIfscLoading(true);\r\n      const key = 'ifsc_cache';\r\n      let cache = {};\r\n      try { cache = JSON.parse(sessionStorage.getItem(key) || '{}') || {}; } catch { cache = {}; }\r\n      const isOnline = typeof navigator !== 'undefined' ? navigator.onLine : true;\r\n      if (!isOnline) {\r\n        const c = cache[code];\r\n        if (c) {\r\n          setBankName(prev => c.BANK || prev);\r\n          setBranchName(prev => c.BRANCH || prev);\r\n        }\r\n        return;\r\n      }\r\n      const res = await fetch(`https://ifsc.razorpay.com/${encodeURIComponent(code)}`);\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setBankName(prev => data.BANK || prev);\r\n        setBranchName(prev => data.BRANCH || prev);\r\n        setBankLocation(prev => data.CITY || data.DISTRICT || prev); // Auto-populate location\r\n        const v = { ...data, ts: Date.now() };\r\n        cache[code] = v;\r\n        try { sessionStorage.setItem(key, JSON.stringify(cache)); } catch { /* ignore sessionStorage errors */ }\r\n      }\r\n    } finally {\r\n      setIfscLoading(false);\r\n    }\r\n  }, [ifscRe]);\r\n\r\n  const handleCityLookup = useCallback(async (city, target = 'temp') => {\r\n    try {\r\n      if (!city || city.length < 3) { setPincodeLoading(false); return; }\r\n\r\n      const isOnline = typeof navigator !== 'undefined' ? navigator.onLine : true;\r\n      if (!isOnline) { setPincodeLoading(false); return; }\r\n\r\n      const res = await fetch(`https://api.postalpincode.in/postoffice/${encodeURIComponent(city)}`);\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        const entry = Array.isArray(data) ? data[0] : null;\r\n        if (entry && entry.Status === 'Success' && Array.isArray(entry.PostOffice) && entry.PostOffice.length > 0) {\r\n          const list = entry.PostOffice;\r\n          const inputCity = city.trim().toLowerCase();\r\n\r\n          // Priority 1: Exact Match on District\r\n          let po = list.find(item => item.District && item.District.toLowerCase() === inputCity);\r\n\r\n          // Priority 2: Exact Match on Region\r\n          if (!po) po = list.find(item => item.Region && item.Region.toLowerCase() === inputCity);\r\n\r\n          // Priority 3: Fuzzy Match on Name (Starts with input + space, or exact)\r\n          // e.g. Input \"Dhari\" matches \"Dhari S.O\"\r\n          if (!po) {\r\n            const nameRegex = new RegExp(`^${inputCity}( |$|\\\\.)`, 'i');\r\n            const nameMatches = list.filter(item => item.Name && nameRegex.test(item.Name));\r\n\r\n            if (nameMatches.length > 0) {\r\n              // Sort by State (A-Z) -> Gujarat comes before Uttarakhand\r\n              nameMatches.sort((a, b) => (a.State || '').localeCompare(b.State || ''));\r\n              po = nameMatches[0];\r\n            }\r\n          }\r\n\r\n          // Fallback: Just take the first one if we can't find a direct match\r\n          if (!po) po = list[0];\r\n\r\n          const stateVal = po.State || '';\r\n          const countryVal = po.Country || 'India';\r\n          const pinVal = po.Pincode || '';\r\n\r\n          if (target === 'temp') {\r\n            ignoreAutoFill.current = true;\r\n            setTempAddress(p => ({ ...p, state: stateVal || p.state, country: countryVal || p.country, pinCode: pinVal }));\r\n            setTimeout(() => { ignoreAutoFill.current = false; }, 2000);\r\n          } else {\r\n            ignoreAutoFill.current = true;\r\n            setPermAddress(p => ({ ...p, state: stateVal || p.state, country: countryVal || p.country, pinCode: pinVal }));\r\n            setTimeout(() => { ignoreAutoFill.current = false; }, 2000);\r\n          }\r\n        } else {\r\n          // Fallback to Global Search (Nominatim)\r\n          throw new Error(\"No Indian match found\");\r\n        }\r\n\r\n      } else {\r\n        throw new Error(\"Indian API Failed\");\r\n      }\r\n    } catch (e) {\r\n      console.log(\"Indian API missed, trying global...\", e);\r\n\r\n      // Clear stale data immediately to prevent wrong info persistence\r\n      if (target === 'temp') setTempAddress(p => ({ ...p, state: '', country: '', pinCode: '' }));\r\n      else setPermAddress(p => ({ ...p, state: '', country: '', pinCode: '' }));\r\n\r\n      try {\r\n        const globalRes = await fetch(`https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(city)}&format=json&addressdetails=1&limit=1`, {\r\n          headers: { 'Accept-Language': 'en' } // Prefer English results\r\n        });\r\n        if (globalRes.ok) {\r\n          const gData = await globalRes.json();\r\n          const gEntry = Array.isArray(gData) ? gData[0] : null;\r\n          if (gEntry && gEntry.address) {\r\n            const stateVal = gEntry.address.state || gEntry.address.county || '';\r\n            const countryVal = gEntry.address.country || '';\r\n            const pinVal = gEntry.address.postcode || '';\r\n\r\n            if (target === 'temp') {\r\n              ignoreAutoFill.current = true;\r\n              setTempAddress(p => ({ ...p, state: stateVal || p.state, country: countryVal || p.country, pinCode: pinVal }));\r\n              setTimeout(() => { ignoreAutoFill.current = false; }, 2000);\r\n            } else {\r\n              ignoreAutoFill.current = true;\r\n              setPermAddress(p => ({ ...p, state: stateVal || p.state, country: countryVal || p.country, pinCode: pinVal }));\r\n              setTimeout(() => { ignoreAutoFill.current = false; }, 2000);\r\n            }\r\n          }\r\n        }\r\n      } catch (err2) {\r\n        console.error(\"Global lookup failed\", err2);\r\n      }\r\n    } finally {\r\n      setPincodeLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Debounced Effect for City Lookup - Temp Address\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      if (tempAddress.city && tempAddress.city.length > 2) handleCityLookup(tempAddress.city, 'temp');\r\n    }, 800);\r\n    return () => clearTimeout(timer);\r\n  }, [tempAddress.city, handleCityLookup]);\r\n\r\n  // Debounced Effect for City Lookup - Perm Address\r\n  useEffect(() => {\r\n    if (sameAsTemp) return;\r\n    const timer = setTimeout(() => {\r\n      if (permAddress.city && permAddress.city.length > 2) handleCityLookup(permAddress.city, 'perm');\r\n    }, 800);\r\n    return () => clearTimeout(timer);\r\n  }, [permAddress.city, sameAsTemp, handleCityLookup]);\r\n\r\n  // ... (renderFilePreview and validateStep unchanged)\r\n\r\n  // ...\r\n\r\n  // Helper to render file preview\r\n  const renderFilePreview = (fileOrUrl, altText) => {\r\n    if (!fileOrUrl) return null;\r\n    const isFile = fileOrUrl instanceof File;\r\n    const isPdf = isFile ? (fileOrUrl.type === 'application/pdf') : fileOrUrl.toLowerCase().endsWith('.pdf');\r\n\r\n    if (isPdf) {\r\n      return <div className=\"text-red-500 font-bold text-xs p-2 text-center border rounded bg-slate-50\">PDF Document</div>;\r\n    }\r\n\r\n    let src = '';\r\n    if (isFile) {\r\n      src = URL.createObjectURL(fileOrUrl);\r\n    } else {\r\n      if (fileOrUrl.startsWith('http')) {\r\n        src = fileOrUrl;\r\n      } else {\r\n        // Normalize URL: remove /api from end if present (for static files), remove trailing slash\r\n        const backendUrl = BACKEND_URL || '';\r\n        const baseUrl = backendUrl.replace(/\\/api\\/?$/, '').replace(/\\/$/, '');\r\n        const cleanPath = (fileOrUrl || '').replace(/\\\\/g, '/');\r\n        const path = cleanPath.startsWith('/') ? cleanPath : `/${cleanPath}`;\r\n        src = `${baseUrl}${path}`;\r\n      }\r\n    }\r\n\r\n    return <img src={src} alt={altText} className=\"w-full h-full object-contain\" />;\r\n  };\r\n\r\n  const validateStep = (stepNum) => {\r\n    const e = {};\r\n    if (stepNum === 1) {\r\n      if (!firstName || firstName.length < 3 || !/^[A-Za-z]+$/.test(firstName)) e.firstName = 'First name required (min 3 chars, letters only)';\r\n      if (!middleName || middleName.length < 3) e.middleName = 'Middle name is required (min 3 chars)';\r\n      if (!lastName || lastName.length < 3) e.lastName = 'Last name is required (min 3 chars)';\r\n      if (!gender) e.gender = 'Gender is required';\r\n      // Department and Manager are optional now\r\n      if (!joiningDate) e.joiningDate = 'Joining Date is required';\r\n      if (!dob) e.dob = 'Date of birth required';\r\n      else {\r\n        const birth = new Date(dob); const age = Math.floor((Date.now() - birth.getTime()) / (1000 * 60 * 60 * 24 * 365.25));\r\n        if (age < 18) e.dob = 'Employee must be at least 18 years old';\r\n      }\r\n      if (!contactNo || !phoneRe.test(contactNo)) e.contactNo = 'Phone must be 10-15 digits';\r\n      // Email and Password validation removed\r\n\r\n      if (!maritalStatus) e.maritalStatus = 'Marital Status is required';\r\n\r\n      const validBloodGroups = ['A+', 'A-', 'B+', 'B-', 'O+', 'O-', 'AB+', 'AB-'];\r\n      if (!bloodGroup) e.bloodGroup = 'Blood Group is required';\r\n      else if (!validBloodGroups.includes(bloodGroup.toUpperCase())) e.bloodGroup = 'Invalid Blood Group (Allowed: A+, A-, B+, B-, O+, O-, AB+, AB-)';\r\n\r\n      if (!nationality) e.nationality = 'Nationality is required';\r\n\r\n      // Father/Mother remain optional, but validate if entered\r\n      if (fatherName && fatherName.length < 3) e.fatherName = 'Father name must be at least 3 chars';\r\n      if (motherName && motherName.length < 3) e.motherName = 'Mother name must be at least 3 chars';\r\n\r\n      if (!emergencyContactName || emergencyContactName.length < 3) e.emergencyContactName = 'Emergency contact name required (min 3 chars)';\r\n      if (!emergencyContactNumber || !phoneRe.test(emergencyContactNumber)) e.emergencyContactNumber = 'Emergency contact number invalid';\r\n    }\r\n\r\n    if (stepNum === 2) {\r\n      if (!tempAddress.line1) e.tempLine1 = 'Temporary address line1 required';\r\n      if (!tempAddress.city) e.tempCity = 'Temporary city required';\r\n      if (!tempAddress.state) e.tempState = 'Temporary state required';\r\n      if (!tempAddress.pinCode || !pinRe.test(tempAddress.pinCode)) e.tempPin = 'Temporary pin code invalid';\r\n      if (!tempAddress.country) e.tempCountry = 'Temporary country required';\r\n      if (!sameAsTemp) {\r\n        if (!permAddress.line1) e.permLine1 = 'Permanent address line1 required';\r\n        if (!permAddress.city) e.permCity = 'Permanent city required';\r\n        if (!permAddress.state) e.permState = 'Permanent state required';\r\n        if (!permAddress.pinCode || !pinRe.test(permAddress.pinCode)) e.permPin = 'Permanent pin code invalid';\r\n        if (!permAddress.country) e.permCountry = 'Permanent country required';\r\n      }\r\n    }\r\n\r\n    if (stepNum === 3) {\r\n      experience.forEach((exp, idx) => {\r\n        if (exp.from && exp.to) {\r\n          const f = new Date(exp.from); const t = new Date(exp.to);\r\n          if (f > t) e[`exp_${idx}`] = 'From date must be before To date';\r\n        }\r\n        // Mandatory fields check\r\n        if (!exp.companyName) e[`exp_${idx}`] = 'Company Name is required';\r\n        if (!exp.reportingPersonName) e[`exp_${idx}`] = 'Reporting Person Name is required';\r\n        if (!exp.reportingPersonEmail) e[`exp_${idx}`] = 'Reporting Person Email is required';\r\n        if (!exp.payslips || exp.payslips.filter(Boolean).length !== 3) e[`exp_${idx}`] = 'Exactly 3 payslips are required';\r\n      });\r\n    }\r\n\r\n    if (stepNum === 4) {\r\n      if (!employee) {\r\n        if (!bankName) e.bankName = 'Bank name required';\r\n        if (!accountNumber || !/^[0-9]{9, 18}$/.test(accountNumber)) e.accountNumber = 'Account Number must be 9-18 digits';\r\n        if (!ifsc || !ifscRe.test(ifsc)) e.ifsc = 'IFSC invalid';\r\n        if (!branchName) e.branchName = 'Branch name required';\r\n        // Bank Proof Mandatory Validation\r\n        if (!currentBankProof) e.bankProof = 'Bank Proof (Cheque/Passbook Photo) is required';\r\n      }\r\n    }\r\n\r\n    if (stepNum === 5) {\r\n      if (!eduType) { e.eduType = 'Education Type is required'; return false; }\r\n\r\n      // Common Rule: 10th Marksheet is always required\r\n      if (!class10Marksheet) e.class10 = '10th Marksheet is required';\r\n\r\n      if (eduType === 'Diploma') {\r\n        // Diploma: Require Diploma Certificate OR (Last 3 Sem Marksheets)\r\n        const hasDegree = !!diplomaCertificate;\r\n        const hasAlt = lastSem1 && lastSem2 && lastSem3;\r\n        if (!hasDegree && !hasAlt) {\r\n          e.diploma = 'Diploma Certificate OR Last 3 Sem Marksheets required';\r\n        }\r\n      } else if (eduType === 'Bachelor') {\r\n        if (!class12Marksheet) e.class12 = '12th Marksheet is required';\r\n        // Bachelor: Require Bachelor Degree OR (Last 3 Sem Marksheets)\r\n        const hasDegree = !!bachelorDegree;\r\n        const hasAlt = lastSem1 && lastSem2 && lastSem3;\r\n        if (!hasDegree && !hasAlt) {\r\n          e.bachelor = 'Bachelor Degree OR Last 3 Sem Marksheets required';\r\n        }\r\n      }\r\n    }\r\n\r\n    if (stepNum === 6) {\r\n      // Identity Documents validation\r\n      if (!aadharFront && !employee?.documents?.aadharFront) e.aadharFront = 'Aadhar Front is required';\r\n      if (!aadharBack && !employee?.documents?.aadharBack) e.aadharBack = 'Aadhar Back is required';\r\n      if (!panCard && !employee?.documents?.panCard) e.panCard = 'PAN Card is required';\r\n    }\r\n\r\n    if (stepNum === 7) {\r\n      // Step 7: Account Credentials\r\n      // Employee Code is read-only\r\n      if (!email || !/\\S+@\\S+\\.\\S+/.test(email)) e.email = 'Valid Email is required';\r\n\r\n      // Password is now mandatory for both New/Draft AND Edit modes\r\n      if (!password || password.length < 6) {\r\n        e.password = 'Password is required (min 6 chars)';\r\n      }\r\n    }\r\n\r\n    setErrors(e);\r\n    return Object.keys(e).length === 0;\r\n  };\r\n\r\n  const handleNext = () => {\r\n    if (validateStep(step)) setStep(step + 1);\r\n  };\r\n\r\n\r\n  const handlePrev = () => {\r\n    setStep(step - 1);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (sameAsTemp) setPermAddress({ ...tempAddress });\r\n  }, [sameAsTemp, tempAddress]);\r\n\r\n  useEffect(() => {\r\n    const t = setTimeout(() => {\r\n      const pin = tempAddress.pinCode;\r\n      if (pin && pinRe.test(pin)) handlePincodeLookup(pin, 'temp');\r\n    }, 500);\r\n    return () => clearTimeout(t);\r\n  }, [tempAddress.pinCode, handlePincodeLookup, pinRe]);\r\n\r\n  useEffect(() => {\r\n    const t = setTimeout(() => {\r\n      const pin = permAddress.pinCode;\r\n      if (pin && pinRe.test(pin) && !sameAsTemp) handlePincodeLookup(pin, 'perm');\r\n    }, 500);\r\n    return () => clearTimeout(t);\r\n  }, [permAddress.pinCode, sameAsTemp, handlePincodeLookup, pinRe]);\r\n\r\n  useEffect(() => {\r\n    const t = setTimeout(() => {\r\n      if (ifsc && ifscRe.test(ifsc)) handleIfscLookup(ifsc);\r\n    }, 500);\r\n    return () => clearTimeout(t);\r\n  }, [ifsc, handleIfscLookup, ifscRe]);\r\n\r\n  async function submit(e) {\r\n    e.preventDefault();\r\n    if (!validateStep(7)) return;\r\n    setSaving(true);\r\n    try {\r\n      // Upload Current Bank Proof if changed\r\n      let currentBankProofUrl = employee?.bankDetails?.bankProofUrl;\r\n      if (currentBankProof && currentBankProof instanceof File) {\r\n        try {\r\n          const fd = new FormData();\r\n          fd.append('file', currentBankProof);\r\n          const up = await api.post('/uploads/doc', fd);\r\n          if (up?.data?.success) currentBankProofUrl = up.data.url;\r\n        } catch (e) { console.warn('Bank proof upload failed', e) }\r\n      } else if (currentBankProof) {\r\n        currentBankProofUrl = currentBankProof; // string\r\n      } else {\r\n        currentBankProofUrl = ''; // removed\r\n      }\r\n      /* Profile Pic removed\r\n      let profilePicUrl = employee?.profilePic || undefined;\r\n      if (profilePic && profilePic instanceof File) {... }\r\n      */\r\n\r\n      // Process experience file uploads\r\n      let processedExperience = [];\r\n      if (experience && experience.length > 0) {\r\n        processedExperience = await Promise.all(experience.map(async (exp) => {\r\n          let pSlips = [];\r\n          if (exp.payslips && exp.payslips.length > 0) {\r\n            for (const item of exp.payslips) {\r\n              if (item instanceof File) {\r\n                const fd = new FormData();\r\n                fd.append('file', item);\r\n                try {\r\n                  const up = await api.post('/uploads/doc', fd);\r\n                  if (up?.data?.success) pSlips.push(up.data.url);\r\n                } catch (e) { console.warn('Payslip upload failed', e); }\r\n              } else if (typeof item === 'string') { pSlips.push(item); }\r\n            }\r\n          }\r\n          return { ...exp, payslips: pSlips };\r\n        }));\r\n      }\r\n\r\n      // Education File Uploads\r\n      let c10Url = employee?.education?.class10Marksheet;\r\n      let c12Url = employee?.education?.class12Marksheet;\r\n      let diplomaUrl = employee?.education?.diplomaCertificate;\r\n      let bachelorUrl = employee?.education?.bachelorDegree;\r\n      let masterUrl = employee?.education?.masterDegree;\r\n      let ls1Url = employee?.education?.lastSem1Marksheet;\r\n      let ls2Url = employee?.education?.lastSem2Marksheet;\r\n      let ls3Url = employee?.education?.lastSem3Marksheet;\r\n\r\n      const uploadFile = async (file) => {\r\n        if (!file || !(file instanceof File)) return null;\r\n        const fd = new FormData();\r\n        fd.append('file', file);\r\n        try {\r\n          const res = await api.post('/uploads/doc', fd);\r\n          return res?.data?.success ? res.data.url : null;\r\n        } catch (e) {\r\n          console.warn('File upload failed', e);\r\n          return null;\r\n        }\r\n      };\r\n\r\n      if (class10Marksheet instanceof File) { c10Url = await uploadFile(class10Marksheet) || c10Url; }\r\n      if (class12Marksheet instanceof File) { c12Url = await uploadFile(class12Marksheet) || c12Url; }\r\n      if (diplomaCertificate instanceof File) { diplomaUrl = await uploadFile(diplomaCertificate) || diplomaUrl; }\r\n      if (bachelorDegree instanceof File) { bachelorUrl = await uploadFile(bachelorDegree) || bachelorUrl; }\r\n      if (masterDegree instanceof File) { masterUrl = await uploadFile(masterDegree) || masterUrl; }\r\n\r\n      if (lastSem1 instanceof File) { ls1Url = await uploadFile(lastSem1) || ls1Url; }\r\n      if (lastSem2 instanceof File) { ls2Url = await uploadFile(lastSem2) || ls2Url; }\r\n      if (lastSem3 instanceof File) { ls3Url = await uploadFile(lastSem3) || ls3Url; }\r\n\r\n      // Step 6 Documents\r\n\r\n      // Step 6 Documents\r\n      let aadharFrontUrl = employee?.documents?.aadharFront;\r\n      let aadharBackUrl = employee?.documents?.aadharBack;\r\n      let panUrl = employee?.documents?.panCard;\r\n      let profilePicUrl = employee?.profilePic; // Existing URL\r\n\r\n      if (profilePic instanceof File) { profilePicUrl = await uploadFile(profilePic) || profilePicUrl; }\r\n      if (aadharFront instanceof File) { aadharFrontUrl = await uploadFile(aadharFront) || aadharFrontUrl; }\r\n      if (aadharBack instanceof File) { aadharBackUrl = await uploadFile(aadharBack) || aadharBackUrl; }\r\n      if (panCard instanceof File) { panUrl = await uploadFile(panCard) || panUrl; }\r\n\r\n      const payload = {\r\n        firstName, middleName, lastName, gender, dob: dob || undefined,\r\n        contactNo, email, password: password || undefined,\r\n        maritalStatus, bloodGroup, nationality, fatherName, motherName,\r\n        emergencyContactName, emergencyContactNumber,\r\n        tempAddress, permAddress: sameAsTemp ? tempAddress : permAddress,\r\n        experience: processedExperience,\r\n        jobType,\r\n        bankDetails: { bankName, accountNumber, ifsc, branchName, location: bankLocation, bankProofUrl: currentBankProofUrl },\r\n        education: {\r\n          type: eduType,\r\n          class10Marksheet: c10Url,\r\n          class12Marksheet: c12Url,\r\n          diplomaCertificate: diplomaUrl,\r\n          bachelorDegree: bachelorUrl,\r\n          masterDegree: masterUrl,\r\n          lastSem1Marksheet: ls1Url,\r\n          lastSem2Marksheet: ls2Url,\r\n          lastSem3Marksheet: ls3Url\r\n        },\r\n        documents: {\r\n          aadharFront: aadharFrontUrl,\r\n          aadharBack: aadharBackUrl,\r\n          panCard: panUrl\r\n        },\r\n        role,\r\n        department: department || (departments.find(d => d._id === departmentId)?.name || ''),\r\n        departmentId: departmentId || undefined,\r\n        manager: manager || undefined,\r\n        joiningDate: joiningDate || new Date().toISOString(),\r\n        departmentHead: _departmentHead,\r\n        profilePic: profilePicUrl,\r\n        status: 'Active',\r\n        lastStep: 7,\r\n        leavePolicy: leavePolicy || undefined,\r\n        // Include new ID if generated (mainly for Draft updates)\r\n        ...(employeeCode && !employeeCode.startsWith('Error') ? { employeeId: employeeCode } : {}),\r\n      };\r\n\r\n      let empResult;\r\n      if (employee) {\r\n        empResult = await api.put(`/hr/employees/${employee._id}`, payload);\r\n      } else {\r\n        empResult = await api.post('/hr/employees', payload);\r\n      }\r\n\r\n      // If employee is marked as \"Dep Head\", update the department's head field\r\n      if (role === 'Dep Head' && department) {\r\n        const empId = empResult?.data?.data?._id || empResult?.data?._id || employee?._id;\r\n        if (empId) {\r\n          await api.put(`/hr/departments/${department}`, { head: empId })\r\n            .catch(err => console.error('Failed to update department head', err?.response?.data?.message || err.message));\r\n        }\r\n      }\r\n\r\n      onClose();\r\n    } catch (err) {\r\n      console.error('Employee save error:', err);\r\n      const errorMsg = err?.response?.data?.message || err?.response?.data?.error || err?.message || 'Failed to save employee';\r\n      notification.error({ message: 'Error', description: errorMsg, placement: 'topRight' });\r\n      // alert(`Error: ${errorMsg}`);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  async function saveDraft(e) {\r\n    if (e) e.preventDefault();\r\n    setSaving(true);\r\n    try {\r\n      const uploadFile = async (file) => {\r\n        if (!file || !(file instanceof File)) return null;\r\n        const fd = new FormData();\r\n        fd.append('file', file);\r\n        try {\r\n          const res = await api.post('/uploads/doc', fd);\r\n          return res?.data?.success ? res.data.url : null;\r\n        } catch (e) { console.warn('File upload failed', e); return null; }\r\n      };\r\n\r\n      // Bank Proof\r\n      let currentBankProofUrl = employee?.bankDetails?.bankProofUrl;\r\n      if (currentBankProof && currentBankProof instanceof File) {\r\n        currentBankProofUrl = await uploadFile(currentBankProof) || currentBankProofUrl;\r\n      } else if (currentBankProof) { currentBankProofUrl = currentBankProof; }\r\n      else { currentBankProofUrl = ''; }\r\n\r\n      // Profile Pic\r\n      let profilePicUrl = employee?.profilePic;\r\n      if (profilePic && profilePic instanceof File) {\r\n        profilePicUrl = await uploadFile(profilePic) || profilePicUrl;\r\n      } else if (profilePic) { profilePicUrl = profilePic; }\r\n\r\n      // Payslips\r\n      let processedExperience = [];\r\n      if (experience && experience.length > 0) {\r\n        processedExperience = await Promise.all(experience.map(async (exp) => {\r\n          let pSlips = [];\r\n          if (exp.payslips && exp.payslips.length > 0) {\r\n            for (const item of exp.payslips) {\r\n              if (item instanceof File) {\r\n                const u = await uploadFile(item);\r\n                if (u) pSlips.push(u);\r\n              } else if (typeof item === 'string') { pSlips.push(item); }\r\n            }\r\n          }\r\n          return { ...exp, payslips: pSlips };\r\n        }));\r\n      }\r\n\r\n      // Education\r\n      let c10Url = employee?.education?.class10Marksheet;\r\n      let c12Url = employee?.education?.class12Marksheet;\r\n      let diplomaUrl = employee?.education?.diplomaCertificate;\r\n      let bachelorUrl = employee?.education?.bachelorDegree;\r\n      let masterUrl = employee?.education?.masterDegree;\r\n      let ls1Url = employee?.education?.lastSem1Marksheet;\r\n      let ls2Url = employee?.education?.lastSem2Marksheet;\r\n      let ls3Url = employee?.education?.lastSem3Marksheet;\r\n\r\n      if (class10Marksheet instanceof File) { c10Url = await uploadFile(class10Marksheet) || c10Url; }\r\n      if (class12Marksheet instanceof File) { c12Url = await uploadFile(class12Marksheet) || c12Url; }\r\n      if (diplomaCertificate instanceof File) { diplomaUrl = await uploadFile(diplomaCertificate) || diplomaUrl; }\r\n      if (bachelorDegree instanceof File) { bachelorUrl = await uploadFile(bachelorDegree) || bachelorUrl; }\r\n      if (masterDegree instanceof File) { masterUrl = await uploadFile(masterDegree) || masterUrl; }\r\n\r\n      if (lastSem1 instanceof File) { ls1Url = await uploadFile(lastSem1) || ls1Url; }\r\n      if (lastSem2 instanceof File) { ls2Url = await uploadFile(lastSem2) || ls2Url; }\r\n      if (lastSem3 instanceof File) { ls3Url = await uploadFile(lastSem3) || ls3Url; }\r\n\r\n      let aadharFrontUrl = employee?.documents?.aadharFront;\r\n      let aadharBackUrl = employee?.documents?.aadharBack;\r\n      let panUrl = employee?.documents?.panCard;\r\n      if (aadharFront instanceof File) { aadharFrontUrl = await uploadFile(aadharFront) || aadharFrontUrl; }\r\n      if (aadharBack instanceof File) { aadharBackUrl = await uploadFile(aadharBack) || aadharBackUrl; }\r\n      if (panCard instanceof File) { panUrl = await uploadFile(panCard) || panUrl; }\r\n\r\n      const payload = {\r\n        firstName, middleName, lastName,\r\n        gender: gender || undefined,\r\n        dob: dob || undefined,\r\n        contactNo, email,\r\n        password: password || undefined,\r\n        maritalStatus: maritalStatus || undefined,\r\n        bloodGroup,\r\n        nationality: nationality || undefined,\r\n        fatherName, motherName,\r\n        emergencyContactName, emergencyContactNumber,\r\n        tempAddress, permAddress: sameAsTemp ? tempAddress : permAddress,\r\n        experience: processedExperience,\r\n        jobType: jobType || undefined,\r\n        bankDetails: { bankName, accountNumber, ifsc, branchName, location: bankLocation, bankProofUrl: currentBankProofUrl },\r\n        education: {\r\n          type: eduType,\r\n          class10Marksheet: c10Url,\r\n          class12Marksheet: c12Url,\r\n          diplomaCertificate: diplomaUrl,\r\n          bachelorDegree: bachelorUrl,\r\n          masterDegree: masterUrl,\r\n          lastSem1Marksheet: ls1Url,\r\n          lastSem2Marksheet: ls2Url,\r\n          lastSem3Marksheet: ls3Url\r\n        },\r\n        documents: {\r\n          aadharFront: aadharFrontUrl,\r\n          aadharBack: aadharBackUrl,\r\n          panCard: panUrl\r\n        },\r\n        role, department: department || undefined, departmentId: departmentId || undefined,\r\n        manager: manager || undefined, joiningDate: joiningDate || undefined,\r\n        profilePic: profilePicUrl,\r\n        status: 'Draft',\r\n        lastStep: step,\r\n        leavePolicy: leavePolicy || undefined, // Add Leave Policy\r\n        // Include new ID if generated\r\n        ...(employeeCode && !employeeCode.startsWith('Error') ? { employeeId: employeeCode } : {}),\r\n      };\r\n\r\n      if (employee?._id) {\r\n        await api.put(`/hr/employees/${employee._id}`, payload);\r\n      } else {\r\n        await api.post('/hr/employees', payload);\r\n        // If new employee created, we might want to set it so future saves are updates?\r\n        // But for now just alert.\r\n      }\r\n      notification.success({ message: 'Success', description: 'Draft saved successfully!', placement: 'topRight' });\r\n      // onClose(); // Removed as requested: User wants to stay on form\r\n    } catch (err) {\r\n      console.error(\"Failed to save draft\", err);\r\n      notification.error({ message: 'Error', description: \"Failed to save draft: \" + (err.response?.data?.message || err.message), placement: 'topRight' });\r\n    } finally { setSaving(false); }\r\n  }\r\n\r\n  const stepTitles = ['General Details', 'Address', 'Experience', 'Bank & Job', 'Education Details', 'Identity Documents', 'Account Credentials'];\r\n\r\n  return (\r\n    <div>\r\n      <form onSubmit={submit} className=\"bg-white p-6 rounded-lg border border-slate-200 shadow-sm w-full\">\r\n        {/* Step Indicator */}\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h3 className=\"font-bold text-lg\">{employee ? 'Edit' : 'Add'} Employee - Step {step} of {stepTitles.length}</h3>\r\n          <div className=\"text-xs text-slate-500\">{stepTitles[step - 1]}</div>\r\n        </div>\r\n\r\n        {/* Draft Badge */}\r\n        {employee?.status === 'Draft' && (\r\n          <div className=\"mb-4 bg-amber-50 text-amber-800 text-sm px-3 py-2 rounded border border-amber-200\">\r\n            This is a <strong>Draft</strong>. You are currently on Step {step}.\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 1: General Details */}\r\n        {step === 1 && (\r\n          <div className=\"space-y-6\">\r\n\r\n            {/* Profile Picture Upload */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200 flex flex-col md:flex-row items-center gap-6\">\r\n              <div className=\"relative group\">\r\n                <div className=\"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-md bg-slate-200 flex items-center justify-center\">\r\n                  {profilePreview ? (\r\n                    <img src={profilePreview instanceof File ? URL.createObjectURL(profilePreview) : `${BACKEND_URL}${profilePreview}`} alt=\"Profile\" className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <svg className=\"w-12 h-12 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" /></svg>\r\n                  )}\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => profilePicRef.current?.click()}\r\n                  className=\"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full shadow hover:bg-blue-700 transition\"\r\n                  title=\"Upload Photo\"\r\n                >\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\" /></svg>\r\n                </button>\r\n                <input\r\n                  ref={profilePicRef}\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  className=\"hidden\"\r\n                  onChange={(e) => {\r\n                    const file = e.target.files[0];\r\n                    if (file) {\r\n                      setProfilePic(file);\r\n                      setProfilePreview(file);\r\n                    }\r\n                  }}\r\n                />\r\n              </div>\r\n              <div className=\"flex-1 text-center md:text-left\">\r\n                <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-1\">Profile Photo</h4>\r\n                <p className=\"text-xs text-slate-500 mb-2\">Upload a professional photo. Max 2MB. (Optional)</p>\r\n                {profilePic && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => { setProfilePic(null); setProfilePreview(null); if (profilePicRef.current) profilePicRef.current.value = ''; }}\r\n                    className=\"text-xs text-red-500 hover:text-red-700 border border-red-200 bg-red-50 px-3 py-1 rounded-full transition\"\r\n                  >\r\n                    Remove Photo\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section: Identity Details */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Identity Details</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">First Name <span className=\"text-red-500\">*</span></label>\r\n                  <input required value={firstName} onChange={e => { const v = e.target.value; setFirstName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.firstName ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"John\" />\r\n                  {errors.firstName && <div className=\"text-xs text-red-600 mt-1\">{errors.firstName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Middle Name</label>\r\n                  <input value={middleName} onChange={e => { const v = e.target.value; setMiddleName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.middleName ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"D.\" />\r\n                  {errors.middleName && <div className=\"text-xs text-red-600 mt-1\">{errors.middleName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Last Name <span className=\"text-red-500\">*</span></label>\r\n                  <input required value={lastName} onChange={e => { const v = e.target.value; setLastName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.lastName ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"Doe\" />\r\n                  {errors.lastName && <div className=\"text-xs text-red-600 mt-1\">{errors.lastName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Gender</label>\r\n                  <select\r\n                    value={gender}\r\n                    onChange={e => setGender(e.target.value)}\r\n                    className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.gender ? 'border-red-500' : 'border-slate-300'}`}\r\n                  >\r\n                    <option value=\"\">Select Gender</option>\r\n                    <option value=\"Male\">Male</option>\r\n                    <option value=\"Female\">Female</option>\r\n                    <option value=\"Other\">Other</option>\r\n                  </select>\r\n                  {errors.gender && <div className=\"text-xs text-red-600 mt-1\">{errors.gender}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Date of Birth</label>\r\n                  <DatePicker\r\n                    className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none h-[40px] ${errors.dob ? 'border-red-500' : 'border-slate-300'}`}\r\n                    format=\"DD-MM-YYYY\"\r\n                    placeholder=\"DD-MM-YYYY\"\r\n                    allowClear={false}\r\n                    value={dob ? dayjs(dob) : null}\r\n                    onChange={(date) => setDob(date ? date.format('YYYY-MM-DD') : '')}\r\n                  />\r\n                  {errors.dob && <div className=\"text-xs text-red-600 mt-1\">{errors.dob}</div>}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section: Official Information */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Official Information</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Department <span className=\"text-red-500\">*</span></label>\r\n                  <select\r\n                    value={departmentId}\r\n                    onChange={e => {\r\n                      const selectedDept = departments.find(d => d._id === e.target.value);\r\n                      setDepartmentId(e.target.value);\r\n                      setDepartment(selectedDept?.name || '');\r\n                    }}\r\n                    className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.department ? 'border-red-500' : 'border-slate-300'}`}\r\n                    required\r\n                  >\r\n                    <option value=\"\">-- Select Department --</option>\r\n                    {departments.map((d) => (\r\n                      <option key={d._id || d} value={d._id || d}>{typeof d === 'string' ? d : d.name}</option>\r\n                    ))}\r\n                  </select>\r\n                  {errors.department && <div className=\"text-xs text-red-600 mt-1\">{errors.department}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Manager (Optional)</label>\r\n                  <select\r\n                    value={manager}\r\n                    onChange={e => setManager(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">-- No Manager (Top Level) --</option>\r\n                    {managers\r\n                      .filter(m => !departmentId || m.departmentId === departmentId || m.department === department)\r\n                      .map((m) => (\r\n                        <option key={m._id} value={m._id}>\r\n                          {[m.firstName, m.lastName].filter(Boolean).join(' ')} ({m.employeeId}) - {m.role || 'Employee'}\r\n                        </option>\r\n                      ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Leave Policy</label>\r\n                  <select\r\n                    value={leavePolicy}\r\n                    onChange={e => setLeavePolicy(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">-- Select Leave Policy --</option>\r\n                    {policies.map(p => (\r\n                      <option key={p._id} value={p._id}>{p.name}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Joining Date</label>\r\n                  <DatePicker\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300 h-[40px]\"\r\n                    format=\"DD-MM-YYYY\"\r\n                    placeholder=\"DD-MM-YYYY\"\r\n                    allowClear={false}\r\n                    value={joiningDate ? dayjs(joiningDate) : null}\r\n                    onChange={(date) => setJoiningDate(date ? date.format('YYYY-MM-DD') : '')}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Designation / Role</label>\r\n                  <select\r\n                    value={role}\r\n                    onChange={e => setRole(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option>Employee</option>\r\n                    <option>Manager</option>\r\n                    <option>Dep Head</option>\r\n                    <option>HR</option>\r\n                    <option>Admin</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Job Type</label>\r\n                  <select\r\n                    value={jobType}\r\n                    onChange={e => setJobType(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option>Full-Time</option>\r\n                    <option>Part-Time</option>\r\n                    <option>Internship</option>\r\n                    <option>Contract</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section: Personal & Family */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Personal & Family</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Marital Status</label>\r\n                  <select value={maritalStatus} onChange={e => setMaritalStatus(e.target.value)} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\">\r\n                    <option value=\"\">Select</option>\r\n                    <option>Single</option>\r\n                    <option>Married</option>\r\n                    <option>Divorced</option>\r\n                    <option>Widowed</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Blood Group</label>\r\n                  <select\r\n                    value={bloodGroup}\r\n                    onChange={e => setBloodGroup(e.target.value)}\r\n                    className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.bloodGroup ? 'border-red-500' : 'border-slate-300'}`}\r\n                  >\r\n                    <option value=\"\">Select</option>\r\n                    <option value=\"A+\">A+</option>\r\n                    <option value=\"A-\">A-</option>\r\n                    <option value=\"B+\">B+</option>\r\n                    <option value=\"B-\">B-</option>\r\n                    <option value=\"O+\">O+</option>\r\n                    <option value=\"O-\">O-</option>\r\n                    <option value=\"AB+\">AB+</option>\r\n                    <option value=\"AB-\">AB-</option>\r\n                  </select>\r\n                  {errors.bloodGroup && <div className=\"text-xs text-red-600 mt-1\">{errors.bloodGroup}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Nationality</label>\r\n                  <select\r\n                    value={nationality}\r\n                    onChange={e => setNationality(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">Select Country</option>\r\n                    {NATIONALITIES.map((nat) => (\r\n                      <option key={nat} value={nat}>{nat}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Father's Name</label>\r\n                  <input value={fatherName} onChange={e => { const v = e.target.value; setFatherName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.fatherName ? 'border-red-500' : 'border-slate-300'}`} />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Mother's Name</label>\r\n                  <input value={motherName} onChange={e => { const v = e.target.value; setMotherName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.motherName ? 'border-red-500' : 'border-slate-300'}`} />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section: Contact */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Contact Information</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Phone Number</label>\r\n                  <input value={contactNo} onChange={e => setContactNo(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.contactNo ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  {errors.contactNo && <div className=\"text-xs text-red-600 mt-1\">{errors.contactNo}</div>}\r\n                </div>\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <div>\r\n                    <label className=\"text-sm font-semibold text-slate-700\">Emergency Contact Name</label>\r\n                    <input value={emergencyContactName} onChange={e => { const v = e.target.value; setEmergencyContactName(v ? v.charAt(0).toUpperCase() + v.slice(1) : v); }} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.emergencyContactName ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-sm font-semibold text-slate-700\">Emergency Contact #</label>\r\n                    <input value={emergencyContactNumber} onChange={e => setEmergencyContactNumber(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.emergencyContactNumber ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 2: Address */}\r\n        {step === 2 && (\r\n          <div className=\"space-y-6\">\r\n            {/* Temporary Address Section */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <div className=\"flex items-center justify-between mb-4 border-b border-slate-200 pb-2\">\r\n                <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide\">Temporary Address</h4>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Address Line 1 <span className=\"text-red-500\">*</span></label>\r\n                  <input value={tempAddress.line1} onChange={e => setTempAddress(p => ({ ...p, line1: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempLine1 ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"Street, Sector, Area\" />\r\n                  {errors.tempLine1 && <div className=\"text-xs text-red-600 mt-1\">{errors.tempLine1}</div>}\r\n                </div>\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Address Line 2 (Optional)</label>\r\n                  <input value={tempAddress.line2} onChange={e => setTempAddress(p => ({ ...p, line2: e.target.value }))} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" placeholder=\"Landmark, Building Name\" />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">City <span className=\"text-red-500\">*</span></label>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      value={tempAddress.city}\r\n                      onChange={e => {\r\n                        setTempAddress(p => ({ ...p, city: e.target.value }));\r\n                        setPincodeLoading(true);\r\n                      }}\r\n                      className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempCity ? 'border-red-500' : 'border-slate-300'}`}\r\n                      placeholder=\"Start typing...\"\r\n                    />\r\n                    {pincodeLoading && tempAddress.city.length > 2 && <div className=\"absolute right-2 top-2 text-xs text-blue-500 animate-pulse\">Searching...</div>}\r\n                  </div>\r\n                  {errors.tempCity && <div className=\"text-xs text-red-600 mt-1\">{errors.tempCity}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">State</label>\r\n                  <input value={tempAddress.state} onChange={e => setTempAddress(p => ({ ...p, state: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempState ? 'border-red-500' : 'border-slate-300'}`} disabled />\r\n                  {errors.tempState && <div className=\"text-xs text-red-600 mt-1\">{errors.tempState}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Pin/Zip Code <span className=\"text-red-500\">*</span></label>\r\n                  <input value={tempAddress.pinCode} onChange={e => setTempAddress(p => ({ ...p, pinCode: e.target.value }))} onBlur={() => handlePincodeLookup(tempAddress.pinCode, 'temp')} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempPin ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  {errors.tempPin && <div className=\"text-xs text-red-600 mt-1\">{errors.tempPin}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Country</label>\r\n                  <input value={tempAddress.country} onChange={e => setTempAddress(p => ({ ...p, country: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.tempCountry ? 'border-red-500' : 'border-slate-300'}`} disabled />\r\n                  {errors.tempCountry && <div className=\"text-xs text-red-600 mt-1\">{errors.tempCountry}</div>}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Same As Temp Checkbox */}\r\n            <div className=\"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-100\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={sameAsTemp}\r\n                onChange={e => {\r\n                  const checked = e.target.checked;\r\n                  setSameAsTemp(checked);\r\n                  if (!checked) {\r\n                    setPermAddress({ line1: '', line2: '', city: '', state: '', pinCode: '', country: '' });\r\n                  }\r\n                }}\r\n                id=\"sameTemp\"\r\n                className=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\"\r\n              />\r\n              <label htmlFor=\"sameTemp\" className=\"text-sm font-medium text-blue-800 cursor-pointer\">Permanent Address is same as Temporary Address</label>\r\n            </div>\r\n\r\n            {/* Permanent Address Section */}\r\n            <div className={`bg-slate-50 p-4 rounded-lg border border-slate-200 transition-opacity ${sameAsTemp ? 'opacity-50 pointer-events-none' : ''}`}>\r\n              <div className=\"flex items-center justify-between mb-4 border-b border-slate-200 pb-2\">\r\n                <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide\">Permanent Address</h4>\r\n              </div>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Address Line 1 <span className=\"text-red-500\">*</span></label>\r\n                  <input value={permAddress.line1} onChange={e => setPermAddress(p => ({ ...p, line1: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permLine1 ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permLine1 && <div className=\"text-xs text-red-600 mt-1\">{errors.permLine1}</div>}\r\n                </div>\r\n                <div className=\"md:col-span-2\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Address Line 2 (Optional)</label>\r\n                  <input value={permAddress.line2} onChange={e => setPermAddress(p => ({ ...p, line2: e.target.value }))} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" disabled={sameAsTemp} />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">City <span className=\"text-red-500\">*</span></label>\r\n                  <input value={permAddress.city} onChange={e => setPermAddress(p => ({ ...p, city: e.target.value }))} onBlur={() => handleCityLookup(permAddress.city, 'perm')} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permCity ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permCity && <div className=\"text-xs text-red-600 mt-1\">{errors.permCity}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">State</label>\r\n                  <input value={permAddress.state} onChange={e => setPermAddress(p => ({ ...p, state: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permState ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permState && <div className=\"text-xs text-red-600 mt-1\">{errors.permState}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Pin/Zip Code <span className=\"text-red-500\">*</span></label>\r\n                  <input value={permAddress.pinCode} onChange={e => setPermAddress(p => ({ ...p, pinCode: e.target.value }))} onBlur={() => handlePincodeLookup(permAddress.pinCode, 'perm')} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permPin ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permPin && <div className=\"text-xs text-red-600 mt-1\">{errors.permPin}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Country</label>\r\n                  <input value={permAddress.country} onChange={e => setPermAddress(p => ({ ...p, country: e.target.value }))} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.permCountry ? 'border-red-500' : 'border-slate-300'}`} disabled={sameAsTemp} />\r\n                  {errors.permCountry && <div className=\"text-xs text-red-600 mt-1\">{errors.permCountry}</div>}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 3: Experience */}\r\n        {step === 3 && (\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h4 className=\"text-lg font-bold text-slate-800\">Work Experience</h4>\r\n            </div>\r\n            {experience.map((exp, idx) => (\r\n              <div key={idx} className=\"bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative group hover:shadow-md transition\">\r\n                {/* Remove Button */}\r\n                {experience.length > 1 && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      const copy = [...experience];\r\n                      copy.splice(idx, 1);\r\n                      setExperience(copy);\r\n                    }}\r\n                    className=\"absolute top-4 right-4 text-slate-300 hover:text-red-500 transition\"\r\n                    title=\"Remove Entry\"\r\n                  >\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                      <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </button>\r\n                )}\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\r\n                  {/* Left Col: Company Info */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-3 border-b border-slate-100 pb-1 text-blue-600\">Company Details</h5>\r\n                    <div className=\"space-y-3\">\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Company Name <span className=\"text-red-500\">*</span></label>\r\n                        <input placeholder=\"Ex. Tech Solutions Inc.\" value={exp.companyName} onChange={e => { const v = e.target.value; const copy = [...experience]; copy[idx].companyName = v ? v.charAt(0).toUpperCase() + v.slice(1) : v; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                      <div className=\"grid grid-cols-2 gap-3\">\r\n                        <div>\r\n                          <label className=\"text-sm font-semibold text-slate-700\">From Date</label>\r\n                          <DatePicker\r\n                            className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300 h-[40px]\"\r\n                            format=\"DD-MM-YYYY\"\r\n                            placeholder=\"DD-MM-YYYY\"\r\n                            value={exp.from ? dayjs(exp.from) : null}\r\n                            onChange={(date) => { const copy = [...experience]; copy[idx].from = date ? date.format('YYYY-MM-DD') : ''; setExperience(copy); }}\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"text-sm font-semibold text-slate-700\">To Date</label>\r\n                          <DatePicker\r\n                            className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300 h-[40px]\"\r\n                            format=\"DD-MM-YYYY\"\r\n                            placeholder=\"DD-MM-YYYY\"\r\n                            value={exp.to ? dayjs(exp.to) : null}\r\n                            onChange={(date) => { const copy = [...experience]; copy[idx].to = date ? date.format('YYYY-MM-DD') : ''; setExperience(copy); }}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Last Salary</label>\r\n                        <input placeholder=\"Ex. 50000\" type=\"number\" value={exp.lastDrawnSalary} onChange={e => { const copy = [...experience]; copy[idx].lastDrawnSalary = e.target.value; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Right Col: Manager Info */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-3 border-b border-slate-100 pb-1 text-green-600\">Reporting Manager</h5>\r\n                    <div className=\"space-y-3\">\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Manager Name <span className=\"text-red-500\">*</span></label>\r\n                        <input placeholder=\"Full Name\" value={exp.reportingPersonName || ''} onChange={e => { const v = e.target.value; const copy = [...experience]; copy[idx].reportingPersonName = v ? v.charAt(0).toUpperCase() + v.slice(1) : v; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Manager Email <span className=\"text-red-500\">*</span></label>\r\n                        <input placeholder=\"email@company.com\" value={exp.reportingPersonEmail || ''} onChange={e => { const copy = [...experience]; copy[idx].reportingPersonEmail = e.target.value; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"text-sm font-semibold text-slate-700\">Manager Phone</label>\r\n                        <input placeholder=\"Optional\" value={exp.reportingPersonPhone || ''} onChange={e => { const copy = [...experience]; copy[idx].reportingPersonPhone = e.target.value; setExperience(copy); }} className=\"w-full border px-3 py-2 rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Verification Documents */}\r\n                <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n                  <h5 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-3 border-b border-slate-200 pb-1 text-indigo-600\">Verification Documents</h5>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    {/* Payslips */}\r\n                    <div>\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Payslips (Last 3 Months) <span className=\"text-red-500\">*</span></label>\r\n                      <div className=\"flex gap-2\">\r\n                        {[0, 1, 2].map((i) => (\r\n                          <div key={i} className=\"flex-1\">\r\n                            <label className=\"block bg-white border border-dashed border-slate-300 rounded p-2 text-center cursor-pointer hover:border-blue-400 transition\" title={`Upload Month ${i + 1}`}>\r\n                              <div className=\"text-xs font-semibold text-slate-500 mb-1\">Mo. {i + 1}</div>\r\n                              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 mx-auto text-slate-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" /></svg>\r\n                            </label>\r\n                            <input\r\n                              type=\"file\"\r\n                              className=\"hidden\"\r\n                              onChange={(e) => {\r\n                                const file = e.target.files[0];\r\n                                const copy = [...experience];\r\n                                if (!copy[idx].payslips) copy[idx].payslips = [];\r\n                                copy[idx].payslips[i] = file;\r\n                                setExperience(copy);\r\n                              }}\r\n                            />\r\n                            {exp.payslips && exp.payslips[i] && <div className=\"text-[10px] text-green-600 text-center mt-1 truncate\">{exp.payslips[i].name}</div>}\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Chequebook */}\r\n                    <div>\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Bank Proof (Cheque/Passbook) <span className=\"text-red-500\">*</span></label>\r\n                      <label className=\"block bg-white border border-dashed border-slate-300 rounded p-2 text-center cursor-pointer hover:border-blue-400 transition h-[74px] flex flex-col justify-center items-center\">\r\n                        <div className=\"text-xs font-semibold text-slate-500 mb-1\">{exp.chequebook ? 'File Selected' : 'Upload File'}</div>\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 mx-auto text-slate-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" /></svg>\r\n                      </label>\r\n                      <input\r\n                        type=\"file\"\r\n                        className=\"hidden\"\r\n                        onChange={(e) => {\r\n                          const file = e.target.files[0];\r\n                          const copy = [...experience];\r\n                          copy[idx].chequebook = file;\r\n                          setExperience(copy);\r\n                        }}\r\n                      />\r\n                      {exp.chequebook && <div className=\"text-[10px] text-green-600 text-center mt-1 truncate\">{exp.chequebook.name}</div>}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n              </div>\r\n            ))}\r\n\r\n\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setExperience([...experience, { companyName: '', from: '', to: '', lastDrawnSalary: '', reportingPersonName: '', reportingPersonEmail: '', reportingPersonContact: '', payslips: [] }])}\r\n              className=\"w-full py-3 border-2 border-dashed border-blue-200 rounded-lg text-blue-600 hover:bg-blue-50 font-semibold transition flex items-center justify-center gap-2 hover:border-blue-300\"\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" /></svg>\r\n              Add Another Experience\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 4: Bank & Job */}\r\n        {/* Step 4: Bank & Job */}\r\n        {step === 4 && (\r\n          <div className=\"space-y-6\">\r\n            {/* Bank Details */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Bank Details</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Bank Name</label>\r\n                  <input value={bankName} onChange={e => setBankName(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.bankName ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"HDFC, SBI, etc.\" />\r\n                  {errors.bankName && <div className=\"text-xs text-red-600 mt-1\">{errors.bankName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Account Number</label>\r\n                  <input value={accountNumber} onChange={e => setAccountNumber(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.accountNumber ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"Account No\" />\r\n                  {errors.accountNumber && <div className=\"text-xs text-red-600 mt-1\">{errors.accountNumber}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">IFSC Code</label>\r\n                  <div className=\"relative\">\r\n                    <input value={ifsc} onChange={e => setIfsc(e.target.value.toUpperCase())} onBlur={() => handleIfscLookup(ifsc)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.ifsc ? 'border-red-500' : 'border-slate-300'}`} placeholder=\"SBIN000....\" />\r\n                    {ifscLoading && <div className=\"absolute right-3 top-2.5 text-xs text-blue-500 animate-pulse\">Checking...</div>}\r\n                  </div>\r\n                  {errors.ifsc && <div className=\"text-xs text-red-600 mt-1\">{errors.ifsc}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Branch Name</label>\r\n                  <input value={branchName} onChange={e => setBranchName(e.target.value)} className={`w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none ${errors.branchName ? 'border-red-500' : 'border-slate-300'}`} />\r\n                  {errors.branchName && <div className=\"text-xs text-red-600 mt-1\">{errors.branchName}</div>}\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Bank Location</label>\r\n                  <input value={bankLocation} onChange={e => setBankLocation(e.target.value)} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\" placeholder=\"City/District\" />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Bank Proof Upload */}\r\n              <div className=\"mt-4 pt-4 border-t border-slate-200\">\r\n                <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Upload Cheque / Passbook <span className=\"text-red-500\">*</span></label>\r\n                <label className=\"flex flex-col items-center justify-center w-full h-32 border-2 border-slate-300 border-dashed rounded-lg cursor-pointer bg-white hover:bg-slate-50 transition border-slate-400\">\r\n                  <div className=\"flex flex-col items-center justify-center pt-5 pb-6\">\r\n                    <svg className=\"w-8 h-8 mb-3 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"></path></svg>\r\n                    <p className=\"mb-2 text-sm text-slate-500\"><span className=\"font-semibold\">Click to upload</span> or drag and drop</p>\r\n                    <p className=\"text-xs text-slate-500\">SVG, PNG, JPG or PDF (MAX. 2MB)</p>\r\n                  </div>\r\n                  <input ref={bankProofRef} type=\"file\" className=\"hidden\" accept=\"image/*,application/pdf\" onChange={e => setCurrentBankProof(e.target.files[0])} />\r\n                </label>\r\n                {currentBankProof && (\r\n                  <div className=\"mt-2 flex items-center justify-between bg-blue-50 px-3 py-2 rounded border border-blue-100\">\r\n                    <div className=\"flex items-center space-x-2 overflow-hidden\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-blue-500 flex-shrink-0\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" /></svg>\r\n                      {currentBankProof instanceof File ? <span className=\"text-sm text-blue-700 truncate\">{currentBankProof.name}</span> : <a href={`${BACKEND_URL}${currentBankProof}`} target=\"_blank\" rel=\"noreferrer\" className=\"text-sm text-blue-600 underline truncate\">View Uploaded File</a>}\r\n                    </div>\r\n                    <button type=\"button\" onClick={() => { setCurrentBankProof(null); if (bankProofRef.current) bankProofRef.current.value = ''; }} className=\"text-red-500 hover:text-red-700 p-1\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" /></svg>\r\n                    </button>\r\n                  </div>\r\n                )}\r\n                {errors.bankProof && <div className=\"text-xs text-red-600 mt-1\">{errors.bankProof}</div>}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Job Details */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Employment Details</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Job Type</label>\r\n                  <select value={jobType} onChange={e => setJobType(e.target.value)} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\">\r\n                    <option>Full-Time</option>\r\n                    <option>Part-Time</option>\r\n                    <option>Internship</option>\r\n                    <option>Contract</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Role / Access Level</label>\r\n                  <select value={role} onChange={e => setRole(e.target.value)} className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\">\r\n                    <option value=\"Employee\">Employee</option>\r\n                    <option value=\"Dep Head\">Dep Head</option>\r\n                    <option value=\"Manager\">Manager</option>\r\n                    <option value=\"HR\">HR</option>\r\n                    <option value=\"Admin\">Admin</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Department</label>\r\n                  <select\r\n                    value={departmentId}\r\n                    onChange={e => {\r\n                      const selectedDept = departments.find(d => d._id === e.target.value);\r\n                      setDepartmentId(e.target.value);\r\n                      setDepartment(selectedDept?.name || '');\r\n                    }}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">-- Select Department --</option>\r\n                    {departments.map(dept => (\r\n                      <option key={dept._id} value={dept._id}>{dept.name}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Reporting Manager</label>\r\n                  <select\r\n                    value={manager}\r\n                    onChange={e => setManager(e.target.value)}\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300\"\r\n                  >\r\n                    <option value=\"\">-- No Manager (Top Level) --</option>\r\n                    {managers\r\n                      .filter(m => !departmentId || m.departmentId === departmentId || m.department === department)\r\n                      .map((m) => (\r\n                        <option key={m._id} value={m._id}>\r\n                          {[m.firstName, m.lastName].filter(Boolean).join(' ')} ({m.employeeId})\r\n                        </option>\r\n                      ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700\">Joining Date</label>\r\n                  <DatePicker\r\n                    className=\"w-full border px-3 py-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none border-slate-300 h-[40px]\"\r\n                    format=\"DD-MM-YYYY\"\r\n                    placeholder=\"DD-MM-YYYY\"\r\n                    allowClear={false}\r\n                    value={joiningDate ? dayjs(joiningDate) : null}\r\n                    onChange={(date) => setJoiningDate(date ? date.format('YYYY-MM-DD') : '')}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 5: Education Details */}\r\n        {step === 5 && (\r\n          <div className=\"space-y-6\">\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Academic Information</h4>\r\n\r\n              <div className=\"mb-6\">\r\n                <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Education Track <span className=\"text-red-500\">*</span></label>\r\n                <div className=\"flex space-x-4\">\r\n                  {['Diploma', 'Bachelor'].map((type) => (\r\n                    <label key={type} className={`cursor-pointer px-4 py-2 rounded-lg border flex items-center space-x-2 transition ${eduType === type ? 'bg-blue-50 border-blue-500 text-blue-700' : 'bg-white border-slate-300 text-slate-600 hover:bg-slate-50'}`}>\r\n                      <input type=\"radio\" name=\"eduType\" value={type} checked={eduType === type} onChange={e => setEduType(e.target.value)} className=\"w-4 h-4 text-blue-600 focus:ring-blue-500\" />\r\n                      <span className=\"font-medium\">{type}</span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                {/* 10th Standard (Always Required) */}\r\n                <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                  <label className=\"text-sm font-semibold text-slate-700 block mb-2\">10th Standard Marksheet <span className=\"text-red-500\">*</span></label>\r\n                  <input ref={c10Ref} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setClass10Marksheet(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                  {class10Marksheet && (\r\n                    <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                      {class10Marksheet instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{class10Marksheet.name}</span> : <a href={`${BACKEND_URL}${class10Marksheet}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                      <button type=\"button\" onClick={() => { setClass10Marksheet(null); if (c10Ref.current) c10Ref.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                    </div>\r\n                  )}\r\n                  {errors.class10 && <div className=\"text-xs text-red-600 mt-1\">{errors.class10}</div>}\r\n                </div>\r\n\r\n                {/* Conditional Fields */}\r\n                {eduType === 'Diploma' ? (\r\n                  <>\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Diploma Certificate <span className=\"text-red-500\">*</span></label>\r\n                      <input ref={diplomaRef} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setDiplomaCertificate(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {diplomaCertificate && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {diplomaCertificate instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{diplomaCertificate.name}</span> : <a href={`${BACKEND_URL}${diplomaCertificate}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setDiplomaCertificate(null); if (diplomaRef.current) diplomaRef.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                      {errors.diploma && <div className=\"text-xs text-red-600 mt-1\">{errors.diploma}</div>}\r\n                      <p className=\"text-[10px] text-slate-400 mt-1 italic\">If certificate not available, upload combined marksheets below.</p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Optional Degree</label>\r\n                      <input ref={bachelorRef} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setBachelorDegree(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {bachelorDegree && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {bachelorDegree instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{bachelorDegree.name}</span> : <a href={`${BACKEND_URL}${bachelorDegree}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setBachelorDegree(null); if (bachelorRef.current) bachelorRef.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">12th Standard Marksheet <span className=\"text-red-500\">*</span></label>\r\n                      <input ref={c12Ref} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setClass12Marksheet(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {class12Marksheet && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {class12Marksheet instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{class12Marksheet.name}</span> : <a href={`${BACKEND_URL}${class12Marksheet}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setClass12Marksheet(null); if (c12Ref.current) c12Ref.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                      {errors.class12 && <div className=\"text-xs text-red-600 mt-1\">{errors.class12}</div>}\r\n                    </div>\r\n\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Bachelor Degree {eduType === 'Bachelor' && <span className=\"text-red-500\">*</span>}</label>\r\n                      <input ref={bachelorRef} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setBachelorDegree(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {bachelorDegree && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {bachelorDegree instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{bachelorDegree.name}</span> : <a href={`${BACKEND_URL}${bachelorDegree}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setBachelorDegree(null); if (bachelorRef.current) bachelorRef.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                      {errors.bachelor && <div className=\"text-xs text-red-600 mt-1\">{errors.bachelor}</div>}\r\n                    </div>\r\n\r\n                    <div className=\"bg-white p-3 rounded border border-slate-200\">\r\n                      <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Master Degree (Optional)</label>\r\n                      <input ref={masterRef} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setMasterDegree(e.target.files[0])} className=\"block w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\" />\r\n                      {masterDegree && (\r\n                        <div className=\"mt-2 flex items-center justify-between bg-slate-50 px-2 py-1 rounded\">\r\n                          {masterDegree instanceof File ? <span className=\"text-xs text-slate-700 truncate\">{masterDegree.name}</span> : <a href={`${BACKEND_URL}${masterDegree}`} target=\"_blank\" className=\"text-xs text-blue-600 underline\">View File</a>}\r\n                          <button type=\"button\" onClick={() => { setMasterDegree(null); if (masterRef.current) masterRef.current.value = ''; }} className=\"text-red-500 font-bold ml-2\">√ó</button>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n\r\n              {/* Alternative */}\r\n              <div className=\"mt-6 pt-4 border-t border-slate-100\">\r\n                <h5 className=\"text-xs font-bold text-slate-500 uppercase tracking-wide mb-3\">Alternative: Last 3 Semester Marksheets</h5>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                  {[ls1Ref, ls2Ref, ls3Ref].map((ref, i) => {\r\n                    const stateVal = i === 0 ? lastSem1 : i === 1 ? lastSem2 : lastSem3;\r\n                    const setter = i === 0 ? setLastSem1 : i === 1 ? setLastSem2 : setLastSem3;\r\n                    return (\r\n                      <div key={i} className=\"bg-white p-2 rounded border border-slate-200\">\r\n                        <label className=\"text-[10px] font-semibold text-slate-400 block mb-1\">Sem {i + 1} Marksheet</label>\r\n                        <input ref={ref} type=\"file\" accept=\"image/*,application/pdf\" onChange={e => setter(e.target.files[0])} className=\"block w-full text-[10px] text-slate-500 file:mr-1 file:py-0.5 file:px-2 file:rounded-full file:border-0 file:text-[10px] file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200\" />\r\n                        {stateVal && (\r\n                          <div className=\"mt-1 flex items-center justify-between\">\r\n                            {stateVal instanceof File ? <span className=\"text-[10px] text-slate-600 truncate max-w-[80px]\">{stateVal.name}</span> : <a href={`${BACKEND_URL}${stateVal}`} target=\"_blank\" className=\"text-[10px] text-blue-500 underline\">View</a>}\r\n                            <button type=\"button\" onClick={() => { setter(null); if (ref.current) ref.current.value = ''; }} className=\"text-red-400 font-bold ml-1 text-[10px]\">√ó</button>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )\r\n                  })}\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 6: Documents & Identity */}\r\n        {/* Step 6: Documents & Identity */}\r\n        {step === 6 && (\r\n          <div className=\"space-y-6\">\r\n            {/* Section 1: Education Documents Preview (Read-Only) */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Uploaded Education Documents</h4>\r\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                {[\r\n                  { label: '10th Marksheet', file: class10Marksheet },\r\n                  { label: '12th Marksheet', file: class12Marksheet, show: eduType !== 'Diploma' },\r\n                  { label: 'Diploma Cert', file: diplomaCertificate, show: eduType === 'Diploma' },\r\n                  { label: 'Bachelor Degree', file: bachelorDegree },\r\n                  { label: 'Master Degree', file: masterDegree },\r\n                  { label: 'Last Sem 1', file: lastSem1 },\r\n                  { label: 'Last Sem 2', file: lastSem2 },\r\n                  { label: 'Last Sem 3', file: lastSem3 },\r\n                ].map((item, idx) => {\r\n                  if (item.show === false || !item.file) return null;\r\n                  return (\r\n                    <div key={idx} className=\"bg-white border rounded p-3 flex flex-col items-center shadow-sm\">\r\n                      <div className=\"w-full h-24 bg-slate-100 mb-2 rounded overflow-hidden flex items-center justify-center border border-slate-200\">\r\n                        {renderFilePreview(item.file, item.label)}\r\n                      </div>\r\n                      <span className=\"text-xs font-semibold text-center text-slate-700 block truncate w-full\" title={item.label}>{item.label}</span>\r\n                    </div>\r\n                  );\r\n                })}\r\n                {/* Empty State if no docs */}\r\n                {![class10Marksheet, class12Marksheet, diplomaCertificate, bachelorDegree, masterDegree, lastSem1, lastSem2, lastSem3].some(f => f) && (\r\n                  <div className=\"col-span-full text-center text-sm text-slate-500 py-4 italic\">No education documents uploaded in Step 5.</div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Section 2: Personal Identity (Aadhar/Pan) */}\r\n            <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-200\">\r\n              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wide mb-4 border-b border-slate-200 pb-2\">Identity Verification</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                {/* Aadhar Front */}\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Aadhar Front <span className=\"text-red-500\">*</span></label>\r\n                  <div className=\"bg-white p-3 rounded border border-slate-200 flex flex-col gap-3\">\r\n                    {aadharFront ? (\r\n                      <div className=\"relative group\">\r\n                        <div className=\"w-full h-32 bg-slate-100 rounded overflow-hidden border flex items-center justify-center\">\r\n                          {renderFilePreview(aadharFront, 'Aadhar Front')}\r\n                        </div>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => { setAadharFront(null); if (aadharFrontRef.current) aadharFrontRef.current.value = ''; }}\r\n                          className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600 opacity-0 group-hover:opacity-100 transition\"\r\n                        >\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\"></path></svg>\r\n                        </button>\r\n                      </div>\r\n                    ) : (\r\n                      <label className=\"flex flex-col items-center justify-center h-32 border-2 border-dashed border-slate-300 rounded cursor-pointer hover:bg-slate-50 transition\">\r\n                        <div className=\"text-center\">\r\n                          <svg className=\"mx-auto h-8 w-8 text-slate-400\" stroke=\"currentColor\" fill=\"none\" viewBox=\"0 0 48 48\"><path d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" /></svg>\r\n                          <p className=\"mt-1 text-xs text-slate-500\">Upload Front</p>\r\n                        </div>\r\n                        <input ref={aadharFrontRef} type=\"file\" className=\"hidden\" accept=\"image/*,application/pdf\" onChange={e => setAadharFront(e.target.files[0])} />\r\n                      </label>\r\n                    )}\r\n                    {errors.aadharFront && <div className=\"text-xs text-red-600\">{errors.aadharFront}</div>}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Aadhar Back */}\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700 block mb-2\">Aadhar Back <span className=\"text-red-500\">*</span></label>\r\n                  <div className=\"bg-white p-3 rounded border border-slate-200 flex flex-col gap-3\">\r\n                    {aadharBack ? (\r\n                      <div className=\"relative group\">\r\n                        <div className=\"w-full h-32 bg-slate-100 rounded overflow-hidden border flex items-center justify-center\">\r\n                          {renderFilePreview(aadharBack, 'Aadhar Back')}\r\n                        </div>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => { setAadharBack(null); if (aadharBackRef.current) aadharBackRef.current.value = ''; }}\r\n                          className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600 opacity-0 group-hover:opacity-100 transition\"\r\n                        >\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\"></path></svg>\r\n                        </button>\r\n                      </div>\r\n                    ) : (\r\n                      <label className=\"flex flex-col items-center justify-center h-32 border-2 border-dashed border-slate-300 rounded cursor-pointer hover:bg-slate-50 transition\">\r\n                        <div className=\"text-center\">\r\n                          <svg className=\"mx-auto h-8 w-8 text-slate-400\" stroke=\"currentColor\" fill=\"none\" viewBox=\"0 0 48 48\"><path d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" /></svg>\r\n                          <p className=\"mt-1 text-xs text-slate-500\">Upload Back</p>\r\n                        </div>\r\n                        <input ref={aadharBackRef} type=\"file\" className=\"hidden\" accept=\"image/*,application/pdf\" onChange={e => setAadharBack(e.target.files[0])} />\r\n                      </label>\r\n                    )}\r\n                    {errors.aadharBack && <div className=\"text-xs text-red-600\">{errors.aadharBack}</div>}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* PAN Card */}\r\n                <div>\r\n                  <label className=\"text-sm font-semibold text-slate-700 block mb-2\">PAN Card <span className=\"text-red-500\">*</span></label>\r\n                  <div className=\"bg-white p-3 rounded border border-slate-200 flex flex-col gap-3\">\r\n                    {panCard ? (\r\n                      <div className=\"relative group\">\r\n                        <div className=\"w-full h-32 bg-slate-100 rounded overflow-hidden border flex items-center justify-center\">\r\n                          {renderFilePreview(panCard, 'PAN Card')}\r\n                        </div>\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => { setPanCard(null); if (panRef.current) panRef.current.value = ''; }}\r\n                          className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow hover:bg-red-600 opacity-0 group-hover:opacity-100 transition\"\r\n                        >\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\"></path></svg>\r\n                        </button>\r\n                      </div>\r\n                    ) : (\r\n                      <label className=\"flex flex-col items-center justify-center h-32 border-2 border-dashed border-slate-300 rounded cursor-pointer hover:bg-slate-50 transition\">\r\n                        <div className=\"text-center\">\r\n                          <svg className=\"mx-auto h-8 w-8 text-slate-400\" stroke=\"currentColor\" fill=\"none\" viewBox=\"0 0 48 48\"><path d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" /></svg>\r\n                          <p className=\"mt-1 text-xs text-slate-500\">Upload PAN</p>\r\n                        </div>\r\n                        <input ref={panRef} type=\"file\" className=\"hidden\" accept=\"image/*,application/pdf\" onChange={e => setPanCard(e.target.files[0])} />\r\n                      </label>\r\n                    )}\r\n                    {errors.panCard && <div className=\"text-xs text-red-600\">{errors.panCard}</div>}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Step 7: Account Credentials */}\r\n        {step === 7 && (\r\n          <div className=\"bg-slate-50 p-6 rounded-lg border border-slate-200 shadow-sm\">\r\n            <h3 className=\"text-lg font-bold text-slate-800 border-b border-slate-200 pb-3 mb-6 flex items-center gap-2\">\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\" /></svg>\r\n              Account Credentials\r\n            </h3>\r\n\r\n            <div className=\"bg-white p-4 rounded-lg flex items-center justify-between border border-blue-100 shadow-sm\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"bg-blue-50 p-2 rounded-full\">\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2\" /></svg>\r\n                </div>\r\n                <div>\r\n                  <span className=\"text-xs text-blue-600 font-bold uppercase tracking-wider block mb-1\">Employee ID</span>\r\n                  <span className=\"text-2xl font-bold text-slate-800 tracking-tight\">{employeeCode || (employee?.employeeId ? employee.employeeId : 'Generating...')}</span>\r\n                </div>\r\n                {(!employeeCode && !employee?.employeeId) || employeeCode.startsWith('Error') ? (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => { setEmployeeCode('Generating...'); loadEmployeeCodePreview(); }}\r\n                    className=\"text-xs bg-white border border-blue-200 text-blue-600 px-3 py-1.5 rounded hover:bg-blue-50 font-medium transition\"\r\n                  >\r\n                    Retry\r\n                  </button>\r\n                ) : null}\r\n              </div>\r\n              <div className=\"text-xs text-slate-500 max-w-xs text-right hidden sm:block leading-relaxed bg-slate-100 p-2 rounded border border-slate-200\">\r\n                <span className=\"font-semibold text-slate-700\">Auto-Generated:</span> Based on company prefix, department code, and sequence number.\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-2 gap-6 mt-6\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-slate-700 mb-2\">Login Email <span className=\"text-red-500\">*</span></label>\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                    <svg className=\"h-5 w-5 text-slate-400\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\r\n                      <path d=\"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z\" />\r\n                      <path d=\"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z\" />\r\n                    </svg>\r\n                  </div>\r\n                  <input\r\n                    type=\"email\"\r\n                    value={email}\r\n                    onChange={e => setEmail(e.target.value)}\r\n                    className={`w-full pl-10 p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none ${errors.email ? 'border-red-500 bg-red-50' : 'border-slate-300 bg-white'}`}\r\n                    placeholder=\"employee@company.com\"\r\n                    disabled={viewOnly && step !== 7}\r\n                  />\r\n                </div>\r\n                {errors.email && <p className=\"text-red-600 text-xs mt-1 font-medium\">{errors.email}</p>}\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-slate-700 mb-2\">Login Password <span className=\"text-red-500\">*</span></label>\r\n                <div className=\"relative\">\r\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                    <svg className=\"h-5 w-5 text-slate-400\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">\r\n                      <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </div>\r\n                  <input\r\n                    type={showPassword ? \"text\" : \"password\"}\r\n                    value={password}\r\n                    onChange={e => setPassword(e.target.value)}\r\n                    className={`w-full pl-10 p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none ${errors.password ? 'border-red-500 bg-red-50' : 'border-slate-300 bg-white'}`}\r\n                    placeholder=\"Create strong password\"\r\n                    disabled={viewOnly && step !== 7}\r\n                  />\r\n                  <button type=\"button\" onClick={() => setShowPassword(!showPassword)} className=\"absolute right-3 top-2.5 text-slate-400 hover:text-slate-600 transition\">\r\n                    {showPassword ? (\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21\" /></svg>\r\n                    ) : (\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg>\r\n                    )}\r\n                  </button>\r\n                </div>\r\n                {errors.password && <p className=\"text-red-600 text-xs mt-1 font-medium\">{errors.password}</p>}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Navigation Buttons */}\r\n        <div className=\"flex justify-between gap-2 mt-6 pt-4 border-t border-slate-200\">\r\n          <button type=\"button\" onClick={() => step > 1 ? handlePrev() : onClose()} className=\"px-5 py-2.5 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition shadow-sm\">{step > 1 ? 'Previous' : (viewOnly ? 'Close' : 'Cancel')}</button>\r\n\r\n          <div className=\"flex gap-3\">\r\n\r\n            {(!viewOnly || step === 7) && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={(e) => saveDraft(e)}\r\n                className=\"px-5 py-2.5 bg-amber-50 text-amber-700 border border-amber-200 rounded-lg hover:bg-amber-100 font-medium transition shadow-sm\"\r\n                disabled={saving}\r\n              >\r\n                Save as Draft\r\n              </button>\r\n            )}\r\n\r\n            {step < 7 ? (\r\n              <button\r\n                type=\"button\"\r\n                onClick={(e) => { e.preventDefault(); handleNext(); }}\r\n                className=\"px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium shadow-md hover:shadow-lg transition flex items-center gap-2\"\r\n              >\r\n                Next\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" /></svg>\r\n              </button>\r\n            ) : (\r\n              (!viewOnly || step === 7) ? (\r\n                <button\r\n                  onClick={(e) => submit(e)}\r\n                  disabled={saving}\r\n                  className=\"px-6 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium shadow-md hover:shadow-lg transition flex items-center gap-2\"\r\n                >\r\n                  {saving ? 'Saving...' : 'Submit Employee'}\r\n                  {!saving && <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" /></svg>}\r\n                </button>\r\n              ) : (\r\n                <button type=\"button\" onClick={onClose} className=\"px-5 py-2.5 bg-slate-800 text-white rounded-lg hover:bg-slate-900 font-medium shadow-sm\">Close</button>\r\n              )\r\n            )}\r\n          </div>\r\n        </div>\r\n      </form>\r\n\r\n      {/* View Only Overlay style for inputs */}\r\n      {viewOnly && (\r\n        <style>{`\r\n          .employee-form input, .employee-form select, .employee-form textarea {\r\n             pointer-events: none;\r\n             background-color: #f8fafc;\r\n             color: #475569;\r\n          }\r\n          .employee-form input[type=\"file\"] {\r\n             display: none;\r\n          }\r\n           /* Keep buttons clickable */\r\n           .employee-form button { pointer-events: auto; }\r\n           .employee-form a { pointer-events: auto; }\r\n        `}</style>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n\r\nconst FileLink = ({ url, label }) => {\r\n  if (!url) return <span className=\"text-slate-400 text-sm italic py-1 block\">Not uploaded</span>;\r\n  return (\r\n    <a href={`${BACKEND_URL}${url}`} target=\"_blank\" rel=\"noreferrer\" className=\"flex items-center gap-3 text-blue-600 hover:text-blue-800 bg-blue-50 px-3 py-2 rounded-lg transition border border-blue-100 hover:border-blue-200 mb-2\">\r\n      <div className=\"bg-white p-1 rounded text-blue-500\">\r\n        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" /></svg>\r\n      </div>\r\n      <span className=\"text-sm font-medium truncate flex-1\">{label || 'View Document'}</span>\r\n      <svg className=\"w-4 h-4 opacity-50\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\" /></svg>\r\n    </a>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\HRDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'formatDateDDMMYYYY' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"formatDateDDMMYYYY"},"fix":{"range":[436,495],"text":""},"desc":"Remove unused variable 'formatDateDDMMYYYY'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Pagination } from 'antd';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport api from '../../utils/api';\r\nimport { Link } from 'react-router-dom';\r\nimport {\r\n  Eye, Users, Building2, UserCheck, Clock,\r\n  AlertTriangle, Layers, Briefcase, FileClock,\r\n  Settings, UserPlus, Shield, Activity, Calendar,\r\n  CheckCircle, XCircle, ChevronRight\r\n} from 'lucide-react';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\n\r\nexport default function HRDashboard() {\r\n  const { _user, _logout } = useAuth();\r\n  const [tenant, setTenant] = useState(null);\r\n  const [departments, setDepartments] = useState([]);\r\n  const [counts, setCounts] = useState({\r\n    employees: 0,\r\n    departments: 0,\r\n    managers: 0,\r\n    pendingLeaves: 0,\r\n    activeHRs: 0,\r\n    topLevel: 0\r\n  });\r\n  const [attendanceStats, setAttendanceStats] = useState(null);\r\n  const [leaves, setLeaves] = useState([]);\r\n  const [_loading, setLoading] = useState(true);\r\n  const [_error, setError] = useState(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const pageSize = 5;\r\n\r\n  useEffect(() => {\r\n    async function load() {\r\n      setLoading(true);\r\n      setError(null);\r\n      try {\r\n        const [tRes, eRes, dRes, lRes, attRes] = await Promise.all([\r\n          api.get('/tenants/me').catch(() => ({ data: null })),\r\n          api.get('/hr/employees').catch(() => ({ data: [] })),\r\n          api.get('/hr/departments').catch(() => ({ data: [] })),\r\n          api.get('/hr/leaves/requests').catch(() => ({ data: { data: [] } })),\r\n          api.get('/attendance/stats').catch(() => ({ data: null }))\r\n        ]);\r\n\r\n        const employees = Array.isArray(eRes.data) ? eRes.data : (eRes.data?.data || []);\r\n        const formattedDepartments = Array.isArray(dRes.data) ? dRes.data : [];\r\n        const leavesData = lRes.data?.data || [];\r\n\r\n        setTenant(tRes.data);\r\n        setDepartments(formattedDepartments);\r\n        setLeaves(leavesData);\r\n        setAttendanceStats(attRes?.data);\r\n\r\n        // Get hierarchy stats\r\n        const hierarchyRes = await api.get('/hr/employees/hierarchy').catch(() => ({ data: { stats: {} } }));\r\n        const hierarchyStats = hierarchyRes.data?.stats || {};\r\n\r\n        setCounts({\r\n          employees: employees.length,\r\n          departments: formattedDepartments.length,\r\n          managers: employees.filter(emp => (emp.role || '').toLowerCase().includes('manager')).length,\r\n          pendingLeaves: leavesData.filter(l => (l.status || '').toLowerCase() === 'pending').length,\r\n          activeHRs: employees.filter(emp => (emp.role || '').toLowerCase().includes('hr')).length,\r\n          topLevel: hierarchyStats.roots || employees.filter(emp => !emp.manager).length,\r\n        });\r\n      } catch (err) {\r\n        console.error('Failed to load HR dashboard data', err);\r\n        setError('Failed to load dashboard data. Please check your connection.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n  }, []);\r\n\r\n  if (_loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!tenant) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center h-full p-8 text-center bg-white rounded-xl shadow-sm border border-slate-200\">\r\n        <div className=\"text-red-500 mb-4 bg-red-50 p-4 rounded-full\">\r\n          <svg className=\"w-10 h-10\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" /></svg>\r\n        </div>\r\n        <h2 className=\"text-xl font-bold text-slate-800 mb-2\">Company Data Not Found</h2>\r\n        <p className=\"text-slate-600 mb-6 max-w-md\">\r\n          We sent a request to fetch your company details but received no response. This could be due to:\r\n          <ul className=\"list-disc text-left ml-6 mt-2 space-y-1\">\r\n            <li>Expired session/token</li>\r\n            <li>Backend server issues (recently restarted?)</li>\r\n            <li>Invalid Tenant ID</li>\r\n          </ul>\r\n        </p>\r\n        <button\r\n          onClick={_logout}\r\n          className=\"px-6 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition shadow-lg\"\r\n        >\r\n          Log Out & Retry\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4 md:space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h1 className=\"text-2xl md:text-3xl font-bold text-slate-900\">Dashboard</h1>\r\n      </div>\r\n\r\n      <div className=\"relative overflow-hidden bg-gradient-to-br from-indigo-600 to-violet-700 p-6 md:p-8 rounded-2xl shadow-xl text-white\">\r\n        <div className=\"absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white opacity-10 rounded-full blur-2xl\"></div>\r\n        <div className=\"absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-blue-500 opacity-20 rounded-full blur-2xl\"></div>\r\n\r\n        <div className=\"relative z-10\">\r\n          <div className=\"flex items-center gap-3 mb-2 opacity-90\">\r\n            <Building2 size={18} />\r\n            <span className=\"text-sm font-bold uppercase tracking-widest\">Company Overview</span>\r\n          </div>\r\n          <div className=\"flex items-end gap-3\">\r\n            <h1 className=\"text-3xl md:text-4xl font-black tracking-tight\">{tenant?.name || '‚Äî'}</h1>\r\n            <span className=\"text-lg md:text-xl font-medium opacity-70 mb-1\">({tenant?.code})</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Attendance Overview - NEW */}\r\n\r\n      <h2 className=\"text-lg md:text-xl font-bold text-slate-800 mt-8 flex items-center gap-2\">\r\n        <Activity className=\"text-indigo-500\" />\r\n        Today's Attendance Overview\r\n      </h2>\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <div className=\"bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all group overflow-hidden relative\">\r\n          <div className=\"absolute right-0 top-0 w-24 h-24 bg-emerald-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110\"></div>\r\n          <div className=\"relative z-10\">\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n              <div className=\"p-2 bg-emerald-100/50 text-emerald-600 rounded-lg\">\r\n                <UserCheck size={24} />\r\n              </div>\r\n              <span className=\"text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full uppercase tracking-wider\">Live</span>\r\n            </div>\r\n            <div className=\"text-3xl font-black text-slate-800\">{attendanceStats?.totalPunchedIn || 0}</div>\r\n            <div className=\"text-xs font-semibold text-slate-400 uppercase tracking-widest mt-1\">Punched In</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all group overflow-hidden relative\">\r\n          <div className=\"absolute right-0 top-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110\"></div>\r\n          <div className=\"relative z-10\">\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n              <div className=\"p-2 bg-blue-100/50 text-blue-600 rounded-lg\">\r\n                <Layers size={24} />\r\n              </div>\r\n            </div>\r\n            <div className=\"text-3xl font-black text-slate-800\">{attendanceStats?.multiplePunches || 0}</div>\r\n            <div className=\"text-xs font-semibold text-slate-400 uppercase tracking-widest mt-1\">Multiple Punches</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all group overflow-hidden relative\">\r\n          <div className=\"absolute right-0 top-0 w-24 h-24 bg-rose-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110\"></div>\r\n          <div className=\"relative z-10\">\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n              <div className=\"p-2 bg-rose-100/50 text-rose-600 rounded-lg\">\r\n                <AlertTriangle size={24} />\r\n              </div>\r\n              <span className=\"text-xs font-bold text-rose-600 bg-rose-50 px-2 py-1 rounded-full uppercase tracking-wider\">Alert</span>\r\n            </div>\r\n            <div className=\"text-3xl font-black text-slate-800\">{attendanceStats?.missingPunchOut || 0}</div>\r\n            <div className=\"text-xs font-semibold text-slate-400 uppercase tracking-widest mt-1\">Missing Out</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all group overflow-hidden relative\">\r\n          <div className=\"absolute right-0 top-0 w-24 h-24 bg-indigo-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110\"></div>\r\n          <div className=\"relative z-10\">\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n              <div className=\"p-2 bg-indigo-100/50 text-indigo-600 rounded-lg\">\r\n                <Clock size={24} />\r\n              </div>\r\n            </div>\r\n            <div className=\"text-3xl font-black text-slate-800\">{attendanceStats?.avgWorkingHours || 0}</div>\r\n            <div className=\"text-xs font-semibold text-slate-400 uppercase tracking-widest mt-1\">Avg Hours</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mt-8\">\r\n        <Link to=\"/hr/org\" className=\"bg-blue-50/50 p-6 rounded-2xl border border-blue-100 hover:border-blue-300 hover:bg-blue-50 transition cursor-pointer group\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div className=\"text-xs font-bold text-blue-400 uppercase tracking-widest\">Total Employees</div>\r\n            <Users className=\"text-blue-500 group-hover:scale-110 transition-transform\" size={20} />\r\n          </div>\r\n          <div className=\"text-4xl font-black text-blue-900\">{counts.employees}</div>\r\n        </Link>\r\n\r\n        <div className=\"bg-emerald-50/50 p-6 rounded-2xl border border-emerald-100 hover:border-emerald-300 hover:bg-emerald-50 transition group\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div className=\"text-xs font-bold text-emerald-400 uppercase tracking-widest\">Departments</div>\r\n            <Building2 className=\"text-emerald-500 group-hover:scale-110 transition-transform\" size={20} />\r\n          </div>\r\n          <div className=\"text-4xl font-black text-emerald-900\">{counts.departments}</div>\r\n        </div>\r\n\r\n        <div className=\"bg-cyan-50/50 p-6 rounded-2xl border border-cyan-100 hover:border-cyan-300 hover:bg-cyan-50 transition group\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div className=\"text-xs font-bold text-cyan-400 uppercase tracking-widest\">Managers</div>\r\n            <Briefcase className=\"text-cyan-500 group-hover:scale-110 transition-transform\" size={20} />\r\n          </div>\r\n          <div className=\"text-4xl font-black text-cyan-900\">{counts.managers}</div>\r\n        </div>\r\n\r\n        <div className=\"bg-amber-50/50 p-6 rounded-2xl border border-amber-100 hover:border-amber-300 hover:bg-amber-50 transition group\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div className=\"text-xs font-bold text-amber-400 uppercase tracking-widest\">Pending Leaves</div>\r\n            <FileClock className=\"text-amber-500 group-hover:scale-110 transition-transform\" size={20} />\r\n          </div>\r\n          <div className=\"text-4xl font-black text-amber-900\">{counts.pendingLeaves}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Employees by Department */}\r\n      <div>\r\n        <h3 className=\"text-lg font-bold text-slate-800 mb-4 mt-6\">Employees by Department</h3>\r\n        <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4\">\r\n          {departments.map(dept => (\r\n            <div key={dept._id} className=\"bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:shadow-lg hover:border-indigo-100 transition-all flex items-center justify-between group cursor-pointer relative overflow-hidden\">\r\n              <div className=\"absolute right-0 top-0 w-16 h-16 bg-gradient-to-br from-slate-50 to-indigo-50 rounded-bl-full -mr-2 -mt-2 transition-transform group-hover:scale-110\"></div>\r\n              <div className=\"relative z-10 w-full\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <div className=\"p-2 bg-slate-50 text-slate-500 rounded-lg group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors\">\r\n                    <Building2 size={16} />\r\n                  </div>\r\n                  <div className=\"text-2xl font-black text-slate-800 group-hover:text-indigo-600 transition-colors\">{dept.employeeCount || 0}</div>\r\n                </div>\r\n                <div className=\"text-xs font-bold text-slate-400 uppercase tracking-widest truncate\" title={dept.name}>{dept.name}</div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          {departments.length === 0 && <div className=\"text-slate-400 text-sm col-span-full\">No departments found.</div>}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Quick Links */}\r\n      <div className=\"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm p-4 md:p-6\">\r\n        <h3 className=\"font-bold text-slate-800 text-lg mb-4 flex items-center gap-2\">\r\n          <Settings size={20} className=\"text-slate-400\" />\r\n          Quick Actions\r\n        </h3>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <Link\r\n            to=\"/hr/org\"\r\n            className=\"flex items-center gap-4 p-4 bg-white border border-slate-200 rounded-xl hover:bg-indigo-50 hover:border-indigo-200 transition-all shadow-sm group\"\r\n          >\r\n            <div className=\"p-3 bg-indigo-100 text-indigo-600 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-colors\">\r\n              <Shield size={24} />\r\n            </div>\r\n            <div>\r\n              <div className=\"font-bold text-slate-800 text-sm\">Org Structure</div>\r\n              <div className=\"text-xs text-slate-500 font-medium\">Visualize hierarchy</div>\r\n            </div>\r\n          </Link>\r\n          <Link\r\n            to=\"/hr/users\"\r\n            className=\"flex items-center gap-4 p-4 bg-white border border-slate-200 rounded-xl hover:bg-indigo-50 hover:border-indigo-200 transition-all shadow-sm group\"\r\n          >\r\n            <div className=\"p-3 bg-indigo-100 text-indigo-600 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-colors\">\r\n              <Settings size={24} />\r\n            </div>\r\n            <div>\r\n              <div className=\"font-bold text-slate-800 text-sm\">Manage Users</div>\r\n              <div className=\"text-xs text-slate-500 font-medium\">System access control</div>\r\n            </div>\r\n          </Link>\r\n          <Link\r\n            to=\"/hr/employees\"\r\n            className=\"flex items-center gap-4 p-4 bg-white border border-slate-200 rounded-xl hover:bg-indigo-50 hover:border-indigo-200 transition-all shadow-sm group\"\r\n          >\r\n            <div className=\"p-3 bg-indigo-100 text-indigo-600 rounded-lg group-hover:bg-indigo-600 group-hover:text-white transition-colors\">\r\n              <UserPlus size={24} />\r\n            </div>\r\n            <div>\r\n              <div className=\"font-bold text-slate-800 text-sm\">Employee List</div>\r\n              <div className=\"text-xs text-slate-500 font-medium\">View all staff</div>\r\n            </div>\r\n          </Link>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"mt-10\">\r\n        <div className=\"flex items-center justify-between mb-6 px-1\">\r\n          <div>\r\n            <h3 className=\"text-xl font-black text-slate-800 flex items-center gap-2\">\r\n              <Calendar className=\"text-indigo-500\" size={24} />\r\n              Recent Leave Requests\r\n            </h3>\r\n            <p className=\"text-sm text-slate-500 font-medium mt-1\">Manage pending approvals and employee time off.</p>\r\n          </div>\r\n          <Link to=\"/hr/leave-requests\" className=\"group flex items-center gap-1 text-sm font-bold text-indigo-600 hover:text-indigo-700 bg-indigo-50 px-4 py-2 rounded-full transition-all hover:pr-6\">\r\n            View All\r\n            <ChevronRight size={16} className=\"transition-transform group-hover:translate-x-1\" />\r\n          </Link>\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          {(leaves.length === 0) ? (\r\n            <div className=\"py-16 text-center bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200\">\r\n              <div className=\"flex justify-center mb-4\">\r\n                <div className=\"p-4 bg-white rounded-full shadow-sm\">\r\n                  <FileClock size={32} className=\"text-slate-300\" />\r\n                </div>\r\n              </div>\r\n              <h4 className=\"text-slate-900 font-bold text-lg\">All Caught Up!</h4>\r\n              <p className=\"text-slate-500 text-sm mt-1\">No pending leave requests at the moment.</p>\r\n            </div>\r\n          ) : leaves.slice((currentPage - 1) * pageSize, currentPage * pageSize).map(l => {\r\n            const empName = typeof l.employee === 'object'\r\n              ? `${l.employee.firstName || ''} ${l.employee.lastName || ''}`.trim() || 'Unknown'\r\n              : l.employee || 'Unknown';\r\n            const empInitial = empName.charAt(0).toUpperCase();\r\n            const isPending = l.status === 'pending';\r\n\r\n            return (\r\n              <div key={l._id} className=\"group bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg hover:border-indigo-100 transition-all duration-300 relative overflow-hidden\">\r\n                {/* Status Color Bar */}\r\n                <div className={`absolute left-0 top-0 bottom-0 w-1.5 ${l.leaveType?.toLowerCase().includes('sick') ? 'bg-rose-500' :\r\n                    l.leaveType?.toLowerCase().includes('casual') ? 'bg-blue-500' : 'bg-indigo-500'\r\n                  }`}></div>\r\n\r\n                <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6 pl-4\">\r\n\r\n                  {/* Employee Info */}\r\n                  <div className=\"flex items-center gap-4 min-w-[200px]\">\r\n                    <div className=\"w-12 h-12 rounded-2xl bg-slate-100 flex items-center justify-center text-lg font-black text-slate-600 shadow-inner\">\r\n                      {empInitial}\r\n                    </div>\r\n                    <div>\r\n                      <h4 className=\"font-bold text-slate-900 text-base group-hover:text-indigo-700 transition-colors\">{empName}</h4>\r\n                      <p className=\"text-xs font-semibold text-slate-400 uppercase tracking-wider mt-0.5\">Development Team</p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Leave Details */}\r\n                  <div className=\"flex flex-wrap items-center gap-6 flex-1\">\r\n                    <div className=\"flex flex-col\">\r\n                      <span className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1\">Leave Type</span>\r\n                      <span className={`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold ${l.leaveType?.toLowerCase().includes('sick') ? 'bg-rose-50 text-rose-700' :\r\n                          l.leaveType?.toLowerCase().includes('casual') ? 'bg-blue-50 text-blue-700' : 'bg-slate-100 text-slate-700'\r\n                        }`}>\r\n                        <div className={`w-2 h-2 rounded-full ${l.leaveType?.toLowerCase().includes('sick') ? 'bg-rose-500' :\r\n                            l.leaveType?.toLowerCase().includes('casual') ? 'bg-blue-500' : 'bg-slate-500'\r\n                          }`}></div>\r\n                        {l.leaveType}\r\n                      </span>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col\">\r\n                      <span className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1\">Duration</span>\r\n                      <div className=\"flex items-center gap-2 font-bold text-slate-700 text-sm\">\r\n                        <Calendar size={16} className=\"text-indigo-400\" />\r\n                        {l.from ? (\r\n                          <span>\r\n                            {new Date(l.from).toLocaleDateString(undefined, { month: 'short', day: 'numeric' })}\r\n                            <span className=\"mx-2 text-slate-300\">‚ûú</span>\r\n                            {new Date(l.to).toLocaleDateString(undefined, { month: 'short', day: 'numeric' })}\r\n                          </span>\r\n                        ) : <span className=\"italic text-slate-400\">Date info missing</span>}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <div className=\"flex items-center gap-3\">\r\n                    {isPending ? (\r\n                      <>\r\n                        <button className=\"flex items-center gap-2 px-4 py-2 bg-emerald-50 text-emerald-700 font-bold rounded-xl hover:bg-emerald-500 hover:text-white transition-all shadow-sm border border-emerald-100 hover:border-emerald-500\">\r\n                          <CheckCircle size={18} />\r\n                          <span className=\"text-xs\">Approve</span>\r\n                        </button>\r\n                        <button className=\"flex items-center gap-2 px-4 py-2 bg-rose-50 text-rose-700 font-bold rounded-xl hover:bg-rose-500 hover:text-white transition-all shadow-sm border border-rose-100 hover:border-rose-500\">\r\n                          <XCircle size={18} />\r\n                          <span className=\"text-xs\">Reject</span>\r\n                        </button>\r\n                      </>\r\n                    ) : (\r\n                      <div className={`px-4 py-2 rounded-xl font-bold text-xs uppercase tracking-wider flex items-center gap-2 ${l.status === 'Approved' ? 'bg-emerald-50 text-emerald-600 border border-emerald-100' :\r\n                          l.status === 'Rejected' ? 'bg-rose-50 text-rose-600 border border-rose-100' : 'bg-slate-50 text-slate-500'\r\n                        }`}>\r\n                        {l.status === 'Approved' ? <CheckCircle size={16} /> : <XCircle size={16} />}\r\n                        {l.status}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n\r\n          {leaves.length > pageSize && (\r\n            <div className=\"pt-6 flex justify-center\">\r\n              <Pagination\r\n                current={currentPage}\r\n                pageSize={pageSize}\r\n                total={leaves.length}\r\n                onChange={(page) => setCurrentPage(page)}\r\n                showSizeChanger={false}\r\n              />\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\LeaveApprovals.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token `}`. Did you mean `&rbrace;` or `{\"}\"}`?","line":409,"column":1}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Pagination, notification } from 'antd';\r\nimport api from '../../utils/api';\r\nimport { Check, X, Eye, ChevronLeft, ChevronRight, AlertCircle, Clock, CheckCircle, XCircle, FileText, Filter } from 'lucide-react';\r\nimport { formatDateDDMMYYYY, formatDateTimeDDMMYYYY } from '../../utils/dateUtils';\r\n\r\nexport default function LeaveApprovals({\r\n    isManagerView = false,\r\n    endpoint = '/hr/leaves/requests',\r\n    actionEndpoint = '/hr/leaves/requests'\r\n}) {\r\n    const [requests, setRequests] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [pagination, setPagination] = useState({ page: 1, limit: 10, total: 0, totalPages: 1 });\r\n\r\n    // Modals state\r\n    const [viewReason, setViewReason] = useState(null); // content string or null\r\n    const [actionModal, setActionModal] = useState(null); // { id, type } or null\r\n    const [remark, setRemark] = useState('');\r\n\r\n    useEffect(() => {\r\n        fetchRequests(pagination.page);\r\n    }, [pagination.page, endpoint]);\r\n\r\n    const fetchRequests = async (page = 1) => {\r\n        setLoading(true);\r\n        try {\r\n            const separator = endpoint.includes('?') ? '&' : '?';\r\n            const res = await api.get(`${endpoint}${separator}page=${page}&limit=${pagination.limit}`);\r\n            if (res.data.data) {\r\n                // New format with pagination\r\n                setRequests(res.data.data);\r\n                setPagination(prev => ({ ...prev, ...res.data.meta }));\r\n            } else {\r\n                // Fallback for old API if something goes wrong or returns array\r\n                setRequests(res.data);\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleActionSubmit = async () => {\r\n        if (!actionModal) return;\r\n        if (!remark.trim()) {\r\n            notification.error({ message: 'Error', description: \"Remark is mandatory.\", placement: 'topRight' });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const body = { remark, rejectionReason: remark };\r\n            await api.post(`${actionEndpoint}/${actionModal.id}/${actionModal.type}`, body);\r\n            notification.success({\r\n                message: 'Success',\r\n                description: `Request ${actionModal.type === 'approve' ? 'Approved' : 'Rejected'} Successfully`,\r\n                placement: 'topRight'\r\n            });\r\n            setActionModal(null);\r\n            setRemark('');\r\n            fetchRequests(pagination.page);\r\n        } catch (err) {\r\n            notification.error({\r\n                message: 'Action Failed',\r\n                description: err.response?.data?.error || \"An error occurred\",\r\n                placement: 'topRight'\r\n            });\r\n        }\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'Approved': return 'text-emerald-700 bg-emerald-50 border-emerald-200 ring-emerald-200/50';\r\n            case 'Rejected': return 'text-rose-700 bg-rose-50 border-rose-200 ring-rose-200/50';\r\n            default: return 'text-amber-700 bg-amber-50 border-amber-200 ring-amber-200/50';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-in fade-in duration-500\">\r\n            {/* Header & Stats */}\r\n            {!isManagerView && (\r\n                <div className=\"flex flex-col md:flex-row gap-6\">\r\n                    <div className=\"flex-1 space-y-1\">\r\n                        <h1 className=\"text-2xl sm:text-3xl font-bold text-slate-900 tracking-tight\">\r\n                            Leave Requests\r\n                        </h1>\r\n                        <p className=\"text-sm text-slate-500\">\r\n                            Review and manage employee leave applications.\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Stats Cards Layout (Compact) */}\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 flex-shrink-0 min-w-[500px]\">\r\n                        <div className=\"relative overflow-hidden bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 text-white shadow-lg shadow-blue-500/20 flex flex-col justify-between h-24\">\r\n                            <div className=\"relative z-10\">\r\n                                <div className=\"text-blue-100 text-[10px] font-bold uppercase tracking-wider\">Total Requests</div>\r\n                                <div className=\"text-2xl font-bold mt-1\">{pagination.total}</div>\r\n                            </div>\r\n                            <FileText className=\"absolute right-[-10px] bottom-[-10px] text-white opacity-10\" size={60} />\r\n                        </div>\r\n\r\n                        <div className=\"relative overflow-hidden bg-gradient-to-br from-amber-500 to-amber-600 rounded-2xl p-4 text-white shadow-lg shadow-amber-500/20 flex flex-col justify-between h-24\">\r\n                            <div className=\"relative z-10\">\r\n                                <div className=\"text-amber-100 text-[10px] font-bold uppercase tracking-wider\">Pending Action</div>\r\n                                <div className=\"text-2xl font-bold mt-1\">\r\n                                    {requests.filter(r => r.status === 'Pending').length}\r\n                                    <span className=\"text-xs font-normal opacity-70 ml-1\">on this page</span>\r\n                                </div>\r\n                            </div>\r\n                            <Clock className=\"absolute right-[-10px] bottom-[-10px] text-white opacity-10\" size={60} />\r\n                        </div>\r\n\r\n                        <div className=\"relative overflow-hidden bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-4 text-white shadow-lg shadow-emerald-500/20 flex flex-col justify-between h-24\">\r\n                            <div className=\"relative z-10\">\r\n                                <div className=\"text-emerald-100 text-[10px] font-bold uppercase tracking-wider\">Approved</div>\r\n                                <div className=\"text-2xl font-bold mt-1\">\r\n                                    {requests.filter(r => r.status === 'Approved').length}\r\n                                    <span className=\"text-xs font-normal opacity-70 ml-1\">on this page</span>\r\n                                </div>\r\n                            </div>\r\n                            <CheckCircle className=\"absolute right-[-10px] bottom-[-10px] text-white opacity-10\" size={60} />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden\">\r\n                {/* Table Header/Toolbar */}\r\n                <div className=\"px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-slate-50/50\">\r\n                    <h3 className=\"text-sm font-semibold text-slate-700\">All Applications</h3>\r\n                    <div className=\"flex gap-2\">\r\n                        <button className=\"p-2 text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded-lg transition\">\r\n                            <Filter size={16} />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden border border-slate-200 dark:border-slate-700\">\r\n                <div className=\"table-responsive mobile-card-hide\">\r\n                    <table className=\"min-w-full divide-y divide-gray-200 dark:divide-slate-700 text-sm\">\r\n                        <thead className=\"bg-slate-50 dark:bg-slate-900/50\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Employee</th>\r\n                                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Type</th>\r\n                                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Dates</th>\r\n                                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Days</th>\r\n                                <th className=\"px-6 py-4 text-center text-xs font-semibold text-slate-500 uppercase tracking-wider\">Reason</th>\r\n                                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">Status</th>\r\n                                <th className=\"px-6 py-4 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider\">Actions</th>\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"min-w-full text-left text-sm\">\r\n                        <thead>\r\n                            <tr className=\"bg-slate-50 border-b border-slate-200\">\r\n                                <th className=\"px-6 py-3 font-semibold text-slate-500\">Employee</th>\r\n                                <th className=\"px-6 py-3 font-semibold text-slate-500\">Type</th>\r\n                                <th className=\"px-6 py-3 font-semibold text-slate-500\">Dates</th>\r\n                                <th className=\"px-6 py-3 font-semibold text-slate-500\">Duration</th>\r\n                                <th className=\"px-6 py-3 font-semibold text-slate-500 text-center\">Reason</th>\r\n                                <th className=\"px-6 py-3 font-semibold text-slate-500\">Status</th>\r\n                                <th className=\"px-6 py-3 font-semibold text-slate-500 text-right\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-100\">\r\n                            {loading ? (\r\n                                <tr><td colSpan=\"7\" className=\"p-10 text-center text-slate-400\">Loading requests...</td></tr>\r\n                            ) : requests.length === 0 ? (\r\n                                <tr><td colSpan=\"7\" className=\"px-6 py-12 text-center text-slate-500\">No leave requests found.</td></tr>\r\n                            ) : (\r\n                                requests.map(req => (\r\n                                    <tr key={req._id} className=\"hover:bg-slate-50 transition duration-200\">\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"flex-shrink-0 h-9 w-9 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-xs ring-2 ring-white border border-blue-200 shadow-sm\">\r\n                                                    {req.employee?.firstName?.[0] || 'U'}\r\n                                                </div>\r\n                                                <div className=\"min-w-0\">\r\n                                                    <div className=\"font-semibold text-slate-900 truncate\">\r\n                                                        {req.employee?.firstName} {req.employee?.lastName}\r\n                                                    </div>\r\n                                                    <div className=\"text-xs text-slate-500 truncate\" title={req.employee?.email}>{req.employee?.email}</div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <div className=\"font-medium text-slate-700\">{req.leaveType}</div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"font-medium text-slate-700\">\r\n                                                    {formatDateDDMMYYYY(req.startDate)} - {formatDateDDMMYYYY(req.endDate)}\r\n                                                </span>\r\n                                                {req.isHalfDay && (\r\n                                                    <span className=\"text-[10px] text-blue-600 font-semibold bg-blue-50 w-fit px-1.5 rounded mt-0.5\">\r\n                                                        Half-Day\r\n                                                    </span>\r\n                                                )}\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <span className=\"inline-flex items-center px-2 py-1 rounded-md bg-slate-100 text-slate-600 text-xs font-semibold\">\r\n                                                {req.daysCount} Day{req.daysCount !== 1 ? 's' : ''}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-center\">\r\n                                            <button\r\n                                                onClick={() => setViewReason(req.reason)}\r\n                                                className=\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-200 text-slate-500 hover:text-blue-600 hover:bg-blue-50 hover:border-blue-100 text-xs font-medium transition\"\r\n                                            >\r\n                                                <Eye size={14} /> View\r\n                                            </button>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <span className={`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-semibold border ring-1 ring-inset shadow-sm ${getStatusColor(req.status)}`}>\r\n                                                {req.status}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-right\">\r\n                                            {req.status === 'Pending' ? (\r\n                                                <div className=\"flex justify-end gap-2\">\r\n                                                    <button\r\n                                                        onClick={() => { setActionModal({ id: req._id, type: 'approve' }); setRemark(''); }}\r\n                                                        className=\"p-1.5 rounded-lg bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 transition shadow-sm\"\r\n                                                        title=\"Approve\"\r\n                                                    >\r\n                                                        <Check size={16} />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => { setActionModal({ id: req._id, type: 'reject' }); setRemark(''); }}\r\n                                                        className=\"p-1.5 rounded-lg bg-rose-50 text-rose-600 hover:bg-rose-100 border border-rose-200 transition shadow-sm\"\r\n                                                        title=\"Reject\"\r\n                                                    >\r\n                                                        <X size={16} />\r\n                                                    </button>\r\n                                                </div>\r\n                                            ) : (\r\n                                                <div className=\"flex flex-col items-end\">\r\n                                                    <span className=\"text-[10px] font-semibold text-slate-400 uppercase tracking-wider\">\r\n                                                        {req.status}\r\n                                                    </span>\r\n                                                    {req.actionDateTime && (\r\n                                                        <span className=\"text-[10px] text-slate-400\">\r\n                                                            {formatDateTimeDDMMYYYY(req.actionDateTime).split(' ')[0]}\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                            )}\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n                {/* Mobile Card View (<= 480px) */}\r\n                <div className=\"mobile-card-show bg-slate-50/50 divide-y divide-slate-200\">\r\n                    {loading ? (\r\n                        <div className=\"p-10 text-center text-slate-500\">Loading...</div>\r\n                    ) : requests.length === 0 ? (\r\n                        <div className=\"p-10 text-center text-slate-500\">No leave requests found.</div>\r\n                    ) : (\r\n                        requests.map(req => (\r\n                            <div key={req._id} className=\"p-4 bg-white space-y-4\">\r\n                                <div className=\"flex justify-between items-start\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-sm\">\r\n                                            {req.employee?.firstName?.[0] || 'U'}\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"font-bold text-slate-900\">{req.employee?.firstName} {req.employee?.lastName}</div>\r\n                                            <div className=\"text-[10px] text-slate-400 uppercase font-bold tracking-wider\">{req.leaveType}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <span className={`px-2.5 py-1 text-[10px] font-bold rounded-full border ${getStatusColor(req.status)}`}>\r\n                                        {req.status}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-2 gap-4 py-3 border-y border-slate-50\">\r\n                                    <div>\r\n                                        <div className=\"text-[10px] text-slate-400 uppercase font-bold mb-1\">Duration</div>\r\n                                        <div className=\"text-xs font-semibold text-slate-700\">\r\n                                            {formatDateDDMMYYYY(req.startDate)} - {formatDateDDMMYYYY(req.endDate)}\r\n                                            <span className=\"ml-1 text-blue-600\">({req.daysCount} d)</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"text-right\">\r\n                                        <div className=\"text-[10px] text-slate-400 uppercase font-bold mb-1\">Reason</div>\r\n                                        <button\r\n                                            onClick={() => setViewReason(req.reason)}\r\n                                            className=\"text-xs text-blue-600 font-bold hover:underline\"\r\n                                        >\r\n                                            View Details\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {req.status === 'Pending' ? (\r\n                                    <div className=\"flex gap-2 pt-1\">\r\n                                        <button\r\n                                            onClick={() => { setActionModal({ id: req._id, type: 'approve' }); setRemark(''); }}\r\n                                            className=\"flex-1 py-2 bg-emerald-600 text-white rounded-lg text-xs font-bold shadow-sm flex items-center justify-center gap-2\"\r\n                                        >\r\n                                            <Check size={14} /> APPROVE\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => { setActionModal({ id: req._id, type: 'reject' }); setRemark(''); }}\r\n                                            className=\"flex-1 py-2 bg-rose-50 text-rose-600 border border-rose-100 rounded-lg text-xs font-bold flex items-center justify-center gap-2\"\r\n                                        >\r\n                                            <X size={14} /> REJECT\r\n                                        </button>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"text-[10px] text-slate-500 italic text-center py-1 bg-slate-50 rounded\">\r\n                                        Processed {req.actionDateTime && `on ${formatDateTimeDDMMYYYY(req.actionDateTime)}`} {req.actionBy && `by ${req.actionBy.firstName}`}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"px-6 py-4 border-t border-slate-200 dark:border-slate-700 flex justify-end bg-slate-50 dark:bg-slate-900/50\">\r\n                <div className=\"px-6 py-4 border-t border-slate-200 bg-slate-50 flex justify-end\">\r\n                    <Pagination\r\n                        current={pagination.page}\r\n                        pageSize={pagination.limit}\r\n                        total={pagination.total}\r\n                        onChange={(page) => setPagination(prev => ({ ...prev, page }))}\r\n                        showSizeChanger={false}\r\n                        hideOnSinglePage\r\n                        size=\"small\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* View Reason Modal */}\r\n            {viewReason !== null && (\r\n                <div className=\"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 animate-in fade-in zoom-in-95 duration-200\">\r\n                        <div className=\"flex justify-between items-center mb-4 border-b border-slate-100 pb-3\">\r\n                            <h3 className=\"text-lg font-bold text-slate-800\">Leave Reason</h3>\r\n                            <button onClick={() => setViewReason(null)} className=\"text-slate-400 hover:text-slate-600 transition\">\r\n                                <X size={20} />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"bg-slate-50 p-4 rounded-lg text-sm text-slate-700 min-h-[100px] whitespace-pre-wrap border border-slate-100 font-medium leading-relaxed\">\r\n                            {viewReason || \"No reason provided by the employee.\"}\r\n                        </div>\r\n                        <div className=\"mt-6 flex justify-end\">\r\n                            <button onClick={() => setViewReason(null)} className=\"px-4 py-2 bg-white border border-slate-200 text-slate-600 rounded-lg hover:bg-slate-50 text-sm font-medium transition shadow-sm\">\r\n                                Close\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Action Confirmation Modal */}\r\n            {actionModal && (\r\n                <div className=\"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 animate-in fade-in zoom-in-95 duration-200\">\r\n                        <div className=\"flex flex-col items-center mb-5 text-center\">\r\n                            <div className={`h-14 w-14 rounded-full flex items-center justify-center mb-4 shadow-sm ${actionModal.type === 'approve' ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'}`}>\r\n                                {actionModal.type === 'approve' ? <Check size={28} /> : <AlertCircle size={28} />}\r\n                            </div>\r\n                            <h3 className=\"text-xl font-bold text-slate-800 capitalize\">\r\n                                {actionModal.type} Request\r\n                            </h3>\r\n                            <p className=\"text-sm text-slate-500 mt-2 px-2 leading-relaxed\">\r\n                                Are you sure you want to <strong>{actionModal.type}</strong> this leave request? This action cannot be undone.\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div className=\"mb-5\">\r\n                            <label className=\"block text-xs font-bold text-slate-700 mb-1.5 uppercase tracking-wide\">\r\n                                Admin Remark <span className=\"text-rose-500\">*</span>\r\n                            </label>\r\n                            <textarea\r\n                                value={remark}\r\n                                onChange={(e) => setRemark(e.target.value)}\r\n                                className=\"w-full px-3 py-2 border border-slate-200 bg-slate-50 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm min-h-[100px] resize-none outline-none transition\"\r\n                                placeholder=\"Enter reason or remarks...\"\r\n                                autoFocus\r\n                            ></textarea>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-3\">\r\n                            <button\r\n                                onClick={() => setActionModal(null)}\r\n                                className=\"flex-1 px-4 py-2 border border-slate-200 text-slate-600 rounded-lg hover:bg-slate-50 text-sm font-medium transition\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleActionSubmit}\r\n                                className={`flex-1 px-4 py-2 text-white rounded-lg text-sm font-medium shadow-md hover:shadow-lg transition-all transform active:scale-95 ${actionModal.type === 'approve' ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-rose-600 hover:bg-rose-700'}`}\r\n                            >\r\n                                Confirm {actionModal.type === 'approve' ? 'Approval' : 'Rejection'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\LeavePolicies.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":165,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":165,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { showToast, showConfirmToast } from '../../utils/uiNotifications';\r\nimport api from '../../utils/api';\r\nimport { Plus, Trash2, Edit2, Save, X, Check, AlertTriangle } from 'lucide-react';\r\n\r\nexport default function LeavePolicies() {\r\n    const [policies, setPolicies] = useState([]);\r\n    const [employees, setEmployees] = useState([]);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Edit mode\r\n    const [editingId, setEditingId] = useState(null);\r\n\r\n    const [form, setForm] = useState({\r\n        name: '',\r\n        applicableTo: 'All', // All, Department, Role, Specific\r\n        specificEmployeeId: '',\r\n        roles: [],\r\n        departmentIds: [],\r\n        rules: []\r\n    });\r\n\r\n    const [ruleForm, setRuleForm] = useState({\r\n        leaveType: '',\r\n        totalPerYear: 0,\r\n        monthlyAccrual: false,\r\n        carryForwardAllowed: false,\r\n        maxCarryForward: 0,\r\n        requiresApproval: true,\r\n        color: '#3b82f6'\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchPolicies();\r\n        fetchEmployees();\r\n    }, []);\r\n\r\n    const fetchPolicies = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await api.get('/hr/leave-policies');\r\n            setPolicies(res.data);\r\n        } catch (err) {\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const fetchEmployees = async () => {\r\n        try {\r\n            const res = await api.get('/hr/employees');\r\n            if (res.data.success && Array.isArray(res.data.data)) {\r\n                setEmployees(res.data.data);\r\n            } else if (Array.isArray(res.data)) {\r\n                setEmployees(res.data);\r\n            } else {\r\n                setEmployees([]);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Failed to fetch employees\", err);\r\n        }\r\n    };\r\n\r\n    const handleEdit = (policy) => {\r\n        setEditingId(policy._id);\r\n        setForm({\r\n            ...policy,\r\n            specificEmployeeId: policy.specificEmployeeId || '',\r\n        });\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleCreateNew = () => {\r\n        setEditingId(null);\r\n        setForm({ name: '', applicableTo: 'All', specificEmployeeId: '', roles: [], departmentIds: [], rules: [] });\r\n        setShowModal(true);\r\n    };\r\n\r\n    const addRule = () => {\r\n        if (!ruleForm.leaveType) return showToast('error', 'Validation Error', \"Leave Type required\");\r\n        setForm(prev => ({\r\n            ...prev,\r\n            rules: [...prev.rules, { ...ruleForm }]\r\n        }));\r\n        setRuleForm({\r\n            leaveType: '',\r\n            totalPerYear: 0,\r\n            monthlyAccrual: false,\r\n            carryForwardAllowed: false,\r\n            maxCarryForward: 0,\r\n            requiresApproval: true,\r\n            color: '#3b82f6'\r\n        });\r\n    };\r\n\r\n    const removeRule = (idx) => {\r\n        setForm(prev => ({\r\n            ...prev,\r\n            rules: prev.rules.filter((_, i) => i !== idx)\r\n        }));\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            if (editingId) {\r\n                // Update\r\n                showConfirmToast({\r\n                    title: 'Update Policy?',\r\n                    description: 'This update requires careful review. Are you sure?',\r\n                    okText: 'Update',\r\n                    cancelText: 'Cancel',\r\n                    onConfirm: async () => {\r\n                        try {\r\n                            await api.put(`/hr/leave-policies/${editingId}`, form);\r\n                            showToast('success', 'Success', \"Policy updated successfully.\");\r\n                            setShowModal(false);\r\n                            fetchPolicies();\r\n                        } catch (err) {\r\n                            showToast('error', 'Error', err.response?.data?.error || \"Failed to update policy\");\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                // Create\r\n                await api.post('/hr/leave-policies', form);\r\n                showToast('success', 'Success', \"Policy created successfully.\");\r\n                setShowModal(false);\r\n                fetchPolicies();\r\n            }\r\n        } catch (err) {\r\n            console.error('Submit error:', err);\r\n            const errorMsg = err.response?.data?.error || \"Failed to save policy\";\r\n            showToast('error', 'Error', errorMsg);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (id) => {\r\n        showConfirmToast({\r\n            title: 'Delete Policy?',\r\n            description: 'This will remove policies from employees. This action cannot be undone.',\r\n            okText: 'Delete',\r\n            cancelText: 'Cancel',\r\n            danger: true,\r\n            onConfirm: async () => {\r\n                try {\r\n                    await api.delete(`/hr/leave-policies/${id}`);\r\n                    showToast('success', 'Success', \"Policy deleted successfully\");\r\n                    fetchPolicies();\r\n                } catch (err) {\r\n                    console.error(err);\r\n                    showToast('error', 'Error', \"Failed to delete policy\");\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const toggleStatus = async (id, currentStatus) => {\r\n        try {\r\n            await api.patch(`/hr/leave-policies/${id}/status`, { isActive: !currentStatus });\r\n            setPolicies(prev => prev.map(p => p._id === id ? { ...p, isActive: !currentStatus } : p));\r\n            showToast('success', 'Success', `Policy ${!currentStatus ? 'Activated' : 'Deactivated'}`);\r\n        } catch (err) {\r\n            showToast('error', 'Error', \"Failed to update status\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <h1 className=\"text-2xl font-bold text-slate-800\">Leave Policies</h1>\r\n                <button onClick={handleCreateNew} className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-sm transition\">\r\n                    <Plus size={18} /> New Policy\r\n                </button>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className=\"text-center py-10 text-slate-500\">Loading policies...</div>\r\n            ) : (\r\n                <div className=\"grid gap-6 md:grid-cols-2 xl:grid-cols-3\">\r\n                    {policies.map(p => (\r\n                        <div key={p._id} className={`bg-white rounded-xl shadow-sm border ${p.isActive ? 'border-slate-200' : 'border-slate-200 bg-slate-50 opacity-75'} relative overflow-hidden transition hover:shadow-md`}>\r\n                            {/* Status Indicator Bar */}\r\n                            <div className={`h-1.5 w-full ${p.isActive ? 'bg-emerald-500' : 'bg-slate-300'}`}></div>\r\n\r\n                            <div className=\"p-5\">\r\n                                <div className=\"flex justify-between items-start mb-4\">\r\n                                    <div>\r\n                                        <h3 className=\"text-lg font-bold text-slate-800 flex items-center gap-2\">\r\n                                            {p.name}\r\n                                            {!p.isActive && <span className=\"text-[10px] bg-slate-200 text-slate-600 px-1.5 py-0.5 rounded uppercase tracking-wider\">Inactive</span>}\r\n                                        </h3>\r\n                                        <div className=\"text-xs text-slate-500 uppercase tracking-wide mt-1 font-semibold\">\r\n                                            {p.applicableTo === 'Specific' ? 'Specific Employee' : `To: ${p.applicableTo}`}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex gap-1\">\r\n                                        {/* Status Toggle */}\r\n                                        <button\r\n                                            onClick={() => toggleStatus(p._id, p.isActive)}\r\n                                            className={`p-1.5 rounded-md transition ${p.isActive ? 'text-emerald-600 hover:bg-emerald-50' : 'text-slate-400 hover:bg-slate-100 hover:text-slate-600'}`}\r\n                                            title={p.isActive ? \"Deactivate\" : \"Activate\"}\r\n                                        >\r\n                                            <Check size={16} className={!p.isActive ? \"opacity-50\" : \"\"} />\r\n                                        </button>\r\n\r\n                                        <button onClick={() => handleEdit(p)} className=\"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition\">\r\n                                            <Edit2 size={16} />\r\n                                        </button>\r\n                                        <button onClick={() => handleDelete(p._id)} className=\"p-1.5 text-rose-500 hover:bg-rose-50 rounded-md transition\">\r\n                                            <Trash2 size={16} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2 mt-4\">\r\n                                    {p.rules.map((r, i) => (\r\n                                        <div key={i} className=\"flex justify-between text-sm bg-slate-50 p-2.5 rounded-lg border border-slate-100\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <div className=\"h-2 w-2 rounded-full\" style={{ backgroundColor: r.color || '#3b82f6' }}></div>\r\n                                                <span className=\"font-bold text-slate-700 w-8\">{r.leaveType}</span>\r\n                                                <span className=\"text-xs text-slate-400\">|</span>\r\n                                                <span className=\"text-slate-600 font-medium\">{r.totalPerYear} / yr</span>\r\n                                            </div>\r\n                                            <div className=\"flex gap-1\">\r\n                                                {r.monthlyAccrual && <span className=\"text-[10px] bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded border border-blue-100\">Monthly</span>}\r\n                                                {r.carryForwardAllowed && <span className=\"text-[10px] bg-amber-50 text-amber-600 px-1.5 py-0.5 rounded border border-amber-100\">CF</span>}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {showModal && (\r\n                <div className=\"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50\">\r\n                    <div className=\"bg-white rounded-xl w-full w-full max-h-[90vh] overflow-y-auto shadow-2xl animate-in fade-in zoom-in-95 duration-200\">\r\n                        <div className=\"flex justify-between items-center px-6 py-4 border-b border-slate-100 sticky top-0 bg-white z-10\">\r\n                            <h2 className=\"text-xl font-bold text-slate-800\">{editingId ? 'Edit Leave Policy' : 'Create Leave Policy'}</h2>\r\n                            <button onClick={() => setShowModal(false)} className=\"text-slate-400 hover:text-slate-600 transition\"><X /></button>\r\n                        </div>\r\n\r\n                        <form onSubmit={handleSubmit} className=\"p-6 space-y-8\">\r\n                            {/* Section 1: Basic Info */}\r\n                            <div className=\"space-y-4\">\r\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2\">\r\n                                    1. Basic Configuration\r\n                                </h3>\r\n                                <div className=\"grid md:grid-cols-2 gap-5\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1.5\">Policy Name</label>\r\n                                        <input type=\"text\" className=\"w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition\" required\r\n                                            placeholder=\"e.g. Standard Leave Policy\"\r\n                                            value={form.name} onChange={e => setForm({ ...form, name: e.target.value })} />\r\n                                    </div>\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-1.5\">Applicable To</label>\r\n                                        <select className=\"w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-white\"\r\n                                            value={form.applicableTo}\r\n                                            onChange={e => {\r\n                                                setForm({ ...form, applicableTo: e.target.value, specificEmployeeId: '', roles: [], departmentIds: [] });\r\n                                            }}>\r\n                                            <option value=\"All\">All Employees</option>\r\n                                            <option value=\"Role\">By Role</option>\r\n                                            <option value=\"Department\">By Department</option>\r\n                                            <option value=\"Specific\">Specific Employee</option>\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Dynamic Logic */}\r\n                                {form.applicableTo === 'Role' && (\r\n                                    <div className=\"p-4 bg-slate-50 rounded-lg border border-slate-200\">\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">Select Roles</label>\r\n                                        <div className=\"flex flex-wrap gap-2\">\r\n                                            {['Employee', 'Manager', 'HR', 'Intern', 'Admin'].map(role => (\r\n                                                <label key={role} className={`flex items-center gap-2 border px-3 py-1.5 rounded-full cursor-pointer transition text-sm select-none ${form.roles?.includes(role) ? 'bg-blue-100 border-blue-200 text-blue-700 font-medium' : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-100'}`}>\r\n                                                    <input\r\n                                                        type=\"checkbox\"\r\n                                                        className=\"check-accent\"\r\n                                                        hidden\r\n                                                        checked={form.roles?.includes(role) || false}\r\n                                                        onChange={e => {\r\n                                                            const roles = form.roles || [];\r\n                                                            if (e.target.checked) setForm({ ...form, roles: [...roles, role] });\r\n                                                            else setForm({ ...form, roles: roles.filter(r => r !== role) });\r\n                                                        }}\r\n                                                    />\r\n                                                    {role}\r\n                                                </label>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {form.applicableTo === 'Specific' && (\r\n                                    <div className=\"p-4 bg-slate-50 rounded-lg border border-slate-200\">\r\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">Select Employee</label>\r\n                                        <select className=\"w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none bg-white\"\r\n                                            value={form.specificEmployeeId}\r\n                                            onChange={e => setForm({ ...form, specificEmployeeId: e.target.value })}>\r\n                                            <option value=\"\">-- Choose Employee --</option>\r\n                                            {employees.map(emp => (\r\n                                                <option key={emp._id} value={emp._id}>\r\n                                                    {emp.firstName} {emp.lastName} ({emp.employeeId || 'No ID'})\r\n                                                </option>\r\n                                            ))}\r\n                                        </select>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <hr className=\"border-slate-100\" />\r\n\r\n                            {/* Section 2: Rules */}\r\n                            <div className=\"space-y-4\">\r\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2\">\r\n                                    2. Leave Rules Configuration\r\n                                </h3>\r\n\r\n                                {/* Rule Builder */}\r\n                                <div className=\"bg-slate-50 p-5 rounded-xl border border-slate-200\">\r\n                                    <div className=\"grid md:grid-cols-7 gap-4 items-end\">\r\n                                        <div className=\"md:col-span-1\">\r\n                                            <label className=\"text-xs font-bold text-slate-600 mb-1.5 block\">Leave Type</label>\r\n                                            <input list=\"leaveTypes\" className=\"w-full border border-slate-300 rounded-md p-2 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                                                placeholder=\"Select or Type\"\r\n                                                value={ruleForm.leaveType}\r\n                                                onChange={e => setRuleForm({ ...ruleForm, leaveType: e.target.value })}\r\n                                            />\r\n                                            <datalist id=\"leaveTypes\">\r\n                                                <option value=\"CL\" />\r\n                                                <option value=\"PL\" />\r\n                                                <option value=\"SL\" />\r\n                                                <option value=\"EL\" />\r\n                                                <option value=\"LWP\" />\r\n                                            </datalist>\r\n                                        </div>\r\n                                        <div className=\"md:col-span-1\">\r\n                                            <label className=\"text-xs font-bold text-slate-600 mb-1.5 block\">Total / Year</label>\r\n                                            <input type=\"number\" className=\"w-full border border-slate-300 rounded-md p-2 text-sm focus:border-blue-500 outline-none\"\r\n                                                min=\"0\"\r\n                                                value={ruleForm.totalPerYear} onChange={e => setRuleForm({ ...ruleForm, totalPerYear: parseInt(e.target.value) || 0 })} />\r\n                                        </div>\r\n                                        <div className=\"md:col-span-1 flex flex-col items-center\">\r\n                                            <label className=\"text-xs font-bold text-slate-600 mb-2 block cursor-pointer\" title=\"Add 1/12th every month\">Monthly Accrual</label>\r\n                                            <input type=\"checkbox\" className=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\"\r\n                                                checked={ruleForm.monthlyAccrual} onChange={e => setRuleForm({ ...ruleForm, monthlyAccrual: e.target.checked })} />\r\n                                        </div>\r\n                                        <div className=\"md:col-span-1 flex flex-col items-center\">\r\n                                            <label className=\"text-xs font-bold text-slate-600 mb-2 block cursor-pointer\">Carry Forward</label>\r\n                                            <input type=\"checkbox\" className=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\"\r\n                                                checked={ruleForm.carryForwardAllowed} onChange={e => setRuleForm({ ...ruleForm, carryForwardAllowed: e.target.checked })} />\r\n                                        </div>\r\n                                        <div className=\"md:col-span-1\">\r\n                                            <label className=\"text-xs font-bold text-slate-600 mb-1.5 block\">Max CF</label>\r\n                                            <input type=\"number\" className=\"w-full border border-slate-300 rounded-md p-2 text-sm disabled:bg-slate-100 disabled:text-slate-400\"\r\n                                                min=\"0\" disabled={!ruleForm.carryForwardAllowed}\r\n                                                value={ruleForm.maxCarryForward} onChange={e => setRuleForm({ ...ruleForm, maxCarryForward: parseInt(e.target.value) || 0 })} />\r\n                                        </div>\r\n                                        <div className=\"md:col-span-1\">\r\n                                            <label className=\"text-xs font-bold text-slate-600 mb-1.5 block\">Color</label>\r\n                                            <input type=\"color\" className=\"w-full h-9 border border-slate-300 rounded-md p-1 cursor-pointer\"\r\n                                                value={ruleForm.color} onChange={e => setRuleForm({ ...ruleForm, color: e.target.value })} />\r\n                                        </div>\r\n                                        <div className=\"md:col-span-1\">\r\n                                            <button type=\"button\" onClick={addRule} className=\"w-full bg-slate-800 text-white p-2 rounded-md text-sm font-medium hover:bg-slate-700 transition shadow-sm\">\r\n                                                Add Rule\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Rule List */}\r\n                                <div className=\"space-y-2\">\r\n                                    {form.rules.length === 0 && <p className=\"text-sm text-slate-400 italic\">No rules added yet.</p>}\r\n                                    {form.rules.map((r, i) => (\r\n                                        <div key={i} className=\"flex items-center justify-between border border-slate-200 p-3 rounded-lg bg-white shadow-sm hover:shadow-md transition\">\r\n                                            <div className=\"flex items-center gap-6 text-sm\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <span className=\"h-8 w-8 rounded-full flex items-center justify-center font-bold text-xs\" style={{ backgroundColor: `${r.color}20`, color: r.color }}>{r.leaveType}</span>\r\n                                                    <span className=\"font-semibold text-slate-700\">{r.leaveType}</span>\r\n                                                </div>\r\n                                                <span className=\"text-slate-600 bg-slate-50 px-2 py-1 rounded border border-slate-100\">{r.totalPerYear} days/yr</span>\r\n                                                {r.monthlyAccrual && <span className=\"px-2 bg-blue-50 text-blue-700 rounded text-xs py-0.5 border border-blue-100 font-medium\">Monthly Accrual</span>}\r\n                                                {r.carryForwardAllowed && <span className=\"px-2 bg-amber-50 text-amber-700 rounded text-xs py-0.5 border border-amber-100 font-medium\">Carry Fwd (Max: {r.maxCarryForward})</span>}\r\n                                            </div>\r\n                                            <button type=\"button\" onClick={() => removeRule(i)} className=\"text-rose-400 hover:text-rose-600 p-1.5 hover:bg-rose-50 rounded transition\">\r\n                                                <Trash2 size={16} />\r\n                                            </button>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-end pt-6 border-t border-slate-100 sticky bottom-0 bg-white pb-0\">\r\n                                <button type=\"submit\" className=\"bg-blue-600 text-white px-8 py-2.5 rounded-lg hover:bg-blue-700 shadow-lg shadow-blue-200 font-medium transition flex items-center gap-2\">\r\n                                    <Save size={18} />\r\n                                    {editingId ? 'Update Policy' : 'Create Policy'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Leaves.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\LetterSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\LetterTemplates.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\OfferTemplates.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\OrgStructure.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getTopLevelEmployees'. Either include it or remove the dependency array.","line":41,"column":8,"nodeType":"ArrayExpression","endLine":41,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [getTopLevelEmployees]","fix":{"range":[1384,1386],"text":"[getTopLevelEmployees]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'isRoot' is assigned a value but never used.","line":76,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":45,"suggestions":[{"messageId":"removeVar","data":{"varName":"isRoot"},"fix":{"range":[2847,2863],"text":""},"desc":"Remove unused variable 'isRoot'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Tree, TreeNode } from 'react-organizational-chart';\r\nimport useOrgStructure from '../../hooks/useOrgStructure';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Spin, Empty, Button, Tooltip, Avatar, Badge, Tag } from 'antd';\r\nimport {\r\n    ApartmentOutlined,\r\n    UserOutlined,\r\n    CaretDownOutlined,\r\n    CaretUpOutlined,\r\n    ArrowLeftOutlined,\r\n    InfoCircleOutlined,\r\n    EyeOutlined,\r\n    CheckCircleOutlined\r\n} from '@ant-design/icons';\r\n\r\nconst BACKEND_URL = import.meta.env.VITE_BACKEND_URL || 'https://hrms.gitakshmi.com';\r\n\r\nexport default function OrgStructure() {\r\n    const { getTopLevelEmployees, getDirectReports } = useOrgStructure();\r\n    const navigate = useNavigate();\r\n    const [roots, setRoots] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Initial load of roots\r\n    useEffect(() => {\r\n        const fetchRoots = async () => {\r\n            setLoading(true);\r\n            const res = await getTopLevelEmployees();\r\n            if (res.success) {\r\n                setRoots(res.data.employees.map(emp => ({\r\n                    ...emp,\r\n                    isExpanded: false,\r\n                    loaded: false,\r\n                    children: []\r\n                })));\r\n            }\r\n            setLoading(false);\r\n        };\r\n        fetchRoots();\r\n    }, []);\r\n\r\n    const toggleNode = async (nodeId, currentRoots) => {\r\n        const updateRecursive = async (nodes) => {\r\n            return Promise.all(nodes.map(async (node) => {\r\n                if (node._id === nodeId) {\r\n                    if (node.isExpanded) return { ...node, isExpanded: false };\r\n                    if (!node.loaded) {\r\n                        const res = await getDirectReports(node._id);\r\n                        if (res.success) {\r\n                            return {\r\n                                ...node,\r\n                                isExpanded: true,\r\n                                loaded: true,\r\n                                children: res.data.map(child => ({\r\n                                    ...child,\r\n                                    isExpanded: false,\r\n                                    loaded: false,\r\n                                    children: []\r\n                                }))\r\n                            };\r\n                        }\r\n                    }\r\n                    return { ...node, isExpanded: true };\r\n                }\r\n                if (node.children?.length > 0) {\r\n                    return { ...node, children: await updateRecursive(node.children) };\r\n                }\r\n                return node;\r\n            }));\r\n        };\r\n        const newRoots = await updateRecursive(currentRoots);\r\n        setRoots(newRoots);\r\n    };\r\n\r\n    const EmployeeNode = ({ employee, isRoot = false }) => {\r\n        const isExpanded = employee.isExpanded;\r\n\r\n        return (\r\n            <div className=\"inline-block p-4 group select-none animate-in fade-in zoom-in duration-500\">\r\n                <div className=\"relative\">\r\n                    {/* The Node Card */}\r\n                    <div\r\n                        className={`\r\n                            w-64 bg-white dark:bg-slate-900 rounded-[3rem] border-2 transition-all duration-700\r\n                            ${isExpanded ? 'border-indigo-500 shadow-2xl scale-105' : 'border-slate-50 dark:border-slate-800 shadow-xl shadow-slate-200/40 hover:border-indigo-200'}\r\n                            flex flex-col items-center pt-8 pb-6 px-4\r\n                        `}\r\n                        style={{ borderTopWidth: '8px' }}\r\n                    >\r\n                        {/* Avatar Section */}\r\n                        <div className=\"relative mb-4\">\r\n                            <div className={`p-1.5 rounded-full bg-slate-50 dark:bg-slate-800 shadow-inner`}>\r\n                                <Avatar\r\n                                    size={80}\r\n                                    src={employee.profilePic ? (employee.profilePic.startsWith('http') ? employee.profilePic : `${BACKEND_URL}${employee.profilePic}`) : null}\r\n                                    icon={<UserOutlined />}\r\n                                    className=\"border-2 border-white dark:border-slate-700 shadow-lg\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"absolute top-1/2 -right-2 transform -translate-y-1/2\">\r\n                                <div className=\"w-5 h-5 bg-white dark:bg-slate-800 rounded-full flex items-center justify-center shadow-md\">\r\n                                    <div className={`w-2.5 h-2.5 rounded-full ${employee.status === 'Active' ? 'bg-emerald-500' : 'bg-slate-300'}`}></div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Identity */}\r\n                        <div className=\"text-center space-y-1\">\r\n                            <h3 className=\"text-base font-black text-slate-800 dark:text-white tracking-tight\">\r\n                                {employee.firstName} {employee.lastName}\r\n                            </h3>\r\n                            <p className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest\">\r\n                                {employee.role || 'Team Member'}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Metadata Pill */}\r\n                        <div className=\"mt-4\">\r\n                            <Tag className=\"m-0 text-[8px] font-black uppercase tracking-widest border-none bg-indigo-50 dark:bg-indigo-900/30 text-indigo-500 px-4 py-1 rounded-full\">\r\n                                {employee.department || 'GLOBAL'}\r\n                            </Tag>\r\n                        </div>\r\n\r\n                        {/* Action Stack */}\r\n                        <div className=\"mt-6 flex flex-col items-center gap-4\">\r\n                            <button\r\n                                onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    navigate(`/hr/details/Employee/${employee._id}`);\r\n                                }}\r\n                                className=\"w-8 h-8 rounded-full bg-slate-50 dark:bg-slate-800 flex items-center justify-center text-slate-400 hover:text-indigo-600 hover:bg-white transition-all shadow-sm border border-slate-100 dark:border-slate-700\"\r\n                            >\r\n                                <EyeOutlined style={{ fontSize: '14px' }} />\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={() => toggleNode(employee._id, roots)}\r\n                                className={`\r\n                                    w-8 h-8 rounded-full flex items-center justify-center transition-all duration-500\r\n                                    ${isExpanded ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-200' : 'bg-slate-50 dark:bg-slate-800 text-slate-400 border border-slate-100 dark:border-slate-700'}\r\n                                `}\r\n                            >\r\n                                {isExpanded ? <CaretUpOutlined style={{ fontSize: '12px' }} /> : <CaretDownOutlined style={{ fontSize: '12px' }} />}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const renderRecursive = (nodes) => {\r\n        return nodes.map((node) => (\r\n            <TreeNode key={node._id} label={<EmployeeNode employee={node} />}>\r\n                {node.isExpanded && node.children && node.children.length > 0 && renderRecursive(node.children)}\r\n                {node.isExpanded && node.loaded && node.children.length === 0 && (\r\n                    <TreeNode label={<div className=\"text-[8px] font-black text-slate-300 uppercase tracking-[0.5em] mt-8 py-3 border-2 border-dashed border-slate-100 rounded-[2rem] mx-auto w-40\">Leaf Node / No Reports</div>} />\r\n                )}\r\n            </TreeNode>\r\n        ));\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className=\"flex h-screen items-center justify-center bg-white dark:bg-slate-950\">\r\n            <div className=\"flex flex-col items-center gap-6\">\r\n                <Spin size=\"large\" />\r\n                <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest animate-pulse\">Mapping Corporate DNA</p>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col bg-slate-50 dark:bg-slate-950 overflow-hidden\">\r\n            {/* Design Header */}\r\n            <div className=\"px-10 py-10 flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-6\">\r\n                    <button\r\n                        onClick={() => navigate(-1)}\r\n                        className=\"w-12 h-12 rounded-full flex items-center justify-center bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 text-slate-600 shadow-sm hover:scale-110 transition-transform\"\r\n                    >\r\n                        <ArrowLeftOutlined />\r\n                    </button>\r\n                    <div className=\"flex items-center gap-6\">\r\n                        <div className=\"p-5 bg-slate-900 rounded-3xl text-white shadow-xl shadow-slate-400/20\">\r\n                            <ApartmentOutlined size={24} className=\"text-2xl\" />\r\n                        </div>\r\n                        <div>\r\n                            <h1 className=\"text-4xl font-black text-slate-800 dark:text-white tracking-tighter\">Org Tree</h1>\r\n                            <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-[0.4em] flex items-center gap-2\">\r\n                                <span className=\"w-2 h-2 rounded-full bg-indigo-500\"></span>\r\n                                Strategic Human Capital Map\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"px-6 py-3 bg-white dark:bg-slate-900 rounded-full flex items-center gap-3 border border-slate-100 dark:border-slate-800 shadow-sm\">\r\n                        <CheckCircleOutlined className=\"text-indigo-500\" />\r\n                        <span className=\"text-[9px] font-black uppercase tracking-widest text-slate-500\">Lazy Loading Active</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tree Canvas */}\r\n            <div className=\"flex-1 overflow-auto p-12 no-scrollbar scroll-smooth bg-[#fafbfc] dark:bg-slate-950/20\">\r\n                {roots.length === 0 ? (\r\n                    <div className=\"h-full flex items-center justify-center\">\r\n                        <Empty description=\"No Root Authority Found\" />\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"flex justify-center min-w-max pb-32\">\r\n                        <Tree\r\n                            lineWidth={'2px'}\r\n                            lineColor={'#e2e8f0'}\r\n                            lineHeight={'60px'}\r\n                            lineBorderRadius={'24px'}\r\n                            label={\r\n                                <div className=\"mb-12\">\r\n                                    <div className=\"inline-block px-10 py-3 bg-slate-900 text-white rounded-full text-[9px] font-black uppercase tracking-[0.5em] shadow-xl\">\r\n                                        Corporate Entity Root\r\n                                    </div>\r\n                                </div>\r\n                            }\r\n                        >\r\n                            {renderRecursive(roots)}\r\n                        </Tree>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Global Overlay Styles */}\r\n            <style>{`\r\n                .no-scrollbar::-webkit-scrollbar { display: none; }\r\n                .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }\r\n                .react-organizational-chart { width: auto !important; margin: 0 auto; }\r\n                .react-organizational-chart .node-content { display: inline-block; }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\BenefitsList.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":13,"column":113,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":114},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":13,"column":115,"nodeType":"BlockStatement","messageId":"unexpected","endLine":13,"endColumn":117,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[572,572],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport api from '../../../utils/api';\r\nimport { formatCalculationLabel } from '../../../utils/payrollFormat';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nexport default function BenefitsList(){\r\n  const [list, setList] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(()=>{ fetchList(); }, []);\r\n  const fetchList = async ()=>{\r\n    try{ setLoading(true); const res = await api.get('/payroll/benefits'); setList(res.data.data || []); }catch(e){}finally{setLoading(false)}\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <div className=\"flex justify-between items-center mb-4\">\r\n        <h2 className=\"text-lg font-bold\">Benefits</h2>\r\n        <button onClick={() => navigate('/hr/payroll/benefits/new')} className=\"px-4 py-2 bg-blue-600 text-white rounded\">Add Benefit</button>\r\n      </div>\r\n      <div className=\"bg-white border rounded shadow-sm\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-slate-50 text-left\">\r\n            <tr>\r\n              <th className=\"p-3\">Name</th>\r\n              <th className=\"p-3\">Type</th>\r\n              <th className=\"p-3\">Value</th>\r\n              <th className=\"p-3\">Part of CTC</th>\r\n              <th className=\"p-3\">Payslip Visible</th>\r\n              <th className=\"p-3\">Status</th>\r\n              <th className=\"p-3\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {list.length === 0 && !loading && (\r\n              <tr><td colSpan={7} className=\"p-4 text-center text-slate-400\">No benefits configured</td></tr>\r\n            )}\r\n            {list.map(b => (\r\n              <tr key={b._id} className=\"border-t\">\r\n                <td className=\"p-3\">{b.name}</td>\r\n                <td className=\"p-3\">{formatCalculationLabel(b)}</td>\r\n                <td className=\"p-3\">{b.partOfSalaryStructure ? 'Yes' : 'No'}</td>\r\n                <td className=\"p-3\">{b.showInPayslip ? 'Yes' : 'No'}</td>\r\n                <td className=\"p-3\">{b.isActive ? 'Active' : 'Disabled'}</td>\r\n                <td className=\"p-3\">\r\n                  <button onClick={()=>navigate(`/hr/payroll/benefits/edit/${b._id}`)} className=\"text-blue-600\">Edit</button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\Deductions\\NewDeduction.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":62,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate, useParams, useSearchParams } from 'react-router-dom';\r\nimport { ArrowLeft, Info, Loader2, ShieldCheck, CreditCard } from 'lucide-react';\r\nimport api from '../../../../utils/api';\r\n\r\nconst PRE_TAX_TYPES = [\r\n    { value: 'PF_EMPLOYEE', label: 'Employee PF Contribution' },\r\n    { value: 'VPF', label: 'Voluntary PF (VPF)' },\r\n    { value: 'NPS_EMPLOYEE', label: 'Employee NPS' },\r\n    { value: 'INSURANCE_PREMIUM', label: 'Insurance Premium' },\r\n    { value: 'SALARY_SACRIFICE', label: 'Salary Sacrifice' },\r\n    { value: 'PRE_TAX_ADJUSTMENT', label: 'Pre-Tax Adjustment' },\r\n];\r\n\r\nconst POST_TAX_TYPES = [\r\n    { value: 'NOTICE_PAY', label: 'Notice Pay' },\r\n    { value: 'WITHHELD_SALARY', label: 'Withheld Salary' },\r\n    { value: 'LOP', label: 'Loss of Pay (LOP)' },\r\n    { value: 'LATE_PENALTY', label: 'Late Penalty' },\r\n    { value: 'LOAN_EMI', label: 'Loan EMI' },\r\n    { value: 'ADVANCE_RECOVERY', label: 'Advance Recovery' },\r\n    { value: 'ASSET_RECOVERY', label: 'Asset Recovery' },\r\n    { value: 'BENEFIT_RECOVERY', label: 'Benefit Recovery' },\r\n    { value: 'PENALTY', label: 'Penalty' },\r\n    { value: 'CHARITY', label: 'Charity' },\r\n    { value: 'CUSTOM', label: 'Custom Deduction' },\r\n];\r\n\r\nexport default function NewDeduction() {\r\n    const navigate = useNavigate();\r\n    const { id } = useParams();\r\n    const [searchParams] = useSearchParams();\r\n    const categoryFromQuery = searchParams.get('category') || 'PRE_TAX';\r\n\r\n    const isEdit = Boolean(id);\r\n    const [loading, setLoading] = useState(false);\r\n    const [fetching, setFetching] = useState(isEdit);\r\n    const [error, setError] = useState(null);\r\n\r\n    const [form, setForm] = useState({\r\n        name: '',\r\n        category: categoryFromQuery,\r\n        amountType: 'FIXED',\r\n        amountValue: '',\r\n        calculationBase: 'BASIC',\r\n        recurring: true,\r\n        isActive: true\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (isEdit) {\r\n            const fetchDeduction = async () => {\r\n                try {\r\n                    setFetching(true);\r\n                    const res = await api.get('/deductions');\r\n                    const deduction = res.data.data.find(d => d._id === id);\r\n                    if (deduction) {\r\n                        setForm(deduction);\r\n                    } else {\r\n                        setError('Deduction not found');\r\n                    }\r\n                } catch (err) {\r\n                    setError('Failed to fetch deduction details');\r\n                } finally {\r\n                    setFetching(false);\r\n                }\r\n            };\r\n            fetchDeduction();\r\n        }\r\n    }, [id, isEdit]);\r\n\r\n    const handleChange = (field, value) => {\r\n        setForm(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const validate = () => {\r\n        if (!form.name.trim()) return 'Deduction Name is required';\r\n        if (!form.amountValue || Number(form.amountValue) <= 0) return 'Valid Amount/Percentage is required';\r\n        if (form.amountType === 'PERCENTAGE' && Number(form.amountValue) > 100) return 'Percentage cannot exceed 100%';\r\n        return null;\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        const err = validate();\r\n        if (err) {\r\n            setError(err);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            if (isEdit) {\r\n                await api.put(`/deductions/${id}`, form);\r\n            } else {\r\n                await api.post('/deductions/create', form);\r\n            }\r\n\r\n            navigate('/hr/payroll/salary-components?tab=deductions');\r\n        } catch (err) {\r\n            setError(err.response?.data?.error || 'Failed to save deduction');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50/50 pb-20\">\r\n            {/* HEADER */}\r\n            <div className=\"bg-white border-b border-slate-200 sticky top-0 z-10\">\r\n                <div className=\"w-full mx-auto px-4 sm:px-6 lg:px-8\">\r\n                    <div className=\"flex justify-between items-center py-4\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <button onClick={() => navigate(-1)} className=\"p-2 hover:bg-slate-100 rounded-full transition text-slate-500\">\r\n                                <ArrowLeft size={20} />\r\n                            </button>\r\n                            <div>\r\n                                <h1 className=\"text-xl font-bold text-slate-900\">{isEdit ? 'Edit Deduction' : 'New Deduction'}</h1>\r\n                                <p className=\"text-xs text-slate-500 font-medium\">Configure tenant-wise payroll deduction component</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"w-full mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n                {error && (\r\n                    <div className=\"mb-6 p-4 bg-rose-50 text-rose-700 border border-rose-200 rounded-xl text-sm flex items-center gap-3 animate-in fade-in slide-in-from-top-2\">\r\n                        <span className=\"flex-1 shrink-0\"><Info size={18} /></span> {error}\r\n                    </div>\r\n                )}\r\n\r\n                {fetching ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 bg-white border border-slate-200 rounded-2xl shadow-sm\">\r\n                        <Loader2 className=\"w-10 h-10 text-blue-600 animate-spin mb-4\" />\r\n                        <p className=\"text-slate-500 font-medium tracking-tight\">Loading record details...</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n                        {/* MAIN FORM */}\r\n                        <div className=\"md:col-span-2 space-y-6\">\r\n                            <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden\">\r\n                                <div className=\"p-6 border-b border-slate-100 bg-slate-50/30\">\r\n                                    <h2 className=\"text-sm font-bold text-slate-900 flex items-center gap-2 uppercase tracking-wider\">\r\n                                        <CreditCard size={16} className=\"text-blue-600\" />\r\n                                        Basic Information\r\n                                    </h2>\r\n                                </div>\r\n\r\n                                <div className=\"p-6 space-y-6\">\r\n                                    {/* Name */}\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2\">Deduction Name <span className=\"text-rose-500\">*</span></label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={form.name}\r\n                                            onChange={e => handleChange('name', e.target.value)}\r\n                                            className=\"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all placeholder:text-slate-400\"\r\n                                            placeholder=\"e.g. Employee State Insurance\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    {/* Category */}\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2\">Category <span className=\"text-rose-500\">*</span></label>\r\n                                        <select\r\n                                            value={form.category}\r\n                                            onChange={e => handleChange('category', e.target.value)}\r\n                                            className=\"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all\"\r\n                                        >\r\n                                            <option value=\"PRE_TAX\">Pre-Tax Deduction</option>\r\n                                            <option value=\"POST_TAX\">Post-Tax Deduction</option>\r\n                                        </select>\r\n                                    </div>\r\n\r\n                                    {/* Calculation */}\r\n                                    <div className=\"space-y-4\">\r\n                                        <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-widest\">Calculation Configuration</label>\r\n\r\n                                        <div className=\"grid grid-cols-2 gap-4\">\r\n                                            <div className=\"p-4 bg-slate-50 rounded-xl border border-slate-100 flex flex-col gap-3\">\r\n                                                <span className=\"text-[10px] font-bold text-slate-400 uppercase\">Amount Type</span>\r\n                                                <div className=\"flex gap-4\">\r\n                                                    <label className=\"flex items-center gap-2 cursor-pointer group\">\r\n                                                        <input type=\"radio\" checked={form.amountType === 'FIXED'} onChange={() => handleChange('amountType', 'FIXED')} className=\"w-4 h-4 text-blue-600 focus:ring-blue-500\" />\r\n                                                        <span className=\"text-sm font-medium text-slate-700 group-hover:text-blue-600 transition-colors\">Fixed</span>\r\n                                                    </label>\r\n                                                    <label className=\"flex items-center gap-2 cursor-pointer group\">\r\n                                                        <input type=\"radio\" checked={form.amountType === 'PERCENTAGE'} onChange={() => handleChange('amountType', 'PERCENTAGE')} className=\"w-4 h-4 text-blue-600 focus:ring-blue-500\" />\r\n                                                        <span className=\"text-sm font-medium text-slate-700 group-hover:text-blue-600 transition-colors\">Percentage</span>\r\n                                                    </label>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {form.amountType === 'PERCENTAGE' && (\r\n                                                <div className=\"p-4 bg-slate-50 rounded-xl border border-slate-100 flex flex-col gap-3\">\r\n                                                    <span className=\"text-[10px] font-bold text-slate-400 uppercase\">Calculation Base</span>\r\n                                                    <select\r\n                                                        value={form.calculationBase}\r\n                                                        onChange={e => handleChange('calculationBase', e.target.value)}\r\n                                                        className=\"w-full bg-transparent text-sm font-medium text-slate-700 outline-none border-none p-0 focus:ring-0\"\r\n                                                    >\r\n                                                        <option value=\"BASIC\">Basic Salary</option>\r\n                                                        <option value=\"GROSS\">Gross Salary</option>\r\n                                                    </select>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        <div className=\"relative\">\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2\">Value ({form.amountType === 'FIXED' ? '‚Çπ' : '%'})</label>\r\n                                            <div className=\"relative\">\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    value={form.amountValue}\r\n                                                    onChange={e => handleChange('amountValue', e.target.value)}\r\n                                                    className=\"w-full p-3 pl-8 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all\"\r\n                                                    placeholder=\"0.00\"\r\n                                                />\r\n                                                <span className=\"absolute left-3 top-3.5 text-slate-400 font-bold text-xs\">{form.amountType === 'FIXED' ? '‚Çπ' : '%'}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden\">\r\n                                <div className=\"p-6 border-b border-slate-100 bg-slate-50/30\">\r\n                                    <h2 className=\"text-sm font-bold text-slate-900 flex items-center gap-2 uppercase tracking-wider\">\r\n                                        Frequency & Status\r\n                                    </h2>\r\n                                </div>\r\n                                <div className=\"p-6 grid grid-cols-2 gap-6\">\r\n                                    <div>\r\n                                        <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3\">Deduction Frequency</label>\r\n                                        <div className=\"flex gap-4\">\r\n                                            {[\r\n                                                { label: 'Recurring', value: true },\r\n                                                { label: 'One Time', value: false }\r\n                                            ].map(f => (\r\n                                                <button\r\n                                                    key={f.label}\r\n                                                    type=\"button\"\r\n                                                    onClick={() => handleChange('recurring', f.value)}\r\n                                                    className={`px-4 py-2 rounded-lg text-xs font-bold transition-all ${form.recurring === f.value\r\n                                                        ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/20'\r\n                                                        : 'bg-slate-100 text-slate-500 hover:bg-slate-200'\r\n                                                        }`}\r\n                                                >\r\n                                                    {f.label}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center pt-6\">\r\n                                        <label className=\"flex items-center gap-3 cursor-pointer group\">\r\n                                            <div className={`w-10 h-6 rounded-full p-1 transition-colors duration-200 flex items-center ${form.isActive ? 'bg-emerald-500' : 'bg-slate-300'}`}>\r\n                                                <div className={`w-4 h-4 bg-white rounded-full transition-transform duration-200 ${form.isActive ? 'translate-x-4' : 'translate-x-0'}`} />\r\n                                            </div>\r\n                                            <input type=\"checkbox\" checked={form.isActive} onChange={e => handleChange('isActive', e.target.checked)} className=\"hidden\" />\r\n                                            <span className=\"text-sm font-bold text-slate-700 group-hover:text-emerald-600 transition-colors\">Active Status</span>\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* INFO PANEL */}\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-200\">\r\n                                <h3 className=\"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2\">\r\n                                    <ShieldCheck size={14} className=\"text-blue-600\" />\r\n                                    Compliance Info\r\n                                </h3>\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"p-4 bg-blue-50 rounded-xl\">\r\n                                        <h4 className=\"text-xs font-bold text-blue-900 mb-1\">\r\n                                            {form.category === 'PRE_TAX' ? 'Pre-Tax Impact' : 'Post-Tax Impact'}\r\n                                        </h4>\r\n                                        <p className=\"text-[11px] text-blue-700 leading-relaxed\">\r\n                                            {form.category === 'PRE_TAX'\r\n                                                ? 'This deduction reduces the Taxable Income of the employee. It is applied BEFORE Income Tax calculation.'\r\n                                                : 'This deduction does NOT affect tax calculations. It is subtracted from the Net Salary after TDS.'\r\n                                            }\r\n                                        </p>\r\n                                    </div>\r\n                                    <div className=\"p-4 bg-slate-50 rounded-xl border border-slate-100\">\r\n                                        <h4 className=\"text-xs font-bold text-slate-900 mb-1\">Calculation Logic</h4>\r\n                                        <p className=\"text-[11px] text-slate-600 leading-relaxed\">\r\n                                            {form.amountType === 'PERCENTAGE'\r\n                                                ? `Calculated as ${form.amountValue || 'X'}% of ${form.calculationBase === 'BASIC' ? 'Basic Salary' : 'Gross Earnings'}.`\r\n                                                : \"Calculated as a flat fixed amount during payroll processing.\"}\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button\r\n                                onClick={handleSubmit}\r\n                                disabled={loading}\r\n                                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-xl shadow-blue-500/20 transition-all active:scale-95 flex items-center justify-center gap-2 disabled:opacity-70\"\r\n                            >\r\n                                {loading ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : 'Save Deduction'}\r\n                            </button>\r\n                            <button\r\n                                onClick={() => navigate(-1)}\r\n                                className=\"w-full bg-white hover:bg-slate-50 text-slate-600 font-bold py-4 rounded-2xl border border-slate-200 transition-all\"\r\n                            >\r\n                                Discard\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\NewBenefit.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'useContext' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":48,"suggestions":[{"messageId":"removeVar","data":{"varName":"useContext"},"fix":{"range":[35,47],"text":""},"desc":"Remove unused variable 'useContext'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":50,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":17},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":50,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":50,"endColumn":22,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1525,1526],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":79,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'form'. Either include it or remove the dependency array. You can also do a functional update 'setForm(f => ...)' if you only need 'form' in the 'setForm' call.","line":85,"column":6,"nodeType":"ArrayExpression","endLine":85,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [form, id, isEdit]","fix":{"range":[2911,2923],"text":"[form, id, isEdit]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'handleEPFChange' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":122,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":122,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"handleEPFChange"},"fix":{"range":[4191,4290],"text":""},"desc":"Remove unused variable 'handleEPFChange'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'handleEPFRuleChange' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":123,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":123,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"handleEPFRuleChange"},"fix":{"range":[4294,4391],"text":""},"desc":"Remove unused variable 'handleEPFRuleChange'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'handleESIChange' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":124,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":124,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"handleESIChange"},"fix":{"range":[4395,4494],"text":""},"desc":"Remove unused variable 'handleESIChange'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'genCode' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":153,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":153,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"genCode"},"fix":{"range":[5479,5614],"text":""},"desc":"Remove unused variable 'genCode'."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useContext } from 'react';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport { ArrowLeft, Info, Loader2 } from 'lucide-react';\r\nimport api from '../../../utils/api';\r\nimport useToast from '../../../hooks/useToast';\r\n\r\nconst BENEFIT_TYPES = [\r\n  'Leave Pay',\r\n  'Employer PF',\r\n  'Gratuity',\r\n  'Employer Medical Insurance',\r\n  'Custom Benefit'\r\n];\r\n\r\nexport default function NewBenefit() {\r\n  const navigate = useNavigate();\r\n  const { id } = useParams();\r\n  const isEdit = Boolean(id);\r\n  const { show } = useToast();\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [fetching, setFetching] = useState(isEdit);\r\n  const [error, setError] = useState(null);\r\n  const [fieldErrors, setFieldErrors] = useState({});\r\n  const [existingBenefits, setExistingBenefits] = useState([]);\r\n  const [customDraft, setCustomDraft] = useState({ name: '', payslipName: '' });\r\n\r\n  const [form, setForm] = useState({\r\n    benefitType: 'Leave Pay',\r\n    name: 'Leave Pay',\r\n    payslipName: 'Leave Pay',\r\n    code: '',\r\n    payType: 'FIXED',\r\n    calculationType: 'FLAT',\r\n    value: '',\r\n    isActive: true,\r\n    isTaxable: false,\r\n    proRata: false,\r\n    partOfSalaryStructure: true,\r\n    considerForEPF: false,\r\n    considerForESI: false,\r\n    showInPayslip: false\r\n  });\r\n\r\n  useEffect(() => {\r\n    const fetchList = async () => {\r\n      try {\r\n        const res = await api.get('/payroll/benefits');\r\n        setExistingBenefits(res.data.data || []);\r\n      } catch (e) { }\r\n    };\r\n    fetchList();\r\n\r\n    if (isEdit) {\r\n      const fetchOne = async () => {\r\n        try {\r\n          setFetching(true);\r\n          const res = await api.get(`/payroll/benefits/${id}`);\r\n          const item = res.data.data;\r\n          if (item) {\r\n            setForm({\r\n              ...form,\r\n              benefitType: item.benefitType || form.benefitType,\r\n              name: item.name,\r\n              payslipName: item.payslipName,\r\n              code: item.code || '',\r\n              payType: item.payType || 'FIXED',\r\n              calculationType: item.calculationType || 'FLAT',\r\n              value: item.value !== undefined && item.value !== null ? item.value : '',\r\n              isActive: item.isActive !== undefined ? item.isActive : true,\r\n              isTaxable: item.isTaxable || false,\r\n              proRata: item.proRata || false,\r\n              partOfSalaryStructure: item.partOfSalaryStructure !== undefined ? item.partOfSalaryStructure : true,\r\n              considerForEPF: item.considerForEPF || false,\r\n              considerForESI: item.considerForESI || false,\r\n              showInPayslip: item.showInPayslip || false\r\n            });\r\n          } else setError('Benefit not found');\r\n        } catch (err) {\r\n          setError('Failed to fetch benefit');\r\n        } finally { setFetching(false); }\r\n      };\r\n      fetchOne();\r\n    }\r\n  }, [id, isEdit]);\r\n\r\n  const handleTypeChange = (e) => {\r\n    const type = e.target.value;\r\n    const updates = { benefitType: type };\r\n    if (type === 'Custom Benefit') {\r\n      updates.name = customDraft.name || '';\r\n      updates.payslipName = customDraft.payslipName || '';\r\n    } else {\r\n      updates.name = type;\r\n      updates.payslipName = type;\r\n      setCustomDraft({ name: '', payslipName: '' });\r\n    }\r\n    setForm(prev => ({ ...prev, ...updates }));\r\n    setFieldErrors({});\r\n  };\r\n\r\n  const customHandleChange = (field, value) => {\r\n    if (form.benefitType === 'Custom Benefit') {\r\n      const nextDraft = { ...customDraft, [field]: value };\r\n      setCustomDraft(nextDraft);\r\n      setForm(prev => ({ ...prev, [field]: value }));\r\n      setFieldErrors(prev => ({ ...prev, [field]: undefined }));\r\n    } else {\r\n      setForm(prev => ({ ...prev, [field]: value }));\r\n      setFieldErrors(prev => ({ ...prev, [field]: undefined }));\r\n    }\r\n    if (field === 'name' && !form.payslipName) {\r\n      setForm(prev => ({ ...prev, payslipName: value }));\r\n    }\r\n    if (field === 'code') {\r\n      setForm(prev => ({ ...prev, code: value }));\r\n      return;\r\n    }\r\n  };\r\n\r\n  const handleCheckbox = (field, checked) => setForm(prev => ({ ...prev, [field]: checked }));\r\n  const handleEPFChange = (enabled) => setForm(prev => ({ ...prev, epf: { ...prev.epf, enabled } }));\r\n  const handleEPFRuleChange = (rule) => setForm(prev => ({ ...prev, epf: { ...prev.epf, rule } }));\r\n  const handleESIChange = (enabled) => setForm(prev => ({ ...prev, esi: { ...prev.esi, enabled } }));\r\n\r\n  const validate = () => {\r\n    const errs = {};\r\n    const name = (form.name || '').toString();\r\n    if (!name.trim()) errs.name = 'Benefit Name is required';\r\n    else if (name !== name.trim()) errs.name = 'No leading or trailing spaces allowed';\r\n\r\n    if (form.value === '' || Number(form.value) <= 0) errs.value = 'Valid value is required';\r\n\r\n    const normalized = name.trim().toLowerCase();\r\n    if (normalized) {\r\n      const dup = existingBenefits.find(e => e.name && e.name.toString().toLowerCase() === normalized && e._id !== id);\r\n      if (dup) errs.name = 'A benefit with this name already exists';\r\n    }\r\n\r\n    // code removed; no client-side code uniqueness check\r\n\r\n    setFieldErrors(errs);\r\n    return Object.keys(errs).length ? errs : null;\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    const errs = validate();\r\n    if (errs) { setError('Please fix the highlighted errors'); return; }\r\n    try {\r\n      setError(null);\r\n      setLoading(true);\r\n\r\n      const genCode = (n) => n.toString().trim().toUpperCase().replace(/[^A-Z0-9]+/g, '_').replace(/^_+|_+$/g, '').slice(0, 30) || `BENEFIT`;\r\n      const sanitizeValue = (v) => {\r\n        if (v === undefined || v === null) return 0;\r\n        const s = v.toString().replace(/%/g, '').replace(/,/g, '').trim();\r\n        return Number(s);\r\n      };\r\n\r\n      const mapBenefitType = (label) => {\r\n        if (!label) return 'CUSTOM';\r\n        const l = label.toString().toLowerCase();\r\n        if (l.includes('employer pf') || l.includes('pf')) return 'EMPLOYER_PF';\r\n        if (l.includes('gratuity')) return 'GRATUITY';\r\n        if (l.includes('medical') || l.includes('insurance')) return 'INSURANCE';\r\n        return 'CUSTOM';\r\n      };\r\n\r\n      const backendBenefitType = mapBenefitType(form.benefitType);\r\n      const payload = {\r\n        name: form.name.trim(),\r\n        code: form.code && form.code.trim() ? form.code.trim().toUpperCase() : form.name.trim().toUpperCase().replace(/\\s+/g, \"_\"),\r\n        benefitType: backendBenefitType,\r\n        payType: form.payType,\r\n        calculationType: (form.calculationType === 'PERCENT_OF_BASIC' || form.calculationType === 'PERCENT_OF_CTC') ? form.calculationType : 'FLAT',\r\n        value: sanitizeValue(form.value),\r\n        partOfSalaryStructure: !!form.partOfSalaryStructure,\r\n        isTaxable: !!form.isTaxable,\r\n        proRata: !!form.proRata,\r\n        considerForEPF: !!form.considerForEPF,\r\n        considerForESI: !!form.considerForESI,\r\n        showInPayslip: !!form.showInPayslip,\r\n        isActive: !!form.isActive\r\n      };\r\n\r\n      if (isEdit) await api.put(`/payroll/benefits/${id}`, payload);\r\n      else await api.post('/payroll/benefits', payload);\r\n\r\n      show({ message: isEdit ? 'Benefit updated' : 'Benefit created', type: 'success' });\r\n      navigate('/hr/payroll/salary-components');\r\n    } catch (err) {\r\n      const msg = err.response?.data?.error || 'Failed to save benefit';\r\n      setError(msg);\r\n      show({ message: msg, type: 'error' });\r\n    } finally { setLoading(false); }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 pb-20\">\r\n      {/* HEADER */}\r\n      <div className=\"bg-white border-b border-slate-200 sticky top-0 z-10\">\r\n        <div className=\"w-full mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex justify-between items-center py-4\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <button onClick={() => navigate(-1)} className=\"p-2 hover:bg-slate-100 rounded-full transition text-slate-500\"><ArrowLeft size={20} /></button>\r\n              <h1 className=\"text-xl font-bold text-slate-900\">{isEdit ? `Edit ${form.name || 'Benefit'}` : 'New Benefit'}</h1>\r\n            </div>\r\n            <button className=\"text-sm font-medium text-blue-600 hover:text-blue-700 flex items-center gap-1\">Page Tips <Info size={14} /></button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"w-full mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {error && (\r\n          <div className=\"mb-6 p-4 bg-rose-50 text-rose-700 border border-rose-200 rounded-lg text-sm flex items-center gap-2\"><Info size={16} /> {error}</div>\r\n        )}\r\n\r\n        {fetching ? (\r\n          <div className=\"flex flex-col items-center justify-center py-20 bg-white border border-slate-200 rounded-xl shadow-sm\">\r\n            <Loader2 className=\"w-10 h-10 text-blue-600 animate-spin mb-4\" />\r\n            <p className=\"text-slate-500 font-medium\">Fetching benefit details...</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n            <div className=\"md:col-span-2 space-y-6\">\r\n              <div className=\"bg-white p-6 rounded-xl shadow-sm border border-slate-200 space-y-6\">\r\n                <div>\r\n                  <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2\">Benefit Type <span className=\"text-rose-500\">*</span></label>\r\n                  <select value={form.benefitType} onChange={handleTypeChange} className=\"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all\">\r\n                    {BENEFIT_TYPES.map(t => <option key={t} value={t}>{t}</option>)}\r\n                  </select>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2\">Benefit Name <span className=\"text-rose-500\">*</span></label>\r\n                    <input name=\"name\" required type=\"text\" value={form.name} onChange={e => customHandleChange('name', e.target.value)} className=\"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all\" placeholder=\"e.g. Employer Provident Fund\" />\r\n                    {fieldErrors.name && (<p className=\"text-rose-600 text-xs mt-1\">{fieldErrors.name}</p>)}\r\n                    <p className=\"text-[10px] text-slate-400 mt-2\">Payslip name will be derived from the Benefit Name automatically.</p>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2\">Code (optional)</label>\r\n                  <input type=\"text\" value={form.code} onChange={e => customHandleChange('code', e.target.value)} className=\"w-48 p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all\" placeholder=\"AUTO from name\" />\r\n                  <p className=\"text-[10px] text-slate-400 mt-2\">Leave empty to auto-generate a code from the name.</p>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3\">Pay Type <span className=\"text-rose-500\">*</span></label>\r\n                  <div className=\"flex gap-6\">\r\n                    <label className=\"flex items-center gap-2 cursor-pointer\"><input type=\"radio\" name=\"payType\" checked={form.payType === 'FIXED'} onChange={() => customHandleChange('payType', 'FIXED')} className=\"w-4 h-4 text-blue-600\" /> <span className=\"text-sm font-medium text-slate-700\">Fixed Pay</span></label>\r\n                    <label className=\"flex items-center gap-2 cursor-pointer\"><input type=\"radio\" name=\"payType\" checked={form.payType === 'VARIABLE'} onChange={() => customHandleChange('payType', 'VARIABLE')} className=\"w-4 h-4 text-blue-600\" /> <span className=\"text-sm font-medium text-slate-700\">Variable Pay</span></label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3\">Calculation Type <span className=\"text-rose-500\">*</span></label>\r\n                  <div className=\"flex gap-6 mb-4\">\r\n                    <label className=\"flex items-center gap-2 cursor-pointer\"><input type=\"radio\" name=\"calcType\" checked={form.calculationType === 'FLAT'} onChange={() => customHandleChange('calculationType', 'FLAT')} className=\"w-4 h-4 text-blue-600\" /> <span className=\"text-sm font-medium text-slate-700\">Flat Amount</span></label>\r\n                    <label className=\"flex items-center gap-2 cursor-pointer\"><input type=\"radio\" name=\"calcType\" checked={form.calculationType === 'PERCENT_OF_BASIC'} onChange={() => customHandleChange('calculationType', 'PERCENT_OF_BASIC')} className=\"w-4 h-4 text-blue-600\" /> <span className=\"text-sm font-medium text-slate-700\">Percent of Basic</span></label>\r\n                    <label className=\"flex items-center gap-2 cursor-pointer\"><input type=\"radio\" name=\"calcType\" checked={form.calculationType === 'PERCENT_OF_CTC'} onChange={() => customHandleChange('calculationType', 'PERCENT_OF_CTC')} className=\"w-4 h-4 text-blue-600\" /> <span className=\"text-sm font-medium text-slate-700\">Percent of CTC</span></label>\r\n                  </div>\r\n\r\n                  <div>\r\n                    {form.calculationType === 'FLAT' ? (\r\n                      <div className=\"relative max-w-xs\">\r\n                        <span className=\"absolute left-3 top-2.5 text-slate-400 font-bold\">‚Çπ</span>\r\n                        <input type=\"number\" min=\"0\" value={form.value} onChange={e => customHandleChange('value', e.target.value)} className=\"w-full pl-8 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm\" placeholder=\"0.00\" />\r\n                        {fieldErrors.value && (<p className=\"text-rose-600 text-xs mt-1\">{fieldErrors.value}</p>)}\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"relative max-w-xs\">\r\n                        <input type=\"number\" min=\"0\" max=\"100\" value={form.value} onChange={e => customHandleChange('value', e.target.value)} className=\"w-full pl-4 pr-8 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm\" placeholder=\"0.00\" />\r\n                        <span className=\"absolute right-3 top-2.5 text-slate-400 font-bold\">%</span>\r\n                        {fieldErrors.value && (<p className=\"text-rose-600 text-xs mt-1\">{fieldErrors.value}</p>)}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"pt-4 border-t border-slate-100\">\r\n                  <label className=\"flex items-center gap-3 cursor-pointer\"><input type=\"checkbox\" checked={form.isActive} onChange={(e) => handleCheckbox('isActive', e.target.checked)} className=\"w-4 h-4 text-blue-600\" /> <span className=\"text-sm font-semibold text-slate-700\">Mark this benefit as Active</span></label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"md:col-span-1 space-y-6\">\r\n              <div className=\"bg-white p-6 rounded-xl shadow-sm border border-slate-200\">\r\n                <h3 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4\">Configuration</h3>\r\n                <div className=\"space-y-4\">\r\n                  <label className=\"flex items-start gap-3 cursor-pointer group\"><input type=\"checkbox\" checked={form.partOfSalaryStructure} onChange={(e) => handleCheckbox('partOfSalaryStructure', e.target.checked)} className=\"mt-1 w-4 h-4 text-blue-600\" /> <div className=\"text-sm\"><span className=\"font-medium text-slate-700 block\">part of salary structure</span><span className=\"text-xs text-slate-400\">Component appears in CTC</span></div></label>\r\n\r\n                  <label className=\"flex items-start gap-3 cursor-pointer group\"><input type=\"checkbox\" checked={form.isTaxable} onChange={(e) => handleCheckbox('isTaxable', e.target.checked)} className=\"mt-1 w-4 h-4 text-blue-600\" /> <div className=\"text-sm\"><span className=\"font-medium text-slate-700 block\">Is Taxable</span><span className=\"text-xs text-slate-400\">Subject to TDS</span></div></label>\r\n\r\n                  <label className={`flex items-start gap-3 group`}><input type=\"checkbox\" checked={form.proRata} onChange={(e) => handleCheckbox('proRata', e.target.checked)} className=\"mt-1 w-4 h-4 text-blue-600\" /> <div className=\"text-sm\"><span className=\"font-medium text-slate-700 block\">Pro-rata Basis</span><span className=\"text-xs text-slate-400\">Calculated based on attendance</span></div></label>\r\n\r\n                  <div className=\"my-4 border-t border-slate-100\"></div>\r\n\r\n                  <div className=\"space-y-3\">\r\n                    <label className=\"flex items-center gap-3\"><input type=\"checkbox\" checked={form.considerForEPF} onChange={(e) => handleCheckbox('considerForEPF', e.target.checked)} className=\"w-4 h-4 text-blue-600\" /> <span className=\"text-sm font-medium text-slate-700\">Consider for EPF</span></label>\r\n                  </div>\r\n\r\n                  <div className=\"pt-2\"><label className=\"flex items-center gap-3\"><input type=\"checkbox\" checked={form.considerForESI} onChange={(e) => handleCheckbox('considerForESI', e.target.checked)} className=\"w-4 h-4 text-blue-600\" /> <span className=\"text-sm font-medium text-slate-700\">Consider for ESI</span></label></div>\r\n\r\n                  <div className=\"my-4 border-t border-slate-100\"></div>\r\n\r\n                  <label className=\"flex items-center gap-3 cursor-pointer\"><input type=\"checkbox\" checked={form.showInPayslip} onChange={(e) => handleCheckbox('showInPayslip', e.target.checked)} className=\"w-4 h-4 text-blue-600\" /> <span className=\"text-sm font-medium text-slate-700\">Show in Payslip</span></label>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"bg-blue-50 p-4 rounded-xl border border-blue-100\"><p className=\"text-xs text-blue-700\"><span className=\"font-bold\">Note:</span> Benefits increase CTC but do not affect monthly take-home unless explicitly configured. They are not treated as earnings.</p></div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"mt-8 flex items-center justify-end gap-4 border-t border-slate-200 pt-6\">\r\n          <button onClick={() => navigate(-1)} className=\"px-6 py-2.5 rounded-lg text-sm font-semibold text-slate-600 hover:bg-slate-100 border border-transparent\">Cancel</button>\r\n          <button onClick={handleSubmit} disabled={loading || fetching} className=\"px-8 py-2.5 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 shadow-md active:scale-95 transition-all disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2\">{loading && <Loader2 className=\"w-4 h-4 animate-spin\" />} {isEdit ? 'Update Benefit' : 'Save Benefit'}</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\NewEarning.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":59,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":84,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":84,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport { ArrowLeft, Info, Loader2 } from 'lucide-react';\r\nimport api from '../../../utils/api';\r\n\r\nconst EARNING_TYPES = [\r\n    'Basic',\r\n    'House Rent Allowance',\r\n    'Conveyance Allowance',\r\n    'Fixed Allowance',\r\n    'Medical Allowance',\r\n    'Bonus',\r\n    'Commission',\r\n    'Custom Allowance'\r\n];\r\n\r\nexport default function NewEarning() {\r\n    const navigate = useNavigate();\r\n    const { id } = useParams();\r\n    const isEdit = Boolean(id);\r\n\r\n    const [loading, setLoading] = useState(false);\r\n    const [fetching, setFetching] = useState(isEdit);\r\n    const [error, setError] = useState(null);\r\n    const [fieldErrors, setFieldErrors] = useState({});\r\n    const [existingEarnings, setExistingEarnings] = useState([]);\r\n    const [customDraft, setCustomDraft] = useState({ name: '', payslipName: '' });\r\n\r\n    const [form, setForm] = useState({\r\n        earningType: 'Basic',\r\n        name: 'Basic',\r\n        payslipName: 'Basic',\r\n        payType: 'FIXED',\r\n        calculationType: 'FLAT_AMOUNT',\r\n        amount: '',\r\n        percentage: '',\r\n        isActive: true,\r\n        isTaxable: true,\r\n        isProRataBasis: true,\r\n        includeInSalaryStructure: true,\r\n        epf: {\r\n            enabled: false,\r\n            rule: 'ALWAYS'\r\n        },\r\n        esi: {\r\n            enabled: false\r\n        },\r\n        showInPayslip: true,\r\n        isUsedInPayroll: false\r\n    });\r\n\r\n    // Fetch data if in edit mode\r\n    useEffect(() => {\r\n        // Always fetch earnings list for duplicate validation; fetch details when editing\r\n        const fetchEarningsList = async () => {\r\n            try {\r\n                const res = await api.get('/payroll/earnings');\r\n                setExistingEarnings(res.data.data || []);\r\n            } catch (e) {\r\n                // non-fatal\r\n            }\r\n        };\r\n        fetchEarningsList();\r\n\r\n        if (isEdit) {\r\n            const fetchData = async () => {\r\n                try {\r\n                    setFetching(true);\r\n                    const res = await api.get(`/payroll/earnings`);\r\n                    const earnings = res.data.data;\r\n                    const item = earnings.find(e => e._id === id);\r\n\r\n                    if (item) {\r\n                        setForm({\r\n                            ...item,\r\n                            earningType: item.isCustom ? 'Custom Allowance' : (item.name || 'Basic'),\r\n                            amount: item.calculationType === 'FLAT_AMOUNT' ? item.amount : '',\r\n                            // support both percentage variants used across UI/backends\r\n                            percentage: (item.calculationType === 'PERCENTAGE_OF_BASIC' || item.calculationType === 'PERCENTAGE_OF_CTC') ? item.percentage : ''\r\n                        });\r\n                    } else {\r\n                        setError('Earning component not found');\r\n                    }\r\n                } catch (err) {\r\n                    setError('Failed to fetch component details');\r\n                } finally {\r\n                    setFetching(false);\r\n                }\r\n            };\r\n            fetchData();\r\n        }\r\n    }, [id, isEdit]);\r\n\r\n    // Handle Type Change (Auto-fill names)\r\n    const handleTypeChange = (e) => {\r\n        const type = e.target.value;\r\n        const updates = { earningType: type };\r\n\r\n        if (type === 'Custom Allowance') {\r\n            // Restore any draft custom values (usually blank unless user typed earlier)\r\n            updates.name = customDraft.name || '';\r\n            updates.payslipName = customDraft.payslipName || '';\r\n        } else {\r\n            updates.name = type;\r\n            updates.payslipName = type === 'House Rent Allowance' ? 'HRA' : type;\r\n            // Clear any previously typed custom draft when switching back to predefined\r\n            setCustomDraft({ name: '', payslipName: '' });\r\n        }\r\n        setForm(prev => ({ ...prev, ...updates }));\r\n        setFieldErrors({});\r\n    };\r\n\r\n    // Handle Input Changes\r\n    const customHandleChange = (field, value) => {\r\n        // Allow typing, but keep a draft when this is a custom component\r\n        if (form.earningType === 'Custom Allowance') {\r\n            const nextDraft = { ...customDraft, [field]: value };\r\n            setCustomDraft(nextDraft);\r\n            setForm(prev => ({ ...prev, [field]: value }));\r\n            setFieldErrors(prev => ({ ...prev, [field]: undefined }));\r\n        } else {\r\n            // If changing calculationType, clear the opposite input to avoid stale values\r\n            if (field === 'calculationType') {\r\n                const calc = value;\r\n                setForm(prev => ({\r\n                    ...prev,\r\n                    calculationType: calc,\r\n                    // when switching to FLAT_AMOUNT keep amount (user may have filled it)\r\n                    // when switching to percentage types, clear amount to avoid accidental mapping\r\n                    amount: calc === 'FLAT_AMOUNT' ? prev.amount : '',\r\n                    // when switching to percentage types keep percentage (user may have filled it)\r\n                    // when switching to FLAT_AMOUNT, clear percentage\r\n                    percentage: calc === 'FLAT_AMOUNT' ? '' : prev.percentage\r\n                }));\r\n                setFieldErrors(prev => ({ ...prev, calculationType: undefined }));\r\n            } else {\r\n                setForm(prev => ({ ...prev, [field]: value }));\r\n                setFieldErrors(prev => ({ ...prev, [field]: undefined }));\r\n            }\r\n        }\r\n\r\n        if (field === 'name' && !form.payslipName) {\r\n            setForm(prev => ({ ...prev, payslipName: value }));\r\n        }\r\n    };\r\n\r\n    const handleCheckbox = (field, checked) => {\r\n        setForm(prev => ({ ...prev, [field]: checked }));\r\n    };\r\n\r\n    const handleEPFChange = (enabled) => {\r\n        setForm(prev => ({\r\n            ...prev,\r\n            epf: { ...prev.epf, enabled }\r\n        }));\r\n    };\r\n\r\n    const handleEPFRuleChange = (rule) => {\r\n        setForm(prev => ({\r\n            ...prev,\r\n            epf: { ...prev.epf, rule }\r\n        }));\r\n    };\r\n\r\n    const handleESIChange = (enabled) => {\r\n        setForm(prev => ({\r\n            ...prev,\r\n            esi: { ...prev.esi, enabled }\r\n        }));\r\n    };\r\n\r\n    const validate = () => {\r\n        const errs = {};\r\n        const name = (form.name || '').toString();\r\n\r\n        // Trim checks: no leading/trailing spaces\r\n        if (!name.trim()) errs.name = 'Earning Name is required';\r\n        else if (name !== name.trim()) errs.name = 'No leading or trailing spaces allowed';\r\n\r\n        if (form.calculationType === 'FLAT_AMOUNT') {\r\n            if (form.amount === '' || Number(form.amount) < 0) errs.amount = 'Valid Amount is required';\r\n        } else {\r\n            if (form.percentage === '' || Number(form.percentage) < 0 || Number(form.percentage) > 100) errs.percentage = 'Valid Percentage (0-100) is required';\r\n        }\r\n\r\n        // Duplicate name check (case-insensitive). Allow when editing same id.\r\n        const normalized = name.trim().toLowerCase();\r\n        if (normalized) {\r\n            const dup = existingEarnings.find(e => e.name && e.name.toString().toLowerCase() === normalized && e._id !== id);\r\n            if (dup) errs.name = 'An earning with this name already exists';\r\n        }\r\n\r\n        setFieldErrors(errs);\r\n        return Object.keys(errs).length ? errs : null;\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        const errs = validate();\r\n        if (errs) {\r\n            setError('Please fix the highlighted errors');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setError(null);\r\n            setLoading(true);\r\n\r\n            // Map to backend-compatible payload\r\n            const payload = {\r\n                earningType: form.earningType,\r\n                name: form.name.trim(),\r\n                payslipName: (form.payslipName && form.payslipName.trim()) || form.name.trim(),\r\n                isCustom: form.earningType === 'Custom Allowance',\r\n                taxable: !!form.isTaxable,\r\n                partOfCTC: !!form.includeInSalaryStructure,\r\n                proRata: !!form.isProRataBasis,\r\n                showInPayslip: !!form.showInPayslip,\r\n                payType: form.payType,\r\n                calculationType: form.calculationType,\r\n                isActive: !!form.isActive,\r\n                isUsedInPayroll: !!form.isUsedInPayroll,\r\n                epf: form.epf || {},\r\n                esi: form.esi || {}\r\n            };\r\n            if (form.calculationType === 'FLAT_AMOUNT') {\r\n                payload.amount = Number(form.amount);\r\n                payload.percentage = 0;\r\n            } else {\r\n                payload.amount = 0;\r\n                payload.percentage = Number(form.percentage);\r\n            }\r\n\r\n            if (isEdit) {\r\n                await api.put(`/payroll/earnings/${id}`, payload);\r\n            } else {\r\n                console.log('CREATE_EARNING_PAYLOAD', payload);\r\n                await api.post('/payroll/earnings', payload);\r\n            }\r\n            navigate('/hr/payroll/salary-components');\r\n        } catch (err) {\r\n            setError(err.response?.data?.error || 'Failed to save earning');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50 pb-20\">\r\n            {/* HEADER */}\r\n            <div className=\"bg-white border-b border-slate-200 sticky top-0 z-10\">\r\n                <div className=\"w-full mx-auto px-4 sm:px-6 lg:px-8\">\r\n                    <div className=\"flex justify-between items-center py-4\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <button\r\n                                onClick={() => navigate(-1)}\r\n                                className=\"p-2 hover:bg-slate-100 rounded-full transition text-slate-500\"\r\n                            >\r\n                                <ArrowLeft size={20} />\r\n                            </button>\r\n                            <h1 className=\"text-xl font-bold text-slate-900\">\r\n                                {isEdit ? `Edit ${form.name || 'Earning'}` : 'New Earning'}\r\n                            </h1>\r\n                        </div>\r\n                        <button className=\"text-sm font-medium text-blue-600 hover:text-blue-700 flex items-center gap-1\">\r\n                            Page Tips <Info size={14} />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* CONTENT */}\r\n            <div className=\"w-full mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n                {error && (\r\n                    <div className=\"mb-6 p-4 bg-rose-50 text-rose-700 border border-rose-200 rounded-lg text-sm flex items-center gap-2\">\r\n                        <Info size={16} /> {error}\r\n                    </div>\r\n                )}\r\n\r\n                {fetching ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 bg-white border border-slate-200 rounded-xl shadow-sm\">\r\n                        <Loader2 className=\"w-10 h-10 text-blue-600 animate-spin mb-4\" />\r\n                        <p className=\"text-slate-500 font-medium\">Fetching earning details...</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n                        {/* LEFT COLUMN */}\r\n                        <div className=\"md:col-span-2 space-y-6\">\r\n                            <div className=\"bg-white p-6 rounded-xl shadow-sm border border-slate-200 space-y-6\">\r\n                                {/* Earning Type */}\r\n                                <div>\r\n                                    <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2\">Earning Type <span className=\"text-rose-500\">*</span></label>\r\n                                    <select\r\n                                        value={form.earningType}\r\n                                        disabled={form.isUsedInPayroll}\r\n                                        onChange={handleTypeChange}\r\n                                        className=\"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all disabled:opacity-60 disabled:cursor-not-allowed\"\r\n                                    >\r\n                                        {EARNING_TYPES.map(t => <option key={t} value={t}>{t}</option>)}\r\n                                    </select>\r\n                                </div>\r\n\r\n                                {/* Names */}\r\n                                {form.earningType === 'Custom Allowance' && (\r\n                                    <div className=\"grid grid-cols-1 gap-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2\">Earning Name <span className=\"text-rose-500\">*</span></label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={form.name}\r\n                                                onChange={e => customHandleChange('name', e.target.value)}\r\n                                                className=\"w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all\"\r\n                                                placeholder=\"e.g. Special Allowance\"\r\n                                            />\r\n                                            {fieldErrors.name && (\r\n                                                <p className=\"text-rose-600 text-xs mt-1\">{fieldErrors.name}</p>\r\n                                            )}\r\n                                            <p className=\"text-[10px] text-slate-400 mt-2\">Payslip name will be derived from the Earning Name automatically.</p>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Pay Type */}\r\n                                <div>\r\n                                    <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3\">Pay Type <span className=\"text-rose-500\">*</span></label>\r\n                                    <div className={`flex gap-6 ${form.isUsedInPayroll ? 'opacity-60 grayscale' : ''}`}>\r\n                                        <label className={`flex items-center gap-2 ${form.isUsedInPayroll ? 'cursor-not-allowed' : 'cursor-pointer'}`}>\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"payType\"\r\n                                                disabled={form.isUsedInPayroll}\r\n                                                checked={form.payType === 'FIXED'}\r\n                                                onChange={() => customHandleChange('payType', 'FIXED')}\r\n                                                className=\"w-4 h-4 text-blue-600 border-slate-300 focus:ring-blue-500\"\r\n                                            />\r\n                                            <span className=\"text-sm font-medium text-slate-700\">Fixed Pay</span>\r\n                                        </label>\r\n                                        <label className={`flex items-center gap-2 ${form.isUsedInPayroll ? 'cursor-not-allowed' : 'cursor-pointer'}`}>\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"payType\"\r\n                                                disabled={form.isUsedInPayroll}\r\n                                                checked={form.payType === 'VARIABLE'}\r\n                                                onChange={() => customHandleChange('payType', 'VARIABLE')}\r\n                                                className=\"w-4 h-4 text-blue-600 border-slate-300 focus:ring-blue-500\"\r\n                                            />\r\n                                            <span className=\"text-sm font-medium text-slate-700\">Variable Pay</span>\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Calculation Type */}\r\n                                <div>\r\n                                    <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3\">Calculation Type <span className=\"text-rose-500\">*</span></label>\r\n                                    <div className=\"flex gap-6 mb-4\">\r\n                                        <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"calcType\"\r\n                                                checked={form.calculationType === 'FLAT_AMOUNT'}\r\n                                                onChange={() => customHandleChange('calculationType', 'FLAT_AMOUNT')}\r\n                                                className=\"w-4 h-4 text-blue-600 border-slate-300 focus:ring-blue-500\"\r\n                                            />\r\n                                            <span className=\"text-sm font-medium text-slate-700\">Flat Amount</span>\r\n                                        </label>\r\n                                        {form.earningType !== 'Basic' && (\r\n                                            <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                <input\r\n                                                    type=\"radio\"\r\n                                                    name=\"calcType\"\r\n                                                    checked={form.calculationType === 'PERCENTAGE_OF_BASIC'}\r\n                                                    onChange={() => customHandleChange('calculationType', 'PERCENTAGE_OF_BASIC')}\r\n                                                    className=\"w-4 h-4 text-blue-600 border-slate-300 focus:ring-blue-500\"\r\n                                                />\r\n                                                <span className=\"text-sm font-medium text-slate-700\">Percent of Basic</span>\r\n                                            </label>\r\n                                        )}\r\n                                        <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"calcType\"\r\n                                                checked={form.calculationType === 'PERCENTAGE_OF_CTC'}\r\n                                                onChange={() => customHandleChange('calculationType', 'PERCENTAGE_OF_CTC')}\r\n                                                className=\"w-4 h-4 text-blue-600 border-slate-300 focus:ring-blue-500\"\r\n                                            />\r\n                                            <span className=\"text-sm font-medium text-slate-700\">Percent of CTC</span>\r\n                                        </label>\r\n                                    </div>\r\n\r\n                                    {/* Amount Input */}\r\n                                    <div>\r\n                                        {form.calculationType === 'FLAT_AMOUNT' ? (\r\n                                            <div className=\"relative max-w-xs\">\r\n                                                <span className=\"absolute left-3 top-2.5 text-slate-400 font-bold\">‚Çπ</span>\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    min=\"0\"\r\n                                                    value={form.amount}\r\n                                                    onChange={e => customHandleChange('amount', e.target.value)}\r\n                                                    className=\"w-full pl-8 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all\"\r\n                                                    placeholder=\"0.00\"\r\n                                                />\r\n                                                {fieldErrors.amount && (\r\n                                                    <p className=\"text-rose-600 text-xs mt-1\">{fieldErrors.amount}</p>\r\n                                                )}\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className=\"relative max-w-xs\">\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    min=\"0\"\r\n                                                    max=\"100\"\r\n                                                    value={form.percentage}\r\n                                                    onChange={e => customHandleChange('percentage', e.target.value)}\r\n                                                    className=\"w-full pl-4 pr-8 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all\"\r\n                                                    placeholder=\"0.00\"\r\n                                                />\r\n                                                <span className=\"absolute right-3 top-2.5 text-slate-400 font-bold\">%</span>\r\n                                                {fieldErrors.percentage && (\r\n                                                    <p className=\"text-rose-600 text-xs mt-1\">{fieldErrors.percentage}</p>\r\n                                                )}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"pt-4 border-t border-slate-100\">\r\n                                    <label className=\"flex items-center gap-3 cursor-pointer\">\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={form.isActive}\r\n                                            onChange={(e) => handleCheckbox('isActive', e.target.checked)}\r\n                                            className=\"w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500\"\r\n                                        />\r\n                                        <span className=\"text-sm font-semibold text-slate-700\">Mark this earning as Active</span>\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* RIGHT COLUMN */}\r\n                        <div className=\"md:col-span-1 space-y-6\">\r\n                            <div className=\"bg-white p-6 rounded-xl shadow-sm border border-slate-200\">\r\n                                <h3 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4\">Configuration</h3>\r\n                                <div className=\"space-y-4\">\r\n                                    <label className=\"flex items-start gap-3 cursor-pointer group\">\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={form.includeInSalaryStructure}\r\n                                            onChange={(e) => handleCheckbox('includeInSalaryStructure', e.target.checked)}\r\n                                            className=\"mt-1 w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500\"\r\n                                        />\r\n                                        <div className=\"text-sm\">\r\n                                            <span className=\"font-medium text-slate-700 block group-hover:text-blue-600 transition-colors\">part of salary structure</span>\r\n                                            <span className=\"text-xs text-slate-400\">Component appears in CTC</span>\r\n                                        </div>\r\n                                    </label>\r\n\r\n                                    <label className=\"flex items-start gap-3 cursor-pointer group\">\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={form.isTaxable}\r\n                                            onChange={(e) => handleCheckbox('isTaxable', e.target.checked)}\r\n                                            className=\"mt-1 w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500\"\r\n                                        />\r\n                                        <div className=\"text-sm\">\r\n                                            <span className=\"font-medium text-slate-700 block group-hover:text-blue-600 transition-colors\">Is Taxable</span>\r\n                                            <span className=\"text-xs text-slate-400\">Subject to TDS</span>\r\n                                        </div>\r\n                                    </label>\r\n\r\n                                    <label className={`flex items-start gap-3 group ${form.isUsedInPayroll ? 'cursor-not-allowed opacity-60' : 'cursor-pointer'}`}>\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            disabled={form.isUsedInPayroll}\r\n                                            checked={form.isProRataBasis}\r\n                                            onChange={(e) => handleCheckbox('isProRataBasis', e.target.checked)}\r\n                                            className=\"mt-1 w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500\"\r\n                                        />\r\n                                        <div className=\"text-sm\">\r\n                                            <span className=\"font-medium text-slate-700 block group-hover:text-blue-600 transition-colors\">Pro-rata Basis</span>\r\n                                            <span className=\"text-xs text-slate-400\">Calculated based on attendance</span>\r\n                                        </div>\r\n                                    </label>\r\n\r\n                                    <div className=\"my-4 border-t border-slate-100\"></div>\r\n\r\n                                    {/* EPF */}\r\n                                    <div className=\"space-y-3\">\r\n                                        <label className={`flex items-center gap-3 ${form.isUsedInPayroll ? 'cursor-not-allowed opacity-60' : 'cursor-pointer'}`}>\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                disabled={form.isUsedInPayroll}\r\n                                                checked={form.epf.enabled}\r\n                                                onChange={(e) => handleEPFChange(e.target.checked)}\r\n                                                className=\"w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500\"\r\n                                            />\r\n                                            <span className=\"text-sm font-medium text-slate-700\">Consider for EPF</span>\r\n                                        </label>\r\n\r\n                                        {form.epf.enabled && (\r\n                                            <div className=\"pl-7 space-y-2 animate-in fade-in slide-in-from-top-1 duration-200\">\r\n                                                <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                    <input\r\n                                                        type=\"radio\"\r\n                                                        name=\"epfRule\"\r\n                                                        checked={form.epf.rule === 'ALWAYS'}\r\n                                                        onChange={() => handleEPFRuleChange('ALWAYS')}\r\n                                                        className=\"w-3 h-3 text-blue-600 border-slate-300 focus:ring-blue-500\"\r\n                                                    />\r\n                                                    <span className=\"text-xs text-slate-600\">Always</span>\r\n                                                </label>\r\n                                                <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                    <input\r\n                                                        type=\"radio\"\r\n                                                        name=\"epfRule\"\r\n                                                        checked={form.epf.rule === 'PF_WAGE_LT_15000'}\r\n                                                        onChange={() => handleEPFRuleChange('PF_WAGE_LT_15000')}\r\n                                                        className=\"w-3 h-3 text-blue-600 border-slate-300 focus:ring-blue-500\"\r\n                                                    />\r\n                                                    <span className=\"text-xs text-slate-600\">Only when PF Wage &lt; ‚Çπ15k</span>\r\n                                                </label>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    {/* ESI */}\r\n                                    <div className=\"pt-2\">\r\n                                        <label className={`flex items-center gap-3 ${form.isUsedInPayroll ? 'cursor-not-allowed opacity-60' : 'cursor-pointer'}`}>\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                disabled={form.isUsedInPayroll}\r\n                                                checked={form.esi.enabled}\r\n                                                onChange={(e) => handleESIChange(e.target.checked)}\r\n                                                className=\"w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500\"\r\n                                            />\r\n                                            <span className=\"text-sm font-medium text-slate-700\">Consider for ESI</span>\r\n                                        </label>\r\n                                    </div>\r\n\r\n                                    <div className=\"my-4 border-t border-slate-100\"></div>\r\n\r\n                                    <label className=\"flex items-center gap-3 cursor-pointer\">\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={form.showInPayslip}\r\n                                            onChange={(e) => handleCheckbox('showInPayslip', e.target.checked)}\r\n                                            className=\"w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500\"\r\n                                        />\r\n                                        <span className=\"text-sm font-medium text-slate-700\">Show in Payslip</span>\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-blue-50 p-4 rounded-xl border border-blue-100\">\r\n                                <p className=\"text-xs text-blue-700 leading-relaxed\">\r\n                                    <span className=\"font-bold\">Note:</span> Once this component is associated with an employee, only Name and Amount can be edited to maintain payroll integrity.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"mt-8 flex items-center justify-end gap-4 border-t border-slate-200 pt-6\">\r\n                    <button\r\n                        onClick={() => navigate(-1)}\r\n                        className=\"px-6 py-2.5 rounded-lg text-sm font-semibold text-slate-600 hover:bg-slate-100 border border-transparent transition-colors\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button\r\n                        onClick={handleSubmit}\r\n                        disabled={loading || fetching}\r\n                        className=\"px-8 py-2.5 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 shadow-md shadow-blue-500/20 active:scale-95 transition-all disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                    >\r\n                        {loading && <Loader2 className=\"w-4 h-4 animate-spin\" />}\r\n                        {isEdit ? 'Update Earning' : 'Save Earning'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\NewSalaryTemplate.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'matches' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":155,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":155,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"matches"},"fix":{"range":[5585,5604],"text":""},"desc":"Remove unused variable 'matches'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'monthlyCTC' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":309,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":309,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"monthlyCTC"},"fix":{"range":[11583,11617],"text":""},"desc":"Remove unused variable 'monthlyCTC'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n    ArrowLeft,\r\n    Info,\r\n    Save,\r\n    Loader2,\r\n    Plus,\r\n    Trash2,\r\n    Calculator,\r\n    ChevronRight,\r\n    Check,\r\n    Wand2,\r\n    Search,\r\n    IndianRupee,\r\n    AlertCircle\r\n} from 'lucide-react';\r\nimport api from '../../../utils/api';\r\n\r\nexport default function NewSalaryTemplate() {\r\n    const navigate = useNavigate();\r\n    const [step, setStep] = useState(1);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState(null);\r\n\r\n    // Master Data\r\n    const [masterEarnings, setMasterEarnings] = useState([]);\r\n    const [masterDeductions, setMasterDeductions] = useState([]);\r\n    const [masterBenefits, setMasterBenefits] = useState([]);\r\n\r\n    // Step 1: Basic Details\r\n    const [basicInfo, setBasicInfo] = useState({\r\n        name: '',\r\n        description: '',\r\n        annualCTC: ''\r\n    });\r\n\r\n    // Step 2: Component Configuration\r\n    const [selectedEarnings, setSelectedEarnings] = useState([]);\r\n    const [selectedDeductions, setSelectedDeductions] = useState([]);\r\n    const [selectedBenefits, setSelectedBenefits] = useState([]);\r\n\r\n    // Search\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [showComponentPicker, setShowComponentPicker] = useState(false);\r\n    const [pickerCategory, setPickerCategory] = useState('earnings');\r\n\r\n    useEffect(() => {\r\n        fetchMasterData();\r\n    }, []);\r\n\r\n    const fetchMasterData = async () => {\r\n        try {\r\n            const [eRes, dRes, bRes] = await Promise.all([\r\n                api.get('/payroll/earnings'),\r\n                api.get('/deductions'),\r\n                api.get('/payroll/benefits')\r\n            ]);\r\n            setMasterEarnings(eRes.data.data || []);\r\n            setMasterDeductions(dRes.data.data || []);\r\n            setMasterBenefits(bRes.data.data || []);\r\n        } catch (err) {\r\n            console.error('Failed to fetch components', err);\r\n        }\r\n    };\r\n\r\n    const handleBasicChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setBasicInfo(prev => ({ ...prev, [name]: value }));\r\n        setError(null);\r\n    };\r\n\r\n    const nextStep = () => {\r\n        if (!basicInfo.name.trim()) return setError('Template name is required');\r\n        if (!basicInfo.annualCTC || Number(basicInfo.annualCTC) <= 0) return setError('Valid Annual CTC is required');\r\n\r\n        // Auto-add \"Basic\" if not already there\r\n        if (selectedEarnings.length === 0) {\r\n            const basicMaster = masterEarnings.find(e => e.name.toLowerCase().includes('basic'));\r\n            if (basicMaster) {\r\n                addEarning(basicMaster);\r\n            }\r\n        }\r\n\r\n        setStep(2);\r\n        window.scrollTo(0, 0);\r\n    };\r\n\r\n    const addEarning = (master) => {\r\n        if (selectedEarnings.find(e => e.id === master._id)) return;\r\n        const newEarning = {\r\n            id: master._id,\r\n            name: master.name,\r\n            code: master.code || master.name.toUpperCase().replace(/\\s+/g, '_'),\r\n            calculationType: 'PERCENT_CTC',\r\n            percentage: master.name.toLowerCase().includes('basic') ? 50 : 0,\r\n            formula: master.name.toLowerCase().includes('basic') ? 'CTC * 0.5' : '',\r\n            monthlyAmount: 0,\r\n            annualAmount: 0,\r\n            isRemovable: !master.name.toLowerCase().includes('basic')\r\n        };\r\n        setSelectedEarnings([...selectedEarnings, newEarning]);\r\n        setShowComponentPicker(false);\r\n    };\r\n\r\n    const addDeduction = (master) => {\r\n        if (selectedDeductions.find(d => d.id === master._id)) return;\r\n        const newDeduction = {\r\n            id: master._id,\r\n            name: master.name,\r\n            code: master.code || master.name.toUpperCase().replace(/\\s+/g, '_'),\r\n            category: master.category || 'POST_TAX',\r\n            amountType: 'FIXED',\r\n            formula: '',\r\n            amountValue: 0,\r\n            monthlyAmount: 0\r\n        };\r\n        setSelectedDeductions([...selectedDeductions, newDeduction]);\r\n        setShowComponentPicker(false);\r\n    };\r\n\r\n    const addBenefit = (master) => {\r\n        if (selectedBenefits.find(b => b.id === master._id)) return;\r\n        const newBenefit = {\r\n            id: master._id,\r\n            name: master.name,\r\n            code: master.code || master.name.toUpperCase().replace(/\\s+/g, '_'),\r\n            calculationType: 'FIXED',\r\n            formula: '',\r\n            monthlyAmount: 0,\r\n            annualAmount: 0\r\n        };\r\n        setSelectedBenefits([...selectedBenefits, newBenefit]);\r\n        setShowComponentPicker(false);\r\n    };\r\n\r\n    const removeEarning = (id) => setSelectedEarnings(selectedEarnings.filter(e => e.id !== id));\r\n    const removeDeduction = (id) => setSelectedDeductions(selectedDeductions.filter(d => d.id !== id));\r\n    const removeBenefit = (id) => setSelectedBenefits(selectedBenefits.filter(b => b.id !== id));\r\n\r\n    const updateEarning = (id, field, value) => {\r\n        setSelectedEarnings(selectedEarnings.map(e => e.id === id ? { ...e, [field]: value } : e));\r\n    };\r\n\r\n    const updateDeduction = (id, field, value) => {\r\n        setSelectedDeductions(selectedDeductions.map(d => d.id === id ? { ...d, [field]: value } : d));\r\n    };\r\n\r\n    const updateBenefit = (id, field, value) => {\r\n        setSelectedBenefits(selectedBenefits.map(b => b.id === id ? { ...b, [field]: value } : b));\r\n    };\r\n\r\n    // Auto-calculate suggested breakdown\r\n    const handleMagicSuggest = () => {\r\n        const matches = [];\r\n        const annualCTC = Number(basicInfo.annualCTC);\r\n        const monthlyCTC = annualCTC / 12;\r\n\r\n        // Reset\r\n        let newEarnings = [];\r\n        let newDeductions = [];\r\n        let newBenefits = [];\r\n\r\n        // 1. Basic (50%)\r\n        const basic = masterEarnings.find(e => e.name.toLowerCase().includes('basic'));\r\n        if (basic) {\r\n            newEarnings.push({\r\n                id: basic._id,\r\n                name: basic.name,\r\n                code: 'BASIC',\r\n                calculationType: 'PERCENT_CTC',\r\n                percentage: 50,\r\n                formula: 'CTC * 0.5',\r\n                monthlyAmount: Math.round(monthlyCTC * 0.5),\r\n                annualAmount: Math.round(annualCTC * 0.5),\r\n                isRemovable: false\r\n            });\r\n        }\r\n\r\n        // 2. HRA (40% of Basic)\r\n        const hra = masterEarnings.find(e => e.name.toLowerCase().includes('hra'));\r\n        if (hra) {\r\n            newEarnings.push({\r\n                id: hra._id,\r\n                name: hra.name,\r\n                code: 'HRA',\r\n                calculationType: 'PERCENT_BASIC',\r\n                percentage: 40,\r\n                formula: 'BASIC * 0.4',\r\n                monthlyAmount: Math.round(monthlyCTC * 0.5 * 0.4),\r\n                annualAmount: Math.round(annualCTC * 0.5 * 0.4),\r\n                isRemovable: true\r\n            });\r\n        }\r\n\r\n        // 3. PF (Employer)\r\n        const epf = masterBenefits.find(b => b.name.toLowerCase().includes('pf') || b.name.toLowerCase().includes('provident'));\r\n        if (epf) {\r\n            const basicMonthly = monthlyCTC * 0.5;\r\n            const pfWage = Math.min(basicMonthly, 15000);\r\n            const pfAmount = Math.round(pfWage * 0.12);\r\n            newBenefits.push({\r\n                id: epf._id,\r\n                name: epf.name,\r\n                code: 'EPF_EMPLOYER',\r\n                calculationType: 'FORMULA',\r\n                formula: 'Math.min(BASIC, 15000) * 0.12',\r\n                monthlyAmount: pfAmount,\r\n                annualAmount: pfAmount * 12\r\n            });\r\n        }\r\n\r\n        // 4. PF (Employee)\r\n        const pfEmp = masterDeductions.find(d => d.name.toLowerCase().includes('pf') || d.name.toLowerCase().includes('provident'));\r\n        if (pfEmp) {\r\n            newDeductions.push({\r\n                id: pfEmp._id,\r\n                name: pfEmp.name,\r\n                code: 'EPF_EMPLOYEE',\r\n                category: 'PRE_TAX',\r\n                amountType: 'FORMULA',\r\n                formula: 'Math.min(BASIC, 15000) * 0.12',\r\n                amountValue: 0,\r\n                monthlyAmount: Math.min(monthlyCTC * 0.5, 15000) * 0.12\r\n            });\r\n        }\r\n\r\n        // 5. Special Allowance (Remnant)\r\n        // Calculate consumed\r\n        const earningsTotal = newEarnings.reduce((s, e) => s + e.monthlyAmount, 0);\r\n        const benefitsTotal = newBenefits.reduce((s, b) => s + b.monthlyAmount, 0);\r\n        const specialAmt = Math.max(0, Math.round(monthlyCTC - (earningsTotal + benefitsTotal)));\r\n\r\n        const special = masterEarnings.find(e => e.name.toLowerCase().includes('special'));\r\n        if (special) {\r\n            newEarnings.push({\r\n                id: special._id,\r\n                name: special.name,\r\n                code: 'SPECIAL_ALLOWANCE',\r\n                calculationType: 'FIXED',\r\n                percentage: 0,\r\n                formula: '',\r\n                monthlyAmount: specialAmt,\r\n                annualAmount: specialAmt * 12,\r\n                isRemovable: true\r\n            });\r\n        }\r\n\r\n        setSelectedEarnings(newEarnings);\r\n        setSelectedDeductions(newDeductions);\r\n        setSelectedBenefits(newBenefits);\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        try {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            const payload = {\r\n                templateName: basicInfo.name,\r\n                description: basicInfo.description,\r\n                annualCTC: Number(basicInfo.annualCTC),\r\n                earnings: selectedEarnings.map(e => ({\r\n                    name: e.name,\r\n                    componentCode: e.code,\r\n                    calculationType: e.calculationType,\r\n                    formula: e.formula,\r\n                    percentage: e.percentage,\r\n                    monthlyAmount: e.monthlyAmount || 0,\r\n                    annualAmount: e.annualAmount || 0\r\n                })),\r\n                employerDeductions: selectedBenefits.map(b => ({\r\n                    name: b.name,\r\n                    componentCode: b.code,\r\n                    formula: b.formula,\r\n                    monthlyAmount: b.monthlyAmount || 0,\r\n                    annualAmount: b.annualAmount || 0\r\n                })),\r\n                employeeDeductions: selectedDeductions.map(d => ({\r\n                    name: d.name,\r\n                    componentCode: d.code,\r\n                    category: d.category,\r\n                    amountType: d.amountType === 'FORMULA' ? 'FORMULA' : (d.amountType === 'PERCENTAGE' ? 'PERCENTAGE' : 'FIXED'),\r\n                    formula: d.formula,\r\n                    amountValue: d.amountValue,\r\n                    monthlyAmount: d.monthlyAmount || 0\r\n                })),\r\n                settings: {\r\n                    pfWageRestriction: true,\r\n                    pfWageLimit: 15000,\r\n                    includeESI: true\r\n                }\r\n            };\r\n\r\n            const res = await api.post('/payroll/salary-templates', payload);\r\n            if (res.data.success) {\r\n                navigate('/hr/payroll/salary-components'); // Use redirection to list or dashboard\r\n            }\r\n        } catch (err) {\r\n            setError(err.response?.data?.error || 'Failed to save template');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Calculate totals for sidebar preview\r\n    const totals = useMemo(() => {\r\n        const annualCTC = Number(basicInfo.annualCTC) || 0;\r\n        const monthlyCTC = annualCTC / 12;\r\n\r\n        const earningsTotal = selectedEarnings.reduce((s, e) => s + (Number(e.monthlyAmount) || 0), 0);\r\n        const benefitsTotal = selectedBenefits.reduce((s, b) => s + (Number(b.monthlyAmount) || 0), 0);\r\n        const deductionsTotal = selectedDeductions.reduce((s, d) => s + (Number(d.monthlyAmount) || 0), 0);\r\n\r\n        const currentCTC = (earningsTotal + benefitsTotal) * 12;\r\n        const diff = Math.abs(currentCTC - annualCTC);\r\n        const isBalanced = diff < 12; // allow 1 rupee rounding drift\r\n\r\n        return {\r\n            gross: earningsTotal,\r\n            net: earningsTotal - deductionsTotal,\r\n            benefits: benefitsTotal,\r\n            deductions: deductionsTotal,\r\n            currentAnnualCTC: currentCTC,\r\n            isBalanced,\r\n            diff\r\n        };\r\n    }, [selectedEarnings, selectedDeductions, selectedBenefits, basicInfo.annualCTC]);\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50 pb-20\">\r\n            {/* HEADER */}\r\n            <div className=\"bg-white border-b border-slate-200 sticky top-0 z-20\">\r\n                <div className=\"w-full mx-auto px-4 md:px-8\">\r\n                    <div className=\"flex justify-between items-center h-20\">\r\n                        <div className=\"flex items-center gap-6\">\r\n                            <button\r\n                                onClick={() => step === 1 ? navigate(-1) : setStep(1)}\r\n                                className=\"p-2.5 hover:bg-slate-100 rounded-xl transition text-slate-500\"\r\n                            >\r\n                                <ArrowLeft size={22} />\r\n                            </button>\r\n                            <div>\r\n                                <h1 className=\"text-xl font-bold text-slate-900 leading-tight\">\r\n                                    {basicInfo.name || \"New Salary Template\"}\r\n                                </h1>\r\n                                <p className=\"text-xs text-slate-400 font-medium uppercase tracking-wider\">\r\n                                    Step {step} of 2 ‚Ä¢ {step === 1 ? 'Basic Details' : 'Component Configuration'}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-4\">\r\n                            {step === 1 ? (\r\n                                <button\r\n                                    onClick={nextStep}\r\n                                    className=\"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold flex items-center gap-2 shadow-lg shadow-blue-200 transition-all active:scale-95\"\r\n                                >\r\n                                    Next: Build Structure <ChevronRight size={18} />\r\n                                </button>\r\n                            ) : (\r\n                                <>\r\n                                    <button\r\n                                        onClick={handleMagicSuggest}\r\n                                        className=\"hidden md:flex items-center gap-2 px-4 py-2.5 bg-white border border-slate-200 text-slate-600 hover:border-blue-500 hover:text-blue-600 rounded-xl font-bold text-sm transition-all shadow-sm\"\r\n                                    >\r\n                                        <Wand2 size={16} /> Auto-Suggest\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleSave}\r\n                                        disabled={loading || !totals.isBalanced}\r\n                                        className=\"px-8 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold flex items-center gap-2 shadow-lg shadow-blue-500/20 transition-all active:scale-95 disabled:opacity-50\"\r\n                                    >\r\n                                        {loading ? <Loader2 className=\"animate-spin\" size={20} /> : <Save size={20} />}\r\n                                        Create Template\r\n                                    </button>\r\n                                </>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"w-full mx-auto px-4 md:px-8 py-8\">\r\n                {error && (\r\n                    <div className=\"mb-6 animate-in fade-in slide-in-from-top-2 duration-300\">\r\n                        <div className=\"bg-rose-50 border border-rose-100 text-rose-600 px-4 py-3 rounded-xl flex items-center gap-3 text-sm font-medium\">\r\n                            <AlertCircle size={18} /> {error}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {step === 1 ? (\r\n                    /* STEP 1: BASIC INFO */\r\n                    <div className=\"max-w-2xl mx-auto\">\r\n                        <div className=\"bg-white rounded-3xl p-8 shadow-sm border border-slate-200 space-y-8\">\r\n                            <div className=\"space-y-2\">\r\n                                <h2 className=\"text-2xl font-black text-slate-800 tracking-tight\">Template Identity</h2>\r\n                                <p className=\"text-slate-500 text-sm\">Define the core attributes for this salary structure.</p>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 gap-6\">\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1\">Template Name *</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        name=\"name\"\r\n                                        value={basicInfo.name}\r\n                                        onChange={handleBasicChange}\r\n                                        placeholder=\"e.g. Standard Product Team (Grade 3)\"\r\n                                        className=\"w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 outline-none transition-all font-semibold\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1\">Description</label>\r\n                                    <textarea\r\n                                        name=\"description\"\r\n                                        value={basicInfo.description}\r\n                                        onChange={handleBasicChange}\r\n                                        placeholder=\"Briefly explain who this template is for...\"\r\n                                        rows={3}\r\n                                        className=\"w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 outline-none transition-all font-medium\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 flex items-center gap-1\">\r\n                                            <IndianRupee size={10} /> Target Annual CTC *\r\n                                        </label>\r\n                                        <div className=\"relative\">\r\n                                            <div className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold\">‚Çπ</div>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                name=\"annualCTC\"\r\n                                                value={basicInfo.annualCTC}\r\n                                                onChange={handleBasicChange}\r\n                                                placeholder=\"0.00\"\r\n                                                className=\"w-full pl-8 pr-4 py-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 outline-none transition-all text-lg font-black\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"space-y-2 opacity-50 select-none\">\r\n                                        <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 flex items-center gap-1 text-blue-500\">\r\n                                            Monthly CTC (Equivalent)\r\n                                        </label>\r\n                                        <div className=\"p-4 bg-blue-50/50 border border-blue-100 rounded-2xl font-black text-blue-700 text-lg\">\r\n                                            ‚Çπ{basicInfo.annualCTC ? (Number(basicInfo.annualCTC) / 12).toLocaleString('en-IN', { maximumFractionDigits: 0 }) : '0'}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"bg-blue-50/30 p-5 rounded-2xl border border-blue-50 flex items-start gap-4\">\r\n                                    <div className=\"p-2 bg-blue-100 rounded-full text-blue-600 flex-shrink-0\">\r\n                                        <Info size={16} />\r\n                                    </div>\r\n                                    <p className=\"text-xs text-blue-700 leading-relaxed font-medium\">\r\n                                        Entering the CTC helps us suggest a balanced structure in the next step.\r\n                                        Don't worry, you can always adjust individual components exactly how you want.\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    /* STEP 2: STRUCTURE DESIGN */\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                        {/* LEFT: COMPONENT EDITOR */}\r\n                        <div className=\"lg:col-span-2 space-y-8\">\r\n\r\n                            {/* EARNINGS */}\r\n                            <section className=\"space-y-4\">\r\n                                <div className=\"flex justify-between items-center px-2\">\r\n                                    <h3 className=\"text-lg font-black text-slate-800 flex items-center gap-2 uppercase tracking-tight\">\r\n                                        <IndianRupee size={20} className=\"text-emerald-500\" /> 1. Monthly Earnings\r\n                                    </h3>\r\n                                    <button\r\n                                        onClick={() => { setPickerCategory('earnings'); setShowComponentPicker(true); }}\r\n                                        className=\"text-blue-600 hover:text-blue-700 font-bold text-xs flex items-center gap-1 uppercase tracking-widest p-1 hover:bg-blue-50 rounded\"\r\n                                    >\r\n                                        <Plus size={14} /> Add Component\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    {selectedEarnings.map(comp => (\r\n                                        <div key={comp.id} className=\"bg-white rounded-2xl p-5 border border-slate-200 shadow-sm hover:border-blue-200 transition-all group\">\r\n                                            <div className=\"flex flex-col md:flex-row md:items-center gap-6\">\r\n                                                <div className=\"flex-1\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <span className=\"font-bold text-slate-900\">{comp.name}</span>\r\n                                                        <span className=\"text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter\">{comp.code}</span>\r\n                                                    </div>\r\n                                                    <div className=\"mt-4 flex flex-wrap gap-4 items-end\">\r\n                                                        <div className=\"space-y-1.5 min-w-[140px]\">\r\n                                                            <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block ml-0.5\">Calculation</label>\r\n                                                            <select\r\n                                                                className=\"w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold outline-none\"\r\n                                                                value={comp.calculationType}\r\n                                                                onChange={(e) => updateEarning(comp.id, 'calculationType', e.target.value)}\r\n                                                            >\r\n                                                                <option value=\"PERCENT_CTC\">% of CTC</option>\r\n                                                                <option value=\"PERCENT_BASIC\">% of Basic</option>\r\n                                                                <option value=\"FIXED\">Flat (Monthly)</option>\r\n                                                                <option value=\"FORMULA\">Custom Formula</option>\r\n                                                            </select>\r\n                                                        </div>\r\n\r\n                                                        {comp.calculationType === 'FORMULA' ? (\r\n                                                            <div className=\"space-y-1.5 flex-1 min-w-[200px]\">\r\n                                                                <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block ml-0.5\">Formula (e.g. CTC * 0.4)</label>\r\n                                                                <input\r\n                                                                    type=\"text\"\r\n                                                                    className=\"w-full p-2 bg-amber-50/50 border border-amber-200 rounded-lg text-xs font-mono font-bold text-amber-900 outline-none\"\r\n                                                                    value={comp.formula}\r\n                                                                    onChange={(e) => updateEarning(comp.id, 'formula', e.target.value)}\r\n                                                                />\r\n                                                            </div>\r\n                                                        ) : comp.calculationType === 'FIXED' ? null : (\r\n                                                            <div className=\"space-y-1.5 w-16\">\r\n                                                                <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block ml-0.5\">Value</label>\r\n                                                                <div className=\"relative\">\r\n                                                                    <input\r\n                                                                        type=\"number\"\r\n                                                                        className=\"w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold outline-none pr-4 text-right\"\r\n                                                                        value={comp.percentage}\r\n                                                                        onChange={(e) => updateEarning(comp.id, 'percentage', e.target.value)}\r\n                                                                    />\r\n                                                                    <span className=\"absolute right-1 top-1/2 -translate-y-1/2 text-[9px] font-bold text-slate-400\">%</span>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        )}\r\n\r\n                                                        <div className=\"space-y-1.5 w-32 ml-auto\">\r\n                                                            <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block text-right mr-1\">Amount (Monthly)</label>\r\n                                                            <input\r\n                                                                type=\"number\"\r\n                                                                className=\"w-full p-2 bg-blue-50/50 border border-blue-200 rounded-lg text-xs font-black text-blue-700 outline-none text-right\"\r\n                                                                value={comp.monthlyAmount}\r\n                                                                onChange={(e) => updateEarning(comp.id, 'monthlyAmount', e.target.value)}\r\n                                                            />\r\n                                                        </div>\r\n\r\n                                                        {comp.isRemovable && (\r\n                                                            <button\r\n                                                                onClick={() => removeEarning(comp.id)}\r\n                                                                className=\"p-2 text-slate-300 hover:text-rose-500 rounded-lg transition-colors group-hover:opacity-100 opacity-0\"\r\n                                                            >\r\n                                                                <Trash2 size={16} />\r\n                                                            </button>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </section>\r\n\r\n                            {/* BENEFITS */}\r\n                            <section className=\"space-y-4\">\r\n                                <div className=\"flex justify-between items-center px-2\">\r\n                                    <h3 className=\"text-lg font-black text-slate-800 flex items-center gap-2 uppercase tracking-tight\">\r\n                                        <Calculator size={20} className=\"text-blue-500\" /> 2. Employer Contributions (Retirals)\r\n                                    </h3>\r\n                                    <button\r\n                                        onClick={() => { setPickerCategory('benefits'); setShowComponentPicker(true); }}\r\n                                        className=\"text-blue-600 hover:text-blue-700 font-bold text-xs flex items-center gap-1 uppercase tracking-widest p-1 hover:bg-blue-50 rounded\"\r\n                                    >\r\n                                        <Plus size={14} /> Add Component\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    {selectedBenefits.length === 0 && (\r\n                                        <div className=\"bg-slate-100/50 border-2 border-dashed border-slate-200 rounded-2xl p-6 text-center text-slate-400 text-xs font-bold uppercase tracking-widest\">\r\n                                            No employer benefits selected\r\n                                        </div>\r\n                                    )}\r\n                                    {selectedBenefits.map(comp => (\r\n                                        <div key={comp.id} className=\"bg-white rounded-2xl p-5 border border-slate-200 shadow-sm hover:border-blue-200 transition-all group\">\r\n                                            <div className=\"flex flex-col md:flex-row md:items-center gap-6\">\r\n                                                <div className=\"flex-1\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <span className=\"font-bold text-slate-900\">{comp.name}</span>\r\n                                                        <span className=\"text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter\">{comp.code}</span>\r\n                                                    </div>\r\n                                                    <div className=\"mt-4 flex flex-wrap gap-4 items-end\">\r\n                                                        <div className=\"space-y-1.5 min-w-[240px] flex-1\">\r\n                                                            <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block ml-0.5 font-mono\">Formula (e.g. BASIC * 0.12)</label>\r\n                                                            <input\r\n                                                                type=\"text\"\r\n                                                                className=\"w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold outline-none font-mono\"\r\n                                                                value={comp.formula}\r\n                                                                onChange={(e) => updateBenefit(comp.id, 'formula', e.target.value)}\r\n                                                                placeholder=\"Calculation rule...\"\r\n                                                            />\r\n                                                        </div>\r\n\r\n                                                        <div className=\"space-y-1.5 w-32 ml-auto text-right\">\r\n                                                            <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block mr-1 text-right\">Monthly Cost</label>\r\n                                                            <input\r\n                                                                type=\"number\"\r\n                                                                className=\"w-full p-2 bg-indigo-50/50 border border-indigo-200 rounded-lg text-xs font-black text-indigo-700 outline-none text-right\"\r\n                                                                value={comp.monthlyAmount}\r\n                                                                onChange={(e) => updateBenefit(comp.id, 'monthlyAmount', e.target.value)}\r\n                                                            />\r\n                                                        </div>\r\n\r\n                                                        <button\r\n                                                            onClick={() => removeBenefit(comp.id)}\r\n                                                            className=\"p-2 text-slate-300 hover:text-rose-500 rounded-lg transition-colors group-hover:opacity-100 opacity-0\"\r\n                                                        >\r\n                                                            <Trash2 size={16} />\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </section>\r\n\r\n                            {/* DEDUCTIONS */}\r\n                            <section className=\"space-y-4\">\r\n                                <div className=\"flex justify-between items-center px-2\">\r\n                                    <h3 className=\"text-lg font-black text-slate-800 flex items-center gap-2 uppercase tracking-tight\">\r\n                                        <Trash2 size={20} className=\"text-rose-500\" /> 3. Employee Deductions (Statutory)\r\n                                    </h3>\r\n                                    <button\r\n                                        onClick={() => { setPickerCategory('deductions'); setShowComponentPicker(true); }}\r\n                                        className=\"text-blue-600 hover:text-blue-700 font-bold text-xs flex items-center gap-1 uppercase tracking-widest p-1 hover:bg-blue-50 rounded\"\r\n                                    >\r\n                                        <Plus size={14} /> Add Component\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    {selectedDeductions.length === 0 && (\r\n                                        <div className=\"bg-slate-100/50 border-2 border-dashed border-slate-200 rounded-2xl p-6 text-center text-slate-400 text-xs font-bold uppercase tracking-widest\">\r\n                                            No employee deductions added\r\n                                        </div>\r\n                                    )}\r\n                                    {selectedDeductions.map(comp => (\r\n                                        <div key={comp.id} className=\"bg-white rounded-2xl p-5 border border-slate-200 shadow-sm hover:border-blue-200 transition-all group\">\r\n                                            <div className=\"flex flex-col md:flex-row md:items-center gap-6\">\r\n                                                <div className=\"flex-1\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <span className=\"font-bold text-slate-900\">{comp.name}</span>\r\n                                                        <span className={`text-[9px] px-1.5 py-0.5 rounded font-bold uppercase tracking-tighter ${comp.category === 'PRE_TAX' ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-500'}`}>\r\n                                                            {comp.category}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <div className=\"mt-4 flex flex-wrap gap-4 items-end\">\r\n                                                        <div className=\"space-y-1.5 w-32\">\r\n                                                            <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block ml-0.5\">Type</label>\r\n                                                            <select\r\n                                                                className=\"w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold outline-none\"\r\n                                                                value={comp.amountType}\r\n                                                                onChange={(e) => updateDeduction(comp.id, 'amountType', e.target.value)}\r\n                                                            >\r\n                                                                <option value=\"FIXED\">Flat (Monthly)</option>\r\n                                                                <option value=\"PERCENTAGE\">% of Basic</option>\r\n                                                                <option value=\"FORMULA\">Formula</option>\r\n                                                            </select>\r\n                                                        </div>\r\n\r\n                                                        {comp.amountType === 'FORMULA' ? (\r\n                                                            <div className=\"space-y-1.5 flex-1 min-w-[200px]\">\r\n                                                                <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block ml-0.5\">Rule</label>\r\n                                                                <input\r\n                                                                    type=\"text\"\r\n                                                                    className=\"w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold outline-none font-mono\"\r\n                                                                    value={comp.formula}\r\n                                                                    onChange={(e) => updateDeduction(comp.id, 'formula', e.target.value)}\r\n                                                                />\r\n                                                            </div>\r\n                                                        ) : comp.amountType === 'FIXED' ? null : (\r\n                                                            <div className=\"space-y-1.5 w-16\">\r\n                                                                <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block ml-0.5\">Value</label>\r\n                                                                <input\r\n                                                                    type=\"number\"\r\n                                                                    className=\"w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold outline-none pr-4 text-right\"\r\n                                                                    value={comp.amountValue}\r\n                                                                    onChange={(e) => updateDeduction(comp.id, 'amountValue', e.target.value)}\r\n                                                                />\r\n                                                            </div>\r\n                                                        )}\r\n\r\n                                                        <div className=\"space-y-1.5 w-32 ml-auto text-right\">\r\n                                                            <label className=\"text-[9px] uppercase font-black text-slate-400 tracking-widest block mr-1 text-right\">Monthly Ded.</label>\r\n                                                            <input\r\n                                                                type=\"number\"\r\n                                                                className=\"w-full p-2 bg-rose-50/50 border border-rose-200 rounded-lg text-xs font-black text-rose-700 outline-none text-right\"\r\n                                                                value={comp.monthlyAmount}\r\n                                                                onChange={(e) => updateDeduction(comp.id, 'monthlyAmount', e.target.value)}\r\n                                                            />\r\n                                                        </div>\r\n\r\n                                                        <button\r\n                                                            onClick={() => removeDeduction(comp.id)}\r\n                                                            className=\"p-2 text-slate-300 hover:text-rose-500 rounded-lg transition-colors group-hover:opacity-100 opacity-0\"\r\n                                                        >\r\n                                                            <Trash2 size={16} />\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </section>\r\n                        </div>\r\n\r\n                        {/* RIGHT: LIVE PREVIEW SIDEBAR */}\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"bg-[#1e293b] text-white p-6 rounded-[2rem] shadow-2xl space-y-8 sticky top-28\">\r\n                                <div className=\"flex justify-between items-center border-b border-white/10 pb-4\">\r\n                                    <h3 className=\"font-bold uppercase tracking-widest text-[10px] text-blue-400\">Live Structure Summary</h3>\r\n                                    {totals.isBalanced ?\r\n                                        <span className=\"flex items-center gap-1.5 text-[9px] font-bold text-emerald-400 uppercase bg-emerald-400/10 px-2 py-0.5 rounded-full border border-emerald-400/20\">\r\n                                            <Check size={10} /> Balanced\r\n                                        </span> :\r\n                                        <span className=\"flex items-center gap-1.5 text-[9px] font-bold text-rose-400 uppercase bg-rose-400/10 px-2 py-0.5 rounded-full border border-rose-400/20\">\r\n                                            Mismatch: ‚Çπ{Math.round(totals.diff)}\r\n                                        </span>\r\n                                    }\r\n                                </div>\r\n\r\n                                <div className=\"space-y-6\">\r\n                                    <div>\r\n                                        <p className=\"text-[10px] uppercase font-bold text-slate-500 tracking-widest mb-1\">Monthly Take Home (Approx)</p>\r\n                                        <p className=\"text-4xl font-black text-white flex items-baseline gap-1\">\r\n                                            <span className=\"text-xl font-bold opacity-40\">‚Çπ</span>{totals.net.toLocaleString('en-IN', { maximumFractionDigits: 0 })}\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-3\">\r\n                                        <div className=\"p-4 bg-white/5 rounded-2xl border border-white/5\">\r\n                                            <p className=\"text-[9px] uppercase font-bold text-slate-500 mb-1\">Gross Earnings</p>\r\n                                            <p className=\"font-black text-lg\">‚Çπ{totals.gross.toLocaleString('en-IN', { maximumFractionDigits: 0 })}</p>\r\n                                        </div>\r\n                                        <div className=\"p-4 bg-white/5 rounded-2xl border border-white/5\">\r\n                                            <p className=\"text-[9px] uppercase font-bold text-slate-500 mb-1\">Emp. Deductions</p>\r\n                                            <p className=\"font-black text-lg text-rose-400\">‚Çπ{totals.deductions.toLocaleString('en-IN', { maximumFractionDigits: 0 })}</p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"p-6 bg-gradient-to-br from-blue-600 to-blue-800 rounded-3xl shadow-xl border border-white/10\">\r\n                                        <div className=\"flex justify-between items-center mb-1\">\r\n                                            <p className=\"text-[10px] uppercase font-bold text-blue-100 tracking-widest opacity-80\">Calculated Annual CTC</p>\r\n                                        </div>\r\n                                        <p className=\"text-3xl font-black\">‚Çπ{totals.currentAnnualCTC.toLocaleString('en-IN', { maximumFractionDigits: 0 })}</p>\r\n                                        <div className=\"mt-3 py-1 border-t border-white/10 flex justify-between items-center\">\r\n                                            <span className=\"text-[9px] uppercase font-bold text-blue-300\">Target CTC</span>\r\n                                            <span className=\"text-[11px] font-black opacity-80\">‚Çπ{Number(basicInfo.annualCTC).toLocaleString('en-IN')}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {!totals.isBalanced && (\r\n                                    <div className=\"flex items-start gap-3 p-4 bg-rose-500/10 border border-rose-500/20 rounded-2xl\">\r\n                                        <AlertCircle size={16} className=\"text-rose-400 flex-shrink-0 mt-0.5\" />\r\n                                        <p className=\"text-[10px] font-medium text-rose-300 leading-normal\">\r\n                                            The sum of <b>Earnings + Employer Benefits</b> must equal the <b>Target CTC</b>. Adjust the monthly amounts to balance the structure.\r\n                                        </p>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <button\r\n                                    onClick={handleSave}\r\n                                    disabled={loading || !totals.isBalanced}\r\n                                    className=\"w-full flex items-center justify-center gap-3 px-6 py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl transition-all disabled:opacity-30 shadow-xl shadow-blue-900/40 font-black text-sm uppercase tracking-widest\"\r\n                                >\r\n                                    {loading ? <Loader2 size={20} className=\"animate-spin\" /> : <Save size={20} />}\r\n                                    Finalize Template\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* COMPONENT PICKER OVERLAY */}\r\n            {showComponentPicker && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                    <div className=\"fixed inset-0 bg-slate-900/80 backdrop-blur-sm\" onClick={() => setShowComponentPicker(false)}></div>\r\n                    <div className=\"bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl relative z-10 overflow-hidden animate-in zoom-in-95 duration-200\">\r\n                        <div className=\"p-8 border-b border-slate-100\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-2xl font-black text-slate-900 tracking-tight\">Add {pickerCategory}</h3>\r\n                                <button onClick={() => setShowComponentPicker(false)} className=\"p-2 hover:bg-slate-100 rounded-full text-slate-400 transition-colors\">\r\n                                    <Trash2 size={20} />\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"relative\">\r\n                                <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder={`Search ${pickerCategory}...`}\r\n                                    className=\"w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-blue-100 outline-none transition-all font-semibold italic text-sm\"\r\n                                    value={searchQuery}\r\n                                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                                    autoFocus\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-4 max-h-[400px] overflow-y-auto bg-slate-50/50\">\r\n                            <div className=\"grid grid-cols-1 gap-2\">\r\n                                {(pickerCategory === 'earnings' ? masterEarnings : pickerCategory === 'deductions' ? masterDeductions : masterBenefits)\r\n                                    .filter(c => c.name.toLowerCase().includes(searchQuery.toLowerCase()))\r\n                                    .map(comp => (\r\n                                        <button\r\n                                            key={comp._id}\r\n                                            onClick={() => {\r\n                                                if (pickerCategory === 'earnings') addEarning(comp);\r\n                                                else if (pickerCategory === 'deductions') addDeduction(comp);\r\n                                                else addBenefit(comp);\r\n                                            }}\r\n                                            className=\"flex items-center justify-between p-4 bg-white border border-slate-200 rounded-2xl hover:border-blue-500 hover:shadow-md transition-all group text-left\"\r\n                                        >\r\n                                            <div>\r\n                                                <div className=\"font-bold text-slate-800\">{comp.name}</div>\r\n                                                <div className=\"text-[10px] text-slate-400 uppercase font-black tracking-widest\">{comp.code || 'NO-CODE'}</div>\r\n                                            </div>\r\n                                            <div className=\"p-2 bg-slate-50 group-hover:bg-blue-600 group-hover:text-white rounded-xl transition-colors\">\r\n                                                <Plus size={16} />\r\n                                            </div>\r\n                                        </button>\r\n                                    ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\PaySlipDesign.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\PayrollDashboard.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token `}`. Did you mean `&rbrace;` or `{\"}\"}`?","line":229,"column":1}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport api from '../../../utils/api';\r\nimport { IndianRupee, Users, TrendingUp, Calendar, ArrowRight, Play, FileText, PieChart } from 'lucide-react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nexport default function PayrollDashboard() {\r\n    const [loading, setLoading] = useState(true);\r\n    const [stats, setStats] = useState({\r\n        lastMonthPayout: 0,\r\n        lastMonthHeadcount: 0,\r\n        ytdPayout: 0,\r\n        recentRuns: []\r\n    });\r\n\r\n    useEffect(() => {\r\n        loadDashboardData();\r\n    }, []);\r\n\r\n    async function loadDashboardData() {\r\n        try {\r\n            setLoading(true);\r\n            const year = new Date().getFullYear();\r\n\r\n            // Fetch runs for current year to calculate stats\r\n            // Note: In a real large-scale app, we'd want a dedicated /stats endpoint.\r\n            // Optimizing here by using existing list endpoint and processing client side for MVP.\r\n            const res = await api.get(`/payroll/runs?year=${year}`);\r\n            const runs = res.data?.data || [];\r\n\r\n            // Sort runs by date desc\r\n            runs.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\r\n\r\n            let lastMonthPayout = 0;\r\n            let lastMonthHeadcount = 0;\r\n            let ytdPayout = 0;\r\n\r\n            // Find latest APPROVED or PAID run\r\n            const latestCompleted = runs.find(r => ['APPROVED', 'PAID'].includes(r.status));\r\n            if (latestCompleted) {\r\n                lastMonthPayout = latestCompleted.totalNetPay || 0;\r\n                lastMonthHeadcount = latestCompleted.processedEmployees || 0;\r\n            }\r\n\r\n            // Calculate YTD\r\n            ytdPayout = runs\r\n                .filter(r => ['APPROVED', 'PAID'].includes(r.status))\r\n                .reduce((sum, r) => sum + (r.totalNetPay || 0), 0);\r\n\r\n            setStats({\r\n                lastMonthPayout,\r\n                lastMonthHeadcount,\r\n                ytdPayout,\r\n                recentRuns: runs.slice(0, 5) // Last 5 runs\r\n            });\r\n\r\n        } catch (err) {\r\n            console.error(\"Failed to load dashboard stats\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    const StatCard = ({ title, value, subtitle, icon: Icon, color, gradient }) => (\r\n        <div className=\"relative overflow-hidden bg-white dark:bg-slate-900 p-8 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-xl group hover:shadow-2xl hover:scale-[1.02] transition-all duration-300\">\r\n            <div className={`absolute -right-6 -top-6 p-4 opacity-5 group-hover:opacity-10 transition-opacity rotate-12`}>\r\n                <Icon className={`w-32 h-32 ${color.replace('bg-', 'text-')}`} />\r\n            </div>\r\n            <div className=\"relative z-10\">\r\n                <div className=\"flex items-center gap-4 mb-6\">\r\n                    <div className={`p-4 rounded-2xl ${color} shadow-lg shadow-blue-500/20 text-white ring-4 ring-white dark:ring-slate-900`}>\r\n                        <Icon className=\"h-6 w-6\" />\r\n                    </div>\r\n                    <p className=\"text-xs font-black text-slate-400 uppercase tracking-widest\">{title}</p>\r\n                </div>\r\n                <h3 className=\"text-3xl md:text-4xl font-black text-slate-800 dark:text-white tracking-tighter mb-2\">{value}</h3>\r\n                <p className=\"text-xs font-bold text-slate-500 dark:text-slate-400 flex items-center gap-2\">\r\n                    <span className={`w-2 h-2 rounded-full ${color}`}></span>\r\n                    {subtitle}\r\n                </p>\r\n            </div>\r\n            <div className={`absolute bottom-0 left-0 right-0 h-1.5 bg-gradient-to-r ${gradient}`}></div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"space-y-6 w-full mx-auto p-6\">\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n        <div className=\"space-y-8 max-w-7xl mx-auto p-6 md:p-8 animate-in fade-in duration-500\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-end gap-6 pb-6 border-b border-slate-100 dark:border-slate-800\">\r\n                <div>\r\n                    <h1 className=\"text-4xl font-black text-slate-800 dark:text-white tracking-tighter uppercase mb-2\">Payroll Overview</h1>\r\n                    <p className=\"text-slate-500 dark:text-slate-400 font-bold text-sm uppercase tracking-wide\">Real-time snapshots of payroll activities</p>\r\n                </div>\r\n                <Link to=\"/hr/payroll/run\" className=\"group px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl shadow-xl shadow-blue-500/20 hover:shadow-2xl hover:shadow-blue-500/30 transition-all duration-300 flex items-center gap-3 font-black uppercase tracking-widest text-sm\">\r\n                    <div className=\"p-1 bg-white/20 rounded-lg group-hover:scale-110 transition-transform\">\r\n                        <Play className=\"h-4 w-4\" fill=\"currentColor\" />\r\n                    </div>\r\n                    Run Payroll\r\n                </Link>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className=\"flex items-center justify-center h-64\">\r\n                    <div className=\"flex flex-col items-center gap-4\">\r\n                        <div className=\"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin\"></div>\r\n                        <div className=\"text-slate-400 font-black uppercase tracking-widest animate-pulse\">Loading metrics...</div>\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <>\r\n                    {/* KPI Cards */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n                        <StatCard\r\n                            title=\"Last Payroll Cost\"\r\n                            value={`‚Çπ${stats.lastMonthPayout.toLocaleString()}`}\r\n                            subtitle=\"Net Pay Disbursed\"\r\n                            icon={IndianRupee}\r\n                            color=\"bg-emerald-500\"\r\n                            gradient=\"from-emerald-400 to-emerald-600\"\r\n                        />\r\n                        <StatCard\r\n                            title=\"Employees Paid\"\r\n                            value={stats.lastMonthHeadcount}\r\n                            subtitle=\"Last processed cycle\"\r\n                            icon={Users}\r\n                            color=\"bg-blue-500\"\r\n                            gradient=\"from-blue-400 to-blue-600\"\r\n                        />\r\n                        <StatCard\r\n                            title=\"YTD Cost\"\r\n                            value={`‚Çπ${stats.ytdPayout.toLocaleString()}`}\r\n                            subtitle={`Total for ${new Date().getFullYear()}`}\r\n                            icon={TrendingUp}\r\n                            color=\"bg-purple-500\"\r\n                            gradient=\"from-purple-400 to-purple-600\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                        {/* Recent Activity */}\r\n                        <div className=\"lg:col-span-2 bg-white dark:bg-slate-900 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-800 overflow-hidden flex flex-col\">\r\n                            <div className=\"px-8 py-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50/50 dark:bg-slate-950/50\">\r\n                                <h3 className=\"font-black text-slate-800 dark:text-white uppercase tracking-widest flex items-center gap-3\">\r\n                                    <Calendar className=\"h-5 w-5 text-slate-400\" /> Recent Runs\r\n                                </h3>\r\n                                <Link to=\"/hr/payroll/run\" className=\"text-xs font-black text-blue-600 hover:text-blue-700 uppercase tracking-widest flex items-center gap-2 hover:gap-3 transition-all\">\r\n                                    View All <ArrowRight className=\"h-3 w-3\" />\r\n                                </Link>\r\n                            </div>\r\n                            <div className=\"overflow-x-auto flex-1\">\r\n                                <table className=\"min-w-full divide-y divide-slate-100 dark:divide-slate-800\">\r\n                                    <thead className=\"bg-white dark:bg-slate-900\">\r\n                                        <tr>\r\n                                            <th className=\"px-8 py-5 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Period</th>\r\n                                            <th className=\"px-8 py-5 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Date</th>\r\n                                            <th className=\"px-8 py-5 text-left text-[10px] font-black text-slate-400 uppercase tracking-widest\">Status</th>\r\n                                            <th className=\"px-8 py-5 text-right text-[10px] font-black text-slate-400 uppercase tracking-widest\">Amount</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody className=\"divide-y divide-slate-100 dark:divide-slate-800 bg-white dark:bg-slate-900\">\r\n                                        {stats.recentRuns.length === 0 ? (\r\n                                            <tr><td colSpan=\"4\" className=\"px-8 py-16 text-center text-slate-400 font-bold uppercase tracking-wider\">No payroll runs found yet.</td></tr>\r\n                                        ) : (\r\n                                            stats.recentRuns.map(run => (\r\n                                                <tr key={run._id} className=\"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors group\">\r\n                                                    <td className=\"px-8 py-5 whitespace-nowrap text-sm font-bold text-slate-700 dark:text-slate-200\">\r\n                                                        {new Date(0, run.month - 1).toLocaleString('default', { month: 'long' })} {run.year}\r\n                                                    </td>\r\n                                                    <td className=\"px-8 py-5 whitespace-nowrap text-xs font-bold text-slate-500 dark:text-slate-400\">\r\n                                                        {new Date(run.updatedAt).toLocaleDateString()}\r\n                                                    </td>\r\n                                                    <td className=\"px-8 py-5 whitespace-nowrap\">\r\n                                                        <span className={`px-4 py-1.5 text-[10px] font-black rounded-xl uppercase tracking-wider shadow-sm \r\n                                         ${run.status === 'PAID' ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400' :\r\n                                                                run.status === 'APPROVED' ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' :\r\n                                                                    run.status === 'CALCULATED' ? 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400' :\r\n                                                                        'bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400'}`}>\r\n                                                            {run.status}\r\n                                                        </span>\r\n                                                    </td>\r\n                                                    <td className=\"px-8 py-5 whitespace-nowrap text-sm text-slate-800 dark:text-white text-right font-black tracking-tight\">\r\n                                                        ‚Çπ{(run.totalNetPay || 0).toLocaleString()}\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ))\r\n                                        )}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Quick Actions / Configuration */}\r\n                        <div className=\"space-y-8\">\r\n                            <div className=\"bg-white dark:bg-slate-900 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-800 p-8 h-full\">\r\n                                <h3 className=\"font-black text-slate-800 dark:text-white mb-8 flex items-center gap-3 uppercase tracking-widest\">\r\n                                    <PieChart className=\"h-5 w-5 text-slate-400\" /> Quick Actions\r\n                                </h3>\r\n                                <div className=\"space-y-4\">\r\n                                    {[\r\n                                        { to: \"/hr/payroll/salary-components\", label: \"Manage Components\", icon: Users },\r\n                                        { to: \"/hr/payroll/salary-templates/new\", label: \"Design Salary Template\", icon: TrendingUp },\r\n                                        { to: \"/hr/payroll/payslips\", label: \"Download Payslips\", icon: FileText }\r\n                                    ].map((action, idx) => (\r\n                                        <Link\r\n                                            key={idx}\r\n                                            to={action.to}\r\n                                            className=\"flex items-center justify-between p-5 rounded-2xl border border-slate-100 dark:border-slate-800 hover:border-blue-500 hover:ring-4 hover:ring-blue-500/10 hover:shadow-lg transition-all duration-300 group bg-slate-50 dark:bg-slate-800/50 hover:bg-white dark:hover:bg-slate-800\"\r\n                                        >\r\n                                            <div className=\"flex items-center gap-4\">\r\n                                                <div className=\"p-2 bg-white dark:bg-slate-700 rounded-lg text-slate-400 group-hover:text-blue-600 transition-colors shadow-sm\">\r\n                                                    <action.icon size={18} />\r\n                                                </div>\r\n                                                <span className=\"text-sm font-bold text-slate-600 dark:text-slate-300 group-hover:text-slate-900 dark:group-hover:text-white transition-colors\">{action.label}</span>\r\n                                            </div>\r\n                                            <div className=\"w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center group-hover:bg-blue-600 transition-colors\">\r\n                                                <ArrowRight className=\"h-4 w-4 text-slate-500 dark:text-slate-400 group-hover:text-white -ml-0.5\" />\r\n                                            </div>\r\n                                        </Link>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\PayrollReport.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPayrollRuns'. Either include it or remove the dependency array.","line":31,"column":8,"nodeType":"ArrayExpression","endLine":31,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPayrollRuns, year]","fix":{"range":[1110,1116],"text":"[fetchPayrollRuns, year]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":51,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { \r\n    Table, Card, Select, Button, DatePicker, \r\n    Statistic, Row, Col, Divider, Tag, Space, Modal, \r\n    Form, Input, Popconfirm, message, Spin, Empty,\r\n    Tooltip, Avatar\r\n} from 'antd';\r\nimport { \r\n    BarChart, Bar, LineChart, Line, PieChart, Pie, Cell,\r\n    XAxis, YAxis, CartesianGrid, Legend, ResponsiveContainer, Tooltip as RechartsTooltip\r\n} from 'recharts';\r\nimport { \r\n    Download, FileJson, Send, CheckCircle, AlertCircle, \r\n    TrendingUp, Users, DollarSign, Activity \r\n} from 'lucide-react';\r\nimport api from '../../../utils/api';\r\nimport dayjs from 'dayjs';\r\n\r\nconst { Option } = Select;\r\n\r\nconst PayrollReport = () => {\r\n    const [payrollRuns, setPayrollRuns] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [year, setYear] = useState(dayjs().year());\r\n    const [selectedRun, setSelectedRun] = useState(null);\r\n    const [runDetails, setRunDetails] = useState(null);\r\n    const [detailsLoading, setDetailsLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchPayrollRuns();\r\n    }, [year]);\r\n\r\n    const fetchPayrollRuns = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await api.get(`/payroll/runs?year=${year}`);\r\n            setPayrollRuns(res.data?.data || []);\r\n        } catch (err) {\r\n            message.error(\"Failed to fetch payroll runs\");\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const fetchRunDetails = async (runId) => {\r\n        setDetailsLoading(true);\r\n        try {\r\n            const res = await api.get(`/payroll/runs/${runId}`);\r\n            setRunDetails(res.data?.data);\r\n        } catch (err) {\r\n            message.error(\"Failed to fetch payroll run details\");\r\n        } finally {\r\n            setDetailsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSelectRun = (run) => {\r\n        setSelectedRun(run);\r\n        fetchRunDetails(run._id);\r\n    };\r\n\r\n    const columns = [\r\n        {\r\n            title: 'Period',\r\n            key: 'period',\r\n            render: (_, record) => {\r\n                const monthName = new Date(0, record.month - 1).toLocaleString('default', { month: 'short' });\r\n                return `${monthName} ${record.year}`;\r\n            },\r\n            width: 120\r\n        },\r\n        {\r\n            title: 'Status',\r\n            dataIndex: 'status',\r\n            key: 'status',\r\n            render: (status) => {\r\n                const statusConfig = {\r\n                    'INITIATED': { color: 'blue', icon: '‚ñ¨' },\r\n                    'CALCULATED': { color: 'gold', icon: '‚öô' },\r\n                    'APPROVED': { color: 'green', icon: '‚úì' },\r\n                    'PAID': { color: 'green', icon: '‚úì‚úì' },\r\n                    'CANCELLED': { color: 'red', icon: '‚úó' }\r\n                };\r\n                const config = statusConfig[status] || { color: 'gray', icon: '?' };\r\n                return <Tag color={config.color}>{config.icon} {status}</Tag>;\r\n            }\r\n        },\r\n        {\r\n            title: 'Employees',\r\n            key: 'employees',\r\n            render: (_, record) => (\r\n                <div className=\"text-sm\">\r\n                    <div className=\"font-medium\">{record.processedEmployees}/{record.totalEmployees}</div>\r\n                    <div className=\"text-gray-500\">\r\n                        {record.failedEmployees > 0 && ` ‚Ä¢ ${record.failedEmployees} failed`}\r\n                    </div>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            title: 'Total Gross',\r\n            key: 'gross',\r\n            render: (_, record) => (\r\n                <div className=\"text-right font-mono\">\r\n                    ‚Çπ{(record.totalGross || 0).toLocaleString('en-IN', { maximumFractionDigits: 2 })}\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            title: 'Total Deductions',\r\n            key: 'deductions',\r\n            render: (_, record) => (\r\n                <div className=\"text-right font-mono\">\r\n                    ‚Çπ{(record.totalDeductions || 0).toLocaleString('en-IN', { maximumFractionDigits: 2 })}\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            title: 'Total Net Pay',\r\n            key: 'netpay',\r\n            render: (_, record) => (\r\n                <div className=\"text-right font-mono font-bold text-green-600\">\r\n                    ‚Çπ{(record.totalNetPay || 0).toLocaleString('en-IN', { maximumFractionDigits: 2 })}\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            title: 'Actions',\r\n            key: 'actions',\r\n            render: (_, record) => (\r\n                <Space size=\"small\">\r\n                    <Button \r\n                        type=\"primary\" \r\n                        size=\"small\"\r\n                        onClick={() => handleSelectRun(record)}\r\n                    >\r\n                        Details\r\n                    </Button>\r\n                </Space>\r\n            )\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"space-y-6 w-full mx-auto p-6\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center bg-white p-4 rounded-lg border border-slate-200 shadow-sm\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-slate-800 flex items-center gap-2\">\r\n                        <TrendingUp className=\"w-6 h-6 text-blue-600\" />\r\n                        Payroll Reports\r\n                    </h1>\r\n                    <p className=\"text-sm text-slate-500\">View payroll runs and detailed analytics</p>\r\n                </div>\r\n                <Select\r\n                    value={year}\r\n                    onChange={setYear}\r\n                    style={{ width: 150 }}\r\n                    placeholder=\"Select Year\"\r\n                >\r\n                    {[2024, 2025, 2026, 2027].map(y => (\r\n                        <Option key={y} value={y}>{y}</Option>\r\n                    ))}\r\n                </Select>\r\n            </div>\r\n\r\n            {/* Main Table */}\r\n            <Card loading={loading} className=\"shadow-sm border-slate-200\">\r\n                <Table\r\n                    columns={columns}\r\n                    dataSource={payrollRuns.map(run => ({ ...run, key: run._id }))}\r\n                    pagination={{ pageSize: 12 }}\r\n                    size=\"middle\"\r\n                    locale={{ emptyText: <Empty description=\"No payroll runs found for this year\" /> }}\r\n                />\r\n            </Card>\r\n\r\n            {/* Details Modal */}\r\n            {selectedRun && (\r\n                <Modal\r\n                    title={`Payroll Run Details ‚Äî ${new Date(0, selectedRun.month - 1).toLocaleString('default', { month: 'long' })} ${selectedRun.year}`}\r\n                    visible={!!selectedRun}\r\n                    onCancel={() => {\r\n                        setSelectedRun(null);\r\n                        setRunDetails(null);\r\n                    }}\r\n                    width={1000}\r\n                    footer={null}\r\n                >\r\n                    <Spin spinning={detailsLoading}>\r\n                        {runDetails && (\r\n                            <div className=\"space-y-6\">\r\n                                {/* Summary Cards */}\r\n                                <Row gutter={16}>\r\n                                    <Col span={6}>\r\n                                        <Card className=\"text-center\">\r\n                                            <Statistic\r\n                                                title=\"Status\"\r\n                                                value={runDetails.status}\r\n                                                prefix={<Activity size={16} />}\r\n                                                valueStyle={{ fontSize: '14px', color: '#1890ff' }}\r\n                                            />\r\n                                        </Card>\r\n                                    </Col>\r\n                                    <Col span={6}>\r\n                                        <Card className=\"text-center\">\r\n                                            <Statistic\r\n                                                title=\"Processed\"\r\n                                                value={runDetails.processedEmployees || 0}\r\n                                                suffix={`/${runDetails.totalEmployees || 0}`}\r\n                                                valueStyle={{ color: '#52c41a' }}\r\n                                            />\r\n                                        </Card>\r\n                                    </Col>\r\n                                    <Col span={6}>\r\n                                        <Card className=\"text-center\">\r\n                                            <Statistic\r\n                                                title=\"Failed\"\r\n                                                value={runDetails.failedEmployees || 0}\r\n                                                valueStyle={{ color: runDetails.failedEmployees > 0 ? '#ff4d4f' : '#52c41a' }}\r\n                                            />\r\n                                        </Card>\r\n                                    </Col>\r\n                                    <Col span={6}>\r\n                                        <Card className=\"text-center\">\r\n                                            <Statistic\r\n                                                title=\"Generated On\"\r\n                                                value={runDetails.calculatedAt ? new Date(runDetails.calculatedAt).toLocaleDateString('en-IN') : '--'}\r\n                                                valueStyle={{ fontSize: '12px' }}\r\n                                            />\r\n                                        </Card>\r\n                                    </Col>\r\n                                </Row>\r\n\r\n                                <Divider />\r\n\r\n                                {/* Financial Summary */}\r\n                                <div className=\"grid grid-cols-3 gap-4\">\r\n                                    <Card className=\"bg-blue-50 border-blue-200\">\r\n                                        <Statistic\r\n                                            title=\"Total Gross Earnings\"\r\n                                            value={runDetails.totalGross || 0}\r\n                                            prefix=\"‚Çπ\"\r\n                                            precision={2}\r\n                                            valueStyle={{ color: '#1890ff' }}\r\n                                        />\r\n                                    </Card>\r\n                                    <Card className=\"bg-orange-50 border-orange-200\">\r\n                                        <Statistic\r\n                                            title=\"Total Deductions\"\r\n                                            value={runDetails.totalDeductions || 0}\r\n                                            prefix=\"‚Çπ\"\r\n                                            precision={2}\r\n                                            valueStyle={{ color: '#ff7a45' }}\r\n                                        />\r\n                                    </Card>\r\n                                    <Card className=\"bg-green-50 border-green-200\">\r\n                                        <Statistic\r\n                                            title=\"Total Net Pay\"\r\n                                            value={runDetails.totalNetPay || 0}\r\n                                            prefix=\"‚Çπ\"\r\n                                            precision={2}\r\n                                            valueStyle={{ color: '#52c41a', fontSize: '20px' }}\r\n                                        />\r\n                                    </Card>\r\n                                </div>\r\n\r\n                                <Divider />\r\n\r\n                                {/* Charts */}\r\n                                {runDetails.processedEmployees > 0 && (\r\n                                    <div className=\"grid grid-cols-2 gap-6\">\r\n                                        {/* Pie Chart for Employee Status */}\r\n                                        <Card title=\"Employee Processing Status\">\r\n                                            <ResponsiveContainer width=\"100%\" height={300}>\r\n                                                <PieChart>\r\n                                                    <Pie\r\n                                                        data={[\r\n                                                            { name: 'Processed', value: runDetails.processedEmployees, fill: '#52c41a' },\r\n                                                            { name: 'Failed', value: runDetails.failedEmployees || 0, fill: '#ff4d4f' }\r\n                                                        ]}\r\n                                                        cx=\"50%\"\r\n                                                        cy=\"50%\"\r\n                                                        labelLine={false}\r\n                                                        label={({ name, value }) => `${name}: ${value}`}\r\n                                                        outerRadius={100}\r\n                                                        dataKey=\"value\"\r\n                                                    >\r\n                                                        <Cell fill=\"#52c41a\" />\r\n                                                        <Cell fill=\"#ff4d4f\" />\r\n                                                    </Pie>\r\n                                                    <RechartsTooltip />\r\n                                                </PieChart>\r\n                                            </ResponsiveContainer>\r\n                                        </Card>\r\n\r\n                                        {/* Bar Chart for Financial Distribution */}\r\n                                        <Card title=\"Financial Distribution\">\r\n                                            <ResponsiveContainer width=\"100%\" height={300}>\r\n                                                <BarChart\r\n                                                    data={[\r\n                                                        {\r\n                                                            name: 'Payroll Summary',\r\n                                                            'Gross': runDetails.totalGross || 0,\r\n                                                            'Deductions': runDetails.totalDeductions || 0,\r\n                                                            'NetPay': runDetails.totalNetPay || 0\r\n                                                        }\r\n                                                    ]}\r\n                                                >\r\n                                                    <CartesianGrid strokeDasharray=\"3 3\" />\r\n                                                    <XAxis dataKey=\"name\" />\r\n                                                    <YAxis />\r\n                                                    <RechartsTooltip />\r\n                                                    <Legend />\r\n                                                    <Bar dataKey=\"Gross\" fill=\"#1890ff\" />\r\n                                                    <Bar dataKey=\"Deductions\" fill=\"#ff7a45\" />\r\n                                                    <Bar dataKey=\"NetPay\" fill=\"#52c41a\" />\r\n                                                </BarChart>\r\n                                            </ResponsiveContainer>\r\n                                        </Card>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Errors Section */}\r\n                                {runDetails.errors && runDetails.errors.length > 0 && (\r\n                                    <>\r\n                                        <Divider />\r\n                                        <Card title=\"Processing Errors\" type=\"inner\" className=\"bg-red-50 border-red-300\">\r\n                                            <div className=\"space-y-2\">\r\n                                                {runDetails.errors.map((err, idx) => (\r\n                                                    <div key={idx} className=\"text-sm bg-red-100 p-2 rounded flex items-start gap-2\">\r\n                                                        <AlertCircle size={16} className=\"text-red-600 mt-0.5 flex-shrink-0\" />\r\n                                                        <div>\r\n                                                            <strong>Employee:</strong> {err.employeeId}\r\n                                                            <br />\r\n                                                            <strong>Error:</strong> {err.message}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                        </Card>\r\n                                    </>\r\n                                )}\r\n\r\n                                {/* Action Buttons */}\r\n                                <div className=\"flex gap-2 justify-end\">\r\n                                    <Button icon={<Download size={16} />}>\r\n                                        Export Report\r\n                                    </Button>\r\n                                    <Button icon={<FileJson size={16} />}>\r\n                                        Export JSON\r\n                                    </Button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </Spin>\r\n                </Modal>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PayrollReport;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\Payslips.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\ProcessPayroll.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchEmployees'. Either include it or remove the dependency array.","line":40,"column":8,"nodeType":"ArrayExpression","endLine":40,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchEmployees, month]","fix":{"range":[1785,1792],"text":"[fetchEmployees, month]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'fetchPreviewForEmployee' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":103,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":103,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"fetchPreviewForEmployee"},"fix":{"range":[4047,4811],"text":""},"desc":"Remove unused variable 'fetchPreviewForEmployee'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":119,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":119,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useMemo has a missing dependency: 'columns'. Either include it or remove the dependency array.","line":270,"column":54,"nodeType":"ArrayExpression","endLine":270,"endColumn":75,"suggestions":[{"desc":"Update the dependencies array to be: [columns]","fix":{"range":[11036,11057],"text":"[columns]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Table, message, Select, Checkbox, Button, DatePicker, Tag, Tooltip, Drawer, Statistic, Row, Col, Space, Modal, Descriptions, Avatar, Progress, Card, Divider, Empty, Spin, Popconfirm } from 'antd';\r\nimport { PlayCircle, Calculator, FileText, AlertCircle, IndianRupee, Calendar, Eye, CheckCircle, Download, FileJson, AlertTriangle, Zap } from 'lucide-react';\r\nimport api from '../../../utils/api';\r\nimport dayjs from 'dayjs';\r\n\r\nconst { Option } = Select;\r\n\r\nconst ProcessPayroll = () => {\r\n    const [month, setMonth] = useState(dayjs());\r\n    const [employees, setEmployees] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [templates, setTemplates] = useState([]);\r\n    const [selectedRowKeys, setSelectedRowKeys] = useState([]);\r\n    const [calculating, setCalculating] = useState(false);\r\n    const [previews, setPreviews] = useState({}); // { empId: { gross, net, error } }\r\n\r\n    // Merged States\r\n    const [detailDrawer, setDetailDrawer] = useState({ visible: false, empId: null });\r\n    const [detailData, setDetailData] = useState(null);\r\n    const [payrollRunning, setPayrollRunning] = useState(false);\r\n    const [payrollResult, setPayrollResult] = useState(null);\r\n\r\n    // Toast\r\n    const [messageApi, contextHolder] = message.useMessage();\r\n\r\n    // Fetch Templates on Mount\r\n    useEffect(() => {\r\n        api.get('/payroll/salary-templates')\r\n            .then(res => setTemplates(res.data?.data || []))\r\n            .catch(err => console.error(\"Failed templates\", err));\r\n    }, []);\r\n\r\n    // Fetch Employees when month changes\r\n    useEffect(() => {\r\n        if (!month) return;\r\n        fetchEmployees();\r\n        setPreviews({});\r\n        setSelectedRowKeys([]);\r\n    }, [month]);\r\n\r\n    const fetchEmployees = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const mStr = month.format('YYYY-MM');\r\n            const res = await api.get(`/payroll/process/employees?month=${mStr}`);\r\n            setEmployees(res.data.data.map(e => ({\r\n                ...e,\r\n                key: e._id,\r\n                // Default to assigned template, or none\r\n                selectedTemplateId: e.salaryTemplateId\r\n            })));\r\n        } catch (err) {\r\n            messageApi.error(err.response?.data?.message || \"Failed to fetch employees\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleTemplateChange = (empId, val) => {\r\n        setEmployees(prev => prev.map(e => e._id === empId ? { ...e, selectedTemplateId: val } : e));\r\n        setPreviews(prev => {\r\n            const next = { ...prev };\r\n            delete next[empId];\r\n            return next;\r\n        });\r\n    };\r\n\r\n    const calculatePreview = async () => {\r\n        const itemsToPreview = employees\r\n            .filter(e => selectedRowKeys.includes(e._id))\r\n            .filter(e => e.selectedTemplateId) // Only those with templates\r\n            .map(e => ({ employeeId: e._id, salaryTemplateId: e.selectedTemplateId }));\r\n\r\n        if (itemsToPreview.length === 0) {\r\n            messageApi.warning(\"Select employees with templates assigned to preview\");\r\n            return;\r\n        }\r\n\r\n        setCalculating(true);\r\n        try {\r\n            const res = await api.post('/payroll/process/preview', {\r\n                month: month.format('YYYY-MM'),\r\n                items: itemsToPreview\r\n            });\r\n\r\n            console.log('Preview Response:', res.data.data);\r\n\r\n            const newPreviews = {};\r\n            res.data.data.forEach(p => {\r\n                newPreviews[p.employeeId] = p;\r\n            });\r\n            setPreviews(newPreviews);\r\n            messageApi.success(`Calculated successfully for ${itemsToPreview.length} employee(s)`);\r\n        } catch (err) {\r\n            console.error('Calculation Error:', err);\r\n            messageApi.error(err.response?.data?.message || \"Calculation failed\");\r\n        } finally {\r\n            setCalculating(false);\r\n        }\r\n    };\r\n\r\n    const fetchPreviewForEmployee = async (emp) => {\r\n        if (!emp.selectedTemplateId) {\r\n            messageApi.warning('Select a template for this employee first');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const res = await api.post('/payroll/process/preview', {\r\n                month: month.format('YYYY-MM'),\r\n                items: [{ employeeId: emp._id, salaryTemplateId: emp.selectedTemplateId }]\r\n            });\r\n\r\n            const p = res.data.data && res.data.data[0];\r\n            setPreviews(prev => ({ ...prev, [emp._id]: p }));\r\n            setDetailData(p);\r\n            setDetailDrawer({ visible: true, empId: emp._id });\r\n        } catch (err) {\r\n            messageApi.error('Failed to fetch preview');\r\n        }\r\n    };\r\n\r\n    const runPayroll = async () => {\r\n        const itemsToProcess = employees\r\n            .filter(e => selectedRowKeys.includes(e._id))\r\n            .filter(e => e.selectedTemplateId)\r\n            .map(e => ({\r\n                employeeId: e._id,\r\n                salaryTemplateId: e.selectedTemplateId\r\n            }));\r\n\r\n        if (itemsToProcess.length === 0) {\r\n            messageApi.error(\"No valid employees selected\");\r\n            return;\r\n        }\r\n\r\n        if (!window.confirm(\r\n            `Are you sure you want to process payroll for ${itemsToProcess.length} employees for ${month.format('MMMM YYYY')}?`\r\n        )) return;\r\n\r\n        setPayrollRunning(true);\r\n        try {\r\n            const response = await api.post('/payroll/process/run', {\r\n                month: month.format('YYYY-MM'),\r\n                items: itemsToProcess\r\n            });\r\n\r\n            const result = response.data.data;\r\n            setPayrollResult(result);\r\n            setSelectedRowKeys([]);\r\n            setPreviews({});\r\n\r\n            messageApi.success(`Payroll processed successfully! ${result.processedEmployees} employees processed.`);\r\n\r\n            // Refresh employee list\r\n            await fetchEmployees();\r\n        } catch (err) {\r\n            messageApi.error(err.response?.data?.message || \"Payroll run failed\");\r\n            console.error(\"Payroll error:\", err);\r\n        } finally {\r\n            setPayrollRunning(false);\r\n        }\r\n    };\r\n\r\n    const columns = [\r\n        {\r\n            title: 'Employee',\r\n            dataIndex: 'name',\r\n            key: 'name',\r\n            render: (text, record) => (\r\n                <div className=\"flex items-center gap-3\">\r\n                    <Avatar size={36} style={{ backgroundColor: '#f0f2f5' }}>{(record.firstName || record.name || '').charAt(0)}</Avatar>\r\n                    <div>\r\n                        <div className=\"font-medium text-slate-800\">{text}</div>\r\n                        <div className=\"text-xs text-slate-500\">{record.department} ‚Ä¢ {record.employeeId || ''}</div>\r\n                    </div>\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            title: 'Attendance',\r\n            key: 'attendance',\r\n            render: (_, record) => (\r\n                <div className=\"text-xs\">\r\n                    <div>Present: <span className=\"font-bold text-green-600\">{record.attendanceParams?.presentDays}</span> / {record.attendanceParams?.totalDays}</div>\r\n                    {record.attendanceParams?.presentDays === 0 && <Tag color=\"red\" className=\"mt-1\">High Absenteeism</Tag>}\r\n                </div>\r\n            )\r\n        },\r\n        {\r\n            title: 'Salary Template',\r\n            key: 'template',\r\n            render: (_, record) => (\r\n                <Select\r\n                    className=\"w-48\"\r\n                    placeholder=\"Select Template\"\r\n                    value={record.selectedTemplateId}\r\n                    onChange={(val) => handleTemplateChange(record._id, val)}\r\n                    status={!record.selectedTemplateId ? 'error' : ''}\r\n                    options={templates.map(t => ({\r\n                        value: t._id,\r\n                        label: `${t.templateName} (‚Çπ${t.annualCTC?.toLocaleString()})`\r\n                    }))}\r\n                />\r\n            )\r\n        },\r\n        {\r\n            title: 'Preview (Net Pay)',\r\n            key: 'preview',\r\n            width: 250,\r\n            render: (_, record) => {\r\n                const prev = previews[record._id];\r\n                if (!prev) {\r\n                    return (\r\n                        <Tooltip title=\"Select this employee and click 'Calculate Preview' to see salary details\">\r\n                            <span className=\"text-slate-400 italic text-xs\">--</span>\r\n                        </Tooltip>\r\n                    );\r\n                }\r\n                if (prev.error) return (\r\n                    <Tooltip title={prev.error}>\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <AlertCircle className=\"w-4 h-4 text-red-500\" />\r\n                            <span className=\"text-xs text-red-600\">Error</span>\r\n                        </div>\r\n                    </Tooltip>\r\n                );\r\n                return (\r\n                    <div className=\"space-y-1 bg-emerald-50 p-2 rounded\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <span className=\"text-xs text-slate-600 font-medium\">Basic:</span>\r\n                            <span className=\"font-mono font-semibold text-slate-800\">‚Çπ{Math.round(prev.gross || 0).toLocaleString()}</span>\r\n                        </div>\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <span className=\"text-xs text-slate-600 font-medium\">Net Pay:</span>\r\n                            <span className=\"font-mono font-bold text-emerald-700\">‚Çπ{Math.round(prev.net || 0).toLocaleString()}</span>\r\n                        </div>\r\n                        <Button\r\n                            size=\"small\"\r\n                            type=\"text\"\r\n                            onClick={() => {\r\n                                setDetailData(prev);\r\n                                setDetailDrawer({ visible: true, empId: record._id });\r\n                            }}\r\n                            icon={<Eye size={14} />}\r\n                            className=\"mt-1 text-blue-600 hover:text-blue-700 h-6\"\r\n                        >\r\n                            Details\r\n                        </Button>\r\n                    </div>\r\n                );\r\n            }\r\n        },\r\n        {\r\n            title: 'Status',\r\n            key: 'status',\r\n            render: (_, record) => {\r\n                if (!record.selectedTemplateId) return <Tag color=\"warning\">Missing Template</Tag>;\r\n                return <Tag color=\"blue\">Ready</Tag>;\r\n            }\r\n        }\r\n    ];\r\n\r\n    const rowSelection = React.useMemo(() => ({\r\n        selectedRowKeys,\r\n        onChange: (keys) => setSelectedRowKeys(keys),\r\n    }), [selectedRowKeys]);\r\n\r\n    const memoColumns = React.useMemo(() => columns, [templates, previews]);\r\n\r\n    return (\r\n        <div className=\"p-6 w-full mx-auto space-y-6\">\r\n            {contextHolder}\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center bg-white p-4 rounded-lg border border-slate-200 shadow-sm\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-slate-800 flex items-center gap-2\">\r\n                        <Calculator className=\"w-6 h-6 text-blue-600\" />\r\n                        Process Payroll\r\n                    </h1>\r\n                    <p className=\"text-sm text-slate-500\">Calculate and generate payslips for a specific month.</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <DatePicker\r\n                        picker=\"month\"\r\n                        value={month}\r\n                        onChange={setMonth}\r\n                        format=\"MMMM YYYY\"\r\n                        allowClear={false}\r\n                        className=\"w-48\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Table Area */}\r\n            <div className=\"bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden\">\r\n                <div className=\"p-4 border-b border-slate-200 bg-slate-50 flex justify-between items-center\">\r\n                    <h3 className=\"font-semibold text-slate-700\">Employee List ({employees.length})</h3>\r\n                    <div className=\"flex gap-4 items-center\">\r\n                        <Space>\r\n                            <Button\r\n                                icon={<IndianRupee size={16} />}\r\n                                onClick={calculatePreview}\r\n                                loading={calculating}\r\n                                disabled={selectedRowKeys.length === 0}\r\n                            >\r\n                                Calculate Preview\r\n                            </Button>\r\n                            <Button\r\n                                type=\"primary\"\r\n                                icon={<PlayCircle size={16} />}\r\n                                onClick={runPayroll}\r\n                                loading={payrollRunning}\r\n                                disabled={selectedRowKeys.length === 0}\r\n                                className=\"bg-emerald-600 hover:bg-emerald-700\"\r\n                            >\r\n                                Run Payroll\r\n                            </Button>\r\n                        </Space>\r\n                        <div className=\"ml-4 flex items-center gap-3\">\r\n                            <Tag color=\"blue\">Selected: {selectedRowKeys.length}</Tag>\r\n                            <Tag color=\"green\">Previews: {Object.keys(previews).length}</Tag>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <Table\r\n                    rowSelection={rowSelection}\r\n                    columns={memoColumns}\r\n                    dataSource={employees}\r\n                    rowKey=\"_id\"\r\n                    loading={loading}\r\n                    pagination={{ pageSize: 50 }}\r\n                    size=\"middle\"\r\n                />\r\n            </div>\r\n\r\n            {/* Payroll Result Modal */}\r\n            <Modal\r\n                title={`Payroll Run Results ‚Äî ${month.format('MMMM YYYY')}`}\r\n                open={!!payrollResult}\r\n                onCancel={() => setPayrollResult(null)}\r\n                footer={[\r\n                    <Button key=\"close\" type=\"primary\" onClick={() => setPayrollResult(null)}>\r\n                        Close\r\n                    </Button>\r\n                ]}\r\n                width={800}\r\n            >\r\n                {payrollResult && (\r\n                    <div className=\"space-y-6\">\r\n                        <Row gutter={24}>\r\n                            <Col span={8}>\r\n                                <Card className=\"text-center\">\r\n                                    <Statistic\r\n                                        title=\"Total Employees\"\r\n                                        value={payrollResult.totalEmployees || 0}\r\n                                        prefix={<Calculator size={16} />}\r\n                                    />\r\n                                </Card>\r\n                            </Col>\r\n                            <Col span={8}>\r\n                                <Card className=\"text-center\">\r\n                                    <Statistic\r\n                                        title=\"Processed\"\r\n                                        value={payrollResult.processedEmployees || 0}\r\n                                        suffix={<CheckCircle size={16} className=\"text-green-600\" />}\r\n                                        valueStyle={{ color: '#52c41a' }}\r\n                                    />\r\n                                </Card>\r\n                            </Col>\r\n                            <Col span={8}>\r\n                                <Card className=\"text-center\">\r\n                                    <Statistic\r\n                                        title=\"Failed\"\r\n                                        value={payrollResult.failedEmployees || 0}\r\n                                        suffix={payrollResult.failedEmployees > 0 ? <AlertTriangle size={16} className=\"text-red-600\" /> : ''}\r\n                                        valueStyle={{ color: payrollResult.failedEmployees > 0 ? '#ff4d4f' : '#1890ff' }}\r\n                                    />\r\n                                </Card>\r\n                            </Col>\r\n                        </Row>\r\n\r\n                        <Divider />\r\n\r\n                        <Row gutter={24}>\r\n                            <Col span={12}>\r\n                                <Card>\r\n                                    <Statistic\r\n                                        title=\"Total Gross Earnings\"\r\n                                        value={Math.round(payrollResult.totalGross || 0)}\r\n                                        prefix=\"‚Çπ\"\r\n                                        valueStyle={{ color: '#1890ff' }}\r\n                                    />\r\n                                </Card>\r\n                            </Col>\r\n                            <Col span={12}>\r\n                                <Card>\r\n                                    <Statistic\r\n                                        title=\"Total Net Payable\"\r\n                                        value={Math.round(payrollResult.totalNetPay || 0)}\r\n                                        prefix=\"‚Çπ\"\r\n                                        valueStyle={{ color: '#52c41a' }}\r\n                                    />\r\n                                </Card>\r\n                            </Col>\r\n                        </Row>\r\n\r\n                        {payrollResult.errors && payrollResult.errors.length > 0 && (\r\n                            <>\r\n                                <Divider />\r\n                                <Card className=\"bg-red-50 border-red-300\">\r\n                                    <h4 className=\"font-semibold text-red-800 mb-3\">Processing Errors</h4>\r\n                                    <div className=\"space-y-2\">\r\n                                        {payrollResult.errors.map((err, idx) => (\r\n                                            <div key={idx} className=\"text-sm text-red-700 bg-red-100 p-2 rounded\">\r\n                                                <strong>Employee:</strong> {err.employeeId} ‚Äî {err.message}\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </Card>\r\n                            </>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </Modal>\r\n\r\n            {/* Payslip Preview Drawer */}\r\n            <Drawer\r\n                width={720}\r\n                title={detailData ? `Payslip Preview ‚Äî ${detailData.employeeInfo?.employeeId || ''}` : 'Payslip Preview'}\r\n                placement=\"right\"\r\n                onClose={() => { setDetailDrawer({ visible: false, empId: null }); setDetailData(null); }}\r\n                open={detailDrawer.visible}\r\n            >\r\n                {detailData ? (\r\n                    <Spin spinning={false} className=\"space-y-6\">\r\n                        <div>\r\n                            <h4 className=\"font-semibold text-lg mb-3\">Employee Details</h4>\r\n                            <Descriptions bordered column={1} size=\"small\">\r\n                                <Descriptions.Item label=\"Employee ID\">{detailData.employeeInfo?.employeeId || '--'}</Descriptions.Item>\r\n                                <Descriptions.Item label=\"Name\">{detailData.employeeInfo?.name || '--'}</Descriptions.Item>\r\n                                <Descriptions.Item label=\"Department\">{detailData.employeeInfo?.department || '--'}</Descriptions.Item>\r\n                                <Descriptions.Item label=\"Designation\">{detailData.employeeInfo?.designation || '--'}</Descriptions.Item>\r\n                            </Descriptions>\r\n                        </div>\r\n                        <Divider />\r\n                        <Row gutter={16}>\r\n                            <Col span={12}>\r\n                                <Card className=\"text-center\">\r\n                                    <Statistic title=\"Gross Earnings\" value={Math.round(detailData.grossEarnings || 0)} prefix=\"‚Çπ\" valueStyle={{ color: '#1890ff' }} />\r\n                                </Card>\r\n                            </Col>\r\n                            <Col span={12}>\r\n                                <Card className=\"text-center\">\r\n                                    <Statistic title=\"Net Pay\" value={Math.round(detailData.netPay || 0)} prefix=\"‚Çπ\" valueStyle={{ color: '#52c41a' }} />\r\n                                </Card>\r\n                            </Col>\r\n                        </Row>\r\n                        <div>\r\n                            <h4 className=\"font-semibold mb-3\">Earnings</h4>\r\n                            {detailData.earningsSnapshot && detailData.earningsSnapshot.length > 0 ? (\r\n                                <Table size=\"small\" dataSource={detailData.earningsSnapshot} pagination={false} rowKey={(r, i) => `${r.name}-${i}`} columns={[{ title: 'Component', dataIndex: 'name', width: '60%' }, { title: 'Amount', dataIndex: 'amount', render: a => `‚Çπ${(a || 0).toLocaleString()}`, align: 'right' }]} />\r\n                            ) : <Empty description=\"No earnings data\" />}\r\n                        </div>\r\n                        <div>\r\n                            <h4 className=\"font-semibold mb-3\">Pre-Tax Deductions</h4>\r\n                            {detailData.preTaxDeductionsSnapshot && detailData.preTaxDeductionsSnapshot.length > 0 ? (\r\n                                <Table size=\"small\" dataSource={detailData.preTaxDeductionsSnapshot} pagination={false} rowKey={(r, i) => `pre-${r.name || i}`} columns={[{ title: 'Name', dataIndex: 'name', width: '60%' }, { title: 'Amount', dataIndex: 'amount', render: a => `‚Çπ${(a || 0).toLocaleString()}`, align: 'right' }]} />\r\n                            ) : <Empty description=\"No pre-tax deductions\" />}\r\n                        </div>\r\n                        <div>\r\n                            <h4 className=\"font-semibold mb-3\">Taxable Income & Tax</h4>\r\n                            <Descriptions bordered column={1} size=\"small\">\r\n                                <Descriptions.Item label=\"Taxable Income\">‚Çπ{(detailData.taxableIncome || 0).toLocaleString()}</Descriptions.Item>\r\n                                <Descriptions.Item label=\"Income Tax (TDS)\">‚Çπ{(detailData.incomeTax || 0).toLocaleString()}</Descriptions.Item>\r\n                            </Descriptions>\r\n                        </div>\r\n                        <div>\r\n                            <h4 className=\"font-semibold mb-3\">Post-Tax Deductions</h4>\r\n                            {detailData.postTaxDeductionsSnapshot && detailData.postTaxDeductionsSnapshot.length > 0 ? (\r\n                                <Table size=\"small\" dataSource={detailData.postTaxDeductionsSnapshot} pagination={false} rowKey={(r, i) => `post-${r.name || i}`} columns={[{ title: 'Name', dataIndex: 'name', width: '60%' }, { title: 'Amount', dataIndex: 'amount', render: a => `‚Çπ${(a || 0).toLocaleString()}`, align: 'right' }]} />\r\n                            ) : <Empty description=\"No post-tax deductions\" />}\r\n                        </div>\r\n                        {detailData.employerContributionsSnapshot && detailData.employerContributionsSnapshot.length > 0 && (\r\n                            <div>\r\n                                <h4 className=\"font-semibold mb-3\">Employer Contributions</h4>\r\n                                <Table\r\n                                    size=\"small\"\r\n                                    dataSource={detailData.employerContributionsSnapshot}\r\n                                    pagination={false}\r\n                                    rowKey={(r, i) => `employer-${r.name || i}`}\r\n                                    columns={[\r\n                                        { title: 'Name', dataIndex: 'name', width: '60%' },\r\n                                        { title: 'Amount', dataIndex: 'amount', render: a => `‚Çπ${(a || 0).toLocaleString()}`, align: 'right' }\r\n                                    ]}\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    </Spin>\r\n                ) : <Empty description=\"No preview available\" />}\r\n            </Drawer>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ProcessPayroll;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\RunPayroll.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadRuns'. Either include it or remove the dependency array.","line":18,"column":8,"nodeType":"ArrayExpression","endLine":18,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [loadRuns, selectedYear]","fix":{"range":[794,808],"text":"[loadRuns, selectedYear]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport api from '../../../utils/api';\r\nimport { formatDateDDMMYYYY } from '../../../utils/dateUtils';\r\nimport { Play, CheckCircle, AlertTriangle, FileText, Loader } from 'lucide-react';\r\nimport { Modal, notification } from 'antd';\r\n\r\nexport default function RunPayroll() {\r\n    const [loading, setLoading] = useState(false);\r\n    const [runs, setRuns] = useState([]);\r\n    const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1);\r\n    const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\r\n    const [calculating, setCalculating] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [success, setSuccess] = useState('');\r\n\r\n    useEffect(() => {\r\n        loadRuns();\r\n    }, [selectedYear]);\r\n\r\n    async function loadRuns() {\r\n        setLoading(true);\r\n        try {\r\n            const res = await api.get(`/payroll/runs?year=${selectedYear}`);\r\n            setRuns(res.data?.data || []);\r\n        } catch (err) {\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    async function handleInitiate() {\r\n        setCalculating(true);\r\n        setError('');\r\n        setSuccess('');\r\n        try {\r\n            // 1. Initiate\r\n            const initRes = await api.post('/payroll/runs', { month: selectedMonth, year: selectedYear });\r\n            const runId = initRes.data?.data?._id;\r\n\r\n            if (runId) {\r\n                // 2. Calculate\r\n                await api.post(`/payroll/runs/${runId}/calculate`);\r\n                setSuccess(`Payroll for ${selectedMonth}/${selectedYear} calculated successfully!`);\r\n                loadRuns();\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError(err.response?.data?.message || err.response?.data?.error || \"Failed to run payroll\");\r\n        } finally {\r\n            setCalculating(false);\r\n        }\r\n    }\r\n\r\n    async function handleApprove(id) {\r\n        Modal.confirm({\r\n            title: 'Approve Payroll',\r\n            content: 'Are you sure you want to approve this payroll? This will allow payslip generation.',\r\n            okText: 'Approve',\r\n            cancelText: 'Cancel',\r\n            onOk: async () => {\r\n                try {\r\n                    await api.post(`/payroll/runs/${id}/approve`);\r\n                    notification.success({ message: 'Success', description: 'Payroll approved successfully', placement: 'topRight' });\r\n                    loadRuns();\r\n                } catch (err) {\r\n                    notification.error({ message: 'Error', description: err.response?.data?.message || \"Failed to approve\", placement: 'topRight' });\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 w-full mx-auto p-6\">\r\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-slate-900\">Run Payroll</h1>\r\n                    <p className=\"text-slate-500 mt-1\">Manage monthly payroll processing</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Runner Card */}\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 p-6\">\r\n                <h3 className=\"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2\">\r\n                    <Play className=\"h-5 w-5 text-blue-600\" />\r\n                    Run New Payroll\r\n                </h3>\r\n\r\n                <div className=\"flex flex-wrap items-end gap-4 p-4 bg-slate-50 rounded-lg border border-slate-100\">\r\n                    <div>\r\n                        <label className=\"block text-xs font-semibold text-slate-500 uppercase mb-1\">Month</label>\r\n                        <select\r\n                            value={selectedMonth}\r\n                            onChange={e => setSelectedMonth(parseInt(e.target.value))}\r\n                            className=\"w-40 rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5 bg-white\"\r\n                        >\r\n                            {Array.from({ length: 12 }, (_, i) => (\r\n                                <option key={i + 1} value={i + 1}>\r\n                                    {new Date(0, i).toLocaleString('default', { month: 'long' })}\r\n                                </option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-xs font-semibold text-slate-500 uppercase mb-1\">Year</label>\r\n                        <select\r\n                            value={selectedYear}\r\n                            onChange={e => setSelectedYear(parseInt(e.target.value))}\r\n                            className=\"w-32 rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5 bg-white\"\r\n                        >\r\n                            {[2024, 2025, 2026, 2027].map(y => (\r\n                                <option key={y} value={y}>{y}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    <button\r\n                        onClick={handleInitiate}\r\n                        disabled={calculating}\r\n                        className=\"px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed font-medium transition flex items-center gap-2\"\r\n                    >\r\n                        {calculating ? <Loader className=\"animate-spin h-5 w-5\" /> : 'Process Payroll'}\r\n                    </button>\r\n                </div>\r\n\r\n                {error && <div className=\"mt-4 p-3 bg-red-50 text-red-700 rounded border border-red-200 flex items-center gap-2\"><AlertTriangle className=\"h-5 w-5\" /> {error}</div>}\r\n                {success && <div className=\"mt-4 p-3 bg-emerald-50 text-emerald-700 rounded border border-emerald-200 flex items-center gap-2\"><CheckCircle className=\"h-5 w-5\" /> {success}</div>}\r\n            </div>\r\n\r\n            {/* History Table */}\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\r\n                <div className=\"px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-gray-50\">\r\n                    <h3 className=\"font-semibold text-slate-800\">Payroll History ({selectedYear})</h3>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"p-8 text-center text-slate-500\">Loading history...</div>\r\n                ) : runs.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-slate-500\">No payroll runs found for {selectedYear}</div>\r\n                ) : (\r\n                    <table className=\"min-w-full divide-y divide-slate-200\">\r\n                        <thead className=\"bg-slate-50 text-xs uppercase font-medium text-slate-500\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-3 text-left tracking-wider\">Month</th>\r\n                                <th className=\"px-6 py-3 text-left tracking-wider\">Status</th>\r\n                                <th className=\"px-6 py-3 text-left tracking-wider\">Headcount</th>\r\n                                <th className=\"px-6 py-3 text-left tracking-wider\">Total Net Pay</th>\r\n                                <th className=\"px-6 py-3 text-left tracking-wider\">Processed On</th>\r\n                                <th className=\"px-6 py-3 text-right tracking-wider\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-slate-200\">\r\n                            {runs.map(run => (\r\n                                <tr key={run._id} className=\"hover:bg-slate-50 transition\">\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap font-medium text-slate-900\">\r\n                                        {new Date(0, run.month - 1).toLocaleString('default', { month: 'long' })}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                        <StatusBadge status={run.status} />\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-slate-600\">\r\n                                        {run.processedEmployees} / {run.totalEmployees}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap font-medium text-slate-900\">\r\n                                        ‚Çπ{run.totalNetPay?.toLocaleString()}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-slate-500 text-sm\">\r\n                                        {formatDateDDMMYYYY(run.updatedAt)}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm\">\r\n                                        {run.status === 'CALCULATED' && (\r\n                                            <button\r\n                                                onClick={() => handleApprove(run._id)}\r\n                                                className=\"text-emerald-600 hover:text-emerald-800 font-medium px-3 py-1 rounded hover:bg-emerald-50 mr-2\"\r\n                                            >\r\n                                                Approve\r\n                                            </button>\r\n                                        )}\r\n                                        {run.status === 'APPROVED' && (\r\n                                            <span className=\"text-emerald-600 font-medium bg-emerald-50 px-2 py-1 rounded text-xs\">Ready for Payment</span>\r\n                                        )}\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction StatusBadge({ status }) {\r\n    const styles = {\r\n        INITIATED: \"bg-blue-100 text-blue-800\",\r\n        CALCULATED: \"bg-purple-100 text-purple-800\",\r\n        APPROVED: \"bg-emerald-100 text-emerald-800\",\r\n        PAID: \"bg-green-100 text-green-800\",\r\n        CANCELLED: \"bg-red-100 text-red-800\"\r\n    };\r\n\r\n    return (\r\n        <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${styles[status] || styles.INITIATED}`}>\r\n            {status}\r\n        </span>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\Payroll\\SalaryComponents.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\RegularizationApprovals.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":23,"column":8,"nodeType":"ArrayExpression","endLine":23,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [endpoint, category, fetchData]","fix":{"range":[942,962],"text":"[endpoint, category, fetchData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Pagination } from 'antd';\r\nimport api from '../../utils/api';\r\nimport { Eye, CheckSquare, XSquare, Clock, ArrowRight, X, AlertCircle } from 'lucide-react';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\n\r\nexport default function RegularizationApprovals({\r\n    isManagerView = false,\r\n    category = 'Attendance', // 'Attendance' | 'Leave'\r\n    endpoint = '/hr/regularization',\r\n    actionEndpoint = '/hr/regularization'\r\n}) {\r\n    const [requests, setRequests] = useState([]);\r\n    const [actionModal, setActionModal] = useState(null); // { id, action: 'approve' | 'reject' }\r\n    const [viewData, setViewData] = useState(null);\r\n    const [remark, setRemark] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const pageSize = 10;\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, [endpoint, category]);\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // Append category filter to endpoint\r\n            const url = endpoint.includes('?')\r\n                ? `${endpoint}&category=${category}`\r\n                : `${endpoint}?category=${category}`;\r\n            const res = await api.get(url);\r\n            setRequests(res.data.data || res.data);\r\n        } catch (err) {\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleAction = async () => {\r\n        if (!remark.trim()) return alert(\"Admin remark is mandatory.\");\r\n        try {\r\n            await api.post(`${actionEndpoint}/${actionModal.id}/${actionModal.action}`, { remark });\r\n            setActionModal(null);\r\n            setRemark('');\r\n            fetchData();\r\n        } catch (err) {\r\n            alert(err.response?.data?.error || \"Action Failed\");\r\n        }\r\n    };\r\n\r\n    const getStatusStyle = (status) => {\r\n        switch (status) {\r\n            case 'Approved': return 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800';\r\n            case 'Rejected': return 'bg-red-100 dark:bg-rose-900/30 text-red-800 dark:text-rose-400 border-red-200 dark:border-rose-800';\r\n            default: return 'bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-400 border-amber-200 dark:border-amber-800';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 text-slate-900 dark:text-white\">\r\n            {!isManagerView && (\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">\r\n                            {category === 'Attendance' ? 'Attendance Correction Management' : 'Leave Correction & Adjustment'}\r\n                        </h1>\r\n                        <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1\">\r\n                            {category === 'Attendance' ? 'Review punch modifications and system overrides' : 'Review leave balance adjustments and type corrections'}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-[2.5rem] border border-slate-100 dark:border-slate-800 shadow-xl shadow-slate-200/50 dark:shadow-none overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"min-w-full divide-y divide-slate-100 dark:divide-slate-800 text-sm\">\r\n                        <thead className=\"bg-slate-50 dark:bg-slate-950 text-slate-400 uppercase font-black text-[10px] tracking-widest\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-5 text-left\">Employee</th>\r\n                                <th className=\"px-6 py-5 text-left\">Date</th>\r\n                                <th className=\"px-6 py-5 text-left\">Issue Type</th>\r\n                                <th className=\"px-6 py-5 text-center\">Status</th>\r\n                                <th className=\"px-6 py-5 text-right\">Action</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-50 dark:divide-slate-800 bg-white dark:bg-slate-900\">\r\n                            {loading ? (\r\n                                <tr><td colSpan=\"5\" className=\"text-center py-20 text-slate-300 dark:text-slate-600 font-black uppercase tracking-widest text-[10px]\">Loading pending requests...</td></tr>\r\n                            ) : requests.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan=\"5\" className=\"px-6 py-20 text-center\">\r\n                                        <div className=\"flex flex-col items-center gap-3 opacity-20 dark:opacity-40\">\r\n                                            <Clock size={48} />\r\n                                            <p className=\"font-black uppercase tracking-widest text-xs\">No pending {category} approvals</p>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ) : (\r\n                                requests.slice((currentPage - 1) * pageSize, currentPage * pageSize).map(req => (\r\n                                    <tr key={req._id} className=\"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition whitespace-nowrap group\">\r\n                                        <td className=\"px-6 py-5\">\r\n                                            <div className=\"font-black text-slate-700 dark:text-slate-200 uppercase tracking-tight\">{req.employee?.firstName} {req.employee?.lastName}</div>\r\n                                            <div className=\"text-[10px] text-slate-400 dark:text-slate-500 font-bold uppercase tracking-wider\">{req.employee?.employeeId}</div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-5 text-slate-600 dark:text-slate-400 font-black text-xs\">\r\n                                            {formatDateDDMMYYYY(req.startDate)}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-5\">\r\n                                            <div className=\"text-xs font-bold text-slate-600 dark:text-slate-400\">{req.issueType}</div>\r\n                                            <div className=\"text-[9px] text-slate-400 uppercase font-black mt-1 italic tracking-tight truncate max-w-[200px]\" title={req.reason}>\"{req.reason}\"</div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-5 text-center\">\r\n                                            <span className={`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter border ${getStatusStyle(req.status)}`}>\r\n                                                {req.status}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-5 text-right\">\r\n                                            <div className=\"flex justify-end gap-2 opacity-40 group-hover:opacity-100 transition-opacity\">\r\n                                                <button onClick={() => setViewData(req)} className=\"p-2.5 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-white dark:hover:bg-slate-800 rounded-2xl transition shadow-sm border border-transparent hover:border-slate-100 dark:hover:border-slate-700\" title=\"View Details\">\r\n                                                    <Eye size={18} />\r\n                                                </button>\r\n                                                {req.status === 'Pending' && (\r\n                                                    <>\r\n                                                        <button onClick={() => setActionModal({ id: req._id, action: 'approve' })} className=\"p-2.5 text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-2xl transition shadow-sm border border-transparent hover:border-emerald-100 dark:hover:border-emerald-900/40\" title=\"Approve\">\r\n                                                            <CheckSquare size={18} />\r\n                                                        </button>\r\n                                                        <button onClick={() => setActionModal({ id: req._id, action: 'reject' })} className=\"p-2.5 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-2xl transition shadow-sm border border-transparent hover:border-rose-100 dark:hover:border-rose-900/40\" title=\"Reject\">\r\n                                                            <XSquare size={18} />\r\n                                                        </button>\r\n                                                    </>\r\n                                                )}\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n                {requests.length > pageSize && (\r\n                    <div className=\"px-8 py-5 border-t border-slate-50 dark:border-slate-800 flex justify-end\">\r\n                        <Pagination\r\n                            current={currentPage}\r\n                            pageSize={pageSize}\r\n                            total={requests.length}\r\n                            onChange={(page) => setCurrentPage(page)}\r\n                            showSizeChanger={false}\r\n                        />\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* View Details Modal */}\r\n            {viewData && (\r\n                <div className=\"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[100] flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-slate-900 rounded-[3rem] shadow-2xl max-w-2xl w-full p-10 animate-in fade-in zoom-in-95 duration-200 border border-slate-100 dark:border-slate-800\">\r\n                        <div className=\"flex justify-between items-start mb-10\">\r\n                            <div>\r\n                                <div className=\"flex items-center gap-2 mb-2\">\r\n                                    <span className={`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest ${viewData.category === 'Attendance' ? 'bg-indigo-50 text-indigo-600' : 'bg-amber-50 text-amber-600'}`}>\r\n                                        {viewData.category} Request\r\n                                    </span>\r\n                                    <span className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest\">#{viewData._id.slice(-6)}</span>\r\n                                </div>\r\n                                <h2 className=\"text-3xl font-black text-slate-800 dark:text-white uppercase tracking-tighter\">Request Details</h2>\r\n                                <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1\">Submitted on {new Date(viewData.createdAt).toLocaleDateString()}</p>\r\n                            </div>\r\n                            <button onClick={() => setViewData(null)} className=\"p-3 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-2xl text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition\">\r\n                                <X size={24} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-8\">\r\n                            <div className=\"flex items-start gap-4 p-6 bg-slate-50 dark:bg-slate-950 rounded-[2rem] border border-slate-100 dark:border-slate-800 shadow-inner\">\r\n                                <AlertCircle className=\"text-blue-500 shrink-0 mt-1\" size={24} />\r\n                                <div>\r\n                                    <h3 className=\"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest mb-2\">Employee Justification</h3>\r\n                                    <p className=\"text-slate-700 dark:text-slate-300 text-base font-bold leading-relaxed italic\">\"{viewData.reason}\"</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                                <div className=\"p-6 bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-[2.5rem] shadow-sm\">\r\n                                    <h3 className=\"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest mb-4\">Original Snapshot</h3>\r\n                                    {viewData.originalData ? (\r\n                                        <div className=\"space-y-3\">\r\n                                            {viewData.category === 'Attendance' ? (\r\n                                                <>\r\n                                                    <div className=\"flex justify-between items-center py-2 border-b border-slate-50 dark:border-slate-800/50\">\r\n                                                        <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-tight\">Status</span>\r\n                                                        <span className=\"text-xs font-black text-slate-700 dark:text-slate-300 uppercase\">{viewData.originalData.attendance?.status || 'N/A'}</span>\r\n                                                    </div>\r\n                                                    <div className=\"flex justify-between items-center py-2 border-b border-slate-50 dark:border-slate-800/50\">\r\n                                                        <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-tight\">Clock In</span>\r\n                                                        <span className=\"text-xs font-black text-slate-700 dark:text-slate-300\">{viewData.originalData.attendance?.checkIn ? new Date(viewData.originalData.attendance.checkIn).toLocaleTimeString() : '-'}</span>\r\n                                                    </div>\r\n                                                    <div className=\"flex justify-between items-center py-2 border-b border-slate-50 dark:border-slate-800/50\">\r\n                                                        <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-tight\">Clock Out</span>\r\n                                                        <span className=\"text-xs font-black text-slate-700 dark:text-slate-300\">{viewData.originalData.attendance?.checkOut ? new Date(viewData.originalData.attendance.checkOut).toLocaleTimeString() : '-'}</span>\r\n                                                    </div>\r\n                                                </>\r\n                                            ) : (\r\n                                                <div className=\"text-xs font-bold text-slate-600 dark:text-slate-400 leading-relaxed\">\r\n                                                    Original Leave Type: {viewData.requestedData?.originalLeaveType || 'Missed Application'}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    ) : <div className=\"text-xs text-slate-400 italic\">No snapshot recorded</div>}\r\n                                </div>\r\n\r\n                                <div className=\"p-6 bg-blue-50/30 dark:bg-blue-900/10 border border-blue-100/50 dark:border-blue-900/30 rounded-[2.5rem] shadow-sm relative overflow-hidden\">\r\n                                    <div className=\"absolute -right-4 -top-4 opacity-5 pointer-events-none transform rotate-12\">\r\n                                        <ArrowRight size={120} />\r\n                                    </div>\r\n                                    <h3 className=\"text-[10px] font-black text-blue-500 dark:text-blue-400 uppercase tracking-widest mb-4 flex items-center gap-2\">\r\n                                        Requested Correction <ArrowRight size={12} />\r\n                                    </h3>\r\n                                    <div className=\"space-y-3\">\r\n                                        {viewData.category === 'Attendance' ? (\r\n                                            <>\r\n                                                <div className=\"flex justify-between items-center py-2 border-b border-blue-100/30 dark:border-blue-800/20\">\r\n                                                    <span className=\"text-[10px] font-black text-blue-400 uppercase\">Corrected In</span>\r\n                                                    <span className=\"text-xs font-black text-blue-700 dark:text-blue-300\">{viewData.requestedData?.checkIn ? viewData.requestedData.checkIn.split('T')[1].slice(0, 5) : '-'}</span>\r\n                                                </div>\r\n                                                <div className=\"flex justify-between items-center py-2 border-b border-blue-100/30 dark:border-blue-800/20\">\r\n                                                    <span className=\"text-[10px] font-black text-blue-400 uppercase\">Corrected Out</span>\r\n                                                    <span className=\"text-xs font-black text-blue-700 dark:text-blue-300\">{viewData.requestedData?.checkOut ? viewData.requestedData.checkOut.split('T')[1].slice(0, 5) : '-'}</span>\r\n                                                </div>\r\n                                            </>\r\n                                        ) : (\r\n                                            <div className=\"p-4 bg-white dark:bg-slate-900/50 rounded-2xl border border-blue-100 dark:border-blue-900/50\">\r\n                                                <div className=\"text-[9px] font-black text-blue-400 uppercase tracking-widest mb-1\">Target Leave Type</div>\r\n                                                <div className=\"text-xl font-black text-blue-600 dark:text-blue-400 uppercase tracking-tighter\">\r\n                                                    {viewData.requestedData?.requestedLeaveType || 'N/A'}\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"mt-12 flex justify-end gap-x-4\">\r\n                            <button onClick={() => setViewData(null)} className=\"px-10 py-4 bg-slate-800 dark:bg-slate-700 hover:bg-slate-900 text-white rounded-2xl font-black uppercase tracking-widest text-[10px] transition shadow-xl shadow-slate-200/50 dark:shadow-none active:scale-95\">Close View</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Action Modal */}\r\n            {actionModal && (\r\n                <div className=\"fixed inset-0 bg-slate-900/80 backdrop-blur-xl z-[110] flex items-center justify-center p-4\">\r\n                    <div className=\"bg-white dark:bg-slate-900 rounded-[3rem] shadow-2xl max-w-md w-full p-10 animate-in fade-in zoom-in-95 duration-200 border border-slate-100 dark:border-slate-800\">\r\n                        <div className={`w-16 h-16 rounded-[1.5rem] flex items-center justify-center mb-6 shadow-xl ${actionModal.action === 'approve' ? 'bg-emerald-500 text-white shadow-emerald-500/20' : 'bg-rose-500 text-white shadow-rose-500/20'}`}>\r\n                            {actionModal.action === 'approve' ? <CheckSquare size={32} /> : <XSquare size={32} />}\r\n                        </div>\r\n                        <h3 className=\"text-3xl font-black text-slate-800 dark:text-white uppercase tracking-tighter mb-2\">{actionModal.action} Request?</h3>\r\n                        <p className=\"text-xs font-bold text-slate-400 uppercase tracking-widest leading-relaxed mb-8\">This action will modify {category.toLowerCase()} records in the database. A professional remark is mandatory for audit trails.</p>\r\n\r\n                        <textarea\r\n                            className=\"w-full bg-slate-50 dark:bg-slate-950 border-2 border-slate-100 dark:border-slate-800 rounded-[2rem] p-6 text-sm font-bold focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none min-h-[140px] dark:text-white transition-all placeholder:text-slate-300\"\r\n                            placeholder=\"Enter administrative remark for audit...\"\r\n                            value={remark}\r\n                            onChange={(e) => setRemark(e.target.value)}\r\n                            autoFocus\r\n                        ></textarea>\r\n\r\n                        <div className=\"flex gap-4 mt-8\">\r\n                            <button onClick={() => setActionModal(null)} className=\"flex-1 py-4 bg-white dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 text-slate-500 dark:text-slate-400 rounded-2xl font-black uppercase tracking-widest text-[10px] hover:bg-slate-50 transition active:scale-95\">Cancel</button>\r\n                            <button onClick={handleAction} className={`flex-1 py-4 text-white rounded-2xl font-black uppercase tracking-widest text-[10px] transition shadow-xl active:scale-95 ${actionModal.action === 'approve' ? 'bg-emerald-600 hover:bg-emerald-700 shadow-emerald-600/20' : 'bg-rose-600 hover:bg-rose-700 shadow-rose-600/20'}`}>\r\n                                Confirm {actionModal.action}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\RequirementPage.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadRequirements'. Either include it or remove the dependency array.","line":40,"column":8,"nodeType":"ArrayExpression","endLine":40,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [loadRequirements, pagination.page]","fix":{"range":[1703,1720],"text":"[loadRequirements, pagination.page]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'openNew' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":53,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":53,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"openNew"},"fix":{"range":[2153,2225],"text":""},"desc":"Remove unused variable 'openNew'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api from '../../utils/api';\r\nimport RequirementForm from '../../components/RequirementForm';\r\n\r\nexport default function RequirementPage() {\r\n    const navigate = useNavigate();\r\n    const [requirements, setRequirements] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [openForm, setOpenForm] = useState(false);\r\n    const [currentReq, setCurrentReq] = useState(null);\r\n    const [openView, setOpenView] = useState(false);\r\n    const [isEditMode, setIsEditMode] = useState(false);\r\n\r\n    const [pagination, setPagination] = useState({ page: 1, limit: 10, totalPages: 1, total: 0 });\r\n\r\n    // Load List of Requirements\r\n    async function loadRequirements(page = 1) {\r\n        setLoading(true);\r\n        try {\r\n            const res = await api.get(`/requirements?page=${page}&limit=${pagination.limit}`);\r\n            // Backend now returns { requirements: [], pagination: {} }\r\n            if (res.data.requirements) {\r\n                setRequirements(res.data.requirements); // Already sorted by backend\r\n                setPagination(res.data.pagination);\r\n            } else if (Array.isArray(res.data)) {\r\n                // Fallback for old API response (if backend update lags)\r\n                setRequirements(res.data.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)));\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert('Failed to load requirements');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        loadRequirements(pagination.page);\r\n    }, [pagination.page]); // Reload on page change\r\n\r\n    async function toggleStatus(id, currentStatus) {\r\n        const newStatus = currentStatus === 'Open' ? 'Closed' : 'Open';\r\n        try {\r\n            await api.patch(`/requirements/${id}/status`, { status: newStatus });\r\n            loadRequirements(pagination.page);\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert('Failed to update status');\r\n        }\r\n    }\r\n\r\n    function openNew() {\r\n        navigate('/hr/create-requirement');\r\n    }\r\n\r\n    function handleEdit(req) {\r\n        setCurrentReq(req);\r\n        setIsEditMode(true);\r\n        setOpenForm(true);\r\n    }\r\n\r\n    function handleView(req) {\r\n        setCurrentReq(req);\r\n        setOpenView(true);\r\n    }\r\n\r\n    async function handleDelete(id) {\r\n        if (!window.confirm('Are you sure you want to delete this job requirement?')) return;\r\n        try {\r\n            await api.delete(`/requirements/${id}`);\r\n            setRequirements(prev => prev.filter(r => r._id !== id));\r\n            // Optional: Reload if page becomes empty\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert('Failed to delete requirement');\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-8 w-full\">\r\n            <div className=\"flex justify-between items-center mb-8\">\r\n                <h1 className=\"text-3xl font-bold text-slate-900\">Requirement Management</h1>\r\n                <div className=\"flex gap-3\">\r\n                    {/* Add button moved to Sidebar */}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden flex flex-col min-h-[500px]\">\r\n                <div className=\"table-responsive mobile-card-hide\">\r\n                    {loading ? (\r\n                        <div className=\"p-12 text-center text-slate-500 bg-white\">Loading...</div>\r\n                    ) : requirements.length === 0 ? (\r\n                        <div className=\"p-12 text-center text-slate-500 bg-white\">No requirements found.</div>\r\n                    ) : (\r\n                        <table className=\"min-w-full divide-y divide-slate-200\">\r\n                            <thead className=\"bg-slate-50\">\r\n                                <tr>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Job ID</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Job Title</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Department</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Vacancy</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider\">Status</th>\r\n                                    <th className=\"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider\">Actions</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-slate-200\">\r\n                                {requirements.map(req => (\r\n                                    <tr key={req._id} className=\"hover:bg-slate-50\">\r\n                                        <td className=\"px-4 py-4 whitespace-nowrap text-sm font-mono text-slate-500\">{req.jobOpeningId || '-'}</td>\r\n                                        <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium text-slate-900\">{req.jobTitle || req.title || 'Untitled'}</td>\r\n                                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-slate-600\">{req.department || '-'}</td>\r\n                                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-slate-600\">{req.vacancy}</td>\r\n                                        <td className=\"px-4 py-4 whitespace-nowrap\">\r\n                                            <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${req.status === 'Open' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\r\n                                                {req.status}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"px-4 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                                            <div className=\"flex items-center justify-end gap-2\">\r\n                                                <button onClick={() => handleView(req)} className=\"text-slate-400 hover:text-blue-600\" title=\"View\">\r\n                                                    <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg>\r\n                                                </button>\r\n                                                <button onClick={() => toggleStatus(req._id, req.status)} className=\"text-slate-400 hover:text-green-600\" title=\"Toggle Status\">\r\n                                                    <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" /></svg>\r\n                                                </button>\r\n                                                <button onClick={() => handleEdit(req)} className=\"text-blue-600 hover:text-blue-800\" title=\"Edit\">\r\n                                                    <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" /></svg>\r\n                                                </button>\r\n                                                <button onClick={() => handleDelete(req._id)} className=\"text-red-600 hover:text-red-900\" title=\"Delete\">\r\n                                                    <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" /></svg>\r\n                                                </button>\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Mobile Card View */}\r\n                <div className=\"mobile-card-show p-4 space-y-4\">\r\n                    {loading ? (\r\n                        <div className=\"text-center py-8 text-slate-500\">Loading...</div>\r\n                    ) : requirements.length === 0 ? (\r\n                        <div className=\"text-center py-8 text-slate-500\">No requirements found.</div>\r\n                    ) : (\r\n                        requirements.map(req => (\r\n                            <div key={req._id} className=\"bg-white rounded-xl border border-slate-200 p-4 shadow-sm\">\r\n                                <div className=\"flex justify-between items-start mb-3\">\r\n                                    <div>\r\n                                        <div className=\"text-[10px] font-mono text-slate-400 uppercase tracking-wider\">{req.jobOpeningId || '-'}</div>\r\n                                        <h3 className=\"font-bold text-slate-900 leading-tight\">{req.jobTitle || req.title || 'Untitled'}</h3>\r\n                                        <p className=\"text-xs text-slate-500 mt-1\">{req.department || '-'}</p>\r\n                                    </div>\r\n                                    <span className={`inline-flex px-2 py-0.5 text-[10px] font-bold rounded-full uppercase tracking-tighter ${req.status === 'Open' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>\r\n                                        {req.status}\r\n                                    </span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-4 py-3 border-y border-slate-50 mb-3\">\r\n                                    <div>\r\n                                        <div className=\"text-[10px] text-slate-400 uppercase font-black\">Vacancy</div>\r\n                                        <div className=\"text-sm font-bold text-slate-700\">{req.vacancy} Position(s)</div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex justify-end gap-2 pt-1\">\r\n                                    <button onClick={() => handleView(req)} className=\"p-2 bg-slate-50 text-slate-600 rounded-lg border border-slate-100\">\r\n                                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg>\r\n                                    </button>\r\n                                    <button onClick={() => toggleStatus(req._id, req.status)} className=\"p-2 bg-green-50 text-green-600 rounded-lg border border-green-100\">\r\n                                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" /></svg>\r\n                                    </button>\r\n                                    <button onClick={() => handleEdit(req)} className=\"p-2 bg-blue-50 text-blue-600 rounded-lg border border-blue-100\">\r\n                                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" /></svg>\r\n                                    </button>\r\n                                    <button onClick={() => handleDelete(req._id)} className=\"p-2 bg-red-50 text-red-600 rounded-lg border border-red-100\">\r\n                                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" /></svg>\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n\r\n                {/* Pagination Controls */}\r\n                {pagination.totalPages > 1 && (\r\n                    <div className=\"bg-slate-50 px-4 py-3 flex items-center justify-between border-t border-slate-200\">\r\n                        <div className=\"flex-1 flex justify-between sm:hidden\">\r\n                            <button onClick={() => setPagination(prev => ({ ...prev, page: Math.max(1, prev.page - 1) }))} disabled={pagination.page === 1} className=\"relative inline-flex items-center px-4 py-2 border border-slate-300 text-sm font-medium rounded-md text-slate-700 bg-white hover:bg-slate-50 disabled:opacity-50\">\r\n                                Previous\r\n                            </button>\r\n                            <button onClick={() => setPagination(prev => ({ ...prev, page: Math.min(pagination.totalPages, prev.page + 1) }))} disabled={pagination.page === pagination.totalPages} className=\"ml-3 relative inline-flex items-center px-4 py-2 border border-slate-300 text-sm font-medium rounded-md text-slate-700 bg-white hover:bg-slate-50 disabled:opacity-50\">\r\n                                Next\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm text-slate-700\">\r\n                                    Showing <span className=\"font-medium\">{(pagination.page - 1) * pagination.limit + 1}</span> to <span className=\"font-medium\">{Math.min(pagination.page * pagination.limit, pagination.total)}</span> of <span className=\"font-medium\">{pagination.total}</span> results\r\n                                </p>\r\n                            </div>\r\n                            <div>\r\n                                <nav className=\"relative z-0 inline-flex rounded-md shadow-sm -space-x-px\" aria-label=\"Pagination\">\r\n                                    <button onClick={() => setPagination(prev => ({ ...prev, page: 1 }))} disabled={pagination.page === 1} className=\"relative inline-flex items-center px-2 py-2 rounded-l-md border border-slate-300 bg-white text-sm font-medium text-slate-500 hover:bg-slate-50 disabled:opacity-50\">\r\n                                        <span className=\"sr-only\">First</span>\r\n                                        <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 19l-7-7 7-7m8 14l-7-7 7-7\" /></svg>\r\n                                    </button>\r\n                                    <button onClick={() => setPagination(prev => ({ ...prev, page: Math.max(1, prev.page - 1) }))} disabled={pagination.page === 1} className=\"relative inline-flex items-center px-2 py-2 border border-slate-300 bg-white text-sm font-medium text-slate-500 hover:bg-slate-50 disabled:opacity-50\">\r\n                                        <span className=\"sr-only\">Previous</span>\r\n                                        <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" /></svg>\r\n                                    </button>\r\n                                    <span className=\"relative inline-flex items-center px-4 py-2 border border-slate-300 bg-white text-sm font-medium text-slate-700\">\r\n                                        Page {pagination.page} of {pagination.totalPages}\r\n                                    </span>\r\n                                    <button onClick={() => setPagination(prev => ({ ...prev, page: Math.min(pagination.totalPages, prev.page + 1) }))} disabled={pagination.page === pagination.totalPages} className=\"relative inline-flex items-center px-2 py-2 border border-slate-300 bg-white text-sm font-medium text-slate-500 hover:bg-slate-50 disabled:opacity-50\">\r\n                                        <span className=\"sr-only\">Next</span>\r\n                                        <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" /></svg>\r\n                                    </button>\r\n                                    <button onClick={() => setPagination(prev => ({ ...prev, page: pagination.totalPages }))} disabled={pagination.page === pagination.totalPages} className=\"relative inline-flex items-center px-2 py-2 rounded-r-md border border-slate-300 bg-white text-sm font-medium text-slate-500 hover:bg-slate-50 disabled:opacity-50\">\r\n                                        <span className=\"sr-only\">Last</span>\r\n                                        <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 5l7 7-7 7M5 5l7 7-7 7\" /></svg>\r\n                                    </button>\r\n                                </nav>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {openForm && (\r\n                <RequirementForm\r\n                    initialData={currentReq}\r\n                    isEdit={isEditMode}\r\n                    isModal={true}\r\n                    onClose={() => setOpenForm(false)}\r\n                    onSuccess={() => loadRequirements(1)} // Reset to page 1 on new creation\r\n                />\r\n            )}\r\n\r\n            {openView && currentReq && (\r\n                <ViewRequirementModal\r\n                    req={currentReq}\r\n                    onClose={() => { setOpenView(false); setCurrentReq(null); }}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction LocalRequirementForm({ onClose, onSuccess, initialData, isEdit }) {\r\n    const [formData, setFormData] = useState({\r\n        jobTitle: '',\r\n        department: '',\r\n        vacancy: 1,\r\n        description: '',\r\n        priority: 'Medium',\r\n        workMode: 'On-site',\r\n        jobType: 'Full Time',\r\n        expYears: '',\r\n        expMonths: '',\r\n        salaryMin: '',\r\n        salaryMax: ''\r\n    });\r\n\r\n    const [customFields, setCustomFields] = useState([]);\r\n\r\n    // Track which fields are visible to the public\r\n    const [publicFields, setPublicFields] = useState(new Set([\r\n        'jobTitle', 'department', 'vacancy', 'description',\r\n        'workMode', 'jobType', 'experience', 'salary'\r\n    ]));\r\n\r\n    // Default Workflow\r\n    const [workflow, setWorkflow] = useState(['Shortlisted', 'Interview']);\r\n\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (initialData) {\r\n            setFormData({\r\n                jobTitle: initialData.jobTitle || '',\r\n                department: initialData.department || '',\r\n                vacancy: initialData.vacancy || 1,\r\n                description: initialData.description || '',\r\n                priority: initialData.priority || 'Medium',\r\n                workMode: initialData.workMode || 'On-site',\r\n                jobType: initialData.jobType || 'Full Time',\r\n                expYears: initialData.minExperienceMonths ? Math.floor(initialData.minExperienceMonths / 12) : '',\r\n                expMonths: initialData.minExperienceMonths ? initialData.minExperienceMonths % 12 : '',\r\n                salaryMin: initialData.salaryMin || '',\r\n                salaryMax: initialData.salaryMax || ''\r\n            });\r\n            if (initialData.customFields && Array.isArray(initialData.customFields)) {\r\n                setCustomFields(initialData.customFields);\r\n            }\r\n            if (initialData.publicFields && Array.isArray(initialData.publicFields)) {\r\n                setPublicFields(new Set(initialData.publicFields));\r\n            }\r\n            if (initialData.workflow && Array.isArray(initialData.workflow)) {\r\n                // Filter out 'Applied' and 'Finalized' as they are fixed start/end points\r\n                const editable = initialData.workflow.filter(s => s !== 'Applied' && s !== 'Finalized' && s !== 'Rejected' && s !== 'Selected');\r\n                if (editable.length > 0) setWorkflow(editable);\r\n            }\r\n        }\r\n    }, [initialData]);\r\n\r\n    const addCustomField = () => {\r\n        setCustomFields([...customFields, { label: '', value: '', isPublic: true }]);\r\n    };\r\n\r\n    const removeCustomField = (index) => {\r\n        const newFields = [...customFields];\r\n        newFields.splice(index, 1);\r\n        setCustomFields(newFields);\r\n    };\r\n\r\n    const updateCustomField = (index, field, val) => {\r\n        const newFields = [...customFields];\r\n        newFields[index][field] = val;\r\n        setCustomFields(newFields);\r\n    };\r\n\r\n    const togglePublic = (key) => {\r\n        const newSet = new Set(publicFields);\r\n        if (newSet.has(key)) {\r\n            newSet.delete(key);\r\n        } else {\r\n            newSet.add(key);\r\n        }\r\n        setPublicFields(newSet);\r\n    };\r\n\r\n    // Workflow Handlers\r\n    const addStage = () => {\r\n        setWorkflow([...workflow, 'New Round']);\r\n    };\r\n\r\n    const updateStage = (index, val) => {\r\n        const newWorkflow = [...workflow];\r\n        newWorkflow[index] = val;\r\n        setWorkflow(newWorkflow);\r\n    };\r\n\r\n    const removeStage = (index) => {\r\n        const newWorkflow = [...workflow];\r\n        newWorkflow.splice(index, 1);\r\n        setWorkflow(newWorkflow);\r\n    };\r\n\r\n    async function submit(e) {\r\n        e.preventDefault();\r\n        setSaving(true);\r\n\r\n        // Filter out empty custom fields\r\n        const validCustomFields = customFields.filter(f => f.label.trim() !== '' && f.value.trim() !== '');\r\n\r\n        // Construct simplified workflow to save\r\n        const fullWorkflow = ['Applied', ...workflow.filter(w => w.trim() !== ''), 'Finalized'];\r\n\r\n        // Convert Years and Months to total months\r\n        const totalMonths = (parseInt(formData.expYears) || 0) * 12 + (parseInt(formData.expMonths) || 0);\r\n\r\n        // Convert Set to Array for storage\r\n        const payload = {\r\n            ...formData,\r\n            minExperienceMonths: totalMonths,\r\n            maxExperienceMonths: totalMonths,\r\n            customFields: validCustomFields,\r\n            publicFields: Array.from(publicFields),\r\n            workflow: fullWorkflow\r\n        };\r\n\r\n        try {\r\n            if (isEdit) {\r\n                await api.put(`/requirements/${initialData._id}`, payload);\r\n            } else {\r\n                await api.post('/requirements/create', payload);\r\n            }\r\n            onSuccess();\r\n            onClose();\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert('Failed to save');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    }\r\n\r\n    // Helper for label with visibility toggle\r\n    // Helper component definition removed from render scope\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-3xl flex flex-col max-h-[90vh]\">\r\n                <div className=\"px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-xl\">\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold text-slate-800\">{isEdit ? 'Edit Requirement' : 'New Job Requirement'}</h2>\r\n                        <p className=\"text-xs text-slate-500 mt-0.5\">Configure job details and hiring process steps.</p>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"text-slate-400 hover:text-slate-600\"><svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" /></svg></button>\r\n                </div>\r\n\r\n                <form onSubmit={submit} className=\"p-6 overflow-y-auto\">\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"col-span-2\">\r\n                            <LabelWithToggle label=\"Job Title\" fieldKey=\"jobTitle\" required publicFields={publicFields} togglePublic={togglePublic} />\r\n                            <input\r\n                                required\r\n                                value={formData.jobTitle}\r\n                                onChange={e => setFormData({ ...formData, jobTitle: e.target.value })}\r\n                                className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                placeholder=\"e.g. Senior Developer\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <LabelWithToggle label=\"Department\" fieldKey=\"department\" required publicFields={publicFields} togglePublic={togglePublic} />\r\n                            <select\r\n                                required\r\n                                value={formData.department}\r\n                                onChange={e => setFormData({ ...formData, department: e.target.value })}\r\n                                className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white\"\r\n                            >\r\n                                <option value=\"\">Select Department</option>\r\n                                <option value=\"HR\">HR</option>\r\n                                <option value=\"IT\">IT</option>\r\n                                <option value=\"Sales\">Sales</option>\r\n                                <option value=\"Marketing\">Marketing</option>\r\n                                <option value=\"Finance\">Finance</option>\r\n                                <option value=\"Operations\">Operations</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <LabelWithToggle label=\"Vacancy\" fieldKey=\"vacancy\" required publicFields={publicFields} togglePublic={togglePublic} />\r\n                            <input\r\n                                required\r\n                                type=\"number\"\r\n                                min=\"1\"\r\n                                value={formData.vacancy}\r\n                                onChange={e => setFormData({ ...formData, vacancy: e.target.value })}\r\n                                className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <LabelWithToggle label=\"Job Type\" fieldKey=\"jobType\" publicFields={publicFields} togglePublic={togglePublic} />\r\n                            <select\r\n                                value={formData.jobType}\r\n                                onChange={e => setFormData({ ...formData, jobType: e.target.value })}\r\n                                className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white\"\r\n                            >\r\n                                <option value=\"Full Time\">Full Time</option>\r\n                                <option value=\"Part Time\">Part Time</option>\r\n                                <option value=\"Contract\">Contract</option>\r\n                                <option value=\"Internship\">Internship</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <LabelWithToggle label=\"Work Mode\" fieldKey=\"workMode\" publicFields={publicFields} togglePublic={togglePublic} />\r\n                            <select\r\n                                value={formData.workMode}\r\n                                onChange={e => setFormData({ ...formData, workMode: e.target.value })}\r\n                                className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white\"\r\n                            >\r\n                                <option value=\"On-site\">On-site</option>\r\n                                <option value=\"Remote\">Remote</option>\r\n                                <option value=\"Hybrid\">Hybrid</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <LabelWithToggle label=\"Experience\" fieldKey=\"experience\" />\r\n                            <LabelWithToggle label=\"Experience (Months)\" fieldKey=\"experience\" publicFields={publicFields} togglePublic={togglePublic} />\r\n                            <div className=\"flex gap-2\">\r\n                                <input\r\n                                    type=\"number\"\r\n                                    placeholder=\"Years\"\r\n                                    value={formData.expYears}\r\n                                    onChange={e => setFormData({ ...formData, expYears: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                />\r\n                                <input\r\n                                    type=\"number\"\r\n                                    placeholder=\"Months\"\r\n                                    value={formData.expMonths}\r\n                                    onChange={e => setFormData({ ...formData, expMonths: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"\">\r\n                            <LabelWithToggle label=\"Priority\" fieldKey=\"priority\" publicFields={publicFields} togglePublic={togglePublic} />\r\n                            <select\r\n                                value={formData.priority}\r\n                                onChange={e => setFormData({ ...formData, priority: e.target.value })}\r\n                                className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white\"\r\n                            >\r\n                                <option value=\"High\">High</option>\r\n                                <option value=\"Medium\">Medium</option>\r\n                                <option value=\"Low\">Low</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div className=\"col-span-2\">\r\n                            <LabelWithToggle label=\"Salary Range (Annual)\" fieldKey=\"salary\" publicFields={publicFields} togglePublic={togglePublic} />\r\n                            <div className=\"flex gap-2\">\r\n                                <input\r\n                                    type=\"number\"\r\n                                    placeholder=\"Min Salary\"\r\n                                    value={formData.salaryMin}\r\n                                    onChange={e => setFormData({ ...formData, salaryMin: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                />\r\n                                <span className=\"self-center text-slate-400\">-</span>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    placeholder=\"Max Salary\"\r\n                                    value={formData.salaryMax}\r\n                                    onChange={e => setFormData({ ...formData, salaryMax: e.target.value })}\r\n                                    className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"col-span-2\">\r\n                            <LabelWithToggle label=\"Description\" fieldKey=\"description\" publicFields={publicFields} togglePublic={togglePublic} />\r\n                            <textarea\r\n                                rows=\"3\"\r\n                                value={formData.description}\r\n                                onChange={e => setFormData({ ...formData, description: e.target.value })}\r\n                                className=\"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                placeholder=\"Job details, key responsibilities, etc...\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-6 mt-6 pt-4 border-t border-slate-100\">\r\n                        {/* Custom Fields Section */}\r\n                        <div>\r\n                            <div className=\"flex justify-between items-center mb-3\">\r\n                                <label className=\"block text-sm font-bold text-slate-700\">Ad-hoc Details</label>\r\n                                <button type=\"button\" onClick={addCustomField} className=\"text-xs text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1\">\r\n                                    + Add Detail\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                {customFields.map((field, index) => (\r\n                                    <div key={index} className=\"flex gap-1 items-center bg-slate-50 p-1.5 rounded border border-slate-100\">\r\n                                        {/* Public Toggle for Custom Field */}\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => updateCustomField(index, 'isPublic', !field.isPublic)}\r\n                                            className={`p-1.5 rounded border transition ${field.isPublic ? 'bg-green-100 text-green-700 border-green-200' : 'bg-white text-slate-400 border-slate-200'}`}\r\n                                            title={field.isPublic ? \"Visible Publicly\" : \"Hidden Publicly\"}\r\n                                        >\r\n                                            <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                                {field.isPublic ? (\r\n                                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                                                ) : (\r\n                                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21\" />\r\n                                                )}\r\n                                            </svg>\r\n                                        </button>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            placeholder=\"Label\"\r\n                                            value={field.label}\r\n                                            onChange={(e) => updateCustomField(index, 'label', e.target.value)}\r\n                                            className=\"w-24 px-2 py-1.5 border border-slate-300 rounded text-sm outline-none focus:ring-1 focus:ring-blue-500\"\r\n                                        />\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            placeholder=\"Value\"\r\n                                            value={field.value}\r\n                                            onChange={(e) => updateCustomField(index, 'value', e.target.value)}\r\n                                            className=\"flex-1 px-2 py-1.5 border border-slate-300 rounded text-sm outline-none focus:ring-1 focus:ring-blue-500\"\r\n                                        />\r\n                                        <button type=\"button\" onClick={() => removeCustomField(index)} className=\"text-red-400 hover:text-red-600 p-1\">\r\n                                            <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" /></svg>\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                                {customFields.length === 0 && (\r\n                                    <div className=\"text-xs text-slate-400 italic text-center py-2 bg-slate-50 rounded border border-dashed border-slate-200\">\r\n                                        No custom fields.\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Hiring Process Configurator */}\r\n                        <div>\r\n                            <div className=\"flex justify-between items-center mb-3\">\r\n                                <label className=\"block text-sm font-bold text-slate-700\">Hiring Stages</label>\r\n                                <button type=\"button\" onClick={addStage} className=\"text-xs text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-1\">\r\n                                    + Add Stage\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                {/* Fixed Start */}\r\n                                <div className=\"flex items-center gap-2 p-2 bg-green-50 rounded border border-green-100 opacity-70\">\r\n                                    <span className=\"text-xs font-bold text-green-700 w-6\">Start</span>\r\n                                    <div className=\"flex-1 text-sm text-green-900 font-medium\">Applied</div>\r\n                                </div>\r\n\r\n                                {/* Dynamic Middle Stages */}\r\n                                {workflow.map((stage, index) => (\r\n                                    <div key={index} className=\"flex gap-2 items-center p-1 rounded hover:bg-slate-50 group border border-transparent hover:border-slate-200\">\r\n                                        <span className=\"text-xs text-slate-400 w-6 text-center\">{index + 1}</span>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={stage}\r\n                                            onChange={(e) => updateStage(index, e.target.value)}\r\n                                            className=\"flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                                            placeholder=\"Stage Name (e.g. Technical Round)\"\r\n                                        />\r\n                                        <button type=\"button\" onClick={() => removeStage(index)} className=\"text-slate-400 hover:text-red-500 p-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" /></svg>\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n\r\n                                {/* Fixed End */}\r\n                                <div className=\"flex items-center gap-2 p-2 bg-slate-100 rounded border border-slate-200 opacity-70\">\r\n                                    <span className=\"text-xs font-bold text-slate-500 w-6\">End</span>\r\n                                    <div className=\"flex-1 text-sm text-slate-700 font-medium\">Finalized (Selected / Rejected)</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-end gap-3 pt-6 mt-4 border-t border-slate-100\">\r\n                        <button type=\"button\" onClick={onClose} className=\"px-4 py-2 text-slate-600 hover:bg-slate-50 rounded-lg border border-slate-200\">Cancel</button>\r\n                        <button type=\"submit\" disabled={saving} className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md\">\r\n                            {saving ? 'Saving...' : 'Save & Configure'}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ViewRequirementModal({ req, onClose }) {\r\n    const customFields = req.customFields || [];\r\n    const workflow = req.workflow || [];\r\n    const detailedWorkflow = req.detailedWorkflow || [];\r\n\r\n    // Helper to get detailed info for a stage\r\n    const getStageDetails = (stageName) => {\r\n        return detailedWorkflow.find(s => s.name === stageName) || { name: stageName };\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\r\n            <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-3xl overflow-hidden max-h-[90vh] overflow-y-auto\">\r\n                <div className=\"flex justify-between items-start p-6 border-b\">\r\n                    <div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <h2 className=\"text-2xl font-bold text-slate-900\">{req.jobTitle || 'Untitled'}</h2>\r\n                            {req.jobOpeningId && <span className=\"text-sm font-mono bg-slate-100 px-2 py-1 rounded text-slate-600 border border-slate-200\">{req.jobOpeningId}</span>}\r\n                        </div>\r\n                        <div className=\"flex gap-2 text-sm mt-1\">\r\n                            <span className=\"px-2 py-0.5 bg-blue-50 text-blue-700 rounded border border-blue-100\">{req.department}</span>\r\n                            <span className=\"px-2 py-0.5 bg-slate-100 text-slate-700 rounded border border-slate-200\">{req.jobType}</span>\r\n                            <span className=\"px-2 py-0.5 bg-purple-50 text-purple-700 rounded border border-purple-100\">{req.workMode}</span>\r\n                        </div>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"text-slate-400 hover:text-slate-600\"><svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" /></svg></button>\r\n                </div>\r\n\r\n                <div className=\"p-6 grid grid-cols-2 gap-6 bg-slate-50 border-b\">\r\n                    <div>\r\n                        <div className=\"text-xs text-slate-500 uppercase tracking-wide font-semibold\">Experience</div>\r\n                        <div className=\"text-slate-800 font-medium\">\r\n                            {req.minExperienceMonths ? `${Math.floor(req.minExperienceMonths / 12)} Years ${req.minExperienceMonths % 12} Months` : 'No experience required'}\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"text-xs text-slate-500 uppercase tracking-wide font-semibold\">Salary Range</div>\r\n                        <div className=\"text-slate-800 font-medium\">{req.salaryMin ? `‚Çπ${req.salaryMin} - ‚Çπ${req.salaryMax}` : 'Not Disclosed'}</div>\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"text-xs text-slate-500 uppercase tracking-wide font-semibold\">Vacancy</div>\r\n                        <div className=\"text-slate-800 font-medium\">{req.vacancy} Position(s)</div>\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"text-xs text-slate-500 uppercase tracking-wide font-semibold\">Priority</div>\r\n                        <div className=\"text-slate-800 font-medium\">{req.priority || 'Medium'}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"p-6\">\r\n                    <h3 className=\"font-semibold text-slate-800 mb-2\">Job Description</h3>\r\n                    <p className=\"text-slate-600 whitespace-pre-wrap\">{req.description || 'No description provided.'}</p>\r\n                </div>\r\n\r\n                {/* Hiring Stages Section */}\r\n                {workflow && workflow.length > 0 && (\r\n                    <div className=\"p-6 border-t border-slate-100 bg-gradient-to-br from-blue-50 to-indigo-50\">\r\n                        <h3 className=\"font-semibold text-slate-800 mb-4 flex items-center gap-2\">\r\n                            <svg className=\"w-5 h-5 text-indigo-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\" /></svg>\r\n                            Hiring Process ({workflow.length} Stages)\r\n                        </h3>\r\n                        <div className=\"space-y-3\">\r\n                            {workflow.map((stageName, index) => {\r\n                                const details = getStageDetails(stageName);\r\n                                const isStart = stageName === 'Applied';\r\n                                const isEnd = stageName === 'Finalized';\r\n\r\n                                return (\r\n                                    <div\r\n                                        key={index}\r\n                                        className={`p-4 rounded-lg border-2 ${isStart ? 'bg-green-50 border-green-200' :\r\n                                            isEnd ? 'bg-slate-100 border-slate-300' :\r\n                                                'bg-white border-indigo-200 shadow-sm'\r\n                                            }`}\r\n                                    >\r\n                                        <div className=\"flex items-start gap-3\">\r\n                                            <span className={`flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm ${isStart ? 'bg-green-200 text-green-800' :\r\n                                                isEnd ? 'bg-slate-300 text-slate-700' :\r\n                                                    'bg-indigo-100 text-indigo-700'\r\n                                                }`}>\r\n                                                {isStart ? 'S' : isEnd ? 'E' : index}\r\n                                            </span>\r\n                                            <div className=\"flex-1\">\r\n                                                <div className=\"flex items-center gap-2 mb-1\">\r\n                                                    <h4 className=\"font-semibold text-slate-900\">{details.name || stageName}</h4>\r\n                                                    {details.type && !isStart && !isEnd && (\r\n                                                        <span className=\"text-xs px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded-full border border-indigo-200\">\r\n                                                            {details.type}\r\n                                                        </span>\r\n                                                    )}\r\n                                                    {details.interviewType && (\r\n                                                        <span className=\"text-xs px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full border border-purple-200\">\r\n                                                            {details.interviewType}\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n\r\n                                                {details.interviewer && (\r\n                                                    <div className=\"flex items-center gap-1.5 text-sm text-slate-600 mt-2\">\r\n                                                        <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" /></svg>\r\n                                                        <span className=\"font-medium\">Interviewer:</span> {details.interviewer}\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                {details.description && (\r\n                                                    <p className=\"text-sm text-slate-600 mt-2 pl-0 border-l-2 border-indigo-200 pl-3\">\r\n                                                        {details.description}\r\n                                                    </p>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {customFields.length > 0 && (\r\n                    <div className=\"p-6 border-t border-slate-100\">\r\n                        <h3 className=\"font-semibold text-slate-800 mb-3\">Additional Details</h3>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            {customFields.map((field, idx) => (\r\n                                <div key={idx} className=\"bg-slate-50 p-3 rounded border border-slate-100\">\r\n                                    <span className=\"block text-xs text-slate-500 mb-1\">{field.label}</span>\r\n                                    <span className=\"block text-sm font-medium text-slate-800\">{field.value}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"bg-slate-50 px-6 py-4 flex justify-end\">\r\n                    <button onClick={onClose} className=\"px-4 py-2 bg-white border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50\">Close</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\n// Helper for label with visibility toggle\r\nconst LabelWithToggle = ({ label, fieldKey, required, publicFields, togglePublic }) => (\r\n    <div className=\"flex justify-between items-center mb-1\">\r\n        <label className=\"block text-sm font-medium text-slate-700\">\r\n            {label} {required && <span className=\"text-red-500\">*</span>}\r\n        </label>\r\n        <button\r\n            type=\"button\"\r\n            onClick={() => togglePublic(fieldKey)}\r\n            className={`text-xs flex items-center gap-1 px-2 py-0.5 rounded border transition ${publicFields.has(fieldKey) ? 'bg-green-50 text-green-700 border-green-200' : 'bg-slate-50 text-slate-400 border-slate-200'}`}\r\n            title={publicFields.has(fieldKey) ? \"Visible on Public Page\" : \"Hidden from Public Page\"}\r\n        >\r\n            {publicFields.has(fieldKey) ? (\r\n                <>\r\n                    <svg className=\"w-3 h-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg>\r\n                    Public\r\n                </>\r\n            ) : (\r\n                <>\r\n                    <svg className=\"w-3 h-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21\" /></svg>\r\n                    Hidden\r\n                </>\r\n            )}\r\n        </button>\r\n    </div>\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\RevisionApproval.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPendingRevisions'. Either include it or remove the dependency array.","line":22,"column":8,"nodeType":"ArrayExpression","endLine":22,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [filterType, loadPendingRevisions]","fix":{"range":[905,917],"text":"[filterType, loadPendingRevisions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport api from '../../utils/api';\r\nimport { Check, X, Eye, TrendingUp, RefreshCw, ArrowUpCircle, Calendar, User, AlertCircle } from 'lucide-react';\r\n\r\n/**\r\n * Revision Approval Component\r\n * \r\n * HR Dashboard for approving/rejecting salary revisions\r\n */\r\nexport default function RevisionApproval() {\r\n    const [revisions, setRevisions] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [selectedRevision, setSelectedRevision] = useState(null);\r\n    const [showDetails, setShowDetails] = useState(false);\r\n    const [filterType, setFilterType] = useState('');\r\n    const [actionLoading, setActionLoading] = useState(false);\r\n    const [rejectionReason, setRejectionReason] = useState('');\r\n    const [showRejectModal, setShowRejectModal] = useState(null);\r\n\r\n    useEffect(() => {\r\n        loadPendingRevisions();\r\n    }, [filterType]);\r\n\r\n    const loadPendingRevisions = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const params = filterType ? `?type=${filterType}` : '';\r\n            const response = await api.get(`/hr/salary-revisions/pending${params}`);\r\n            if (response.data.success) {\r\n                setRevisions(response.data.data || []);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading pending revisions:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleApprove = async (revisionId) => {\r\n        if (!confirm('Are you sure you want to approve this salary revision?')) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setActionLoading(true);\r\n            const response = await api.post(`/hr/salary-revisions/${revisionId}/approve`);\r\n            if (response.data.success) {\r\n                alert('Salary revision approved successfully!');\r\n                loadPendingRevisions();\r\n                setShowDetails(false);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error approving revision:', error);\r\n            alert(error.response?.data?.message || 'Failed to approve revision');\r\n        } finally {\r\n            setActionLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleReject = async (revisionId) => {\r\n        if (!rejectionReason.trim()) {\r\n            alert('Please provide a reason for rejection');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setActionLoading(true);\r\n            const response = await api.post(`/hr/salary-revisions/${revisionId}/reject`, {\r\n                reason: rejectionReason\r\n            });\r\n            if (response.data.success) {\r\n                alert('Salary revision rejected');\r\n                loadPendingRevisions();\r\n                setShowRejectModal(null);\r\n                setRejectionReason('');\r\n                setShowDetails(false);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error rejecting revision:', error);\r\n            alert(error.response?.data?.message || 'Failed to reject revision');\r\n        } finally {\r\n            setActionLoading(false);\r\n        }\r\n    };\r\n\r\n    const viewDetails = async (revisionId) => {\r\n        try {\r\n            const response = await api.get(`/hr/salary-revisions/${revisionId}`);\r\n            if (response.data.success) {\r\n                setSelectedRevision(response.data.data);\r\n                setShowDetails(true);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading revision details:', error);\r\n            alert('Failed to load revision details');\r\n        }\r\n    };\r\n\r\n    const getTypeIcon = (type) => {\r\n        switch (type) {\r\n            case 'INCREMENT':\r\n                return <TrendingUp className=\"h-5 w-5\" />;\r\n            case 'REVISION':\r\n                return <RefreshCw className=\"h-5 w-5\" />;\r\n            case 'PROMOTION':\r\n                return <ArrowUpCircle className=\"h-5 w-5\" />;\r\n            default:\r\n                return null;\r\n        }\r\n    };\r\n\r\n    const getTypeColor = (type) => {\r\n        switch (type) {\r\n            case 'INCREMENT':\r\n                return 'green';\r\n            case 'REVISION':\r\n                return 'blue';\r\n            case 'PROMOTION':\r\n                return 'purple';\r\n            default:\r\n                return 'slate';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-slate-900\">Salary Revision Approvals</h1>\r\n                    <p className=\"text-slate-600 mt-1\">Review and approve pending salary changes</p>\r\n                </div>\r\n\r\n                <select\r\n                    value={filterType}\r\n                    onChange={(e) => setFilterType(e.target.value)}\r\n                    className=\"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                >\r\n                    <option value=\"\">All Types</option>\r\n                    <option value=\"INCREMENT\">Increments</option>\r\n                    <option value=\"REVISION\">Revisions</option>\r\n                    <option value=\"PROMOTION\">Promotions</option>\r\n                </select>\r\n            </div>\r\n\r\n            {/* Pending Count */}\r\n            {revisions.length > 0 && (\r\n                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <AlertCircle className=\"h-5 w-5 text-amber-600\" />\r\n                        <span className=\"font-semibold text-amber-900\">\r\n                            {revisions.length} pending {revisions.length === 1 ? 'revision' : 'revisions'} awaiting approval\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Revisions List */}\r\n            <div className=\"bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden\">\r\n                {loading ? (\r\n                    <div className=\"flex items-center justify-center p-12\">\r\n                        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n                    </div>\r\n                ) : revisions.length === 0 ? (\r\n                    <div className=\"p-12 text-center text-slate-500\">\r\n                        <div className=\"text-6xl mb-4\">‚úì</div>\r\n                        <div className=\"text-lg font-semibold\">No pending revisions</div>\r\n                        <div className=\"text-sm mt-1\">All salary changes have been reviewed</div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y divide-slate-200\">\r\n                        {revisions.map((revision) => {\r\n                            const color = getTypeColor(revision.type);\r\n                            const employee = revision.employeeId;\r\n\r\n                            return (\r\n                                <div\r\n                                    key={revision._id}\r\n                                    className=\"p-6 hover:bg-slate-50 transition\"\r\n                                >\r\n                                    <div className=\"flex items-start justify-between gap-4\">\r\n                                        <div className=\"flex items-start gap-4 flex-1\">\r\n                                            <div className={`p-3 rounded-lg bg-${color}-100`}>\r\n                                                {getTypeIcon(revision.type)}\r\n                                            </div>\r\n\r\n                                            <div className=\"flex-1\">\r\n                                                <div className=\"flex items-center gap-3 mb-2\">\r\n                                                    <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-${color}-100 text-${color}-800`}>\r\n                                                        {revision.type}\r\n                                                    </span>\r\n                                                    <span className=\"text-sm text-slate-500\">\r\n                                                        {new Date(revision.effectiveFrom).toLocaleDateString('en-IN')}\r\n                                                    </span>\r\n                                                </div>\r\n\r\n                                                <div className=\"font-semibold text-slate-900 text-lg mb-1\">\r\n                                                    {employee?.firstName} {employee?.lastName}\r\n                                                </div>\r\n                                                <div className=\"text-sm text-slate-600 mb-3\">\r\n                                                    {employee?.employeeId} ‚Ä¢ {employee?.designation} ‚Ä¢ {employee?.department}\r\n                                                </div>\r\n\r\n                                                <div className=\"grid md:grid-cols-3 gap-4 mb-3\">\r\n                                                    <div>\r\n                                                        <div className=\"text-xs text-slate-500 mb-1\">Current CTC</div>\r\n                                                        <div className=\"font-semibold text-slate-700\">\r\n                                                            ‚Çπ{revision.changeSummary?.oldCTC?.toLocaleString('en-IN')}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <div className=\"text-xs text-slate-500 mb-1\">New CTC</div>\r\n                                                        <div className=\"font-semibold text-green-600\">\r\n                                                            ‚Çπ{revision.changeSummary?.newCTC?.toLocaleString('en-IN')}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <div className=\"text-xs text-slate-500 mb-1\">Change</div>\r\n                                                        <div className=\"font-semibold text-green-600\">\r\n                                                            +‚Çπ{revision.changeSummary?.absoluteChange?.toLocaleString('en-IN')}\r\n                                                            <span className=\"text-xs ml-1\">\r\n                                                                (+{revision.changeSummary?.percentageChange}%)\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                {revision.changeSummary?.reason && (\r\n                                                    <div className=\"text-sm text-slate-600 italic\">\r\n                                                        \"{revision.changeSummary.reason}\"\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"flex flex-col gap-2\">\r\n                                            <button\r\n                                                onClick={() => viewDetails(revision._id)}\r\n                                                className=\"flex items-center gap-2 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition text-sm\"\r\n                                            >\r\n                                                <Eye className=\"h-4 w-4\" />\r\n                                                Details\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => handleApprove(revision._id)}\r\n                                                className=\"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm\"\r\n                                                disabled={actionLoading}\r\n                                            >\r\n                                                <Check className=\"h-4 w-4\" />\r\n                                                Approve\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => setShowRejectModal(revision._id)}\r\n                                                className=\"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-sm\"\r\n                                                disabled={actionLoading}\r\n                                            >\r\n                                                <X className=\"h-4 w-4\" />\r\n                                                Reject\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Details Modal */}\r\n            {showDetails && selectedRevision && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm\">\r\n                    <div className=\"w-full w-full max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-2xl\">\r\n                        <div className=\"bg-blue-600 text-white px-6 py-4 flex items-center justify-between rounded-t-2xl\">\r\n                            <h2 className=\"text-xl font-bold\">Revision Details</h2>\r\n                            <button\r\n                                onClick={() => setShowDetails(false)}\r\n                                className=\"p-1 hover:bg-white/20 rounded-full transition\"\r\n                            >\r\n                                <X className=\"h-6 w-6\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 space-y-6\">\r\n                            {/* Employee Info */}\r\n                            <div className=\"bg-slate-50 rounded-lg p-4\">\r\n                                <h3 className=\"font-semibold text-slate-900 mb-3\">Employee Information</h3>\r\n                                <div className=\"grid md:grid-cols-2 gap-4 text-sm\">\r\n                                    <div>\r\n                                        <span className=\"text-slate-600\">Name: </span>\r\n                                        <span className=\"font-semibold\">\r\n                                            {selectedRevision.employeeId?.firstName} {selectedRevision.employeeId?.lastName}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div>\r\n                                        <span className=\"text-slate-600\">Employee ID: </span>\r\n                                        <span className=\"font-semibold\">{selectedRevision.employeeId?.employeeId}</span>\r\n                                    </div>\r\n                                    <div>\r\n                                        <span className=\"text-slate-600\">Designation: </span>\r\n                                        <span className=\"font-semibold\">{selectedRevision.employeeId?.designation}</span>\r\n                                    </div>\r\n                                    <div>\r\n                                        <span className=\"text-slate-600\">Department: </span>\r\n                                        <span className=\"font-semibold\">{selectedRevision.employeeId?.department}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Salary Comparison */}\r\n                            <div className=\"grid md:grid-cols-2 gap-6\">\r\n                                <div className=\"border border-slate-200 rounded-lg p-4\">\r\n                                    <h4 className=\"font-semibold text-slate-700 mb-3\">Current Salary</h4>\r\n                                    <div className=\"text-2xl font-bold text-slate-900 mb-2\">\r\n                                        ‚Çπ{selectedRevision.oldSnapshot?.ctc?.toLocaleString('en-IN')}\r\n                                    </div>\r\n                                    <div className=\"text-sm text-slate-600\">\r\n                                        ‚Çπ{selectedRevision.oldSnapshot?.monthlyCTC?.toLocaleString('en-IN')}/month\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"border border-green-200 rounded-lg p-4 bg-green-50\">\r\n                                    <h4 className=\"font-semibold text-green-900 mb-3\">New Salary</h4>\r\n                                    <div className=\"text-2xl font-bold text-green-700 mb-2\">\r\n                                        ‚Çπ{selectedRevision.newSnapshot?.ctc?.toLocaleString('en-IN')}\r\n                                    </div>\r\n                                    <div className=\"text-sm text-green-700\">\r\n                                        ‚Çπ{selectedRevision.newSnapshot?.monthlyCTC?.toLocaleString('en-IN')}/month\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Actions */}\r\n                            <div className=\"flex gap-3 pt-4 border-t border-slate-200\">\r\n                                <button\r\n                                    onClick={() => setShowDetails(false)}\r\n                                    className=\"flex-1 px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition font-medium\"\r\n                                >\r\n                                    Close\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => handleApprove(selectedRevision._id)}\r\n                                    className=\"flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium\"\r\n                                    disabled={actionLoading}\r\n                                >\r\n                                    Approve\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Reject Modal */}\r\n            {showRejectModal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm\">\r\n                    <div className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl\">\r\n                        <div className=\"bg-red-600 text-white px-6 py-4 flex items-center justify-between rounded-t-2xl\">\r\n                            <h2 className=\"text-xl font-bold\">Reject Revision</h2>\r\n                            <button\r\n                                onClick={() => {\r\n                                    setShowRejectModal(null);\r\n                                    setRejectionReason('');\r\n                                }}\r\n                                className=\"p-1 hover:bg-white/20 rounded-full transition\"\r\n                            >\r\n                                <X className=\"h-6 w-6\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-slate-700 mb-2\">\r\n                                    Reason for Rejection *\r\n                                </label>\r\n                                <textarea\r\n                                    value={rejectionReason}\r\n                                    onChange={(e) => setRejectionReason(e.target.value)}\r\n                                    className=\"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none\"\r\n                                    rows=\"4\"\r\n                                    placeholder=\"Please provide a reason for rejecting this revision...\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-3\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        setShowRejectModal(null);\r\n                                        setRejectionReason('');\r\n                                    }}\r\n                                    className=\"flex-1 px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition font-medium\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => handleReject(showRejectModal)}\r\n                                    className=\"flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium\"\r\n                                    disabled={actionLoading || !rejectionReason.trim()}\r\n                                >\r\n                                    Reject\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\SalaryStructure.jsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Identifier 'React' has already been declared","line":2,"column":8}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport {\r\n    ArrowLeft, Calculator, ShieldCheck, AlertCircle, Check, X, Database, Lock, Unlock, IndianRupee, TrendingUp, TrendingDown\r\n} from 'lucide-react';\r\nimport api from '../../utils/api';\r\n\r\n/**\r\n * ============================================\r\n * SALARY STRUCTURE (v9.0) - ARCHITECT EDITION\r\n * ============================================\r\n */\r\n\r\nexport default function SalaryStructure() {\r\n    const { candidateId } = useParams();\r\n    const navigate = useNavigate();\r\n\r\n    // --- CORE STATE ---\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [error, setError] = useState(null);\r\n    const [candidate, setCandidate] = useState(null);\r\n\r\n    // --- UI SELECTION STATE ---\r\n    const [ctcInput, setCtcInput] = useState('');\r\n    const [selectedEarnings, setSelectedEarnings] = useState([]);\r\n    const [selectedDeductions, setSelectedDeductions] = useState([]);\r\n    const [selectedBenefits, setSelectedBenefits] = useState([]);\r\n\r\n    // --- CALCULATION RESULT STATE ---\r\n    const [salaryData, setSalaryData] = useState({\r\n        annualCTC: 0,\r\n        locked: false,\r\n        breakdown: { earnings: [], deductions: [], benefits: [] },\r\n        totals: { netMonthly: 0, grossMonthly: 0, deductionMonthly: 0 }\r\n    });\r\n\r\n    // --- MODAL STATE ---\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [activeSection, setActiveSection] = useState(null);\r\n    const [availableComponents, setAvailableComponents] = useState({ earnings: [], deductions: [], benefits: [] });\r\n    const [tempSelectedIds, setTempSelectedIds] = useState([]);\r\n\r\n    // --- HELPERS ---\r\n    const safe = (v) => {\r\n        const n = Number(v);\r\n        return isNaN(n) ? 0 : n;\r\n    };\r\n    const formatINR = (v) => {\r\n        try {\r\n            return safe(v).toLocaleString('en-IN');\r\n        } catch (e) {\r\n            return \"0\";\r\n        }\r\n    };\r\n\r\n    const deriveCode = (c) => {\r\n        if (!c) return '';\r\n        const raw = (c.code || c.name || '').toUpperCase().trim();\r\n        if (raw.includes('BASIC')) return 'BASIC';\r\n        if (raw.includes('SPECIAL')) return 'SPECIAL_ALLOWANCE';\r\n        return raw.replace(/\\s+/g, '_').replace(/[^A-Z0-9_]/g, '');\r\n    };\r\n\r\n    // --- INITIALIZATION ---\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            try {\r\n                setLoading(true);\r\n                // 1. Fetch Candidate\r\n                const candidateRes = await api.get(`/requirements/applicants/${candidateId}`).catch(() => api.get(`/hr/employees/${candidateId}`));\r\n                const cData = candidateRes.data?.data || candidateRes.data;\r\n                setCandidate(cData);\r\n\r\n                // 2. Fetch Master Components\r\n                const [eMaster, dMaster, bMaster] = await Promise.all([\r\n                    api.get('/payroll/earnings'), api.get('/deductions'), api.get('/payroll/benefits')\r\n                ]);\r\n                setAvailableComponents({\r\n                    earnings: eMaster.data?.data || [],\r\n                    deductions: dMaster.data?.data || [],\r\n                    benefits: bMaster.data?.data || []\r\n                });\r\n\r\n                // 3. Fetch Current Snapshot/Calculation\r\n                const url = `/salary/current?applicantId=${candidateId}`;\r\n                console.log(`[DEBUG] Fetching salary from: ${url}`);\r\n                const currentRes = await api.get(url);\r\n                const sData = currentRes.data?.data;\r\n                console.log(`[DEBUG] Received salary data:`, sData);\r\n\r\n                if (sData) {\r\n                    setSalaryData({\r\n                        annualCTC: safe(sData.annualCTC),\r\n                        locked: !!sData.locked,\r\n                        breakdown: {\r\n                            earnings: sData.earnings || [],\r\n                            deductions: sData.deductions || [],\r\n                            benefits: sData.benefits || []\r\n                        },\r\n                        totals: sData.totals || { netMonthly: 0, grossMonthly: 0, deductionMonthly: 0 }\r\n                    });\r\n                    setCtcInput(sData.annualCTC ? sData.annualCTC.toString() : '');\r\n                    setSelectedEarnings(sData.earnings || []);\r\n                    setSelectedDeductions(sData.deductions || []);\r\n                    setSelectedBenefits(sData.benefits || []);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"[DEBUG] Initialization Error:\", err);\r\n                setError(\"Initialization failed: \" + err.message);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        init();\r\n    }, [candidateId]);\r\n\r\n    // --- AUTO-CALCULATION LOGIC ---\r\n    useEffect(() => {\r\n        const ctc = safe(ctcInput);\r\n        if (ctc <= 0 || salaryData.locked) return;\r\n\r\n        const timer = setTimeout(() => {\r\n            handleCalculate();\r\n        }, 800);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [ctcInput, selectedEarnings, selectedDeductions, selectedBenefits]);\r\n\r\n    const handleCalculate = async () => {\r\n        try {\r\n            const payload = {\r\n                annualCTC: safe(ctcInput),\r\n                selectedEarnings,\r\n                selectedDeductions,\r\n                selectedBenefits\r\n            };\r\n\r\n            const res = await api.post('/salary/preview', payload);\r\n            if (res.data?.success) {\r\n                const result = res.data.data;\r\n                setSalaryData({\r\n                    annualCTC: result.annualCTC || 0,\r\n                    locked: false,\r\n                    breakdown: {\r\n                        earnings: result.earnings || [],\r\n                        deductions: result.deductions || [],\r\n                        benefits: result.benefits || []\r\n                    },\r\n                    totals: result.totals || { netMonthly: 0, grossMonthly: 0, deductionMonthly: 0 }\r\n                });\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Calculation Error:\", err);\r\n            setError(\"Calculation failed: \" + (err.response?.data?.message || err.message));\r\n        }\r\n    };\r\n\r\n    // --- ACTIONS ---\r\n    const handleSaveDraft = async () => {\r\n        if (safe(salaryData.annualCTC) <= 0) return;\r\n        try {\r\n            setSaving(true);\r\n            const payload = {\r\n                applicantId: candidateId,\r\n                annualCTC: safe(ctcInput),\r\n                earnings: selectedEarnings,\r\n                deductions: selectedDeductions,\r\n                benefits: selectedBenefits\r\n            };\r\n            await api.post('/salary/assign', payload);\r\n            alert(\"Draft Saved Successfully\");\r\n        } catch (err) {\r\n            alert(\"Save Failed: \" + (err.response?.data?.message || err.message));\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleFinalize = async () => {\r\n        try {\r\n            setSaving(true);\r\n            const res = await api.post('/salary/confirm', { applicantId: candidateId });\r\n            if (res.data?.success) {\r\n                setSalaryData(p => ({ ...p, locked: true }));\r\n                alert(\"Salary Finalized & Locked!\");\r\n            }\r\n        } catch (err) {\r\n            alert(\"Lock Failed: \" + (err.response?.data?.message || err.message));\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleUnlock = async () => {\r\n        if (!window.confirm(\"Unlock this salary? All locked data will become editable.\")) return;\r\n        try {\r\n            setSaving(true);\r\n            await api.post('/salary/unlock', { applicantId: candidateId });\r\n            setSalaryData(p => ({ ...p, locked: false }));\r\n        } catch (err) {\r\n            alert(\"Unlock Failed\");\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    // --- MODAL WRANGLING ---\r\n    const openModal = (section) => {\r\n        if (salaryData.locked) return;\r\n        setActiveSection(section);\r\n        const current = section === 'Earnings' ? selectedEarnings : section === 'Deductions' ? selectedDeductions : selectedBenefits;\r\n\r\n        let codes = current.map(c => deriveCode(c));\r\n\r\n        // Auto-include mandatory codes if they are in the master list\r\n        if (section === 'Earnings') {\r\n            const masterCodes = availableComponents.earnings.map(m => deriveCode(m));\r\n            if (masterCodes.includes('BASIC') && !codes.includes('BASIC')) codes.push('BASIC');\r\n            if (masterCodes.includes('SPECIAL_ALLOWANCE') && !codes.includes('SPECIAL_ALLOWANCE')) codes.push('SPECIAL_ALLOWANCE');\r\n        }\r\n\r\n        setTempSelectedIds(codes);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const confirmSelection = () => {\r\n        const master = availableComponents[activeSection.toLowerCase()] || [];\r\n        const filtered = master.filter(m => tempSelectedIds.includes(deriveCode(m)));\r\n        if (activeSection === 'Earnings') setSelectedEarnings(filtered);\r\n        else if (activeSection === 'Deductions') setSelectedDeductions(filtered);\r\n        else setSelectedBenefits(filtered);\r\n        setShowModal(false);\r\n    };\r\n\r\n    // --- AUTO-BALANCE LOGIC (NEW) ---\r\n    // --- AUTO-BALANCE LOGIC (SMART FIT) ---\r\n    const handleAutoBalance = () => {\r\n        const ctc = safe(ctcInput);\r\n        if (ctc <= 0) return;\r\n\r\n        // 1. Calculate Limits\r\n        const basicAnnual = ctc * 0.40;\r\n        let used = basicAnnual; // Basic is mandatory\r\n\r\n        // 2. Sum up Fixed & Percentage Costs (Excluding HRA & SA)\r\n        // We will treat HRA as the variable lever to shrink\r\n        const otherEarnings = selectedEarnings.filter(e => {\r\n            const code = deriveCode(e);\r\n            return code !== 'BASIC' && code !== 'SPECIAL_ALLOWANCE' && code !== 'HOUSE_RENT_ALLOWANCE';\r\n        });\r\n\r\n        const calculateComponentCost = (list) => {\r\n            return list.reduce((sum, c) => {\r\n                const code = deriveCode(c);\r\n                if (code === 'SPECIAL_ALLOWANCE') return sum;\r\n\r\n                // Hardcoded Statutory\r\n                if (code === 'PROFESSIONAL_TAX') return sum + 2400;\r\n                if (code === 'EMPLOYER_PF' || code === 'EMPLOYEE_PF' || code === 'PF') return sum + (basicAnnual * 0.12);\r\n                if (code === 'GRATUITY') return sum + (basicAnnual * 0.0481);\r\n\r\n                // Configured\r\n                const type = (c.calculationType || c.amountType || 'FIXED').toUpperCase();\r\n                const base = (c.basedOn || c.calculationBase || 'NA').toUpperCase();\r\n                const val = safe(c.value || c.amount || c.percentage || 0);\r\n\r\n                if (type.includes('PERCENT')) {\r\n                    if (base === 'BASIC') return sum + (basicAnnual * val / 100);\r\n                    return sum + (ctc * val / 100);\r\n                } else {\r\n                    return sum + (val * 12);\r\n                }\r\n            }, 0);\r\n        };\r\n\r\n        used += calculateComponentCost(otherEarnings);\r\n        used += calculateComponentCost(selectedDeductions); // Usually PT/PF covered above but safe to run\r\n        used += calculateComponentCost(selectedBenefits);\r\n\r\n        // 3. Determine remaining space for HRA + SA\r\n        const remaining = ctc - used;\r\n\r\n        if (remaining < 0) {\r\n            alert(`Critical Error: Fixed Allocations (${formatINR(used)}) exceed CTC (${formatINR(ctc)}). Cannot balance without removing components.`);\r\n            return;\r\n        }\r\n\r\n        // 4. Adjust HRA\r\n        // Default Expectation: HRA = 50% of Basic (Standard) or 40%\r\n        // We set HRA to absorb the remaining space, leaving 0 for SA (or small buffer)\r\n        // Actually, SA is the balancer, so SA should take the dust. \r\n        // We sets HRA to \"Max possible\" or \"Standard\".\r\n\r\n        // Let's check current HRA config\r\n        const currentHRA = selectedEarnings.find(e => deriveCode(e) === 'HOUSE_RENT_ALLOWANCE');\r\n        if (currentHRA) {\r\n            // New Plan: Set HRA to (Remaining - 1200). 1200 for SA buffer (100/mo)\r\n            // If Remaining is huge, cap HRA at 50% of Basic.\r\n\r\n            const maxHRA = basicAnnual * 0.50; // Standard Cap\r\n            let newHRAValue = remaining - 1200; // Leave buffer for SA\r\n\r\n            if (newHRAValue > maxHRA) newHRAValue = maxHRA;\r\n            if (newHRAValue < 0) newHRAValue = 0;\r\n\r\n            // Update HRA to FIXED Amount to ensure stability\r\n            const updatedHRA = {\r\n                ...currentHRA,\r\n                calculationType: 'FIXED',\r\n                value: newHRAValue / 12, // Monthly Amount\r\n                amount: newHRAValue / 12,\r\n                amountType: 'FIXED',\r\n                basedOn: 'NA'\r\n            };\r\n\r\n            const newEarnings = selectedEarnings.map(e =>\r\n                deriveCode(e) === 'HOUSE_RENT_ALLOWANCE' ? updatedHRA : e\r\n            );\r\n\r\n            setSelectedEarnings(newEarnings);\r\n            // Trigger calculation\r\n            setError(null);\r\n            setTimeout(handleCalculate, 100); // Allow state to update\r\n        } else {\r\n            // No HRA found? Then the Deficit is from other things.\r\n            alert(`Cannot Auto-Balance: HRA component not found to adjust. Please reduce allowance amounts manually.`);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-6 w-full mx-auto space-y-6 bg-gray-50 min-h-screen\">\r\n            {/* Modal for Adding Components */}\r\n            {showModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm\">\r\n                    <div className=\"bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl animate-in fade-in zoom-in duration-200 flex flex-col max-h-[80vh]\">\r\n                        <div className=\"flex justify-between items-center mb-4 flex-shrink-0\">\r\n                            <h3 className=\"text-lg font-bold\">Add {activeSection}</h3>\r\n                            <button onClick={() => setShowModal(false)} className=\"p-1 hover:bg-gray-100 rounded-full\"><X size={20} /></button>\r\n                        </div>\r\n    // --- VALIDATION FOR SHIELD ---\r\n    const isSumCorrect = Math.abs(safe(salaryData.annualCTC) - safe(ctcInput)) < 2 && safe(ctcInput) > 0;\r\n    const canLock = isSumCorrect && !salaryData.locked && salaryData.breakdown.earnings.length > 0;\r\n\r\n    if (loading) return (\r\n        <div className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\r\n            <div className=\"flex flex-col items-center gap-4\">\r\n                <Database className=\"animate-spin text-blue-600\" size={48} />\r\n                <p className=\"font-black text-slate-400 animate-pulse\">LOADING ARCHITECTURE...</p>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-[#F8FAFC]\">\r\n            {error && (\r\n                <div className=\"bg-rose-600 text-white px-8 py-3 flex items-center justify-between animate-in slide-in-from-top-full duration-300\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <AlertCircle size={20} />\r\n                        <span className=\"font-bold text-sm tracking-wide\">{error}</span>\r\n                        {(error.includes('CTC') || error.includes('exceeds')) && (\r\n                            <button\r\n                                onClick={handleAutoBalance}\r\n                                className=\"ml-4 px-3 py-1 bg-white text-rose-600 rounded-lg text-xs font-black uppercase tracking-wider hover:bg-rose-50 transition-colors shadow-sm\"\r\n                            >\r\n                                AUTO BALANCE\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                    <button onClick={() => setError(null)} className=\"p-1 hover:bg-white/20 rounded-lg\"><X size={18} /></button>\r\n                </div>\r\n            )}\r\n            {/* Header */}\r\n            <header className=\"bg-white border-b border-slate-100 sticky top-0 z-40 px-8 py-4 flex items-center justify-between shadow-sm\">\r\n                <div className=\"flex items-center gap-6\">\r\n                    <button onClick={() => navigate(-1)} className=\"p-2 hover:bg-slate-50 rounded-xl transition-colors\">\r\n                        <ArrowLeft size={20} className=\"text-slate-600\" />\r\n                    </button>\r\n                    <div>\r\n                        <h1 className=\"text-lg font-black text-slate-900 uppercase tracking-tight\">{candidate?.name || 'Loading...'}</h1>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-md uppercase\">{candidate?.requirementId?.jobTitle || 'CANDIDATE'}</span>\r\n                            {salaryData.locked && <span className=\"text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-md uppercase flex items-center gap-1\"><ShieldCheck size={10} /> LOCKED</span>}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"relative group\">\r\n                        <input\r\n                            type=\"number\"\r\n                            value={ctcInput}\r\n                            disabled={salaryData.locked}\r\n                            onChange={(e) => setCtcInput(e.target.value)}\r\n                            placeholder=\"ANNUAL CTC (‚Çπ)\"\r\n                            className=\"bg-slate-50 border-2 border-slate-100 rounded-2xl px-6 py-3 font-black text-blue-900 text-lg w-48 focus:border-blue-500 focus:bg-white transition-all outline-none disabled:opacity-50\"\r\n                        />\r\n                        <div className=\"absolute -top-2 -right-2 bg-blue-600 text-white p-1.5 rounded-lg shadow-lg\">\r\n                            <IndianRupee size={12} strokeWidth={4} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={handleCalculate}\r\n                        disabled={salaryData.locked || safe(ctcInput) <= 0}\r\n                        className=\"flex items-center gap-2 px-6 py-3 bg-blue-50 text-blue-600 rounded-2xl font-black hover:bg-blue-100 transition-all disabled:opacity-30\"\r\n                    >\r\n                        <Calculator size={18} />\r\n                        CALCULATE\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={handleSaveDraft}\r\n                        disabled={salaryData.locked || saving || safe(ctcInput) <= 0}\r\n                        className=\"p-3 bg-white border-2 border-slate-100 text-slate-600 rounded-2xl hover:border-blue-200 hover:text-blue-600 transition-all disabled:opacity-30\"\r\n                    >\r\n                        <Database size={20} />\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={handleFinalize}\r\n                        disabled={!canLock || saving}\r\n                        className={`flex items-center gap-3 px-8 py-3 rounded-2xl font-black shadow-lg transition-all active:scale-95 disabled:opacity-30 ${salaryData.locked ? 'bg-emerald-500 text-white shadow-emerald-200' : 'bg-slate-900 text-white shadow-slate-200'}`}\r\n                    >\r\n                        {saving ? <Database size={20} className=\"animate-spin\" /> : (salaryData.locked ? <ShieldCheck size={20} /> : <Lock size={20} />)}\r\n                        {salaryData.locked ? 'FINALIZED' : 'FINALIZE & LOCK'}\r\n                    </button>\r\n\r\n                    {salaryData.locked && (\r\n                        <button onClick={handleUnlock} className=\"p-3 bg-orange-50 text-orange-600 rounded-2xl border-2 border-orange-100 hover:bg-orange-100 transition-all\">\r\n                            <Unlock size={20} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"max-w-[1400px] mx-auto p-8 grid grid-cols-12 gap-8\">\r\n                {/* Breakup Section */}\r\n                <div className=\"col-span-8 space-y-8\">\r\n                    {['Earnings', 'Deductions', 'Benefits'].map(section => (\r\n                        <section key={section} className=\"bg-white rounded-[32px] p-8 shadow-sm border border-slate-100\">\r\n                            <div className=\"flex items-center justify-between mb-8\">\r\n                                <h3 className=\"text-sm font-black text-slate-900 uppercase tracking-widest flex items-center gap-3\">\r\n                                    <div className={`w-2 h-6 rounded-full ${section === 'Earnings' ? 'bg-emerald-500' : section === 'Deductions' ? 'bg-rose-500' : 'bg-blue-500'}`} />\r\n                                    {section}\r\n                                </h3>\r\n                                <button\r\n                                    onClick={() => openModal(section)}\r\n                                    disabled={salaryData.locked}\r\n                                    className=\"text-[10px] font-black text-blue-600 hover:bg-blue-50 px-4 py-2 rounded-xl transition-all disabled:opacity-30\"\r\n                                >\r\n                                    MODIFY ({salaryData.breakdown[section.toLowerCase()]?.length || 0})\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                {salaryData.breakdown[section.toLowerCase()]?.map(comp => (\r\n                                    <div key={comp.code} className=\"p-4 bg-slate-50 rounded-2xl flex items-center justify-between group hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-slate-100\">\r\n                                        <div>\r\n                                            <p className=\"text-xs font-black text-slate-800 uppercase truncate\">{comp.name}</p>\r\n                                            <div className=\"flex items-center gap-2 mt-1\">\r\n                                                <span className=\"text-[9px] font-bold text-slate-400 uppercase tracking-tighter\">\r\n                                                    {comp.calculationType} {comp.basedOn !== 'NA' ? `OF ${comp.basedOn}` : ''}\r\n                                                </span>\r\n                                                {comp.code === 'SPECIAL_ALLOWANCE' && <span className=\"text-[9px] font-black text-blue-500 bg-blue-50 px-1.5 rounded uppercase\">BALANCER</span>}\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"text-right\">\r\n                                            <p className=\"font-black text-slate-900\">‚Çπ{formatINR(comp.monthly)}</p>\r\n                                            <p className=\"text-[9px] font-bold text-slate-400 uppercase tracking-tighter\">‚Çπ{formatINR(comp.yearly)} /yr</p>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </section>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Sidebar Summary */}\r\n                <div className=\"col-span-4 space-y-8 sticky top-28 h-fit\">\r\n                    <div className=\"bg-slate-900 rounded-[40px] p-8 text-white shadow-2xl relative overflow-hidden\">\r\n                        <div className=\"absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16 blur-3xl\" />\r\n                        <p className=\"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2\">Monthly Take-Home</p>\r\n                        <h2 className=\"text-5xl font-black mb-10 flex items-center gap-3\">\r\n                            ‚Çπ{formatINR(salaryData?.totals?.netMonthly || 0)}<span className=\"text-lg text-slate-500\">/mo</span>\r\n                        </h2>\r\n\r\n                        <div className=\"space-y-4 pt-8 border-t border-slate-800\">\r\n                            {[\r\n                                { label: 'Gross Income', val: salaryData?.totals?.grossMonthly || 0, color: 'text-emerald-400', icon: TrendingUp },\r\n                                { label: 'Total Deductions', val: salaryData?.totals?.deductionMonthly || 0, color: 'text-rose-400', icon: TrendingDown },\r\n                                { label: 'Annual CTC', val: salaryData?.annualCTC || 0, color: 'text-blue-400', icon: IndianRupee }\r\n                            ].map(item => (\r\n                                <div key={item.label} className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"p-2 bg-slate-800 rounded-lg\"><item.icon size={14} className={item.color} /></div>\r\n                                        <span className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest\">{item.label}</span>\r\n                                    </div>\r\n                                    <span className={`font-black ${item.color}`}>‚Çπ{formatINR(item.val)}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-blue-600 rounded-[32px] p-8 text-white shadow-lg relative cursor-help group\">\r\n                        <div className=\"flex items-center gap-4 mb-4\">\r\n                            <div className=\"p-3 bg-white/20 rounded-2xl\"><Calculator size={24} /></div>\r\n                            <h4 className=\"font-black uppercase tracking-tight text-sm\">System Status</h4>\r\n                        </div>\r\n                        <p className=\"text-[11px] font-medium leading-relaxed opacity-80\">\r\n                            Calculation Engine v9.0 Active. Every component is derived from CTC. Special Allowance adjusts automatically to ensure 100% precision.\r\n                        </p>\r\n                        <div className=\"mt-6 pt-6 border-t border-white/20 flex items-center justify-between\">\r\n                            <span className=\"text-[10px] font-black uppercase tracking-widest\">Integrity Check</span>\r\n                            {isSumCorrect ? <Check size={16} className=\"text-emerald-300\" /> : <AlertCircle size={16} className=\"text-warning-300\" />}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n\r\n            {/* Modal */}\r\n            {showModal && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-8\">\r\n                    <div className=\"absolute inset-0 bg-slate-900/40 backdrop-blur-md\" onClick={() => setShowModal(false)} />\r\n                    <div className=\"relative bg-white w-full max-w-2xl rounded-[40px] shadow-2xl overflow-hidden border border-slate-100\">\r\n                        <div className=\"p-8 border-b border-slate-50 flex items-center justify-between bg-slate-50/50\">\r\n                            <div>\r\n                                <h3 className=\"text-lg font-black text-slate-900 uppercase tracking-tight\">Modify {activeSection}</h3>\r\n                                <p className=\"text-xs text-slate-400 font-bold uppercase tracking-widest mt-1\">Select components to include in structure</p>\r\n                            </div>\r\n                            <button onClick={() => setShowModal(false)} className=\"p-3 hover:bg-white rounded-2xl border border-transparent hover:border-slate-200 transition-all\">\r\n                                <X size={20} className=\"text-slate-400\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"p-8 max-h-[500px] overflow-y-auto grid grid-cols-2 gap-4\">\r\n                            {(availableComponents[activeSection.toLowerCase()] || []).map(comp => {\r\n                                const code = deriveCode(comp);\r\n                                const isSelected = tempSelectedIds.includes(code);\r\n                                // Prevent unselecting BASIC or SPECIAL_ALLOWANCE\r\n                                const isMandatory = code === 'BASIC' || code === 'SPECIAL_ALLOWANCE';\r\n\r\n                                return (\r\n                                    <button\r\n                                        key={code}\r\n                                        disabled={isMandatory}\r\n                                        onClick={() => setTempSelectedIds(p => isSelected ? p.filter(id => id !== code) : [...p, code])}\r\n                                        className={`p-5 rounded-[24px] border-2 text-left transition-all relative overflow-hidden group ${isSelected ? 'border-blue-500 bg-blue-50/50' : 'border-slate-100 bg-white hover:border-slate-200'} ${isMandatory ? 'opacity-50 grayscale' : ''}`}\r\n                                    >\r\n                                        <p className={`font-black uppercase text-xs transition-colors ${isSelected ? 'text-blue-900' : 'text-slate-600'}`}>{comp.name}</p>\r\n                                        <p className=\"text-[10px] font-bold text-slate-400 uppercase mt-1\">\r\n                                            {comp.calculationType} {comp.calculationBase ? `OF ${comp.calculationBase}` : ''}\r\n                                        </p>\r\n                                        {isSelected && <div className=\"absolute top-4 right-4 text-blue-600\"><Check size={16} strokeWidth={3} /></div>}\r\n                                    </button>\r\n                                );\r\n                            })}\r\n                        </div>\r\n\r\n                        <div className=\"p-8 bg-slate-50/50 border-t border-slate-50 flex items-center justify-between\">\r\n                            <span className=\"text-[10px] font-black text-slate-400 uppercase\">{tempSelectedIds.length} COMPONENTS SELECTED</span>\r\n                            <button onClick={confirmSelection} className=\"px-10 py-4 bg-slate-900 text-white rounded-2xl font-black text-xs hover:bg-blue-600 transition-all shadow-xl shadow-slate-200\">\r\n                                APPLY CONFIGURATION\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\TemplatePreview.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadTemplateAndGeneratePDF'. Either include it or remove the dependency array.","line":18,"column":8,"nodeType":"ArrayExpression","endLine":18,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [loadTemplateAndGeneratePDF, templateId]","fix":{"range":[645,657],"text":"[loadTemplateAndGeneratePDF, templateId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport api from '../../utils/api';\r\nimport { ArrowLeft, Download, Eye } from 'lucide-react';\r\n\r\nexport default function TemplatePreview() {\r\n    const { templateId } = useParams();\r\n    const navigate = useNavigate();\r\n    const [template, setTemplate] = useState(null);\r\n    const [pdfUrl, setPdfUrl] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (templateId) {\r\n            loadTemplateAndGeneratePDF();\r\n        }\r\n    }, [templateId]);\r\n\r\n    const loadTemplateAndGeneratePDF = async () => {\r\n        try {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            // First get template details\r\n            const templateResponse = await api.get(`/letters/templates/${templateId}`);\r\n            const templateData = templateResponse.data;\r\n            setTemplate(templateData);\r\n\r\n            // Check template type - only WORD templates support PDF preview\r\n            if (templateData.templateType === 'WORD') {\r\n                // Check if file is available\r\n                if (templateData.hasFile === false) {\r\n                    const fileError = templateData.fileError || 'Template file not found';\r\n                    setError(`Cannot preview: ${fileError}. Please re-upload the template.`);\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n\r\n                // Get the PDF preview for WORD templates\r\n                try {\r\n                    const pdfResponse = await api.get(`/letters/templates/${templateId}/preview-pdf`, {\r\n                        responseType: 'blob',\r\n                        timeout: 60000 // 60 second timeout for PDF conversion\r\n                    });\r\n\r\n                    // Verify response is actually a PDF\r\n                    if (pdfResponse.data && pdfResponse.data.size > 0) {\r\n                        const blob = new Blob([pdfResponse.data], { type: 'application/pdf' });\r\n                        const url = window.URL.createObjectURL(blob);\r\n                        setPdfUrl(url);\r\n                    } else {\r\n                        throw new Error('PDF preview is empty');\r\n                    }\r\n                } catch (pdfError) {\r\n                    console.error('PDF preview error:', pdfError);\r\n                    const errorMessage = pdfError.response?.data?.message || \r\n                                       pdfError.message || \r\n                                       'Failed to generate PDF preview. Please ensure LibreOffice is installed on the server.';\r\n                    setError(errorMessage);\r\n                }\r\n            } else {\r\n                // HTML templates (BLANK, LETTER_PAD) - show HTML preview instead\r\n                setError('HTML templates cannot be previewed as PDF. Please use the template editor to view HTML templates.');\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error('Template load error:', error);\r\n            const errorMessage = error.response?.data?.message || \r\n                               error.response?.data?.error ||\r\n                               error.message || \r\n                               'Failed to load template. Please try again.';\r\n            setError(errorMessage);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDownload = async () => {\r\n        // Only allow download for WORD templates\r\n        if (template?.templateType !== 'WORD') {\r\n            alert('Download is only available for WORD templates.');\r\n            return;\r\n        }\r\n\r\n        if (template?.hasFile === false) {\r\n            alert('Template file is missing. Please re-upload the template.');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await api.get(`/letters/templates/${templateId}/download-pdf`, {\r\n                responseType: 'blob',\r\n                timeout: 60000 // 60 second timeout for PDF conversion\r\n            });\r\n\r\n            // Create download link\r\n            if (response.data && response.data.size > 0) {\r\n                const blob = new Blob([response.data], { type: 'application/pdf' });\r\n                const url = window.URL.createObjectURL(blob);\r\n                const link = document.createElement('a');\r\n                link.href = url;\r\n                link.download = `${template?.name || 'template'}.pdf`;\r\n                document.body.appendChild(link);\r\n                link.click();\r\n                document.body.removeChild(link);\r\n\r\n                // Clean up the blob URL\r\n                window.URL.revokeObjectURL(url);\r\n            } else {\r\n                throw new Error('Downloaded file is empty');\r\n            }\r\n        } catch (error) {\r\n            console.error('Download error:', error);\r\n            const errorMessage = error.response?.data?.message || \r\n                               error.response?.data?.error ||\r\n                               error.message || \r\n                               'Failed to download PDF';\r\n            alert(`Failed to download PDF: ${errorMessage}`);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n                    <p className=\"text-slate-600\">Converting template to PDF...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"min-h-screen bg-slate-50 flex items-center justify-center p-4\">\r\n                <div className=\"bg-white rounded-lg shadow-lg p-6 max-w-md w-full text-center\">\r\n                    <div className=\"text-red-500 mb-4\">\r\n                        <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n                        </svg>\r\n                    </div>\r\n                    <h2 className=\"text-xl font-semibold text-slate-800 mb-2\">Preview Failed</h2>\r\n                    <p className=\"text-slate-600 mb-4\">{error}</p>\r\n                    <button\r\n                        onClick={() => navigate('/hr/letter-templates')}\r\n                        className=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700\"\r\n                    >\r\n                        Back to Templates\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50\">\r\n            {/* Header */}\r\n            <div className=\"bg-white border-b border-slate-200 px-6 py-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <button\r\n                            onClick={() => navigate('/hr/letter-templates')}\r\n                            className=\"flex items-center gap-2 text-slate-600 hover:text-slate-800\"\r\n                        >\r\n                            <ArrowLeft size={20} />\r\n                            Back to Templates\r\n                        </button>\r\n                        <div className=\"h-6 w-px bg-slate-300\"></div>\r\n                        <div>\r\n                            <h1 className=\"text-xl font-semibold text-slate-800\">\r\n                                {template?.name || 'Template Preview'}\r\n                            </h1>\r\n                            <p className=\"text-sm text-slate-500\">\r\n                                {template?.type} template ‚Ä¢ {template?.templateType}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-3\">\r\n                        {template?.templateType === 'WORD' && template?.hasFile !== false && (\r\n                            <button\r\n                                onClick={handleDownload}\r\n                                className=\"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700\"\r\n                            >\r\n                                <Download size={18} />\r\n                                Download PDF\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* PDF Viewer */}\r\n            <div className=\"flex-1 p-6\">\r\n                {pdfUrl ? (\r\n                    <div className=\"bg-white rounded-lg shadow-lg overflow-hidden\">\r\n                        <iframe\r\n                            src={pdfUrl}\r\n                            className=\"w-full h-[calc(100vh-200px)] border-0\"\r\n                            title=\"PDF Preview\"\r\n                        />\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"flex items-center justify-center h-64 bg-white rounded-lg shadow-lg\">\r\n                        <div className=\"text-center text-slate-500\">\r\n                            <Eye size={48} className=\"mx-auto mb-4 opacity-50\" />\r\n                            <p>PDF preview not available</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\HR\\UserManagement.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'useContext' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":48,"suggestions":[{"messageId":"removeVar","data":{"varName":"useContext"},"fix":{"range":[35,47],"text":""},"desc":"Remove unused variable 'useContext'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useContext } from 'react';\r\nimport { Pagination } from 'antd';\r\nimport { showToast, showConfirmToast } from '../../utils/uiNotifications';\r\nimport api from '../../utils/api';\r\nimport { UIContext } from '../../context/UIContext';\r\n\r\nexport default function UserManagement() {\r\n  // const uiContext = useContext(UIContext);\r\n  // const setToast = uiContext?.setToast || (() => { });\r\n  const [employees, setEmployees] = useState([]);\r\n  const [departments, setDepartments] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editingEmployee, setEditingEmployee] = useState(null);\r\n  const [viewingEmployee, setViewingEmployee] = useState(null);\r\n  const [formData, setFormData] = useState({\r\n    firstName: '',\r\n    lastName: '',\r\n    email: '',\r\n    role: '',\r\n    department: '',\r\n    managerId: '',\r\n    contactNo: '',\r\n    jobType: 'Full-Time'\r\n  });\r\n  const [filter, setFilter] = useState({ search: '', department: '', role: '' });\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const pageSize = 10;\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n     \r\n  }, []);\r\n\r\n  async function loadData() {\r\n    try {\r\n      setLoading(true);\r\n      const [employeesRes, deptRes] = await Promise.all([\r\n        api.get('/hr/employees').catch(() => ({ data: [] })),\r\n        api.get('/hr/departments').catch(() => ({ data: [] }))\r\n      ]);\r\n      const empList =\r\n        (Array.isArray(employeesRes.data?.data) && employeesRes.data.data) ||\r\n        (Array.isArray(employeesRes.data) && employeesRes.data) ||\r\n        [];\r\n      const deptList =\r\n        (Array.isArray(deptRes.data?.data) && deptRes.data.data) ||\r\n        (Array.isArray(deptRes.data) && deptRes.data) ||\r\n        [];\r\n      setEmployees(empList);\r\n      setDepartments(deptList);\r\n    } catch (err) {\r\n      console.error('Failed to load data', err);\r\n      showToast('error', 'Error', 'Failed to load employees');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSubmit() {\r\n    try {\r\n      if (editingEmployee) {\r\n        await api.put(`/hr/employees/${editingEmployee._id}`, formData);\r\n        if (formData.managerId !== undefined) {\r\n          // Ensure we only send a raw ObjectId string (24 hex chars) or null\r\n          const raw = (formData.managerId || '').toString();\r\n          const match = raw.match(/[a-fA-F0-9]{24}/);\r\n          const sendManagerId = match ? match[0] : null;\r\n          await api.post(`/hr/employees/${editingEmployee._id}/set-manager`, {\r\n            managerId: sendManagerId\r\n          });\r\n        }\r\n        showToast('success', 'Success', 'Employee updated successfully');\r\n      } else {\r\n        await api.post('/hr/employees', formData);\r\n        showToast('success', 'Success', 'Employee created successfully');\r\n      }\r\n      setShowModal(false);\r\n      setEditingEmployee(null);\r\n      resetForm();\r\n      loadData();\r\n    } catch (err) {\r\n      console.error('Failed to save employee', err);\r\n      showToast('error', 'Error', err.response?.data?.message || err.response?.data?.error || err.message || 'Failed to save employee');\r\n    }\r\n  }\r\n\r\n  function handleDelete(id) {\r\n    showConfirmToast({\r\n      title: 'Delete Employee',\r\n      description: 'Are you sure you want to delete this employee?',\r\n      okText: 'Delete',\r\n      cancelText: 'Cancel',\r\n      danger: true,\r\n      onConfirm: async () => {\r\n        try {\r\n          await api.delete(`/hr/employees/${id}`);\r\n          showToast('success', 'Success', 'Employee deleted successfully');\r\n          loadData();\r\n        } catch (err) {\r\n          console.error('Failed to delete employee', err);\r\n          showToast('error', 'Error', 'Failed to delete employee');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  function openEditModal(emp) {\r\n    setEditingEmployee(emp);\r\n    setFormData({\r\n      firstName: emp.firstName || '',\r\n      lastName: emp.lastName || '',\r\n      email: emp.email || '',\r\n      role: emp.role || '',\r\n      department: emp.department || '',\r\n      managerId: emp.manager ? String(emp.manager._id || emp.manager) : '',\r\n      contactNo: emp.contactNo || '',\r\n      jobType: emp.jobType || 'Full-Time'\r\n    });\r\n    setShowModal(true);\r\n  }\r\n\r\n  function openCreateModal() {\r\n    setEditingEmployee(null);\r\n    resetForm();\r\n    setShowModal(true);\r\n  }\r\n\r\n  function resetForm() {\r\n    setFormData({\r\n      firstName: '',\r\n      lastName: '',\r\n      email: '',\r\n      role: '',\r\n      department: '',\r\n      managerId: '',\r\n      contactNo: '',\r\n      jobType: 'Full-Time'\r\n    });\r\n  }\r\n\r\n  const employeesList = Array.isArray(employees) ? employees : [];\r\n  const filteredEmployees = employeesList.filter(emp => {\r\n    const name = `${emp.firstName || ''} ${emp.lastName || ''}`.toLowerCase();\r\n    const searchMatch = !filter.search || name.includes(filter.search.toLowerCase()) ||\r\n      (emp.employeeId || '').toLowerCase().includes(filter.search.toLowerCase()) ||\r\n      (emp.email || '').toLowerCase().includes(filter.search.toLowerCase());\r\n    const deptMatch = !filter.department || emp.department === filter.department;\r\n    const roleMatch = !filter.role || emp.role === filter.role;\r\n    return searchMatch && deptMatch && roleMatch;\r\n  });\r\n\r\n  const uniqueRoles = [...new Set(employeesList.map(e => e.role).filter(Boolean))];\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // View Toggle Logic\r\n  // View Toggle Logic\r\n\r\n  // View Toggle Logic\r\n  if (showModal) {\r\n    // ... (Existing Edit/Create Form Logic - unchanged) ...\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex items-center gap-4 mb-4\">\r\n          <button\r\n            onClick={() => { setShowModal(false); setEditingEmployee(null); }}\r\n            className=\"p-2 hover:bg-slate-100 rounded-full transition text-slate-600\"\r\n            title=\"Back to List\"\r\n          >\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n          </button>\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-slate-900 dark:text-white\">\r\n              {editingEmployee ? 'Edit Employee' : 'Add New Employee'}\r\n            </h1>\r\n            <p className=\"text-sm text-slate-500\">Enter the details below</p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm p-6 w-full\">\r\n          <div className=\"grid grid-cols-2 gap-6\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">First Name *</label>\r\n              <input\r\n                type=\"text\"\r\n                required\r\n                value={formData.firstName}\r\n                onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Last Name *</label>\r\n              <input\r\n                type=\"text\"\r\n                required\r\n                value={formData.lastName}\r\n                onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"mt-4\">\r\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Email *</label>\r\n            <input\r\n              type=\"email\"\r\n              required\r\n              value={formData.email}\r\n              onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n              className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-6 mt-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Role</label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.role}\r\n                onChange={(e) => setFormData({ ...formData, role: e.target.value })}\r\n                placeholder=\"e.g., CEO, HR Manager, Team Lead\"\r\n                className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Department</label>\r\n              <select\r\n                value={formData.department}\r\n                onChange={(e) => setFormData({ ...formData, department: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n              >\r\n                <option value=\"\">Select Department</option>\r\n                {departments.map(dept => (\r\n                  <option key={dept._id} value={dept.name}>{dept.name}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-6 mt-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Contact Number</label>\r\n              <input\r\n                type=\"tel\"\r\n                value={formData.contactNo}\r\n                onChange={(e) => setFormData({ ...formData, contactNo: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Job Type</label>\r\n              <select\r\n                value={formData.jobType}\r\n                onChange={(e) => setFormData({ ...formData, jobType: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n              >\r\n                <option value=\"Full-Time\">Full-Time</option>\r\n                <option value=\"Part-Time\">Part-Time</option>\r\n                <option value=\"Internship\">Internship</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"mt-4\">\r\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Reports To</label>\r\n            <select\r\n              value={formData.managerId}\r\n              onChange={(e) => setFormData({ ...formData, managerId: e.target.value })}\r\n              className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n            >\r\n              <option value=\"\">‚Äî No Manager (Top Level) ‚Äî</option>\r\n              {employeesList\r\n                .filter(e => !editingEmployee || String(e._id) !== String(editingEmployee._id))\r\n                .filter(e => !formData.department || String(e.department) === String(formData.department))\r\n                .map(emp => (\r\n                  <option key={emp._id} value={emp._id}>\r\n                    {emp.firstName} {emp.lastName} ({emp.employeeId}) - {emp.role || 'Employee'}\r\n                  </option>\r\n                ))}\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"flex justify-end gap-3 pt-6 mt-6 border-t border-slate-200 dark:border-slate-700\">\r\n            <button\r\n              onClick={() => {\r\n                setShowModal(false);\r\n                setEditingEmployee(null);\r\n              }}\r\n              className=\"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\r\n              onClick={handleSubmit}\r\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\r\n            >\r\n              {editingEmployee ? 'Update Employee' : 'Create Employee'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Profile View Logic\r\n  if (viewingEmployee) {\r\n    const managerName = viewingEmployee.manager\r\n      ? `${viewingEmployee.manager.firstName} ${viewingEmployee.manager.lastName}`\r\n      : '‚Äî';\r\n\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex items-center gap-4 mb-4\">\r\n          <button\r\n            onClick={() => setViewingEmployee(null)}\r\n            className=\"p-2 hover:bg-slate-100 rounded-full transition text-slate-600\"\r\n            title=\"Back to List\"\r\n          >\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n          </button>\r\n          <h1 className=\"text-3xl font-bold text-slate-900 dark:text-white\">Employee Profile</h1>\r\n        </div>\r\n\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden w-full mt-8\">\r\n          <div className=\"px-8 py-8\">\r\n            <div className=\"flex flex-col md:flex-row items-center gap-6 mb-8 border-b border-slate-100 dark:border-slate-700 pb-8\">\r\n              <div className=\"w-32 h-32 rounded-full border-4 border-slate-50 dark:border-slate-700 bg-slate-100 flex items-center justify-center text-slate-400 text-4xl font-bold shadow-sm overflow-hidden\">\r\n                {viewingEmployee.profilePic ? (\r\n                  <img\r\n                    src={viewingEmployee.profilePic}\r\n                    alt={`${viewingEmployee.firstName} ${viewingEmployee.lastName}`}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                ) : (\r\n                  <span>{viewingEmployee.firstName[0]}{viewingEmployee.lastName[0]}</span>\r\n                )}\r\n              </div>\r\n              <div className=\"text-center md:text-left\">\r\n                <h2 className=\"text-3xl font-bold text-slate-900 dark:text-white\">\r\n                  {viewingEmployee.firstName} {viewingEmployee.lastName}\r\n                </h2>\r\n                <p className=\"text-slate-500 dark:text-slate-400 font-medium text-lg mt-1\">\r\n                  {viewingEmployee.role || 'No Role Assigned'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n              {/* Personal Details */}\r\n              <div className=\"space-y-4\">\r\n                <h3 className=\"text-lg font-semibold text-slate-900 dark:text-white border-b border-slate-200 dark:border-slate-700 pb-2\">\r\n                  Contact Information\r\n                </h3>\r\n                <div className=\"grid grid-cols-[120px_1fr] gap-y-3\">\r\n                  <span className=\"text-slate-500 dark:text-slate-400 text-sm\">Email</span>\r\n                  <span className=\"text-slate-900 dark:text-white font-medium\">{viewingEmployee.email}</span>\r\n\r\n                  <span className=\"text-slate-500 dark:text-slate-400 text-sm\">Phone</span>\r\n                  <span className=\"text-slate-900 dark:text-white font-medium\">{viewingEmployee.contactNo || '‚Äî'}</span>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Work Details */}\r\n              <div className=\"space-y-4\">\r\n                <h3 className=\"text-lg font-semibold text-slate-900 dark:text-white border-b border-slate-200 dark:border-slate-700 pb-2\">\r\n                  Work Details\r\n                </h3>\r\n                <div className=\"grid grid-cols-[120px_1fr] gap-y-3\">\r\n                  <span className=\"text-slate-500 dark:text-slate-400 text-sm\">Employee ID</span>\r\n                  <span className=\"text-slate-900 dark:text-white font-medium\">{viewingEmployee.employeeId}</span>\r\n\r\n                  <span className=\"text-slate-500 dark:text-slate-400 text-sm\">Department</span>\r\n                  <span className=\"text-slate-900 dark:text-white font-medium\">{viewingEmployee.department || '‚Äî'}</span>\r\n\r\n                  <span className=\"text-slate-500 dark:text-slate-400 text-sm\">Job Type</span>\r\n                  <span className=\"text-slate-900 dark:text-white font-medium\">\r\n                    <span className=\"px-2 py-0.5 rounded-full bg-slate-100 dark:bg-slate-700 text-xs\">\r\n                      {viewingEmployee.jobType || 'Full-Time'}\r\n                    </span>\r\n                  </span>\r\n\r\n                  <span className=\"text-slate-500 dark:text-slate-400 text-sm\">Manager</span>\r\n                  <span className=\"text-slate-900 dark:text-white font-medium\">{managerName}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 w-full\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-slate-900 dark:text-white\">User Management</h1>\r\n          <p className=\"text-sm text-slate-600 dark:text-slate-400 mt-1\">Manage all employees in your organization</p>\r\n        </div>\r\n        <button\r\n          onClick={openCreateModal}\r\n          className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\r\n        >\r\n          + Add Employee\r\n        </button>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm p-4\">\r\n        {/* ... (Previous Filter Code Unchanged - relying on original file content if not explicit here) ... */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Search</label>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Search by name, ID, or email...\"\r\n              value={filter.search}\r\n              onChange={(e) => setFilter({ ...filter, search: e.target.value })}\r\n              className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Department</label>\r\n            <select\r\n              value={filter.department}\r\n              onChange={(e) => setFilter({ ...filter, department: e.target.value })}\r\n              className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n            >\r\n              <option value=\"\">All Departments</option>\r\n              {departments.map(dept => (\r\n                <option key={dept._id} value={dept.name}>{dept.name}</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Role</label>\r\n            <select\r\n              value={filter.role}\r\n              onChange={(e) => setFilter({ ...filter, role: e.target.value })}\r\n              className=\"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white\"\r\n            >\r\n              <option value=\"\">All Roles</option>\r\n              {uniqueRoles.map(role => (\r\n                <option key={role} value={role}>{role}</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Employee Table */}\r\n      <div className=\"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden\">\r\n        <div className=\"px-6 py-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900\">\r\n          <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white\">\r\n            Employees ({filteredEmployees.length})\r\n          </h2>\r\n        </div>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"w-full\">\r\n            <thead className=\"bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700\">\r\n              <tr>\r\n                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase\">Name</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase\">Employee ID</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase\">Email</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase\">Role</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase\">Department</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase\">Manager</th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase\">Actions</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-slate-200 dark:divide-slate-700\">\r\n              {filteredEmployees.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={7} className=\"px-6 py-8 text-center text-slate-500 dark:text-slate-400\">\r\n                    No employees found\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                filteredEmployees.slice((currentPage - 1) * pageSize, currentPage * pageSize).map(emp => {\r\n                  const manager = employees.find(e => String(e._id) === String(emp.manager));\r\n                  return (\r\n                    <tr key={emp._id} className=\"hover:bg-slate-50 dark:hover:bg-slate-900 transition\">\r\n                      <td className=\"px-6 py-4 text-sm font-medium text-slate-900 dark:text-white whitespace-nowrap\">\r\n                        {emp.firstName} {emp.lastName}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 text-sm text-slate-600 dark:text-slate-400 whitespace-nowrap\">{emp.employeeId}</td>\r\n                      <td className=\"px-6 py-4 text-sm text-slate-600 dark:text-slate-400 whitespace-nowrap\">{emp.email || '‚Äî'}</td>\r\n                      <td className=\"px-6 py-4 text-sm text-slate-600 dark:text-slate-400 whitespace-nowrap\">{emp.role || '‚Äî'}</td>\r\n                      <td className=\"px-6 py-4 text-sm text-slate-600 dark:text-slate-400 whitespace-nowrap\">{emp.department || '‚Äî'}</td>\r\n                      <td className=\"px-6 py-4 text-sm text-slate-600 dark:text-slate-400 whitespace-nowrap\">\r\n                        {manager ? `${manager.firstName} ${manager.lastName}` : '‚Äî'}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 text-sm flex gap-2\">\r\n                        <button\r\n                          onClick={() => setViewingEmployee(emp)}\r\n                          className=\"px-3 py-1 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition\"\r\n                        >\r\n                          View\r\n                        </button>\r\n                        <button\r\n                          onClick={() => openEditModal(emp)}\r\n                          className=\"px-3 py-1 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded hover:bg-blue-100 dark:hover:bg-blue-900/50 transition\"\r\n                        >\r\n                          Edit\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleDelete(emp._id)}\r\n                          className=\"px-3 py-1 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded hover:bg-red-100 dark:hover:bg-red-900/50 transition\"\r\n                        >\r\n                          Delete\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        <div className=\"px-6 py-4 border-t border-slate-200 dark:border-slate-700 flex justify-end\">\r\n          <Pagination\r\n            current={currentPage}\r\n            pageSize={pageSize}\r\n            total={filteredEmployees.length}\r\n            onChange={(page) => setCurrentPage(page)}\r\n            showSizeChanger={false}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\JobApplication\\JobApplication.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRequirementDetails'. Either include it or remove the dependency array.","line":43,"column":6,"nodeType":"ArrayExpression","endLine":43,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRequirementDetails, requirementId, tenantId]","fix":{"range":[1392,1417],"text":"[fetchRequirementDetails, requirementId, tenantId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData.name'. Either include it or remove the dependency array.","line":54,"column":6,"nodeType":"ArrayExpression","endLine":54,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [formData.name, user]","fix":{"range":[1653,1659],"text":"[formData.name, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useSearchParams, useParams, useNavigate } from 'react-router-dom';\r\nimport api from '../../utils/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { getTenantId, getCompany } from '../../utils/auth';\r\nimport { DatePicker } from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport {\r\n  ArrowLeft, Send, CheckCircle2, User,\r\n  Mail, Phone, MapPin, Calendar, FileText,\r\n  ShieldCheck, UploadCloud\r\n} from 'lucide-react';\r\n\r\nexport default function JobApplication() {\r\n  const [searchParams] = useSearchParams();\r\n  const { requirementId: paramReqId } = useParams();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n\r\n  const requirementId = paramReqId || searchParams.get('requirementId');\r\n  const tenantId = searchParams.get('tenantId') || getTenantId();\r\n  const company = getCompany();\r\n\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    fatherName: '',\r\n    email: '',\r\n    mobile: '',\r\n    dob: '',\r\n    workLocation: '',\r\n    address: '',\r\n    resume: null,\r\n    consent: true\r\n  });\r\n\r\n  const [requirement, setRequirement] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [submitted, setSubmitted] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  useEffect(() => {\r\n    if (requirementId && tenantId) fetchRequirementDetails();\r\n  }, [requirementId, tenantId]);\r\n\r\n  useEffect(() => {\r\n    if (user && !formData.name) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        name: user.name || '',\r\n        email: user.email || '',\r\n        mobile: user.mobile || '',\r\n      }));\r\n    }\r\n  }, [user]);\r\n\r\n  const fetchRequirementDetails = async () => {\r\n    try {\r\n      const res = await api.get(`/public/job/${requirementId}?tenantId=${tenantId}`);\r\n      setRequirement(res.data);\r\n    } catch (err) { console.error(err); }\r\n  };\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({ ...prev, [name]: value }));\r\n  };\r\n\r\n  const handleFileChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file && (file.type === 'application/pdf' || file.type.includes('word')) && file.size < 5 * 1024 * 1024) {\r\n      setFormData(prev => ({ ...prev, resume: file }));\r\n      setError('');\r\n    } else {\r\n      setError('Please upload a PDF or Word file under 5MB.');\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const submitData = new FormData();\r\n      submitData.append('requirementId', requirementId);\r\n      submitData.append('tenantId', tenantId);\r\n\r\n      Object.keys(formData).forEach(key => {\r\n        if (key === 'resume') {\r\n          if (formData.resume) submitData.append('resume', formData.resume);\r\n        } else if (formData[key] !== null && formData[key] !== undefined) {\r\n          submitData.append(key, formData[key]);\r\n        }\r\n      });\r\n\r\n      await api.post('/public/apply-job', submitData, {\r\n        headers: { 'Content-Type': 'multipart/form-data', 'X-Tenant-ID': tenantId }\r\n      });\r\n      setSubmitted(true);\r\n    } catch (err) {\r\n      setError(err.response?.data?.error || 'Failed to submit application.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleBack = () => {\r\n    if (company && company.code) {\r\n      navigate(`/jobs/${company.code}`);\r\n    } else if (tenantId) {\r\n      navigate(`/jobs/${tenantId}`);\r\n    } else {\r\n      navigate('/');\r\n    }\r\n  };\r\n\r\n  if (submitted) return (\r\n    <div className=\"min-h-screen bg-[#F8FAFC] flex items-center justify-center p-6\">\r\n      <div className=\"max-w-md w-full bg-white rounded-[3rem] p-12 text-center shadow-2xl shadow-blue-500/10 border border-gray-100 animate-fade-in\">\r\n        <div className=\"w-20 h-20 bg-emerald-50 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-8 shadow-inner ring-8 ring-emerald-50\">\r\n          <CheckCircle2 className=\"w-10 h-10\" />\r\n        </div>\r\n        <h2 className=\"text-3xl font-black text-gray-900 tracking-tight\">Applied Successfully!</h2>\r\n        <p className=\"text-gray-500 font-medium mt-4 leading-relaxed\">\r\n          Your application for <span className=\"text-blue-600 font-bold\">{requirement?.jobTitle}</span> has been submitted. We'll be in touch soon.\r\n        </p>\r\n        <button\r\n          onClick={() => navigate('/candidate/dashboard')}\r\n          className=\"mt-10 w-full bg-gray-900 text-white py-5 rounded-2xl font-black shadow-xl shadow-gray-200 hover:bg-black transition-all active:scale-95 flex items-center justify-center gap-2\"\r\n        >\r\n          Go to Dashboard <ArrowLeft className=\"w-4 h-4 rotate-180\" />\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-[#F8FAFC] font-sans pb-20\">\r\n\r\n      {/* Navigation Header */}\r\n      <nav className=\"h-20 bg-white/70 backdrop-blur-xl border-b border-gray-100 flex items-center px-6 lg:px-12 sticky top-0 z-50\">\r\n        <button\r\n          onClick={handleBack}\r\n          className=\"flex items-center gap-2 text-gray-500 hover:text-blue-600 font-black text-sm uppercase tracking-widest transition-all group\"\r\n        >\r\n          <div className=\"bg-gray-50 p-2 rounded-xl group-hover:bg-blue-50 transition-colors\">\r\n            <ArrowLeft className=\"w-5 h-5\" />\r\n          </div>\r\n          <span>Return to Careers</span>\r\n        </button>\r\n      </nav>\r\n\r\n      <div className=\"max-w-5xl mx-auto px-6 py-12 lg:py-16\">\r\n\r\n        {/* Main Content Card */}\r\n        <div className=\"bg-white rounded-[2.5rem] shadow-2xl shadow-blue-900/5 border border-gray-100 overflow-hidden relative animate-fade-in\">\r\n\r\n          {/* Form Header */}\r\n          <div className=\"bg-gradient-to-r from-blue-700 via-indigo-600 to-purple-600 px-10 py-12 text-white relative\">\r\n            <div className=\"absolute top-0 right-0 p-10 opacity-10\">\r\n              <Send className=\"w-24 h-24\" />\r\n            </div>\r\n            <div className=\"relative z-10\">\r\n              <p className=\"text-xs font-black uppercase tracking-[0.2em] text-blue-100/60 mb-2\">Job Application</p>\r\n              <h1 className=\"text-4xl font-black tracking-tight leading-tight\">\r\n                Join our team as<br />\r\n                <span className=\"text-blue-100\">\"{requirement?.jobTitle || 'Role'}\"</span>\r\n              </h1>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Application Form */}\r\n          <form onSubmit={handleSubmit} className=\"p-10 lg:p-12\">\r\n\r\n            {error && (\r\n              <div className=\"mb-8 p-5 bg-rose-50 border border-rose-100 text-rose-600 rounded-2xl text-sm font-bold flex items-center gap-3\">\r\n                <ShieldCheck className=\"w-5 h-5\" /> {error}\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"space-y-12\">\r\n\r\n              {/* Personal Details */}\r\n              <section className=\"space-y-8\">\r\n                <div className=\"flex items-center gap-3 border-b border-gray-100 pb-4\">\r\n                  <User className=\"w-5 h-5 text-blue-600\" />\r\n                  <h3 className=\"text-lg font-black text-gray-900 uppercase tracking-widest text-xs\">Personal Information</h3>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                  {[\r\n                    { label: \"Full Person Name\", name: \"name\", icon: User, placeholder: \"John Doe\" },\r\n                    { label: \"Father's Full Name\", name: \"fatherName\", icon: User, placeholder: \"Sr. John Doe\" },\r\n                    { label: \"Email Address\", name: \"email\", icon: Mail, type: \"email\", placeholder: \"john@email.com\" },\r\n                    { label: \"Contact Phone\", name: \"mobile\", icon: Phone, placeholder: \"+91 98765 43210\" },\r\n                  ].map((field, idx) => (\r\n                    <div key={idx} className=\"space-y-2\">\r\n                      <label className=\"text-xs font-black text-gray-400 uppercase tracking-widest ml-1\">{field.label} *</label>\r\n                      <div className=\"relative group\">\r\n                        <field.icon className=\"absolute left-5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-300 group-focus-within:text-blue-600 transition-colors\" />\r\n                        <input\r\n                          name={field.name}\r\n                          type={field.type || \"text\"}\r\n                          required\r\n                          value={formData[field.name]}\r\n                          onChange={handleInputChange}\r\n                          placeholder={field.placeholder}\r\n                          className=\"w-full bg-gray-50/50 border border-gray-100 rounded-2xl pl-12 pr-6 py-4 text-sm font-bold text-gray-700 focus:outline-none focus:ring-4 focus:ring-blue-500/5 focus:border-blue-500 transition-all\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-xs font-black text-gray-400 uppercase tracking-widest ml-1\">Date of Birth *</label>\r\n                    <div className=\"relative group active-datepicker\">\r\n                      <Calendar className=\"absolute left-5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-300 z-10\" />\r\n                      <DatePicker\r\n                        className=\"w-full bg-gray-50/50 border border-gray-100 rounded-2xl pl-12 pr-6 py-4 text-sm font-bold text-gray-700 shadow-none border hover:border-blue-500 focus:border-blue-500 transition-all custom-picker\"\r\n                        format=\"DD-MM-YYYY\"\r\n                        placeholder=\"Select Date\"\r\n                        value={formData.dob ? dayjs(formData.dob) : null}\r\n                        onChange={(date) => setFormData(prev => ({ ...prev, dob: date ? date.format('YYYY-MM-DD') : '' }))}\r\n                        allowClear={false}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-xs font-black text-gray-400 uppercase tracking-widest ml-1\">Current Work Location</label>\r\n                    <div className=\"relative group\">\r\n                      <MapPin className=\"absolute left-5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-300\" />\r\n                      <input\r\n                        name=\"workLocation\"\r\n                        value={formData.workLocation}\r\n                        onChange={handleInputChange}\r\n                        placeholder=\"City, India\"\r\n                        className=\"w-full bg-gray-50/50 border border-gray-100 rounded-2xl pl-12 pr-6 py-4 text-sm font-bold text-gray-700 focus:outline-none focus:ring-4 focus:ring-blue-500/5 focus:border-blue-500 transition-all\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"md:col-span-2 space-y-2\">\r\n                    <label className=\"text-xs font-black text-gray-400 uppercase tracking-widest ml-1\">Permanent Address *</label>\r\n                    <textarea\r\n                      name=\"address\"\r\n                      required\r\n                      rows={3}\r\n                      value={formData.address}\r\n                      onChange={handleInputChange}\r\n                      placeholder=\"Type your complete home address...\"\r\n                      className=\"w-full bg-gray-50/50 border border-gray-100 rounded-[1.5rem] px-6 py-4 text-sm font-bold text-gray-700 focus:outline-none focus:ring-4 focus:ring-blue-500/5 focus:border-blue-500 transition-all resize-none\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </section>\r\n\r\n              {/* Resume Section */}\r\n              <section className=\"space-y-8\">\r\n                <div className=\"flex items-center gap-3 border-b border-gray-100 pb-4\">\r\n                  <FileText className=\"w-5 h-5 text-blue-600\" />\r\n                  <h3 className=\"text-lg font-black text-gray-900 uppercase tracking-widest text-xs\">Resume Upload</h3>\r\n                </div>\r\n\r\n                <div className=\"relative group\">\r\n                  <input\r\n                    type=\"file\"\r\n                    accept=\".pdf,.doc,.docx\"\r\n                    id=\"resume-upload\"\r\n                    className=\"hidden\"\r\n                    onChange={handleFileChange}\r\n                  />\r\n                  <label\r\n                    htmlFor=\"resume-upload\"\r\n                    className=\"flex flex-col items-center justify-center border-4 border-dashed border-gray-100 rounded-[2.5rem] p-12 hover:border-blue-500 hover:bg-blue-50/30 transition-all cursor-pointer group\"\r\n                  >\r\n                    <div className=\"w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 group-hover:bg-blue-600 group-hover:text-white transition-all shadow-sm ring-8 ring-blue-50\">\r\n                      <UploadCloud className=\"w-8 h-8\" />\r\n                    </div>\r\n                    <span className=\"text-lg font-black text-gray-900 tracking-tight\">\r\n                      {formData.resume ? formData.resume.name : 'Choose Resume / Drag PDF/Word'}\r\n                    </span>\r\n                    <p className=\"text-xs text-gray-400 font-bold mt-2 uppercase tracking-widest\">\r\n                      {formData.resume ? 'Click to replace file' : 'Maximum size 5MB (PDF/Word only)'}\r\n                    </p>\r\n                  </label>\r\n                </div>\r\n              </section>\r\n\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className=\"w-full bg-gradient-to-r from-blue-700 to-indigo-700 text-white py-6 rounded-[1.8rem] font-black shadow-2xl shadow-blue-500/30 hover:shadow-blue-500/50 hover:-translate-y-1 transition-all active:scale-95 disabled:opacity-50 text-lg flex items-center justify-center gap-3\"\r\n              >\r\n                {loading ? 'Submitting Application...' : 'Send Application Now'} <Send className=\"w-5 h-5\" />\r\n              </button>\r\n\r\n            </div>\r\n          </form>\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\JobApplication\\JobsList.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'resolvedTenantId'. Either include it or remove the dependency array.","line":90,"column":8,"nodeType":"ArrayExpression","endLine":90,"endColumn":67,"suggestions":[{"desc":"Update the dependencies array to be: [companyCode, tenantIdQuery, isInitialized, user, navigate, resolvedTenantId]","fix":{"range":[3331,3390],"text":"[companyCode, tenantIdQuery, isInitialized, user, navigate, resolvedTenantId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useSearchParams, Link, useParams, useNavigate } from 'react-router-dom';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\nimport api from '../../utils/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport {\r\n    Search,\r\n    Briefcase,\r\n    Clock,\r\n    ArrowRight,\r\n    Star,\r\n    Zap,\r\n    Users,\r\n    Globe,\r\n    Calendar\r\n} from 'lucide-react';\r\n\r\nexport default function JobsList() {\r\n    const [searchParams] = useSearchParams();\r\n    const { companyId } = useParams();\r\n    const companyCode = companyId;\r\n    const tenantIdQuery = searchParams.get('tenantId');\r\n    const [jobs, setJobs] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    const navigate = useNavigate();\r\n    const { user, isInitialized, logout } = useAuth();\r\n\r\n    const [resolvedTenantId, setResolvedTenantId] = useState(tenantIdQuery || null);\r\n    const [myApplications, setMyApplications] = useState(new Set());\r\n    const [companyName, setCompanyName] = useState('');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [filterDept, setFilterDept] = useState('All Departments');\r\n    const [filterExp, setFilterExp] = useState('All Experience');\r\n    const [filterType, setFilterType] = useState('All Types');\r\n    const [candidateName, setCandidateName] = useState(user?.name || '');\r\n\r\n    useEffect(() => {\r\n        if (user?.name) setCandidateName(user.name);\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        async function init() {\r\n            let tid = resolvedTenantId;\r\n            if (!tid && companyCode) {\r\n                try {\r\n                    const res = await api.get(`/public/resolve-code/${companyCode}`);\r\n                    tid = res.data.tenantId;\r\n                    setResolvedTenantId(tid);\r\n                    setCompanyName(res.data.companyName);\r\n                } catch (e) {\r\n                    console.error(\"Resolve error:\", e);\r\n                    setError(e.response?.data?.error || e.message || 'Invalid Company Link');\r\n                    return;\r\n                }\r\n            }\r\n\r\n            if (!tid) {\r\n                setError('Missing Company Information');\r\n                return;\r\n            }\r\n\r\n            setLoading(true);\r\n            try {\r\n                const jobsRes = await api.get(`/public/jobs?tenantId=${tid}`);\r\n                setJobs(jobsRes.data || []);\r\n\r\n                if (user && user.role === 'candidate') {\r\n                    const dashRes = await api.get('/candidate/dashboard');\r\n                    if (dashRes.data.applications) {\r\n                        const appSet = new Set(dashRes.data.applications.map(app => app.requirementId?._id || app.requirementId));\r\n                        setMyApplications(appSet);\r\n                    }\r\n                    if (dashRes.data.profile?.name) {\r\n                        setCandidateName(dashRes.data.profile.name);\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                console.error(err);\r\n                setError('Failed to load portal data.');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        }\r\n\r\n        if (isInitialized) {\r\n            init();\r\n        }\r\n    }, [companyCode, tenantIdQuery, isInitialized, user, navigate]);\r\n\r\n    // Filtering logic\r\n    const filteredJobs = jobs.filter(job => {\r\n        const matchesSearch = job.jobTitle.toLowerCase().includes(searchTerm.toLowerCase());\r\n        const matchesDept = filterDept === 'All Departments' || job.department === filterDept;\r\n        return matchesSearch && matchesDept;\r\n    });\r\n\r\n    const departments = ['All Departments', ...new Set(jobs.map(j => j.department))];\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n                <div className=\"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center border border-gray-100\">\r\n                    <div className=\"w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                        <Zap size={32} />\r\n                    </div>\r\n                    <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Oops!</h2>\r\n                    <p className=\"text-gray-600 mb-6\">{error}</p>\r\n                    <button\r\n                        onClick={() => window.location.reload()}\r\n                        className=\"w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition\"\r\n                    >\r\n                        Try Again\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-[#FDFDFF] text-gray-900 font-sans selection:bg-blue-100 selection:text-blue-900\">\r\n            {/* Navbar (Over Hero) */}\r\n            <nav className=\"absolute top-0 left-0 right-0 z-50 bg-transparent\">\r\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n                    <div className=\"flex justify-end items-center h-20\">\r\n                        {user ? (\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <span className=\"text-white font-bold opacity-90\">Hi, {candidateName || 'Candidate'}</span>\r\n                                <div className=\"h-4 w-px bg-white/30 hidden sm:block\"></div>\r\n                                <Link to=\"/candidate/dashboard\" className=\"text-white font-bold hover:underline underline-offset-4\">Dashboard</Link>\r\n                                <button onClick={logout} className=\"px-5 py-2.5 bg-white/20 hover:bg-white text-white hover:text-gray-900 rounded-xl text-sm font-bold transition\">Sign Out</button>\r\n                            </div>\r\n                        ) : (\r\n                            <Link\r\n                                to={`/candidate/login?tenantId=${resolvedTenantId}`}\r\n                                className=\"px-6 py-2.5 bg-white text-gray-900 rounded-full text-sm font-bold hover:bg-gray-100 transition shadow-lg shadow-black/10\"\r\n                            >\r\n                                Candidate Login\r\n                            </Link>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </nav>\r\n\r\n            {/* Hero Section - Matching Screenshot Gradient */}\r\n            <section className=\"relative pt-32 pb-44 overflow-hidden bg-gradient-to-r from-[#4F46E5] via-[#9333EA] to-[#EC4899]\">\r\n                {/* Decorative Circles */}\r\n                <div className=\"absolute top-0 right-0 w-[400px] h-[400px] bg-white/10 rounded-full blur-[80px] -translate-y-1/2 translate-x-1/2\"></div>\r\n                <div className=\"absolute bottom-0 left-0 w-[300px] h-[300px] bg-blue-400/20 rounded-full blur-[60px] translate-y-1/2 -translate-x-1/2\"></div>\r\n\r\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10\">\r\n                    <div className=\"text-center max-w-3xl mx-auto text-white\">\r\n                        <h1 className=\"text-5xl sm:text-7xl font-black mb-6 tracking-tight drop-shadow-sm\">\r\n                            {companyName || 'Test'} Careers\r\n                        </h1>\r\n                        <p className=\"text-xl text-white/90 font-medium mb-10 leading-relaxed max-w-2xl mx-auto\">\r\n                            Join our team and build your future with us. We are looking for passionate individuals to help us shape the future.\r\n                        </p>\r\n                        <button\r\n                            onClick={() => document.getElementById('search-filters').scrollIntoView({ behavior: 'smooth' })}\r\n                            className=\"px-8 py-3.5 bg-white text-gray-900 rounded-full font-bold shadow-xl hover:shadow-2xl transition-all active:scale-95 text-lg\"\r\n                        >\r\n                            View Open Positions\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* Search & Filters - Floating Over Hero */}\r\n            <section id=\"search-filters\" className=\"relative z-20 -mt-16 mb-20 px-4\">\r\n                <div className=\"max-w-6xl mx-auto\">\r\n                    <div className=\"bg-white p-4 rounded-3xl shadow-[0_25px_50px_-12px_rgba(0,0,0,0.1)] border border-gray-100 flex flex-col md:flex-row items-stretch gap-4\">\r\n                        <div className=\"flex-1 relative\">\r\n                            <Search className=\"absolute left-6 top-1/2 -translate-y-1/2 text-gray-400\" size={20} />\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Search by job title or keyword...\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                                className=\"w-full pl-16 pr-8 py-5 bg-gray-50/50 rounded-2xl border-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all text-lg font-medium outline-none\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\r\n                            <select\r\n                                value={filterDept}\r\n                                onChange={(e) => setFilterDept(e.target.value)}\r\n                                className=\"pl-6 pr-10 py-5 bg-gray-50/50 rounded-2xl border-none focus:ring-2 focus:ring-blue-500 font-bold text-gray-700 appearance-none bg-[url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M5%207.5L10%2012.5L15%207.5%22%20stroke%3D%22%236B7280%22%20stroke-width%3D%221.66667%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22/%3E%3C/svg%3E')] bg-[length:20px] bg-[right_1.5rem_center] bg-no-repeat\"\r\n                            >\r\n                                {departments.map(d => <option key={d} value={d}>{d}</option>)}\r\n                            </select>\r\n                            <select value={filterExp} onChange={(e) => setFilterExp(e.target.value)} className=\"pl-6 pr-10 py-5 bg-gray-50/50 rounded-2xl border-none focus:ring-2 focus:ring-blue-500 font-bold text-gray-700 appearance-none bg-[url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M5%207.5L10%2012.5L15%207.5%22%20stroke%3D%22%236B7280%22%20stroke-width%3D%221.66667%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22/%3E%3C/svg%3E')] bg-[length:20px] bg-[right_1.5rem_center] bg-no-repeat\">\r\n                                <option>All Experience</option>\r\n                                <option>0-2 Years</option>\r\n                                <option>3-5 Years</option>\r\n                                <option>5+ Years</option>\r\n                            </select>\r\n                            <select value={filterType} onChange={(e) => setFilterType(e.target.value)} className=\"pl-6 pr-10 py-5 bg-gray-50/50 rounded-2xl border-none focus:ring-2 focus:ring-blue-500 font-bold text-gray-700 appearance-none bg-[url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M5%207.5L10%2012.5L15%207.5%22%20stroke%3D%22%236B7280%22%20stroke-width%3D%221.66667%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22/%3E%3C/svg%3E')] bg-[length:20px] bg-[right_1.5rem_center] bg-no-repeat\">\r\n                                <option>All Types</option>\r\n                                <option>Full Time</option>\r\n                                <option>Remote</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* Jobs Board */}\r\n            <section className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10\">\r\n                <div className=\"flex lg:items-center justify-between mb-12 flex-col lg:flex-row gap-4\">\r\n                    <h2 className=\"text-4xl font-black text-gray-900 tracking-tight\">Open Positions</h2>\r\n                    <div className=\"bg-blue-50 text-blue-700 font-bold px-4 py-1.5 rounded-full text-sm self-start lg:self-center\">\r\n                        {loading ? '...' : filteredJobs.length} Jobs Found\r\n                    </div>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n                        {[1, 2, 3].map(i => (\r\n                            <div key={i} className=\"bg-white rounded-[2rem] p-8 border border-gray-100 animate-pulse h-80\"></div>\r\n                        ))}\r\n                    </div>\r\n                ) : filteredJobs.length === 0 ? (\r\n                    <div className=\"bg-white rounded-[3rem] p-20 text-center border-2 border-dashed border-gray-200\">\r\n                        <div className=\"w-24 h-24 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-6 text-gray-300\">\r\n                            <Search size={40} />\r\n                        </div>\r\n                        <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">No jobs matched your search</h3>\r\n                        <p className=\"text-gray-500 font-medium\">Try broader keywords or clear your filters.</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n                        {filteredJobs.map((job) => {\r\n                            const isApplied = myApplications.has(job._id);\r\n                            return (\r\n                                <div key={job._id} className=\"group bg-white rounded-3xl p-8 border border-gray-100 shadow-sm hover:shadow-2xl hover:border-blue-100 transition-all duration-500 flex flex-col h-full relative overflow-hidden\">\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center justify-between mb-4\">\r\n                                            <h3 className=\"text-2xl font-black text-gray-900 leading-tight\">\r\n                                                {job.jobTitle}\r\n                                            </h3>\r\n                                            <span className=\"bg-blue-50 text-blue-600 text-[10px] font-black uppercase tracking-widest px-3 py-1.5 rounded-full whitespace-nowrap\">\r\n                                                {job.vacancy} Openings\r\n                                            </span>\r\n                                        </div>\r\n\r\n                                        <div className=\"flex items-center gap-2 text-gray-400 text-xs font-bold mb-6\">\r\n                                            <Calendar size={14} className=\"text-gray-400\" />\r\n                                            Posted: {formatDateDDMMYYYY(job.createdAt)}\r\n                                        </div>\r\n\r\n                                        <div className=\"flex flex-wrap gap-2 mb-6\">\r\n                                            <span className=\"px-3 py-1.5 bg-purple-50 text-purple-600 rounded-lg text-xs font-bold border border-purple-100 uppercase\">\r\n                                                {job.department}\r\n                                            </span>\r\n                                            <span className=\"px-3 py-1.5 bg-green-50 text-green-600 rounded-lg text-xs font-bold border border-green-100 uppercase\">\r\n                                                0+ Yrs\r\n                                            </span>\r\n                                        </div>\r\n\r\n                                        <p className=\"text-gray-500 text-sm font-medium mb-8 leading-relaxed\">\r\n                                            We are looking for a talented {job.jobTitle} to join our growing team in {job.department}.\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-3 mt-auto\">\r\n                                        <Link\r\n                                            to={`/apply-job/${job._id}`}\r\n                                            className=\"px-4 py-3.5 bg-white border border-gray-200 text-gray-900 rounded-2xl text-sm font-black text-center hover:bg-gray-50 transition-colors active:scale-95\"\r\n                                        >\r\n                                            View Details\r\n                                        </Link>\r\n                                        <Link\r\n                                            to={isApplied ? \"/candidate/dashboard\" : `/apply-job/${job._id}`}\r\n                                            className={`px-4 py-3.5 rounded-2xl text-sm font-black text-center transition-all active:scale-95 flex items-center justify-center gap-1 ${isApplied\r\n                                                ? 'bg-green-100 text-green-700'\r\n                                                : 'bg-blue-600 text-white shadow-lg shadow-blue-200 hover:bg-blue-700'\r\n                                                }`}\r\n                                        >\r\n                                            {isApplied ? 'Applied' : 'Apply Now'}\r\n                                            {!isApplied && <ArrowRight size={16} />}\r\n                                        </Link>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                )}\r\n            </section>\r\n\r\n            {/* Why Work With Us Section */}\r\n            <section className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-32 text-center\">\r\n                <h2 className=\"text-5xl font-black text-gray-900 mb-20 tracking-tight\">Why Work With Us?</h2>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12\">\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6\">\r\n                            <Zap size={32} />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold\">Fast Growth</h3>\r\n                        <p className=\"text-gray-500 text-sm leading-relaxed\">Opportunity to work on cutting-edge tech and grow rapidly.</p>\r\n                    </div>\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"w-16 h-16 bg-green-50 text-green-600 rounded-2xl flex items-center justify-center mx-auto mb-6\">\r\n                            <Users size={32} />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold\">Great Culture</h3>\r\n                        <p className=\"text-gray-500 text-sm leading-relaxed\">Work with a diverse and highly motivated team.</p>\r\n                    </div>\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"w-16 h-16 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-6\">\r\n                            <Globe size={32} />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold\">Global Reach</h3>\r\n                        <p className=\"text-gray-500 text-sm leading-relaxed\">We operate globally, giving you immense exposure.</p>\r\n                    </div>\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"w-16 h-16 bg-orange-50 text-orange-600 rounded-2xl flex items-center justify-center mx-auto mb-6\">\r\n                            <Star size={32} />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold\">Best Perks</h3>\r\n                        <p className=\"text-gray-500 text-sm leading-relaxed\">Competitive salary, insurance, and performance bonuses.</p>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* Footer */}\r\n            <footer className=\"bg-white border-t border-gray-100 py-12\">\r\n                <div className=\"max-w-7xl mx-auto px-4 text-center\">\r\n                    <p className=\"text-xs text-gray-400 font-bold uppercase tracking-[0.2em] mb-2\">Powered by Gitakshmi HRMS</p>\r\n                    <p className=\"text-gray-400 text-sm font-medium\">\r\n                        &copy; {new Date().getFullYear()} {companyName || 'Test'}. All rights reserved.\r\n                    </p>\r\n                </div>\r\n            </footer>\r\n        </div>\r\n    );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Jobs.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'activeTenantId' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":27,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"activeTenantId"},"fix":{"range":[1189,1203],"text":""},"desc":"Remove unused variable 'activeTenantId'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setActiveTenantId' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":27,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"setActiveTenantId"},"fix":{"range":[1203,1222],"text":""},"desc":"Remove unused variable 'setActiveTenantId'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'params.companyId'. Either include it or remove the dependency array.","line":88,"column":6,"nodeType":"ArrayExpression","endLine":88,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [identifier, navigate, params.companyId]","fix":{"range":[3024,3046],"text":"[identifier, navigate, params.companyId]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport HeroSection from '../components/jobs/HeroSection';\r\nimport JobFilters from '../components/jobs/JobFilters';\r\nimport JobCard from '../components/jobs/JobCard';\r\nimport JobModal from '../components/jobs/JobModal';\r\nimport BenefitsSection from '../components/jobs/BenefitsSection';\r\nimport { Briefcase } from 'lucide-react';\r\nimport api from '../utils/api';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { isCandidateLoggedIn, getCandidate, getTenantId, setCompany, getCompany } from '../utils/auth';\r\n\r\nconst Jobs = () => {\r\n  const params = useParams();\r\n  const navigate = useNavigate();\r\n  const { logout } = useAuth();\r\n\r\n  // Resolve identifier: prioritize URL param, but ignore 'jobs' string which is a routing error\r\n  let identifier = params.companyId;\r\n  if (!identifier || identifier === 'jobs') {\r\n    identifier = getTenantId() || localStorage.getItem('companyCode');\r\n  }\r\n\r\n  const [jobs, setJobs] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [companyName, setCompanyName] = useState('Careers');\r\n  const [activeTenantId, setActiveTenantId] = useState(identifier);\r\n\r\n  const isAuth = isCandidateLoggedIn();\r\n  const candidate = getCandidate();\r\n\r\n  const [filters, setFilters] = useState({\r\n    search: '',\r\n    department: '',\r\n    experience: '',\r\n    type: ''\r\n  });\r\n\r\n  const [selectedJob, setSelectedJob] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (!identifier) {\r\n      navigate('/');\r\n      return;\r\n    }\r\n\r\n    const fetchData = async () => {\r\n      try {\r\n        setLoading(true);\r\n\r\n        // Fetch current company details\r\n        let companyInfo = getCompany();\r\n\r\n        // If we have an identifier but no company info, or identifier is different, fetch it\r\n        if (!companyInfo || (companyInfo._id !== identifier && companyInfo.code !== identifier)) {\r\n          try {\r\n            const tRes = await api.get(`/public/tenant/${identifier}`);\r\n            if (tRes.data) {\r\n              companyInfo = { ...tRes.data, tenantId: tRes.data._id || identifier };\r\n              setCompany(companyInfo);\r\n            }\r\n          } catch (e) {\r\n            console.warn(\"Failed to fetch tenant details\", e);\r\n          }\r\n        }\r\n\r\n        if (companyInfo && companyInfo.name) {\r\n          setCompanyName(companyInfo.name);\r\n        }\r\n\r\n        // Fetch jobs for this company\r\n        const jobsRes = await api.get(`/public/jobs?tenantId=${identifier}`);\r\n        setJobs(jobsRes.data || []);\r\n\r\n        // If the URL is just /jobs and we resolved it, redirect to proper code URL if we have it\r\n        if (params.companyId !== identifier && companyInfo?.code) {\r\n          // navigate(`/jobs/${companyInfo.code}`, { replace: true });\r\n        }\r\n\r\n      } catch (err) {\r\n        console.error(\"Failed to load jobs\", err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [identifier, navigate]);\r\n\r\n  const departments = useMemo(() => [...new Set(jobs.map(j => j.department).filter(Boolean))], [jobs]);\r\n  const jobTypes = useMemo(() => [...new Set(jobs.map(j => j.employmentType).filter(Boolean))], [jobs]);\r\n\r\n  const experiences = useMemo(() => {\r\n    const expSet = new Set();\r\n    jobs.forEach(j => {\r\n      if (j.minExperienceMonths !== undefined) {\r\n        const yrs = Math.floor(j.minExperienceMonths / 12);\r\n        expSet.add(`${yrs}+ Years`);\r\n      }\r\n    });\r\n    return [...expSet].sort();\r\n  }, [jobs]);\r\n\r\n  const filteredJobs = useMemo(() => {\r\n    return jobs.filter(job => {\r\n      const matchesSearch = (job.jobTitle || '').toLowerCase().includes(filters.search.toLowerCase()) ||\r\n        (job.description || '').toLowerCase().includes(filters.search.toLowerCase());\r\n      const matchesDept = filters.department ? job.department === filters.department : true;\r\n      const matchesType = filters.type ? job.employmentType === filters.type : true;\r\n\r\n      let matchesExp = true;\r\n      if (filters.experience) {\r\n        const yrs = Math.floor((job.minExperienceMonths || 0) / 12);\r\n        matchesExp = filters.experience === `${yrs}+ Years`;\r\n      }\r\n      return matchesSearch && matchesDept && matchesExp && matchesType;\r\n    });\r\n  }, [filters, jobs]);\r\n\r\n  const handleLogout = () => {\r\n    logout();\r\n    localStorage.removeItem('candidate');\r\n    navigate(0);\r\n  };\r\n\r\n  const handleApply = (job) => {\r\n    if (!isAuth) {\r\n      navigate(`/candidate/login?tenantId=${identifier}&redirect=/candidate/dashboard`);\r\n      return;\r\n    }\r\n    navigate(`/apply-job/${job._id}?tenantId=${identifier}`);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50/50 font-sans relative\">\r\n      <div className=\"absolute top-0 right-0 z-50 p-6 flex items-center gap-4\">\r\n        {isAuth ? (\r\n          <div className=\"flex items-center gap-4 bg-white/90 backdrop-blur-md px-1.5 py-1.5 rounded-full shadow-lg shadow-blue-500/10 border border-white/50 ring-1 ring-gray-100 transition-all hover:shadow-xl\">\r\n            <button\r\n              onClick={() => navigate('/candidate/dashboard')}\r\n              className=\"flex items-center gap-3 px-3 py-1 bg-gray-50 rounded-full border border-gray-100 hover:bg-blue-50 transition-colors group\"\r\n            >\r\n              <div className=\"h-6 w-6 rounded-full bg-gradient-to-tr from-blue-500 to-indigo-500 flex items-center justify-center text-[10px] text-white font-bold shadow-sm group-hover:scale-110 transition-transform\">\r\n                {candidate?.name?.charAt(0) || 'C'}\r\n              </div>\r\n              <span className=\"text-xs font-bold text-gray-700 hidden sm:inline truncate max-w-[100px] group-hover:text-blue-600 transition-colors\">\r\n                {candidate?.name || 'Candidate'}\r\n              </span>\r\n            </button>\r\n\r\n            <div className=\"flex items-center gap-2 pr-3\">\r\n              <div className=\"h-4 w-px bg-gray-200\"></div>\r\n              <button\r\n                onClick={handleLogout}\r\n                className=\"text-xs font-bold text-red-500 hover:text-red-700 px-2 transition-colors\"\r\n              >\r\n                Logout\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              onClick={() => navigate(`/candidate/login?tenantId=${identifier}&redirect=/candidate/dashboard`)}\r\n              className=\"bg-white text-blue-600 px-5 py-2.5 rounded-full text-sm font-bold shadow-md hover:shadow-lg hover:bg-blue-50 transition-all transform hover:-translate-y-0.5 border border-blue-100\"\r\n            >\r\n              Candidate Login\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <HeroSection companyName={companyName} />\r\n\r\n      <JobFilters\r\n        filters={filters}\r\n        setFilters={setFilters}\r\n        departments={departments}\r\n        experiences={experiences}\r\n        jobTypes={jobTypes}\r\n      />\r\n\r\n      <div id=\"open-positions\" className=\"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-12 py-16\">\r\n        <div className=\"flex items-center justify-between mb-8\">\r\n          <h2 className=\"text-3xl font-bold text-gray-900\">Open Positions</h2>\r\n          <span className=\"bg-blue-100 text-blue-800 text-sm font-semibold px-3 py-1 rounded-full\">\r\n            {filteredJobs.length} Jobs Found\r\n          </span>\r\n        </div>\r\n\r\n        {filteredJobs.length > 0 ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8\">\r\n            {filteredJobs.map(job => (\r\n              <JobCard\r\n                key={job._id}\r\n                job={job}\r\n                onView={setSelectedJob}\r\n                onApply={handleApply}\r\n              />\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-center py-20 bg-white rounded-xl border border-dashed border-gray-300\">\r\n            <Briefcase className=\"w-12 h-12 text-gray-300 mx-auto mb-4\" />\r\n            <h3 className=\"text-xl font-medium text-gray-900\">No open positions found</h3>\r\n            <p className=\"text-gray-500\">Check back later or try adjusting your filters.</p>\r\n            <button\r\n              onClick={() => setFilters({ search: '', department: '', experience: '', type: '' })}\r\n              className=\"mt-6 text-blue-600 hover:text-blue-800 font-medium\"\r\n            >\r\n              Clear all filters\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <BenefitsSection />\r\n\r\n      <JobModal\r\n        job={selectedJob}\r\n        onClose={() => setSelectedJob(null)}\r\n        onApply={handleApply}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Jobs;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\Leaves\\RegularizationRequest.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'formatDateDDMMYYYY' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"formatDateDDMMYYYY"},"fix":{"range":[269,328],"text":""},"desc":"Remove unused variable 'formatDateDDMMYYYY'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":19,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"loading"},"fix":{"range":[967,974],"text":""},"desc":"Remove unused variable 'loading'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":40,"column":8,"nodeType":"ArrayExpression","endLine":40,"endColumn":46,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, currentMonth, currentYear, fetchData]","fix":{"range":[1571,1609],"text":"[activeTab, currentMonth, currentYear, fetchData]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport { Pagination } from 'antd';\r\nimport api from '../../utils/api';\r\nimport { Calendar as CalendarIcon, Clock, CheckCircle, XCircle, ChevronLeft, ChevronRight, Info, AlertTriangle } from 'lucide-react';\r\nimport { formatDateDDMMYYYY } from '../../utils/dateUtils';\r\nimport AttendanceCalendar from '../../components/AttendanceCalendar';\r\nimport dayjs from 'dayjs';\r\n\r\nexport default function RegularizationRequest() {\r\n    const [activeTab, setActiveTab] = useState('apply'); // apply | history\r\n    const [requests, setRequests] = useState([]);\r\n\r\n    // Calendar & Data State\r\n    const [attendance, setAttendance] = useState([]);\r\n    const [holidays, setHolidays] = useState([]);\r\n    const [settings, setSettings] = useState({});\r\n    const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());\r\n    const [currentYear, setCurrentYear] = useState(new Date().getFullYear());\r\n    const [loading, setLoading] = useState(false);\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const pageSize = 10;\r\n\r\n    // Form\r\n    const [form, setForm] = useState({\r\n        category: 'Attendance', // Attendance | Leave\r\n        startDate: '',\r\n        endDate: '',\r\n        issueType: '',\r\n        reason: '',\r\n        // Dynamic Fields\r\n        checkIn: '',\r\n        checkOut: '',\r\n        requestedLeaveType: '',\r\n        originalLeaveType: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (activeTab === 'history') fetchHistory();\r\n        if (activeTab === 'apply') fetchData();\r\n    }, [activeTab, currentMonth, currentYear]);\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const [attRes, holidayRes, settingsRes] = await Promise.all([\r\n                api.get(`/attendance/my?month=${currentMonth + 1}&year=${currentYear}`),\r\n                api.get('/holidays'),\r\n                api.get('/attendance/settings')\r\n            ]);\r\n            setAttendance(attRes.data || []);\r\n            setHolidays(holidayRes.data || []);\r\n            setSettings(settingsRes.data || {});\r\n        } catch (err) {\r\n            console.error(\"Failed to fetch data\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const fetchHistory = async () => {\r\n        try {\r\n            const res = await api.get('/employee/regularization/my');\r\n            setRequests(res.data.data);\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    // Calculate Disabled Dates based on strict rules\r\n    const disabledDates = useMemo(() => {\r\n        const disabled = {};\r\n        const today = dayjs().format('YYYY-MM-DD');\r\n        const weeklyOffs = settings.weeklyOffDays || [0];\r\n\r\n        // Helper to check range\r\n        const startOfMonth = dayjs(`${currentYear}-${currentMonth + 1}-01`);\r\n        const endOfMonth = startOfMonth.endOf('month');\r\n\r\n        let current = startOfMonth;\r\n        while (current.isBefore(endOfMonth) || current.isSame(endOfMonth)) {\r\n            const dateStr = current.format('YYYY-MM-DD');\r\n\r\n            // 1. Future Dates\r\n            if (dateStr > today) {\r\n                disabled[dateStr] = \"Future date selection is blocked\";\r\n            }\r\n\r\n            // 2. Weekly Offs\r\n            if (weeklyOffs.includes(current.day())) {\r\n                disabled[dateStr] = \"Selection blocked on Weekly Offs\";\r\n            }\r\n\r\n            current = current.add(1, 'day');\r\n        }\r\n\r\n        // 3. Company Holidays\r\n        holidays.forEach(h => {\r\n            const dStr = h.date.split('T')[0];\r\n            disabled[dStr] = `Holiday: ${h.name}`;\r\n        });\r\n\r\n        // 4. Payroll Locked & Approved Leave Days\r\n        attendance.forEach(att => {\r\n            const dStr = att.date.split('T')[0];\r\n            if (att.locked) {\r\n                disabled[dStr] = \"Attendance record is locked by Payroll\";\r\n            }\r\n            if (att.status === 'leave') {\r\n                disabled[dStr] = \"Regularization not allowed on Approved Leave\";\r\n            }\r\n        });\r\n\r\n        return disabled;\r\n    }, [currentMonth, currentYear, attendance, holidays, settings]);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!form.startDate) return alert(\"Please select a date from the calendar\");\r\n\r\n        try {\r\n            const payload = {\r\n                category: form.category,\r\n                startDate: form.startDate,\r\n                endDate: form.endDate || form.startDate,\r\n                issueType: form.issueType,\r\n                reason: form.reason,\r\n                requestedData: {}\r\n            };\r\n\r\n            if (form.category === 'Attendance') {\r\n                if (form.checkIn) payload.requestedData.checkIn = `${form.startDate}T${form.checkIn}:00`;\r\n                if (form.checkOut) payload.requestedData.checkOut = `${form.startDate}T${form.checkOut}:00`;\r\n            } else {\r\n                payload.requestedData.requestedLeaveType = form.requestedLeaveType;\r\n                payload.requestedData.originalLeaveType = form.originalLeaveType;\r\n            }\r\n\r\n            await api.post('/employee/regularization', payload);\r\n            alert('Request Submitted Successfully');\r\n            setActiveTab('history');\r\n            setForm({ category: 'Attendance', startDate: '', endDate: '', issueType: '', reason: '', checkIn: '', checkOut: '', requestedLeaveType: '', originalLeaveType: '' });\r\n        } catch (err) {\r\n            alert(err.response?.data?.error || \"Submission Failed\");\r\n        }\r\n    };\r\n\r\n    const nextMonth = () => {\r\n        if (currentMonth === 11) {\r\n            setCurrentMonth(0);\r\n            setCurrentYear(prev => prev + 1);\r\n        } else {\r\n            setCurrentMonth(prev => prev + 1);\r\n        }\r\n    };\r\n\r\n    const prevMonth = () => {\r\n        if (currentMonth === 0) {\r\n            setCurrentMonth(11);\r\n            setCurrentYear(prev => prev - 1);\r\n        } else {\r\n            setCurrentMonth(prev => prev - 1);\r\n        }\r\n    };\r\n\r\n    const getStatusBadge = (status) => {\r\n        if (status === 'Approved') return <span className=\"text-green-600 bg-green-50 px-2 py-1 rounded text-xs font-bold border border-green-200\">Approved</span>;\r\n        if (status === 'Rejected') return <span className=\"text-rose-600 bg-rose-50 px-2 py-1 rounded text-xs font-bold border border-rose-200\">Rejected</span>;\r\n        return <span className=\"text-amber-600 bg-amber-50 px-2 py-1 rounded text-xs font-bold border border-amber-200\">Pending</span>;\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-in fade-in duration-700\">\r\n            {/* Header section with glassmorphism */}\r\n            <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl p-8 rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-2xl relative overflow-hidden\">\r\n                <div className=\"absolute top-0 right-0 w-64 h-64 bg-indigo-500/5 blur-[80px] rounded-full -mr-20 -mt-20\"></div>\r\n                <div className=\"relative flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                    <div>\r\n                        <div className=\"flex items-center gap-3 mb-2\">\r\n                            <div className=\"p-2 rounded-xl bg-orange-500/10 text-orange-500\">\r\n                                <AlertTriangle size={20} />\r\n                            </div>\r\n                            <h2 className=\"text-3xl font-black text-slate-800 dark:text-white tracking-tighter uppercase italic\">Correction Portal</h2>\r\n                        </div>\r\n                        <p className=\"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.3em] ml-11\">Request log adjustments & attendance fixes</p>\r\n                    </div>\r\n\r\n                    <div className=\"inline-flex bg-slate-50 dark:bg-slate-950 p-1.5 rounded-2xl border border-slate-200/50 dark:border-slate-800/50\">\r\n                        <button\r\n                            onClick={() => setActiveTab('apply')}\r\n                            className={`flex items-center gap-2 px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all duration-500 ${activeTab === 'apply'\r\n                                ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/20'\r\n                                : 'text-slate-400 hover:text-slate-600 dark:hover:text-slate-300'\r\n                                }`}\r\n                        >\r\n                            New Request\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setActiveTab('history')}\r\n                            className={`flex items-center gap-2 px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all duration-500 ${activeTab === 'history'\r\n                                ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/20'\r\n                                : 'text-slate-400 hover:text-slate-600 dark:hover:text-slate-300'\r\n                                }`}\r\n                        >\r\n                            History\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"p-0\">\r\n                {activeTab === 'apply' ? (\r\n                    <div className=\"grid grid-cols-1 xl:grid-cols-12 gap-8\">\r\n                        {/* Selector Section (Left) */}\r\n                        <div className=\"xl:col-span-8 space-y-6\">\r\n                            <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl p-8 rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-xl\">\r\n                                <div className=\"flex items-center justify-between mb-8\">\r\n                                    <div>\r\n                                        <h3 className=\"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tighter italic\">Select Target Date</h3>\r\n                                        <div className=\"flex items-center gap-2 mt-1\">\r\n                                            <div className=\"w-1.5 h-1.5 rounded-full bg-indigo-500 animate-pulse\"></div>\r\n                                            <p className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest\">Only business days are eligible for adjustment</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-3 bg-slate-50 dark:bg-slate-950 p-1.5 rounded-2xl border border-slate-200/50 dark:border-slate-800/50 shadow-sm\">\r\n                                        <button onClick={prevMonth} className=\"p-2 hover:bg-white dark:hover:bg-slate-800 rounded-xl transition-all shadow-sm\"><ChevronLeft size={14} className=\"text-slate-400\" /></button>\r\n                                        <div className=\"px-4 text-[10px] font-black text-slate-700 dark:text-slate-300 min-w-[140px] text-center uppercase tracking-[0.2em]\">\r\n                                            {dayjs(new Date(currentYear, currentMonth)).format('MMMM YYYY')}\r\n                                        </div>\r\n                                        <button onClick={nextMonth} className=\"p-2 hover:bg-white dark:hover:bg-slate-800 rounded-xl transition-all shadow-sm\"><ChevronRight size={14} className=\"text-slate-400\" /></button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <AttendanceCalendar\r\n                                    data={attendance}\r\n                                    holidays={holidays}\r\n                                    settings={settings}\r\n                                    currentMonth={currentMonth}\r\n                                    currentYear={currentYear}\r\n                                    onDateClick={(date) => setForm({ ...form, startDate: date })}\r\n                                    selectedDate={form.startDate}\r\n                                    selectionMode={true}\r\n                                    disabledDates={disabledDates}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Form Section (Right) */}\r\n                        <div className=\"xl:col-span-4 bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl p-8 rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-xl\">\r\n                            <form onSubmit={handleSubmit} className=\"space-y-8\">\r\n                                <div className=\"space-y-3\">\r\n                                    <h4 className=\"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4\">Correction Module</h4>\r\n                                    <div className=\"grid grid-cols-2 gap-3\">\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => setForm({ ...form, category: 'Attendance' })}\r\n                                            className={`group relative py-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all duration-500 ${form.category === 'Attendance' ? 'bg-indigo-600 border-indigo-600 text-white shadow-xl shadow-indigo-600/30' : 'bg-transparent border-slate-100 dark:border-slate-800 text-slate-400 hover:border-slate-300 dark:hover:border-slate-700'}`}\r\n                                        >\r\n                                            <Clock size={18} className={form.category === 'Attendance' ? 'text-white' : 'text-slate-400 group-hover:scale-110 transition-transform'} />\r\n                                            <span className=\"text-[9px] font-black uppercase tracking-widest\">Punches</span>\r\n                                        </button>\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => setForm({ ...form, category: 'Leave' })}\r\n                                            className={`group relative py-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all duration-500 ${form.category === 'Leave' ? 'bg-indigo-600 border-indigo-600 text-white shadow-xl shadow-indigo-600/30' : 'bg-transparent border-slate-100 dark:border-slate-800 text-slate-400 hover:border-slate-300 dark:hover:border-slate-700'}`}\r\n                                        >\r\n                                            <CalendarIcon size={18} className={form.category === 'Leave' ? 'text-white' : 'text-slate-400 group-hover:scale-110 transition-transform'} />\r\n                                            <span className=\"text-[9px] font-black uppercase tracking-widest\">Leaves</span>\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-6\">\r\n                                    <div>\r\n                                        <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-2 block\">System Issue Path</label>\r\n                                        <select required className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-100 dark:border-slate-800 rounded-2xl px-5 py-4 text-xs font-bold text-slate-700 dark:text-slate-200 outline-none focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 transition-all\"\r\n                                            value={form.issueType} onChange={e => setForm({ ...form, issueType: e.target.value })}>\r\n                                            <option value=\"\">-- RESOLVE ISSUE --</option>\r\n                                            {form.category === 'Attendance' ? (\r\n                                                <>\r\n                                                    <option>Missed Check In</option>\r\n                                                    <option>Missed Check Out</option>\r\n                                                    <option>Forgot to Punch (Both)</option>\r\n                                                    <option>Actually Present (Approved Leave Reversal)</option>\r\n                                                </>\r\n                                            ) : (\r\n                                                <>\r\n                                                    <option>Applied Wrong Leave Type</option>\r\n                                                    <option>Forgot to Apply Leave</option>\r\n                                                    <option>LOP Correction</option>\r\n                                                    <option>Cancel Approved Leave</option>\r\n                                                </>\r\n                                            )}\r\n                                        </select>\r\n                                    </div>\r\n\r\n                                    {form.category === 'Attendance' ? (\r\n                                        <div className=\"bg-slate-50 dark:bg-slate-950 p-6 rounded-[2rem] border border-slate-100 dark:border-slate-800 space-y-4 animate-in slide-in-from-top-4 duration-500\">\r\n                                            <h4 className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                                                <div className=\"w-1.5 h-1.5 rounded-full bg-emerald-500\"></div> Corrected Timestamp\r\n                                            </h4>\r\n                                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                                <div className=\"space-y-1\">\r\n                                                    <label className=\"text-[8px] font-black text-slate-400 uppercase tracking-widest ml-1\">IN_TIME</label>\r\n                                                    <input type=\"time\" className=\"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-3 text-xs font-black text-slate-700 dark:text-indigo-400 focus:ring-2 focus:ring-indigo-500/20 list-none outline-none\"\r\n                                                        value={form.checkIn} onChange={e => setForm({ ...form, checkIn: e.target.value })} />\r\n                                                </div>\r\n                                                <div className=\"space-y-1\">\r\n                                                    <label className=\"text-[8px] font-black text-slate-400 uppercase tracking-widest ml-1\">OUT_TIME</label>\r\n                                                    <input type=\"time\" className=\"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-3 text-xs font-black text-slate-700 dark:text-indigo-400 focus:ring-2 focus:ring-indigo-500/20 list-none outline-none\"\r\n                                                        value={form.checkOut} onChange={e => setForm({ ...form, checkOut: e.target.value })} />\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"bg-slate-50 dark:bg-slate-950 p-6 rounded-[2rem] border border-slate-100 dark:border-slate-800 space-y-4 animate-in slide-in-from-top-4 duration-500\">\r\n                                            <h4 className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                                                <div className=\"w-1.5 h-1.5 rounded-full bg-indigo-500\"></div> Leave Override\r\n                                            </h4>\r\n                                            <div className=\"space-y-3\">\r\n                                                <input type=\"text\" placeholder=\"Marked As (Original status)\" className=\"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-3.5 text-xs font-bold text-slate-700 dark:text-slate-300 outline-none focus:ring-2 focus:ring-indigo-500/20\"\r\n                                                    value={form.originalLeaveType} onChange={e => setForm({ ...form, originalLeaveType: e.target.value })} />\r\n                                                <select className=\"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-3.5 text-xs font-black text-indigo-600 dark:text-indigo-400 outline-none focus:ring-2 focus:ring-indigo-500/20\"\r\n                                                    value={form.requestedLeaveType} onChange={e => setForm({ ...form, requestedLeaveType: e.target.value })}>\r\n                                                    <option value=\"\">-- CONVERT TO --</option>\r\n                                                    <option value=\"CL\">CL (Casual)</option>\r\n                                                    <option value=\"PL\">PL (Paid)</option>\r\n                                                    <option value=\"SL\">SL (Sick)</option>\r\n                                                    <option value=\"Present\">Present (Working)</option>\r\n                                                </select>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    <div>\r\n                                        <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-2 block\">Justification Record</label>\r\n                                        <textarea required className=\"w-full bg-slate-50 dark:bg-slate-950 border border-slate-100 dark:border-slate-800 rounded-2xl px-5 py-4 text-xs font-bold min-h-[120px] text-slate-700 dark:text-slate-200 outline-none focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 transition-all resize-none\"\r\n                                            placeholder=\"Provide technical justification for this correction...\"\r\n                                            value={form.reason} onChange={e => setForm({ ...form, reason: e.target.value })}></textarea>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={!form.startDate || !form.reason}\r\n                                    className={`w-full py-5 rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] transition-all duration-500 ${form.startDate && form.reason\r\n                                        ? 'bg-indigo-600 text-white shadow-xl shadow-indigo-600/30 hover:scale-[1.02] active:scale-95'\r\n                                        : 'bg-slate-100 dark:bg-slate-800 text-slate-400 cursor-not-allowed'}`}\r\n                                >\r\n                                    {form.startDate ? `Push Correction: ${dayjs(form.startDate).format('DD MMM')}` : 'Awaiting Date Selection'}\r\n                                </button>\r\n\r\n                                <div className=\"flex items-start gap-4 p-5 bg-amber-50/50 dark:bg-amber-900/10 border border-amber-100 dark:border-amber-900/30 rounded-[1.5rem] relative overflow-hidden group\">\r\n                                    <div className=\"absolute top-0 right-0 w-24 h-24 bg-amber-500/5 blur-2xl rounded-full\"></div>\r\n                                    <div className=\"flex-shrink-0 p-2 rounded-xl bg-amber-500 text-white shadow-lg shadow-amber-500/20\">\r\n                                        <AlertTriangle size={14} />\r\n                                    </div>\r\n                                    <p className=\"text-[9px] font-bold text-amber-700 dark:text-amber-500 leading-relaxed uppercase tracking-tighter\">\r\n                                        Adjustment protocols are audited. Any falsification of records will result in immediate termination of access.\r\n                                    </p>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    /* HISTORY TAB */\r\n                    <div className=\"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl rounded-[2.5rem] border border-slate-200/60 dark:border-slate-800/60 shadow-2xl overflow-hidden animate-in fade-in duration-500\">\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"min-w-full divide-y divide-slate-100 dark:divide-slate-800 text-sm\">\r\n                                <thead>\r\n                                    <tr className=\"bg-slate-50/50 dark:bg-slate-950/50 text-slate-400 uppercase text-[10px] font-black tracking-[0.2em]\">\r\n                                        <th className=\"px-8 py-6 text-left\">Incident Date</th>\r\n                                        <th className=\"px-8 py-6 text-center\">Module</th>\r\n                                        <th className=\"px-8 py-6 text-left\">Correction Log</th>\r\n                                        <th className=\"px-8 py-6 text-left\">Status</th>\r\n                                        <th className=\"px-8 py-6 text-left\">Manager Authority</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-slate-50 dark:divide-slate-800\">\r\n                                    {requests.length === 0 ? (\r\n                                        <tr>\r\n                                            <td colSpan=\"5\" className=\"px-8 py-32 text-center\">\r\n                                                <div className=\"flex flex-col items-center gap-4 opacity-30\">\r\n                                                    <div className=\"w-20 h-20 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center\">\r\n                                                        <Clock size={32} className=\"text-slate-400\" />\r\n                                                    </div>\r\n                                                    <p className=\"font-black uppercase tracking-[0.3em] text-[10px] text-slate-400\">Archived Stream Empty</p>\r\n                                                </div>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ) : (\r\n                                        requests.slice((currentPage - 1) * pageSize, currentPage * pageSize).map(req => (\r\n                                            <tr key={req._id} className=\"group hover:bg-slate-50/50 dark:hover:bg-slate-800/30 transition-all duration-300\">\r\n                                                <td className=\"px-8 py-5\">\r\n                                                    <div className=\"flex items-center gap-3\">\r\n                                                        <div className=\"w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 flex flex-col items-center justify-center group-hover:bg-indigo-600 group-hover:text-white transition-all duration-500\">\r\n                                                            <span className=\"text-[8px] font-black leading-none mb-1\">{dayjs(req.startDate).format('MMM')}</span>\r\n                                                            <span className=\"text-xs font-black leading-none\">{dayjs(req.startDate).format('DD')}</span>\r\n                                                        </div>\r\n                                                        <span className=\"text-sm font-black text-slate-700 dark:text-slate-200 tracking-tighter uppercase italic\">{dayjs(req.startDate).format('YYYY')}</span>\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td className=\"px-8 py-5 text-center\">\r\n                                                    <span className={`px-4 py-1.5 rounded-full text-[9px] uppercase font-black tracking-widest shadow-sm ${req.category === 'Attendance'\r\n                                                        ? 'bg-indigo-50 text-indigo-600 border border-indigo-100 dark:bg-indigo-900/20 dark:border-indigo-800 dark:text-indigo-400'\r\n                                                        : 'bg-amber-50 text-amber-600 border border-amber-100 dark:bg-amber-900/20 dark:border-amber-800 dark:text-amber-400'}`}>\r\n                                                        {req.category}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-8 py-5\">\r\n                                                    <div className=\"space-y-1\">\r\n                                                        <p className=\"text-xs font-black text-slate-600 dark:text-slate-300 uppercase tracking-tight\">{req.issueType}</p>\r\n                                                        <p className=\"text-[9px] font-bold text-slate-400 uppercase tracking-widest truncate max-w-[200px]\">{req.reason}</p>\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td className=\"px-8 py-5\">{getStatusBadge(req.status)}</td>\r\n                                                <td className=\"px-8 py-5\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        {req.adminRemark ? (\r\n                                                            <div className=\"bg-slate-50 dark:bg-slate-950 p-3 rounded-xl border border-slate-100 dark:border-slate-800 w-full group-hover:border-indigo-500/30 transition-colors\">\r\n                                                                <p className=\"text-[9px] font-bold text-slate-500 dark:text-slate-400 italic\">\"{req.adminRemark}\"</p>\r\n                                                            </div>\r\n                                                        ) : (\r\n                                                            <span className=\"text-[9px] font-black text-slate-300 uppercase tracking-widest\">Awaiting Review</span>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))\r\n                                    )}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                        {requests.length > pageSize && (\r\n                            <div className=\"px-8 py-6 bg-slate-50/30 dark:bg-slate-950/30 border-t border-slate-100 dark:border-slate-800 flex justify-end\">\r\n                                <Pagination\r\n                                    current={currentPage}\r\n                                    pageSize={pageSize}\r\n                                    total={requests.length}\r\n                                    onChange={(page) => setCurrentPage(page)}\r\n                                    showSizeChanger={false}\r\n                                    className=\"custom-pagination\"\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\NotFound.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\Activities.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\AddCompany.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":73,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n    Plus,\r\n    Briefcase\r\n} from 'lucide-react';\r\nimport companiesService from '../../services/companiesService';\r\n\r\nexport default function AddCompany() {\r\n    const navigate = useNavigate();\r\n    const fileInputRef = useRef(null);\r\n\r\n    // UI State\r\n    const [isFormOpen, setIsFormOpen] = useState(false);\r\n\r\n    // Form State - Restoring fields from old CompanyForm\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        email: '', // Company Email\r\n        ownerName: '',\r\n        password: '',\r\n        phone: '',\r\n        address: '',\r\n        logo: null\r\n    });\r\n\r\n    // Derived fields automatically handled in service: \r\n    // code (auto-generated by backend based on name)\r\n\r\n    const [showPassword, setShowPassword] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n    const [errors, setErrors] = useState({});\r\n\r\n    // Default modules hidden from UI\r\n    const defaultModules = ['hr', 'leave', 'attendance', 'payroll', 'recruitment', 'performance'];\r\n\r\n    const handleInputChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: value }));\r\n        if (errors[name]) setErrors(prev => ({ ...prev, [name]: '' }));\r\n    };\r\n\r\n    const handleFileChange = (e) => {\r\n        const file = e.target.files[0];\r\n        setFormData(prev => ({ ...prev, logo: file }));\r\n    };\r\n\r\n    const validate = () => {\r\n        const errs = {};\r\n        if (!formData.name) errs.name = 'Required';\r\n        if (!formData.email) errs.email = 'Required';\r\n        if (!formData.ownerName) errs.ownerName = 'Required';\r\n        if (!formData.password) errs.password = 'Required';\r\n        // Phone/Address optional depending on strictness, usually required\r\n        // if (!formData.phone) errs.phone = 'Required'; \r\n\r\n        setErrors(errs);\r\n        return Object.keys(errs).length === 0;\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!validate()) return;\r\n\r\n        setLoading(true);\r\n        try {\r\n            // 1. Upload Logo if exists\r\n            let logoUrl = '';\r\n            if (formData.logo) {\r\n                try {\r\n                    const upRes = await companiesService.uploadLogo(formData.logo);\r\n                    logoUrl = upRes.url || upRes.path || '';\r\n                } catch (e) { console.warn('Logo upload excluded'); }\r\n            }\r\n\r\n            // 2. Prepare Payload (Mapping back to what backend expects)\r\n            // Backend Controller expects: { name, emailDomain, meta: { primaryEmail, ownerName, phone, address, logo, adminPassword } }\r\n            // Note: 'code' is auto-generated by backend if not provided, or we can slugify validation.\r\n            // Using backend auto-generation is safer if logic exists there.\r\n\r\n            const payload = {\r\n                name: formData.name,\r\n                // code: Auto-generated or simple slug\r\n                code: formData.name.toLowerCase().replace(/[^a-z0-9]/g, '').slice(0, 10),\r\n                status: 'active',\r\n                modules: defaultModules,\r\n                meta: {\r\n                    primaryEmail: formData.email, // Using Company Email as Primary\r\n                    email: formData.email,        // Admin Email same as Primary for simplicity or user prompt\r\n                    ownerName: formData.ownerName,\r\n                    phone: formData.phone,\r\n                    address: formData.address,\r\n                    adminPassword: formData.password,\r\n                    logo: logoUrl\r\n                }\r\n            };\r\n\r\n            await companiesService.createCompany(payload);\r\n            navigate('/psa/companies');\r\n\r\n        } catch (error) {\r\n            console.error(error);\r\n            alert('Failed to create company. Check console.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // 1. LANDING VIEW\r\n    if (!isFormOpen) {\r\n        return (\r\n            <div className=\"min-h-[80vh] flex flex-col items-center justify-center p-4 font-sans\">\r\n                <div className=\"bg-white p-12 rounded-3xl shadow-sm border border-gray-100 text-center max-w-lg w-full\">\r\n                    <div className=\"w-20 h-20 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6\">\r\n                        <Briefcase size={36} />\r\n                    </div>\r\n                    <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Companies Management</h2>\r\n                    <p className=\"text-gray-500 mb-8\">Onboard a new client organization.</p>\r\n\r\n                    <button\r\n                        onClick={() => setIsFormOpen(true)}\r\n                        className=\"w-full py-4 bg-blue-600 hover:bg-blue-700 text-white text-lg font-semibold rounded-2xl shadow-lg shadow-blue-200 transition-all hover:-translate-y-1 active:scale-95 flex items-center justify-center gap-3\"\r\n                    >\r\n                        <Plus size={24} />\r\n                        Add New Company\r\n                    </button>\r\n\r\n                    <button onClick={() => navigate('/psa/companies')} className=\"mt-6 text-gray-400 hover:text-blue-600 text-sm font-medium\">\r\n                        View Companies List\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 2. FORM VIEW - Matching Old Fields Structure\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-6 font-sans\">\r\n            <div className=\"bg-white rounded-xl shadow-lg w-full max-w-4xl p-8\">\r\n                <h2 className=\"text-xl font-bold text-gray-800 mb-6\">Create Company</h2>\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n\r\n                    {/* Company Name */}\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Company Name</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            name=\"name\"\r\n                            value={formData.name}\r\n                            onChange={handleInputChange}\r\n                            className=\"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500\"\r\n                        />\r\n                        {errors.name && <p className=\"text-xs text-red-500 mt-1\">{errors.name}</p>}\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n                        {/* Company Email */}\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Company Email</label>\r\n                            <input\r\n                                type=\"email\"\r\n                                name=\"email\"\r\n                                value={formData.email}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500\"\r\n                            />\r\n                            {errors.email && <p className=\"text-xs text-red-500 mt-1\">{errors.email}</p>}\r\n                        </div>\r\n\r\n                        {/* Owner Name */}\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Owner Name</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                name=\"ownerName\"\r\n                                value={formData.ownerName}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500\"\r\n                            />\r\n                            {errors.ownerName && <p className=\"text-xs text-red-500 mt-1\">{errors.ownerName}</p>}\r\n                        </div>\r\n\r\n                        {/* Password */}\r\n                        <div className=\"relative\">\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Password</label>\r\n                            <input\r\n                                type={showPassword ? \"text\" : \"password\"}\r\n                                name=\"password\"\r\n                                value={formData.password}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500\"\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => setShowPassword(!showPassword)}\r\n                                className=\"absolute right-3 top-8 text-xs text-gray-500 hover:text-blue-600\"\r\n                            >\r\n                                {showPassword ? 'Hide' : 'Show'}\r\n                            </button>\r\n                            {errors.password && <p className=\"text-xs text-red-500 mt-1\">{errors.password}</p>}\r\n                        </div>\r\n\r\n                        {/* Phone */}\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Phone</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                name=\"phone\"\r\n                                value={formData.phone}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Address */}\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Address</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            name=\"address\"\r\n                            value={formData.address}\r\n                            onChange={handleInputChange}\r\n                            className=\"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-blue-500\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* File Upload (Simple) */}\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Company Logo</label>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                className=\"px-3 py-1.5 border border-gray-300 rounded bg-gray-50 text-sm hover:bg-gray-100\"\r\n                            >\r\n                                Choose File\r\n                            </button>\r\n                            <span className=\"text-sm text-gray-500\">{formData.logo ? formData.logo.name : 'No file chosen'}</span>\r\n                            <input type=\"file\" ref={fileInputRef} className=\"hidden\" accept=\"image/*\" onChange={handleFileChange} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Footer Buttons */}\r\n                    <div className=\"flex justify-end gap-3 mt-8 pt-4 border-t border-gray-100\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => setIsFormOpen(false)}\r\n                            className=\"px-6 py-2 border border-gray-200 rounded text-gray-600 hover:bg-gray-50 transition-colors\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading}\r\n                            className=\"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\r\n                        >\r\n                            {loading ? 'Saving...' : 'Save'}\r\n                        </button>\r\n                    </div>\r\n\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\Companies.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\CompanyForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\CompanyList.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":46,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n    Search,\r\n    Filter,\r\n    Eye,\r\n    Edit2,\r\n    Power,\r\n    EyeOff,\r\n    ExternalLink\r\n} from 'lucide-react';\r\nimport companiesService from '../../services/companiesService';\r\n\r\nexport default function CompanyList() {\r\n    const navigate = useNavigate();\r\n    const [companies, setCompanies] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [revealPassword, setRevealPassword] = useState({});\r\n\r\n    // Environment helper\r\n    const API_BASE = import.meta.env.VITE_API_BASE || 'http://localhost:5000/api';\r\n    const API_ORIGIN = API_BASE.replace(/\\/api\\/?$/, '');\r\n\r\n    useEffect(() => {\r\n        fetchCompanies();\r\n    }, []);\r\n\r\n    const fetchCompanies = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const data = await companiesService.getAllCompanies();\r\n            setCompanies(Array.isArray(data) ? data : []);\r\n        } catch (error) {\r\n            console.error('Failed to load companies', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleToggleStatus = async (company) => {\r\n        if (!window.confirm(`Are you sure you want to ${company.status === 'active' ? 'deactivate' : 'activate'} this company?`)) return;\r\n        try {\r\n            await companiesService.toggleCompanyStatus(company._id, company.status);\r\n            fetchCompanies();\r\n        } catch (error) {\r\n            alert('Status update failed');\r\n        }\r\n    };\r\n\r\n    const togglePassword = (id) => {\r\n        setRevealPassword(prev => ({ ...prev, [id]: !prev[id] }));\r\n    };\r\n\r\n    const getLogoUrl = (url) => {\r\n        if (!url) return null;\r\n        return url.startsWith('http') ? url : `${API_ORIGIN}${url}`;\r\n    };\r\n\r\n    const filteredCompanies = companies.filter(c =>\r\n        c.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        c.code?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        c.meta?.email?.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className=\"p-8 bg-gray-50 min-h-screen font-sans\">\r\n            <div className=\"max-w-7xl mx-auto space-y-6\">\r\n\r\n                {/* Header */}\r\n                <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold text-gray-900 tracking-tight\">Companies</h1>\r\n                        <p className=\"text-sm text-gray-500 mt-1\">Manage all tenant companies from here.</p>\r\n                    </div>\r\n                    {/* Button removed as per request */}\r\n                </div>\r\n\r\n                {/* Filter Bar */}\r\n                <div className=\"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between\">\r\n                    <div className=\"relative w-full max-w-md\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search companies...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all\"\r\n                        />\r\n                    </div>\r\n                    <button className=\"flex items-center gap-2 px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors\">\r\n                        <Filter /> Filter\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Table */}\r\n                <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\">\r\n                    {loading ? (\r\n                        <div className=\"p-8 text-center text-gray-500\">Loading companies...</div>\r\n                    ) : filteredCompanies.length === 0 ? (\r\n                        <div className=\"p-8 text-center text-gray-500\">No companies found. Add one to get started.</div>\r\n                    ) : (\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"min-w-full divide-y divide-gray-200\">\r\n                                <thead className=\"bg-gray-50/50\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase\">ID</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase\">Company</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase\">Admin Account</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase\">Modules</th>\r\n                                        <th className=\"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase\">Status</th>\r\n                                        <th className=\"px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase\">Actions</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                                    {filteredCompanies.map((company) => (\r\n                                        <tr key={company._id} className=\"hover:bg-gray-50 transition-colors\">\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500\">\r\n                                                {company.code}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap max-w-[250px]\">\r\n                                                <div className=\"flex items-center\">\r\n                                                    <div className=\"h-10 w-10 flex-shrink-0 bg-gray-100 rounded-lg overflow-hidden border border-gray-200 flex items-center justify-center text-xs font-bold text-gray-400\">\r\n                                                        {getLogoUrl(company.meta?.logo) ? (\r\n                                                            <img src={getLogoUrl(company.meta.logo)} alt=\"\" className=\"h-full w-full object-contain\" />\r\n                                                        ) : (\r\n                                                            company.name?.charAt(0)\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className=\"ml-4 overflow-hidden\">\r\n                                                        <div className=\"text-sm font-medium text-gray-900 truncate\" title={company.name}>{company.name}</div>\r\n                                                        <div className=\"text-xs text-gray-500 truncate\" title={company.meta?.primaryEmail}>{company.meta?.primaryEmail}</div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap max-w-[200px]\">\r\n                                                <div className=\"text-xs text-gray-500\">\r\n                                                    <div className=\"truncate\" title={company.meta?.email}>{company.meta?.email}</div>\r\n                                                    <div className=\"flex items-center gap-2 mt-1\">\r\n                                                        <code className=\"bg-gray-100 px-1 rounded\">\r\n                                                            {revealPassword[company._id] ? company.meta?.adminPassword : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'}\r\n                                                        </code>\r\n                                                        <button onClick={() => togglePassword(company._id)} className=\"text-gray-400 hover:text-blue-600\">\r\n                                                            {revealPassword[company._id] ? <EyeOff size={12} /> : <Eye size={12} />}\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <div className=\"flex flex-wrap gap-1 max-w-[200px]\">\r\n                                                    {company.modules?.slice(0, 3).map(m => (\r\n                                                        <span key={m} className=\"px-2 py-0.5 text-xs font-medium bg-blue-50 text-blue-700 rounded border border-blue-100 capitalize\">\r\n                                                            {m.replace('-', ' ')}\r\n                                                        </span>\r\n                                                    ))}\r\n                                                    {company.modules?.length > 3 && (\r\n                                                        <span className=\"px-1.5 py-0.5 text-xs text-gray-500 bg-gray-100 rounded\">+{company.modules.length - 3}</span>\r\n                                                    )}\r\n                                                    {(!company.modules?.length) && <span className=\"text-gray-400 text-xs italic\">-</span>}\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${company.status === 'active'\r\n                                                    ? 'bg-green-50 text-green-700 border-green-100'\r\n                                                    : 'bg-red-50 text-red-700 border-red-100'\r\n                                                    }`}>\r\n                                                    {company.status === 'active' ? 'Active' : 'Inactive'}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                                                <div className=\"flex items-center justify-end gap-3\">\r\n                                                    <button onClick={() => navigate(`/psa/companies/view/${company._id}`)} className=\"text-gray-400 hover:text-blue-600\" title=\"View\">\r\n                                                        <Eye size={16} />\r\n                                                    </button>\r\n                                                    <button onClick={() => navigate(`/psa/companies/edit/${company._id}`)} className=\"text-gray-400 hover:text-green-600\" title=\"Edit\">\r\n                                                        <Edit2 size={16} />\r\n                                                    </button>\r\n                                                    <button onClick={() => window.open(`/jobs/${company.code}`, '_blank')} className=\"text-gray-400 hover:text-indigo-600\" title=\"Public Portal\">\r\n                                                        <ExternalLink size={16} />\r\n                                                    </button>\r\n                                                    <button onClick={() => handleToggleStatus(company)} className={`text-gray-400 ${company.status === 'active' ? 'hover:text-red-600' : 'hover:text-green-600'}`} title=\"Toggle Status\">\r\n                                                        <Power size={16} />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\CompanyView.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\Dashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'r2err' is defined but never used.","line":33,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":23},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":33,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":33,"endColumn":28,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1379,1380],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from \"react\";\r\nimport api from \"../../utils/api\";\r\nimport { Grid, TrendingUp, Activity, Users } from \"lucide-react\";\r\n\r\nexport default function Dashboard() {\r\n  const [stats, setStats] = useState({\r\n    companies: 0,\r\n    activeTenants: 0,\r\n    activeModules: 0,\r\n    total: 0,\r\n    active: 0,\r\n    inactive: 0\r\n  });\r\n\r\n  useEffect(() => {\r\n    async function load() {\r\n      try {\r\n        const res = await api.get(\"/tenants/psa/stats\");\r\n        const d = res.data || {};\r\n        const total = Number(d.total ?? d.companies ?? 0) || 0;\r\n        const active = Number(d.active ?? d.activeTenants ?? 0) || 0;\r\n        const inactive = Number(d.inactive ?? d.deactiveTenants ?? (total - active)) || (total - active);\r\n        setStats({ ...d, total, active, inactive });\r\n      } catch (err) {\r\n        console.log(err);\r\n        try {\r\n          const r2 = await api.get('/tenants');\r\n          const list = Array.isArray(r2.data) ? r2.data : (r2.data?.tenants || r2.data?.data || []);\r\n          const total = Array.isArray(list) ? list.length : 0;\r\n          const active = Array.isArray(list) ? list.filter(t => t.status === 'active').length : 0;\r\n          const inactive = total - active;\r\n          setStats({ total, active, inactive, companies: total, activeTenants: active, deactiveTenants: inactive });\r\n        } catch (r2err) { }\r\n      }\r\n    }\r\n    load();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"p-8 bg-gray-50 min-h-screen font-sans animate-fade-in\">\r\n      {/* Header */}\r\n      <div className=\"mb-10\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900 tracking-tight\">Super Admin Dashboard</h1>\r\n        <p className=\"text-sm text-gray-500 mt-2\">Overview of all registered tenants and system performance.</p>\r\n      </div>\r\n\r\n      {/* STATS CARDS */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 mb-12\">\r\n        {/* Card 1: Total Companies */}\r\n        <div className=\"bg-white p-8 rounded-2xl border border-gray-100 shadow-sm hover:shadow-lg transition-all duration-300 relative overflow-hidden group\">\r\n          <div className=\"flex justify-between items-start\">\r\n            <div>\r\n              <p className=\"text-sm font-semibold text-gray-400 uppercase tracking-wider\">Total Companies</p>\r\n              <p className=\"text-4xl font-bold text-gray-900 mt-3 group-hover:scale-105 transition-transform origin-left\">\r\n                {stats.total ?? 0}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-3 bg-blue-50 text-blue-600 rounded-xl group-hover:bg-blue-600 group-hover:text-white transition-colors\">\r\n              <Grid size={24} />\r\n            </div>\r\n          </div>\r\n          <div className=\"mt-4 flex items-center text-sm text-gray-500\">\r\n            <span className=\"text-green-500 flex items-center mr-2\"><TrendingUp className=\"mr-1\" /> +12%</span>  from last month\r\n          </div>\r\n        </div>\r\n\r\n        {/* Card 2: Active Tenants */}\r\n        <div className=\"bg-white p-8 rounded-2xl border border-gray-100 shadow-sm hover:shadow-lg transition-all duration-300 relative overflow-hidden group\">\r\n          <div className=\"flex justify-between items-start\">\r\n            <div>\r\n              <p className=\"text-sm font-semibold text-gray-400 uppercase tracking-wider\">Active Tenants</p>\r\n              <p className=\"text-4xl font-bold text-gray-900 mt-3 group-hover:scale-105 transition-transform origin-left\">\r\n                {stats.active ?? 0}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-3 bg-green-50 text-green-600 rounded-xl group-hover:bg-green-600 group-hover:text-white transition-colors\">\r\n              <Users size={24} />\r\n            </div>\r\n          </div>\r\n          <div className=\"mt-4 flex items-center text-sm text-gray-500\">\r\n            <span className=\"text-green-500 font-medium\">Healthy</span> system status\r\n          </div>\r\n        </div>\r\n\r\n        {/* Card 3: Inactive/Suspended */}\r\n        <div className=\"bg-white p-8 rounded-2xl border border-gray-100 shadow-sm hover:shadow-lg transition-all duration-300 relative overflow-hidden group\">\r\n          <div className=\"flex justify-between items-start\">\r\n            <div>\r\n              <p className=\"text-sm font-semibold text-gray-400 uppercase tracking-wider\">Inactive / Suspended</p>\r\n              <p className=\"text-4xl font-bold text-gray-900 mt-3 group-hover:scale-105 transition-transform origin-left\">\r\n                {stats.inactive ?? 0}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-3 bg-rose-50 text-rose-600 rounded-xl group-hover:bg-rose-600 group-hover:text-white transition-colors\">\r\n              <Activity size={24} />\r\n            </div>\r\n          </div>\r\n          <div className=\"mt-4 flex items-center text-sm text-gray-500\">\r\n            Requires admin attention\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\EditCompany.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCompany'. Either include it or remove the dependency array.","line":57,"column":8,"nodeType":"ArrayExpression","endLine":57,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadCompany]","fix":{"range":[1987,1991],"text":"[id, loadCompany]"}}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":130,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport {\r\n    ArrowLeft,\r\n    Upload,\r\n    Check,\r\n    Briefcase,\r\n    Users,\r\n    DollarSign,\r\n    Clock,\r\n    Activity,\r\n    Cpu,\r\n    Save\r\n} from 'lucide-react';\r\nimport companiesService from '../../services/companiesService';\r\n\r\nexport default function EditCompany() {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const fileInputRef = useRef(null);\r\n\r\n    // Form State\r\n    const [formData, setFormData] = useState({\r\n        code: '',\r\n        name: '',\r\n        email: '',\r\n        // password: '', // Password editing usually separate for security\r\n        modules: [],\r\n        status: 'active'\r\n    });\r\n    const [logoFile, setLogoFile] = useState(null);\r\n    const [logoPreview, setLogoPreview] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const [errors, setErrors] = useState({});\r\n\r\n    // Modules\r\n    const availableModules = [\r\n        { id: 'hr', name: 'HR Management', icon: Users, desc: 'Employees & Depts' },\r\n        { id: 'payroll', name: 'Payroll', icon: DollarSign, desc: 'Salary & Tax' },\r\n        { id: 'attendance', name: 'Attendance', icon: Clock, desc: 'Time & Shifts' },\r\n        { id: 'recruitment', name: 'Recruitment', icon: Briefcase, desc: 'Hiring Pipeline' },\r\n        { id: 'performance', name: 'Performance', icon: Activity, desc: 'Goals & Reviews' },\r\n        { id: 'leave', name: 'Leave Mgmt', icon: Cpu, desc: 'Time Off' },\r\n    ];\r\n\r\n    // Environment helper\r\n    const API_BASE = import.meta.env.VITE_API_BASE || 'http://localhost:5000/api';\r\n    const API_ORIGIN = API_BASE.replace(/\\/api\\/?$/, '');\r\n    const getLogoUrl = (url) => {\r\n        if (!url) return null;\r\n        return url.startsWith('http') ? url : `${API_ORIGIN}${url}`;\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadCompany();\r\n    }, [id]);\r\n\r\n    const loadCompany = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const data = await companiesService.getCompanyById(id);\r\n            setFormData({\r\n                code: data.code || '',\r\n                name: data.name || '',\r\n                email: data.meta?.email || '',\r\n                modules: data.modules || [],\r\n                status: data.status || 'active'\r\n            });\r\n            if (data.meta?.logo) {\r\n                setLogoPreview(getLogoUrl(data.meta.logo));\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to load company', error);\r\n            alert('Error loading company data');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleInputChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: value }));\r\n        if (errors[name]) setErrors(prev => ({ ...prev, [name]: '' }));\r\n    };\r\n\r\n    const handleLogoUpload = (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        if (!file.type.startsWith('image/')) return alert('Images only');\r\n\r\n        const reader = new FileReader();\r\n        reader.onloadend = () => setLogoPreview(reader.result);\r\n        reader.readAsDataURL(file);\r\n        setLogoFile(file);\r\n    };\r\n\r\n    const handleModuleToggle = (modId) => {\r\n        setFormData(prev => {\r\n            const newModules = prev.modules.includes(modId)\r\n                ? prev.modules.filter(m => m !== modId)\r\n                : [...prev.modules, modId];\r\n            return { ...prev, modules: newModules };\r\n        });\r\n    };\r\n\r\n    const validate = () => {\r\n        const errs = {};\r\n        if (!formData.code) errs.code = 'Required';\r\n        if (!formData.name) errs.name = 'Required';\r\n        if (!formData.email) errs.email = 'Required';\r\n        if (!formData.modules.length) errs.modules = 'Select at least one';\r\n        setErrors(errs);\r\n        return Object.keys(errs).length === 0;\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!validate()) return;\r\n\r\n        setSubmitting(true);\r\n        try {\r\n            let logoUrl = formData.logo; // Keep existing logic if no new file\r\n\r\n            // 1. Upload Logo if CHANGED\r\n            if (logoFile) {\r\n                try {\r\n                    const upRes = await companiesService.uploadLogo(logoFile);\r\n                    logoUrl = upRes.url || upRes.path || '';\r\n                } catch (e) { console.warn('Logo upload excluded'); }\r\n            }\r\n\r\n            // 2. Prepare Payload\r\n            const payload = {\r\n                code: formData.code,\r\n                name: formData.name,\r\n                status: formData.status,\r\n                modules: formData.modules,\r\n                meta: {\r\n                    ...formData.meta, // Preserve other meta\r\n                    primaryEmail: formData.email,\r\n                    email: formData.email,\r\n                    logo: logoUrl || undefined // Only send if we have a URL\r\n                }\r\n            };\r\n\r\n            // 3. Update Company\r\n            await companiesService.updateCompany(id, payload);\r\n\r\n            // 4. Redirect\r\n            navigate('/psa/companies');\r\n\r\n        } catch (error) {\r\n            console.error(error);\r\n            alert('Failed to update company. Check console.');\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"p-10 text-center\">Loading...</div>;\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 p-8 font-sans\">\r\n            <div className=\"max-w-5xl mx-auto\">\r\n                <div className=\"flex items-center justify-between mb-8\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <button onClick={() => navigate('/psa/companies')} className=\"p-2 bg-white border border-gray-200 hover:bg-gray-50 rounded-lg transition-colors text-gray-600 shadow-sm\">\r\n                            <ArrowLeft size={20} />\r\n                        </button>\r\n                        <div>\r\n                            <h1 className=\"text-2xl font-bold text-gray-900\">Edit Company</h1>\r\n                            <p className=\"text-sm text-gray-500\">Update company details and settings</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                    {/* LEFT: Details */}\r\n                    <div className=\"lg:col-span-2 space-y-6\">\r\n                        {/* Company Info */}\r\n                        <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-100\">\r\n                            <h3 className=\"tex-sm font-semibold text-gray-400 uppercase tracking-wide mb-4\">Company Information</h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Company ID *</label>\r\n                                    <input\r\n                                        type=\"text\" name=\"code\" value={formData.code} onChange={handleInputChange}\r\n                                        className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all ${errors.code ? 'border-red-500' : 'border-gray-200'}`}\r\n                                    />\r\n                                    {errors.code && <p className=\"text-xs text-red-500 mt-1\">{errors.code}</p>}\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Company Name *</label>\r\n                                    <input\r\n                                        type=\"text\" name=\"name\" value={formData.name} onChange={handleInputChange}\r\n                                        className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all ${errors.name ? 'border-red-500' : 'border-gray-200'}`}\r\n                                    />\r\n                                    {errors.name && <p className=\"text-xs text-red-500 mt-1\">{errors.name}</p>}\r\n                                </div>\r\n                                <div className=\"md:col-span-2\">\r\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Logo</label>\r\n                                    <div\r\n                                        onClick={() => fileInputRef.current?.click()}\r\n                                        className=\"border-2 border-dashed border-gray-200 rounded-xl p-6 flex flex-col items-center justify-center text-center hover:bg-gray-50 cursor-pointer transition-colors\"\r\n                                    >\r\n                                        {logoPreview ? (\r\n                                            <img src={logoPreview} className=\"h-20 object-contain mb-2\" alt=\"Preview\" />\r\n                                        ) : (\r\n                                            <Upload className=\"text-gray-400 w-8 h-8 mb-2\" />\r\n                                        )}\r\n                                        <p className=\"text-sm text-gray-600 font-medium\">Click to change logo</p>\r\n                                        <input type=\"file\" ref={fileInputRef} className=\"hidden\" accept=\"image/*\" onChange={handleLogoUpload} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Admin Info */}\r\n                        <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-100\">\r\n                            <h3 className=\"tex-sm font-semibold text-gray-400 uppercase tracking-wide mb-4\">Admin Contact</h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Admin Email *</label>\r\n                                    <input\r\n                                        type=\"email\" name=\"email\" value={formData.email} onChange={handleInputChange}\r\n                                        className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all ${errors.email ? 'border-red-500' : 'border-gray-200'}`}\r\n                                    />\r\n                                    {errors.email && <p className=\"text-xs text-red-500 mt-1\">{errors.email}</p>}\r\n                                </div>\r\n                                {/* Password usually not editable here directly or needs a \"Create New Password\" flow */}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* RIGHT: Modules & Actions */}\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-100\">\r\n                            <h3 className=\"tex-sm font-semibold text-gray-400 uppercase tracking-wide mb-4\">Modules</h3>\r\n                            <div className=\"space-y-3\">\r\n                                {availableModules.map(mod => (\r\n                                    <div\r\n                                        key={mod.id}\r\n                                        onClick={() => handleModuleToggle(mod.id)}\r\n                                        className={`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-all ${formData.modules.includes(mod.id)\r\n                                            ? 'bg-blue-50 border-blue-200'\r\n                                            : 'bg-white border-gray-100 hover:border-gray-200'\r\n                                            }`}\r\n                                    >\r\n                                        <div className={`p-1.5 rounded ${formData.modules.includes(mod.id) ? 'bg-blue-100 text-blue-600' : 'bg-gray-100 text-gray-500'}`}>\r\n                                            <mod.icon size={14} />\r\n                                        </div>\r\n                                        <div className=\"flex-1\">\r\n                                            <div className=\"flex items-center justify-between\">\r\n                                                <span className={`text-sm font-medium ${formData.modules.includes(mod.id) ? 'text-blue-900' : 'text-gray-700'}`}>{mod.name}</span>\r\n                                                {formData.modules.includes(mod.id) && <Check className=\"text-blue-600\" size={14} />}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                            {errors.modules && <p className=\"text-xs text-red-500 mt-3 text-center\">Please select at least one module</p>}\r\n                        </div>\r\n\r\n                        <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-100\">\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Status</label>\r\n                            <select\r\n                                name=\"status\"\r\n                                value={formData.status}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                            >\r\n                                <option value=\"active\">Active</option>\r\n                                <option value=\"inactive\">Inactive</option>\r\n                            </select>\r\n\r\n                            <div className=\"mt-6 pt-6 border-t border-gray-100 flex flex-col gap-3\">\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={submitting}\r\n                                    className=\"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-lg shadow-blue-200 transition-all active:scale-95 disabled:opacity-70 disabled:active:scale-100 flex items-center justify-center gap-2\"\r\n                                >\r\n                                    <Save /> {submitting ? 'Saving...' : 'Save Changes'}\r\n                                </button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => navigate('/psa/companies')}\r\n                                    className=\"w-full py-3 bg-white border border-gray-200 text-gray-600 font-medium rounded-xl hover:bg-gray-50\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\ModuleConfig.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":23,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"error"},"fix":{"range":[1084,1089],"text":""},"desc":"Remove unused variable 'error'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":26,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"navigate"},"fix":{"range":[1249,1280],"text":""},"desc":"Remove unused variable 'navigate'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api from \"../../utils/api\";\r\nimport { Save, Settings, Check, X, Layers } from \"lucide-react\";\r\n\r\n/**\r\n * ModuleConfig UI - Enterprise Upgrade\r\n */\r\n\r\nconst AVAILABLE_MODULES = [\r\n  { code: \"hr\", label: \"HR Management\", description: \"Employee management, roles, policies\" },\r\n  { code: \"payroll\", label: \"Payroll Processing\", description: \"Salary processing, tax, & payslips\" },\r\n  { code: \"attendance\", label: \"Time & Attendance\", description: \"Punch in/out, shifts & timesheets\" },\r\n  { code: \"ess\", label: \"ESS Portal\", description: \"Employee self-service access\" },\r\n  { code: \"recruitment\", label: \"Recruitment\", description: \"Job posting & hiring workflows\" },\r\n  { code: \"analytics\", label: \"Analytics & Reports\", description: \"Data insights & dashboards\" },\r\n];\r\n\r\nexport default function ModuleConfig({ company, onClose }) {\r\n  const [modules, setModules] = useState([]);\r\n  const [saving, setSaving] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [companies, setCompanies] = useState([]);\r\n  const [selectedCompany, setSelectedCompany] = useState(company || null);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    setModules(company?.modules ? [...company.modules] : []);\r\n    setError(null);\r\n    if (!company) {\r\n      loadCompanies();\r\n    } else {\r\n      setSelectedCompany(company);\r\n    }\r\n  }, [company]);\r\n\r\n  async function loadCompanies() {\r\n    try {\r\n      const res = await api.get('/tenants');\r\n      const payload = res.data;\r\n      const list = Array.isArray(payload)\r\n        ? payload\r\n        : (Array.isArray(payload?.tenants) ? payload.tenants : (Array.isArray(payload?.data) ? payload.data : []));\r\n      setCompanies(list || []);\r\n    } catch (err) {\r\n      console.error('Failed to load companies', err);\r\n    }\r\n  }\r\n\r\n  function toggle(code) {\r\n    setModules((prev) =>\r\n      prev.includes(code) ? prev.filter((c) => c !== code) : [...prev, code]\r\n    );\r\n  }\r\n\r\n  async function handleSave() {\r\n    const target = selectedCompany || company;\r\n    if (!target?._id) return alert(\"Please select a company first.\");\r\n    setSaving(true);\r\n    setError(null);\r\n    try {\r\n      await api.put(`/tenants/${target._id}/modules`, { modules });\r\n      alert(\"Modules updated successfully!\");\r\n      if (typeof onClose === 'function') onClose(); // Close modal if used as modal\r\n    } catch (err) {\r\n      console.error(err);\r\n      setError(\"Failed to save modules. Please try again.\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  // Common UI Render Logic for Module Card\r\n  const renderModuleCard = (m) => {\r\n    const active = modules.includes(m.code);\r\n    return (\r\n      <div\r\n        key={m.code}\r\n        onClick={() => !saving && toggle(m.code)}\r\n        className={`cursor-pointer group relative p-6 rounded-xl border-2 transition-all duration-200 ${active\r\n          ? 'border-blue-500 bg-blue-50/30'\r\n          : 'border-transparent bg-white shadow-sm hover:shadow-md hover:border-gray-200'\r\n          }`}\r\n      >\r\n        <div className=\"flex items-start justify-between mb-3\">\r\n          <div className={`p-2 rounded-lg ${active ? 'bg-blue-100 text-blue-600' : 'bg-gray-100 text-gray-400 group-hover:bg-gray-200'}`}>\r\n            <Layers size={20} />\r\n          </div>\r\n          <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${active ? 'bg-blue-500 border-blue-500' : 'bg-transparent border-gray-300'\r\n            }`}>\r\n            {active && <Check size={14} className=\"text-white\" />}\r\n          </div>\r\n        </div>\r\n        <h3 className={`text-base font-bold ${active ? 'text-blue-900' : 'text-gray-800'}`}>{m.label}</h3>\r\n        <p className=\"text-xs text-gray-500 mt-1\">{m.description}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 p-8 font-sans\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 tracking-tight flex items-center gap-3\">\r\n              <Settings className=\"text-gray-400\" /> Module Configuration\r\n            </h1>\r\n            <p className=\"text-sm text-gray-500 mt-2 ml-1\">Enable or disable system modules for individual tenants.</p>\r\n          </div>\r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              onClick={handleSave}\r\n              disabled={saving || !selectedCompany}\r\n              className=\"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-lg shadow-blue-200 transition-all active:scale-95 disabled:opacity-50 disabled:shadow-none flex items-center gap-2\"\r\n            >\r\n              {saving ? <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent\"></div> : <Save />}\r\n              {saving ? 'Saving...' : 'Save Changes'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Selection Area */}\r\n        <div className=\"bg-white rounded-2xl shadow-sm border border-gray-100 p-8 mb-8\">\r\n          <label className=\"block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide\">Select Tenant Company</label>\r\n          <div className=\"relative max-w-xl\">\r\n            <select\r\n              className=\"w-full px-5 py-3 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all appearance-none text-gray-700 font-medium cursor-pointer arrow-down-bg\"\r\n              value={selectedCompany?._id || ''}\r\n              onChange={(e) => {\r\n                const id = e.target.value;\r\n                const c = companies.find((x) => x._id === id) || null;\r\n                setSelectedCompany(c);\r\n                setModules(c?.modules ? [...c.modules] : []);\r\n              }}\r\n            >\r\n              <option value=\"\">-- Choose a Company from List --</option>\r\n              {companies.map((c) => (\r\n                <option key={c._id} value={c._id}>\r\n                  {c.name} ({c.code})\r\n                </option>\r\n              ))}\r\n            </select>\r\n            <div className=\"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500\">\r\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Modules Grid */}\r\n        {selectedCompany ? (\r\n          <div className=\"animate-fade-in-up\">\r\n            <h3 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2\">\r\n              Available Modules <span className=\"text-xs font-normal text-gray-500 bg-gray-200 px-2 py-0.5 rounded-full\">{modules.length} Active</span>\r\n            </h3>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n              {AVAILABLE_MODULES.map(renderModuleCard)}\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-center py-20 bg-white rounded-2xl border border-dashed border-gray-300\">\r\n            <div className=\"w-16 h-16 bg-gray-50 text-gray-300 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n              <Settings size={32} />\r\n            </div>\r\n            <h3 className=\"text-lg font-medium text-gray-900\">No Company Selected</h3>\r\n            <p className=\"text-gray-500 mt-1\">Please select a company above to configure its modules.</p>\r\n          </div>\r\n        )}\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nModuleConfig.propTypes = {\r\n  company: PropTypes.shape({\r\n    _id: PropTypes.string,\r\n    name: PropTypes.string,\r\n    modules: PropTypes.arrayOf(PropTypes.string),\r\n  }),\r\n  onClose: PropTypes.func, // Optional: used when rendered as modal\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\PSAReplica.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\PSA\\ViewCompany.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCompany'. Either include it or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadCompany]","fix":{"range":[927,931],"text":"[id, loadCompany]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport {\r\n    ArrowLeft,\r\n    Mail,\r\n    Globe,\r\n    Calendar,\r\n    CheckCircle,\r\n    Package,\r\n    Edit3,\r\n    Hash,\r\n    Shield\r\n} from 'lucide-react';\r\nimport companiesService from '../../services/companiesService';\r\n\r\nexport default function ViewCompany() {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const [company, setCompany] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Helper for safe logo URL\r\n    const API_BASE = import.meta.env.VITE_API_BASE || 'http://localhost:5000/api';\r\n    const API_ORIGIN = API_BASE.replace(/\\/api\\/?$/, '');\r\n    const getLogoUrl = (url) => {\r\n        if (!url) return null;\r\n        return url.startsWith('http') ? url : `${API_ORIGIN}${url}`;\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadCompany();\r\n    }, [id]);\r\n\r\n    const loadCompany = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const data = await companiesService.getCompanyById(id);\r\n            setCompany(data);\r\n        } catch (error) {\r\n            console.error('Failed to load company details', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\r\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n    );\r\n\r\n    if (!company) return (\r\n        <div className=\"min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4\">\r\n            <div className=\"text-red-500 text-xl font-semibold mb-2\">Company not found</div>\r\n            <button onClick={() => navigate('/psa/companies')} className=\"text-blue-600 hover:underline\">\r\n                Return to Companies List\r\n            </button>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 font-sans pb-12\">\r\n            {/* Top Navigation Bar */}\r\n            <div className=\"bg-white border-b border-gray-200 sticky top-0 z-10 px-8 py-4 flex items-center justify-between shadow-sm\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <button\r\n                        onClick={() => navigate('/psa/companies')}\r\n                        className=\"p-2 -ml-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-all\"\r\n                    >\r\n                        <ArrowLeft size={20} />\r\n                    </button>\r\n                    <div>\r\n                        <h1 className=\"text-lg font-bold text-gray-900\">Company Profile</h1>\r\n                        <p className=\"text-xs text-gray-500\">View and manage tenant details</p>\r\n                    </div>\r\n                </div>\r\n                <button\r\n                    onClick={() => navigate(`/psa/companies/edit/${company._id}`)}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium shadow-sm transition-all active:scale-95\"\r\n                >\r\n                    <Edit3 /> Edit Company\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"max-w-7xl mx-auto px-6 py-8 space-y-8\">\r\n\r\n                {/* 1. Hero Section */}\r\n                <div className=\"bg-white rounded-2xl p-8 shadow-sm border border-gray-100 flex flex-col md:flex-row items-start md:items-center gap-8\">\r\n                    {/* Logo Box */}\r\n                    <div className=\"w-32 h-32 flex-shrink-0 bg-gray-50 rounded-2xl border border-gray-200 p-2 flex items-center justify-center shadow-inner\">\r\n                        {company.meta?.logo ? (\r\n                            <img src={getLogoUrl(company.meta.logo)} alt=\"Logo\" className=\"w-full h-full object-contain\" />\r\n                        ) : (\r\n                            <span className=\"text-4xl font-bold text-gray-300 select-none\">{company.name?.charAt(0)}</span>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Main Info */}\r\n                    <div className=\"flex-1 space-y-4\">\r\n                        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                            <div>\r\n                                <h1 className=\"text-3xl font-bold text-gray-900 tracking-tight\">{company.name}</h1>\r\n                                <div className=\"flex items-center gap-4 mt-2 text-sm text-gray-500\">\r\n                                    <span className=\"flex items-center gap-1.5 px-2.5 py-1 bg-gray-100 rounded-md font-mono text-gray-600\">\r\n                                        <Hash className=\"text-gray-400\" /> {company.code}\r\n                                    </span>\r\n                                    <span className=\"flex items-center gap-1.5\">\r\n                                        <Globe className=\"text-gray-400\" /> {company.domain || 'No domain configured'}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Status Badge */}\r\n                            <div className={`px-4 py-1.5 rounded-full text-sm font-semibold border flex items-center gap-2 ${company.status === 'active'\r\n                                ? 'bg-green-50 text-green-700 border-green-200'\r\n                                : 'bg-red-50 text-red-700 border-red-200'\r\n                                }`}>\r\n                                <div className={`w-2 h-2 rounded-full ${company.status === 'active' ? 'bg-green-500' : 'bg-red-500'}`}></div>\r\n                                {company.status === 'active' ? 'Active Subscription' : 'Inactive Account'}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n\r\n                    {/* 2. Contact & Admin Information */}\r\n                    <div className=\"lg:col-span-1 space-y-6\">\r\n                        <div className=\"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden\">\r\n                            <div className=\"px-6 py-4 border-b border-gray-100 bg-gray-50/50\">\r\n                                <h3 className=\"font-semibold text-gray-900 flex items-center gap-2\">\r\n                                    <Shield className=\"text-blue-500\" /> Admin Contact\r\n                                </h3>\r\n                            </div>\r\n                            <div className=\"p-6 space-y-5\">\r\n                                <div>\r\n                                    <div className=\"text-xs font-semibold text-gray-400 uppercase tracking-wide mb-1\">Primary Email</div>\r\n                                    <div className=\"flex items-center gap-3 text-gray-700\">\r\n                                        <div className=\"p-2 bg-blue-50 text-blue-600 rounded-lg\">\r\n                                            <Mail size={18} />\r\n                                        </div>\r\n                                        <span className=\"font-medium\">{company.meta?.email || 'N/A'}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"text-xs font-semibold text-gray-400 uppercase tracking-wide mb-1\">Backup Email / Owner</div>\r\n                                    <div className=\"flex items-center gap-3 text-gray-700\">\r\n                                        <div className=\"p-2 bg-purple-50 text-purple-600 rounded-lg\">\r\n                                            <Mail size={18} />\r\n                                        </div>\r\n                                        <span className=\"font-medium\">{company.meta?.primaryEmail || 'N/A'}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"text-xs font-semibold text-gray-400 uppercase tracking-wide mb-1\">Created On</div>\r\n                                    <div className=\"flex items-center gap-3 text-gray-700\">\r\n                                        <div className=\"p-2 bg-orange-50 text-orange-600 rounded-lg\">\r\n                                            <Calendar size={18} />\r\n                                        </div>\r\n                                        <span className=\"font-medium\">\r\n                                            {new Date(company.createdAt).toLocaleDateString('en-US', {\r\n                                                year: 'numeric',\r\n                                                month: 'long',\r\n                                                day: 'numeric'\r\n                                            })}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 3. Modules & System Plan */}\r\n                    <div className=\"lg:col-span-2 space-y-6\">\r\n                        <div className=\"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden h-full\">\r\n                            <div className=\"px-6 py-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center\">\r\n                                <h3 className=\"font-semibold text-gray-900 flex items-center gap-2\">\r\n                                    <Package className=\"text-indigo-500\" /> Subscribed Modules\r\n                                </h3>\r\n                                <span className=\"text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded\">\r\n                                    Plan: {company.plan?.toUpperCase() || 'STANDARD'}\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"p-8\">\r\n                                {company.modules && company.modules.length > 0 ? (\r\n                                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                                        {company.modules.map((mod) => (\r\n                                            <div key={mod} className=\"flex items-center gap-3 p-4 bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-md hover:border-blue-200 transition-all group\">\r\n                                                <div className=\"w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition-colors\">\r\n                                                    <CheckCircle size={20} />\r\n                                                </div>\r\n                                                <div>\r\n                                                    <h4 className=\"font-medium text-gray-900 capitalize\">{mod.replace('-', ' ')}</h4>\r\n                                                    <span className=\"text-xs text-green-600 font-medium\">Active</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"text-center py-12\">\r\n                                        <div className=\"w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n                                            <Package className=\"text-gray-300 w-8 h-8\" />\r\n                                        </div>\r\n                                        <h3 className=\"text-gray-900 font-medium\">No Modules Active</h3>\r\n                                        <p className=\"text-gray-500 text-sm mt-1\">This company has not subscribed to any modules yet.</p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\VerifyCompany.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  11 |     if (!token) {\n  12 |       // eslint-disable-next-line react-hooks/set-state-in-effect\n> 13 |       setStatus('error');\n     |       ^^^^^^^^^ Avoid calling setState() directly within an effect\n  14 |       setMessage('Missing verification token');\n  15 |       return;\n  16 |     }","line":13,"column":7,"nodeType":null,"endLine":13,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\pages\\settings\\CompanySettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\router\\AppRoutes.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"useEffect"},"fix":{"range":[12,27],"text":""},"desc":"Remove unused variable 'useEffect'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\r\nimport { Routes, Route, Navigate, Outlet } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { getToken, isValidToken } from '../utils/token';\r\n\r\n// Layouts\r\nimport PsaLayout from '../layouts/PsaLayout';\r\nimport HrLayout from '../layouts/HrLayout';\r\nimport EssLayout from '../layouts/EssLayout';\r\nimport ProtectedRoute from '../components/layout/ProtectedRoute';\r\nimport CandidateProtectedRoute from '../routes/CandidateProtectedRoute';\r\nimport CandidateLayout from '../layouts/CandidateLayout';\r\n\r\n// PSA Pages\r\nimport Dashboard from '../pages/PSA/Dashboard';\r\nimport CompanyList from '../pages/PSA/CompanyList';\r\nimport AddCompany from '../pages/PSA/AddCompany';\r\nimport EditCompany from '../pages/PSA/EditCompany';\r\nimport ViewCompany from '../pages/PSA/ViewCompany';\r\nimport ModuleConfig from '../pages/PSA/ModuleConfig';\r\nimport Activities from '../pages/PSA/Activities';\r\n\r\n// Auth\r\nimport Login from '../pages/Auth/Login';\r\nimport HRLogin from '../pages/Auth/HRLogin';\r\nimport EmployeeLogin from '../pages/Auth/EmployeeLogin';\r\n\r\n// HR Pages\r\nimport HRDashboard from '../pages/HR/HRDashboard';\r\nimport Employees from '../pages/HR/Employees';\r\nimport Departments from '../pages/HR/Departments';\r\nimport LeavePolicies from '../pages/HR/LeavePolicies';\r\nimport LeaveApprovals from '../pages/HR/LeaveApprovals';\r\nimport RegularizationApprovals from '../pages/HR/RegularizationApprovals';\r\nimport OrgStructure from '../pages/HR/OrgStructure';\r\nimport UserManagement from '../pages/HR/UserManagement';\r\nimport CeoOrg from '../pages/HR/CeoOrg';\r\nimport AccessControl from '../pages/HR/AccessControl';\r\nimport OfferTemplates from '../pages/HR/OfferTemplates';\r\nimport RequirementPage from '../pages/HR/RequirementPage';\r\nimport Applicants from '../pages/HR/Applicants';\r\nimport AttendanceAdmin from '../pages/HR/AttendanceAdmin';\r\nimport CalendarManagement from '../pages/HR/CalendarManagement';\r\nimport CandidateStatusTracker from '../pages/HR/CandidateStatusTracker';\r\nimport CandidateTimeline from '../pages/HR/CandidateStatusTracker/CandidateTimeline';\r\nimport PaySlipDesign from '../pages/HR/Payroll/PaySlipDesign';\r\nimport AttendanceHistory from '../pages/HR/AttendanceHistory';\r\n\r\n// Letter modules\r\nimport LetterTemplates from '../pages/HR/LetterTemplates';\r\nimport LetterSettings from '../pages/HR/LetterSettings';\r\nimport TemplatePreview from '../pages/HR/TemplatePreview';\r\nimport SalaryStructure from '../pages/HR/SalaryStructure';\r\nimport CreateRequirement from '../pages/HR/CreateRequirement';\r\n\r\n// Settings\r\nimport CompanySettings from '../pages/settings/CompanySettings';\r\n\r\n// Payroll\r\nimport SalaryComponents from '../pages/HR/Payroll/SalaryComponents';\r\nimport NewEarning from '../pages/HR/Payroll/NewEarning';\r\nimport NewBenefit from '../pages/HR/Payroll/NewBenefit';\r\nimport NewSalaryTemplate from '../pages/HR/Payroll/NewSalaryTemplate';\r\nimport NewDeduction from '../pages/HR/Payroll/Deductions/NewDeduction';\r\nimport PayrollRules from '../pages/Admin/PayrollRules';\r\nimport RunPayroll from '../pages/HR/Payroll/RunPayroll';\r\nimport Payslips from '../pages/HR/Payroll/Payslips';\r\nimport ProcessPayroll from '../pages/HR/Payroll/ProcessPayroll';\r\nimport PayrollDashboard from '../pages/HR/Payroll/PayrollDashboard';\r\n\r\n// Employee\r\nimport EmployeeDashboard from '../pages/Employee/EmployeeDashboard';\r\n\r\n// Global\r\nimport EntityDetail from '../pages/Global/EntityDetail';\r\nimport MyRequests from '../pages/Global/MyRequests';\r\nimport NotFound from '../pages/NotFound';\r\nimport VerifyCompany from '../pages/VerifyCompany';\r\nimport JobApplication from '../pages/JobApplication/JobApplication';\r\nimport Jobs from '../pages/JobApplication/JobsList';\r\nimport FaceAttendance from '../pages/Employee/FaceAttendance';\r\n\r\n// Candidate Pages\r\nimport CandidateLogin from '../pages/Candidate/CandidateLogin';\r\nimport CandidateSignup from '../pages/Candidate/CandidateRegister';\r\nimport CandidateDashboard from '../pages/Candidate/CandidateDashboard';\r\nimport CandidateOpenPositions from '../pages/Candidate/CandidateOpenPositions';\r\nimport CandidateApplications from '../pages/Candidate/CandidateApplications';\r\nimport CandidateProfile from '../pages/Candidate/CandidateProfile';\r\nimport ApplicationTrack from '../pages/ApplicationTrack';\r\n\r\n// Helper for Candidate Outlet\r\nconst OutletProxy = () => <Outlet />;\r\n\r\nexport default function AppRoutes() {\r\n    return (\r\n        <Routes>\r\n            <Route path=\"/\" element={<AutoHome />} />\r\n\r\n            {/* --- PUBLIC AUTH ROUTES --- */}\r\n            <Route path=\"/login\" element={<Login />} />\r\n            <Route path=\"/login/hr\" element={<HRLogin />} />\r\n            <Route path=\"/login/employee\" element={<EmployeeLogin />} />\r\n\r\n            {/* --- PUBLIC CANDIDATE ROUTES --- */}\r\n            <Route path=\"/candidate/login\" element={<CandidateLogin />} />\r\n            <Route path=\"/candidate/signup\" element={<CandidateSignup />} />\r\n            <Route path=\"/jobs/:companyId\" element={<Jobs />} />\r\n\r\n            {/* --- PROTECTED CANDIDATE ROUTES --- */}\r\n            <Route path=\"/candidate\" element={\r\n                <CandidateProtectedRoute>\r\n                    <CandidateLayout />\r\n                </CandidateProtectedRoute>\r\n            }>\r\n                <Route path=\"dashboard\" element={<CandidateDashboard />} />\r\n                <Route path=\"open-positions\" element={<CandidateOpenPositions />} />\r\n                <Route path=\"applications\" element={<CandidateApplications />} />\r\n                <Route path=\"profile\" element={<CandidateProfile />} />\r\n            </Route>\r\n\r\n            <Route element={<CandidateProtectedRoute><OutletProxy /></CandidateProtectedRoute>}>\r\n                <Route path=\"/candidate/application/:applicationId\" element={<ApplicationTrack />} />\r\n            </Route>\r\n\r\n            <Route path=\"/apply-job/:requirementId\" element={<JobApplication />} />\r\n\r\n            {/* --- PSA ROUTES --- */}\r\n            <Route\r\n                path=\"/psa\"\r\n                element={\r\n                    <ProtectedRoute allowedRoles={['psa']}>\r\n                        <PsaLayout />\r\n                    </ProtectedRoute>\r\n                }\r\n            >\r\n                <Route index element={<Dashboard />} />\r\n                <Route path=\"companies\" element={<CompanyList />} />\r\n                <Route path=\"companies/add\" element={<AddCompany />} />\r\n                <Route path=\"companies/edit/:id\" element={<EditCompany />} />\r\n                <Route path=\"companies/view/:id\" element={<ViewCompany />} />\r\n                <Route path=\"modules\" element={<ModuleConfig />} />\r\n                <Route path=\"modules/:id\" element={<ModuleConfig />} />\r\n                <Route path=\"activities\" element={<Activities />} />\r\n            </Route>\r\n\r\n            {/* --- HR ROUTES --- */}\r\n            <Route path=\"/hr\" element={\r\n                <ProtectedRoute allowedRoles={['hr', 'admin']}>\r\n                    <HrLayout />\r\n                </ProtectedRoute>\r\n            }>\r\n                <Route index element={<HRDashboard />} />\r\n                <Route path=\"employees\" element={<Employees />} />\r\n                <Route path=\"users\" element={<UserManagement />} />\r\n                <Route path=\"departments\" element={<Departments />} />\r\n                <Route path=\"leaves\" element={<Navigate to=\"leave-approvals\" replace />} />\r\n                <Route path=\"leave-approvals\" element={<LeaveApprovals />} />\r\n                <Route path=\"leave-approvals/regularization\" element={<RegularizationApprovals category=\"Leave\" />} />\r\n                <Route path=\"attendance\" element={<AttendanceAdmin />} />\r\n                <Route path=\"attendance/correction\" element={<RegularizationApprovals category=\"Attendance\" />} />\r\n                <Route path=\"attendance-calendar\" element={<CalendarManagement />} />\r\n                <Route path=\"leave-policies\" element={<LeavePolicies />} />\r\n                <Route path=\"requirements\" element={<RequirementPage />} />\r\n                <Route path=\"create-requirement\" element={<CreateRequirement />} />\r\n                <Route path=\"applicants\" element={<Applicants />} />\r\n                <Route path=\"candidate-status\" element={<CandidateStatusTracker />} />\r\n                <Route path=\"candidate-status/:id\" element={<CandidateTimeline />} />\r\n                <Route path=\"org\" element={<OrgStructure />} />\r\n                <Route path=\"org-tree\" element={<CeoOrg />} />\r\n                <Route path=\"access\" element={<AccessControl />} />\r\n                <Route path=\"offer-templates\" element={<OfferTemplates />} />\r\n                <Route path=\"attendance-history\" element={<AttendanceHistory />} />\r\n\r\n                {/* Letters */}\r\n                <Route path=\"letter-templates\" element={<LetterTemplates />} />\r\n                <Route path=\"letter-templates/:templateId/preview\" element={<TemplatePreview />} />\r\n                <Route path=\"letter-settings\" element={<LetterSettings />} />\r\n\r\n                {/* Payroll */}\r\n                <Route path=\"salary-structure/:candidateId\" element={<SalaryStructure />} />\r\n                <Route path=\"payroll/dashboard\" element={<PayrollDashboard />} />\r\n                <Route path=\"payroll/salary-components\" element={<SalaryComponents />} />\r\n                <Route path=\"payroll/earnings/new\" element={<NewEarning />} />\r\n                <Route path=\"payroll/earnings/edit/:id\" element={<NewEarning />} />\r\n                <Route path=\"payroll/deductions/new\" element={<NewDeduction />} />\r\n                <Route path=\"payroll/deductions/edit/:id\" element={<NewDeduction />} />\r\n                <Route path=\"payroll/benefits/new\" element={<NewBenefit />} />\r\n                <Route path=\"payroll/benefits/edit/:id\" element={<NewBenefit />} />\r\n                <Route path=\"payroll/salary-templates/new\" element={<NewSalaryTemplate />} />\r\n                <Route path=\"payroll/rules\" element={<PayrollRules />} />\r\n                <Route path=\"payroll/process\" element={<ProcessPayroll />} />\r\n                <Route path=\"payroll/run\" element={<RunPayroll />} />\r\n                <Route path=\"payroll/payslips\" element={<Payslips />} />\r\n                <Route path=\"payroll/payslip-design\" element={<PaySlipDesign />} />\r\n\r\n                {/* Settings */}\r\n                <Route path=\"settings/company\" element={<CompanySettings />} />\r\n\r\n                {/* Global inside HR */}\r\n                <Route path=\"details/:entityType/:entityId\" element={<EntityDetail />} />\r\n                <Route path=\"my-requests\" element={<MyRequests />} />\r\n                <Route path=\"face-attendance\" element={<FaceAttendance />} />\r\n            </Route>\r\n\r\n            {/* --- EMPLOYEE / MANAGER ROUTES --- */}\r\n            <Route\r\n                path=\"/employee\"\r\n                element={\r\n                    <ProtectedRoute allowedRoles={['employee', 'manager']}>\r\n                        <EssLayout />\r\n                    </ProtectedRoute>\r\n                }\r\n            >\r\n                <Route index element={<EmployeeDashboard />} />\r\n                <Route path=\"details/:entityType/:entityId\" element={<EntityDetail />} />\r\n                <Route path=\"my-requests\" element={<MyRequests />} />\r\n                <Route path=\"face-attendance\" element={<FaceAttendance />} />\r\n            </Route>\r\n\r\n            <Route path=\"/verify-company/:token\" element={<VerifyCompany />} />\r\n            <Route path=\"*\" element={<NotFound />} />\r\n        </Routes>\r\n    );\r\n}\r\n\r\nfunction AutoHome() {\r\n    const { user, isInitialized } = useAuth();\r\n    if (!isInitialized) return <div className=\"flex items-center justify-center min-h-screen\"><div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div></div>;\r\n    const token = getToken();\r\n    if (!isValidToken(token)) return <Navigate to=\"/login\" replace />;\r\n    if (user?.role === 'hr' || user?.role === 'admin') return <Navigate to=\"/hr\" replace />;\r\n    if (user?.role === 'employee' || user?.role === 'manager') return <Navigate to=\"/employee\" replace />;\r\n    if (user?.role === 'psa') return <Navigate to=\"/psa\" replace />;\r\n    return <Navigate to=\"/login\" replace />;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\router\\index.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\routes\\CandidateProtectedRoute.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\services\\companiesService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\api.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":64,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\r\nimport { jwtDecode } from 'jwt-decode';\r\nimport { getToken, removeToken } from './token';\r\n\r\n/**\r\n * Centralized Axios instance for HRMS SaaS API calls\r\n * Handles authentication, tenant context, and error management\r\n */\r\n\r\n// 1. Get Base URL (Source of Truth: .env)\r\n// Requirement: Must include '/api' (e.g., http://localhost:5000/api)\r\nlet rawBaseUrl = import.meta.env.VITE_API_URL;\r\n\r\n// Safety Fallbacks\r\nif (!rawBaseUrl) {\r\n  rawBaseUrl = import.meta.env.DEV\r\n    ? 'http://localhost:5000/api'\r\n    : 'https://hrms.gitakshmi.com/api';\r\n}\r\n\r\n// Ensure consistency: Remove trailing slash\r\nexport const API_BASE_URL = rawBaseUrl.replace(/\\/+$/, '');\r\n\r\n// 2. Derive API_ROOT (for static assets like images/uploads)\r\n// Removes '/api' from the end\r\nexport const API_ROOT = API_BASE_URL.replace(/\\/api$/, '');\r\n\r\nconsole.log('üåç GLOBAL API CONFIG:', { API_BASE_URL, API_ROOT });\r\n\r\n// Create axios instance with base configuration\r\nconst api = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  timeout: 60000, // Increased to 60 seconds to accommodate heavy operations like PDF generation\r\n});\r\n\r\n/**\r\n * Request Interceptor: Automatically attach JWT token and tenantId\r\n * - Adds Authorization header with Bearer token\r\n * - Decodes JWT to extract tenantId and adds X-Tenant-ID header\r\n * - Ensures all requests include proper authentication and tenant context\r\n */\r\napi.interceptors.request.use((config) => {\r\n  const token = getToken();\r\n  if (token) {\r\n    // Attach JWT token for authentication\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n\r\n    // Decode token to extract tenantId for multi-tenant context\r\n    try {\r\n      const decoded = jwtDecode(token);\r\n      if (decoded.tenantId) {\r\n        config.headers['X-Tenant-ID'] = decoded.tenantId;\r\n      }\r\n    } catch (error) {\r\n      // Log warning but don't fail - some tokens might not have tenantId (e.g., super admin)\r\n      console.warn('Failed to decode token for tenantId:', error.message);\r\n    }\r\n  }\r\n  // If request body is FormData, do not set Content-Type here so the browser can add the correct boundary\r\n  try {\r\n    if (config && config.data && typeof FormData !== 'undefined' && config.data instanceof FormData) {\r\n      if (config.headers) delete config.headers['Content-Type'];\r\n    }\r\n  } catch (e) {\r\n    // ignore\r\n  }\r\n\r\n  return config;\r\n});\r\n\r\n/**\r\n * Response Interceptor: Handle authentication errors and token expiry\r\n * - Automatically removes invalid/expired tokens\r\n * - Does NOT redirect - let React Router handle that\r\n * - Prevents redirect loops\r\n */\r\n\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    // Handle backend unreachable\r\n    if (error.code === 'ERR_NETWORK' || error.message?.includes('Network Error') || error.message?.includes('ERR_CONNECTION_REFUSED')) {\r\n      if (!window.__HRMS_API_ERROR) {\r\n        window.__HRMS_API_ERROR = 'Backend server is not running. Please start the server.';\r\n        if (window.showToast) {\r\n          window.showToast({ message: window.__HRMS_API_ERROR, type: 'error' });\r\n        }\r\n      }\r\n    }\r\n\r\n    if (error.response && error.response.status === 401) {\r\n      // Token invalid/expired - remove it\r\n      removeToken();\r\n      // Remove Authorization header so next request won't have it\r\n      delete api.defaults.headers.common[\"Authorization\"];\r\n      \r\n      // DO NOT redirect here - let ProtectedRoute handle it\r\n      // The app will detect missing token on next render and show login\r\n      console.log('401 Unauthorized - token cleared. ProtectedRoute will redirect.');\r\n    }\r\n\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default api;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\auth.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":30,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":47,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":15},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":78,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":15},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":102,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":102,"endColumn":15}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { jwtDecode } from 'jwt-decode';\r\n\r\nexport const TOKEN_KEY = 'token';\r\nexport const CANDIDATE_KEY = 'candidate';\r\nexport const TENANT_KEY = 'tenantId';\r\n\r\n// --- Core Token Helpers ---\r\n\r\nexport function getToken() {\r\n    return localStorage.getItem(TOKEN_KEY);\r\n}\r\n\r\nexport function setToken(token) {\r\n    if (token) {\r\n        localStorage.setItem(TOKEN_KEY, token);\r\n    }\r\n}\r\n\r\nexport function removeAuth() {\r\n    localStorage.removeItem(TOKEN_KEY);\r\n    localStorage.removeItem(CANDIDATE_KEY);\r\n}\r\n\r\nexport function isTokenValid(token) {\r\n    if (!token) return false;\r\n    try {\r\n        const decoded = jwtDecode(token);\r\n        const currentTime = Date.now() / 1000;\r\n        return decoded.exp > currentTime;\r\n    } catch (error) {\r\n        return false;\r\n    }\r\n}\r\n\r\n// --- Candidate Auth ---\r\n\r\nexport function getCandidate() {\r\n    const token = getToken();\r\n    const candidateStr = localStorage.getItem(CANDIDATE_KEY);\r\n\r\n    if (!token || !isTokenValid(token)) return null;\r\n    if (!candidateStr) return null;\r\n\r\n    try {\r\n        const candidate = JSON.parse(candidateStr);\r\n        return candidate;\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport function isCandidateLoggedIn() {\r\n    const candidate = getCandidate();\r\n    return !!candidate;\r\n}\r\n\r\nexport function logoutCandidate() {\r\n    removeAuth();\r\n    // Optional: Redirect or event emission can be handled by caller\r\n}\r\n\r\nexport function getTenantId() {\r\n    return localStorage.getItem(TENANT_KEY);\r\n}\r\n\r\nexport function setTenantId(id) {\r\n    if (id) {\r\n        localStorage.setItem(TENANT_KEY, id);\r\n        // Also keep 'companyId' in sync for legacy code\r\n        localStorage.setItem('companyId', id);\r\n    }\r\n}\r\n\r\nexport function getCompany() {\r\n    const companyStr = localStorage.getItem('company');\r\n    try {\r\n        return companyStr ? JSON.parse(companyStr) : null;\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport function setCompany(company) {\r\n    if (company) {\r\n        localStorage.setItem('company', JSON.stringify(company));\r\n        if (company.tenantId || company._id) {\r\n            setTenantId(company.tenantId || company._id);\r\n        }\r\n        if (company.code) {\r\n            localStorage.setItem('companyCode', company.code);\r\n        }\r\n    }\r\n}\r\n\r\n// --- Employee/HR Auth (If needed for centralization later) ---\r\n\r\nexport function getUser() {\r\n    const token = getToken();\r\n    if (!token || !isTokenValid(token)) return null;\r\n    try {\r\n        return jwtDecode(token);\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\authDebug.js","messages":[{"ruleId":"no-constant-binary-expression","severity":2,"message":"Unexpected constant truthiness on the left-hand side of a `||` expression.","line":29,"column":53,"nodeType":"Literal","messageId":"constantShortCircuit","endLine":29,"endColumn":65},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":42,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":42,"endColumn":26}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Debug utility to verify authentication setup is correct\r\n * Use in browser console: window.authDebug()\r\n */\r\n\r\nexport function setupAuthDebug() {\r\n  window.authDebug = function () {\r\n    console.group('üîê AUTH DEBUG INFO');\r\n\r\n    // 1. Check token in sessionStorage\r\n    console.group('üì¶ Token Storage');\r\n    const token = sessionStorage.getItem('token');\r\n    console.log('Token exists:', !!token);\r\n    if (token) {\r\n      console.log('Token length:', token.length);\r\n      console.log('Token parts:', token.split('.').length, '(should be 3)');\r\n      console.log('Token value:', token.substring(0, 50) + '...');\r\n\r\n      // Decode payload\r\n      try {\r\n        const payload = JSON.parse(atob(token.split('.')[1]));\r\n        console.log('Decoded payload:', payload);\r\n\r\n        // Check expiry\r\n        if (payload.exp) {\r\n          const expiryDate = new Date(payload.exp * 1000);\r\n          const now = new Date();\r\n          console.log('Expires:', expiryDate.toLocaleString());\r\n          console.log('Expired:', now > expiryDate, '‚ùå EXPIRED!' || '‚úÖ VALID');\r\n        }\r\n      } catch (e) {\r\n        console.error('Token decode error:', e.message);\r\n      }\r\n    } else {\r\n      console.log('‚ö†Ô∏è No token in sessionStorage');\r\n    }\r\n    console.groupEnd();\r\n\r\n    // 2. Check axios headers\r\n    console.group('üîå Axios Headers');\r\n    try {\r\n      const api = require('./api').default;\r\n      const authHeader = api.defaults.headers.common['Authorization'];\r\n      console.log('Authorization header:', authHeader ? 'SET ‚úÖ' : 'NOT SET ‚ùå');\r\n      if (authHeader) {\r\n        console.log('Header value:', authHeader.substring(0, 30) + '...');\r\n      }\r\n    } catch (e) {\r\n      console.error('Could not import api:', e.message);\r\n    }\r\n    console.groupEnd();\r\n\r\n    // 3. Check sessionStorage for tenantId\r\n    console.group('üè¢ Tenant Info');\r\n    const tenantId = sessionStorage.getItem('tenantId');\r\n    console.log('TenantId:', tenantId || 'NOT SET');\r\n    console.groupEnd();\r\n\r\n    // 4. Check URL and auth state\r\n    console.group('üåê Current State');\r\n    console.log('Current URL:', window.location.href);\r\n    console.log('On login page:', window.location.pathname.includes('/login'));\r\n    console.groupEnd();\r\n\r\n    // 5. Recommendations\r\n    console.group('‚úÖ Action Items');\r\n    if (!token) {\r\n      console.log('‚ùå No token - User should login');\r\n    } else if (token.split('.').length !== 3) {\r\n      console.log('‚ùå Invalid token format - Clear sessionStorage and login');\r\n      console.log('sessionStorage.removeItem(\"token\")');\r\n    } else {\r\n      console.log('‚úÖ Token looks valid');\r\n    }\r\n\r\n    if (!sessionStorage.getItem('tenantId')) {\r\n      console.log('‚ö†Ô∏è No tenantId - Multi-tenant features may not work');\r\n    }\r\n    console.groupEnd();\r\n\r\n    console.groupEnd();\r\n  };\r\n\r\n  // Auto-run on first import\r\n  if (typeof window !== 'undefined') {\r\n    window.authDebug();\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\constants.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\dateUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\faceAttendanceUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\payrollFormat.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\storage.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\token.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\baldaniya nitesh\\Github\\frontend\\src\\utils\\uiNotifications.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]